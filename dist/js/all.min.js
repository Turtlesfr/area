function earcut(t,e,i){i=i||2;var n=e&&e.length,r=n?e[0]*i:t.length,s=linkedList(t,0,r,i,!0),a=[];if(!s)return a;var o,c,h,l,u,f,d;if(n&&(s=eliminateHoles(t,e,s,i)),t.length>80*i){o=h=t[0],c=l=t[1];for(var g=i;g<r;g+=i)u=t[g],f=t[g+1],u<o&&(o=u),f<c&&(c=f),u>h&&(h=u),f>l&&(l=f);d=Math.max(h-o,l-c)}return earcutLinked(s,a,i,o,c,d),a}function linkedList(t,e,i,n,r){var s,a;if(r===signedArea(t,e,i,n)>0)for(s=e;s<i;s+=n)a=insertNode(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=insertNode(s,t[s],t[s+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function earcutLinked(t,e,i,n,r,s,a){if(t){!a&&s&&indexCurve(t,n,r,s);for(var o,c,h=t;t.prev!==t.next;)if(o=t.prev,c=t.next,s?isEarHashed(t,n,r,s):isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(c.i/i),removeNode(t),t=c.next,h=c.next;else if((t=c)===h){a?1===a?earcutLinked(t=cureLocalIntersections(t,e,i),e,i,n,r,s,2):2===a&&splitEarcut(t,e,i,n,r,s):earcutLinked(filterPoints(t),e,i,n,r,s,1);break}}}function isEar(t){var e=t.prev,i=t,n=t.next;if(area(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(t,e,i,n){var r=t.prev,s=t,a=t.next;if(area(r,s,a)>=0)return!1;for(var o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,c=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,h=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,l=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=zOrder(o,c,e,i,n),f=zOrder(h,l,e,i,n),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&pointInTriangle(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&pointInTriangle(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function cureLocalIntersections(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!equals(r,s)&&intersects(r,n,n.next,s)&&locallyInside(r,s)&&locallyInside(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),removeNode(n),removeNode(n.next),n=t=s),n=n.next}while(n!==t);return n}function splitEarcut(t,e,i,n,r,s){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&isValidDiagonal(a,o)){var c=splitPolygon(a,o);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,e,i,n,r,s),void earcutLinked(c,e,i,n,r,s)}o=o.next}a=a.next}while(a!==t)}function eliminateHoles(t,e,i,n){var r,s,a,o=[];for(r=0,s=e.length;r<s;r++)(a=linkedList(t,e[r]*n,r<s-1?e[r+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),o.push(getLeftmost(a));for(o.sort(compareX),r=0;r<o.length;r++)eliminateHole(o[r],i),i=filterPoints(i,i.next);return i}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=findHoleBridge(t,e)){var i=splitPolygon(e,t);filterPoints(i,i.next)}}function findHoleBridge(t,e){var i,n=e,r=t.x,s=t.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&o>a){if(a=o,o===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i.prev;var c,h=i,l=i.x,u=i.y,f=1/0;for(n=i.next;n!==h;)r>=n.x&&n.x>=l&&r!==n.x&&pointInTriangle(s<u?r:a,s,l,u,s<u?a:r,s,n.x,n.y)&&((c=Math.abs(s-n.y)/(r-n.x))<f||c===f&&n.x>i.x)&&locallyInside(n,t)&&(i=n,f=c),n=n.next;return i}function indexCurve(t,e,i,n){var r=t;do{null===r.z&&(r.z=zOrder(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,sortLinked(r)}function sortLinked(t){var e,i,n,r,s,a,o,c,h=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ);e++);for(c=h;o>0||c>0&&n;)0!==o&&(0===c||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,c--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(a>1);return t}function zOrder(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function getLeftmost(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,n){return!!(equals(t,e)&&equals(i,n)||equals(t,n)&&equals(i,e))||area(t,e,i)>0!=area(t,e,n)>0&&area(i,n,t)>0!=area(i,n,e)>0}function intersectsPolygon(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function middleInside(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}function splitPolygon(t,e){var i=new Node(t.i,t.x,t.y),n=new Node(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function insertNode(t,e,i,n){var r=new Node(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,i,n){for(var r=0,s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}function copyGLTo2DDrawImage(t,e){var i=t.canvas,n=e.getContext("2d");n.translate(0,e.height),n.scale(1,-1);var r=i.height-e.height;n.drawImage(i,0,r,e.width,e.height,0,0,e.width,e.height)}function copyGLTo2DPutImageData(t,e){var i=e.getContext("2d"),n=e.width,r=e.height,s=n*r*4,a=new Uint8Array(this.imageBuffer,0,s),o=new Uint8ClampedArray(this.imageBuffer,0,s);t.readPixels(0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,a);var c=new ImageData(o,n);i.putImageData(c,0,0)}function downloadCanvas(t,e,i){t.href=document.getElementById(e).toDataURL(),t.download=i}function createEchelle(){var t=new Path.Line(point_echelle_left,point_echelle_right);t.strokeColor="#000000",t.strokeWidth=6;var e=new Path.Line(point_echelle_left,point_echelle_right);e.strokeColor="white",e.strokeWidth=3,e.dashArray=[8,10];var i=new Path({segments:[point_echelle_left+new Point(0,-10),point_echelle_left+new Point(0,10)]}),n=new Path({segments:[point_echelle_right+new Point(0,-10),point_echelle_right+new Point(0,10)]});i.strokeColor="black",i.strokeWidth=5,n.strokeColor="black",n.strokeWidth=5;var r=point_echelle_left-point_echelle_right,s=new PointText(point_echelle_right+r/2-new Point(0,-7)),a=new PointText(point_echelle_right+r/2-new Point(0,-7));a.sendToBack(),s.fillColor="white",a.fillColor="black",s.justification=a.justification="center",s.strokeWidth=7,s.strokeColor="white",s.fontSize=a.fontSize=20,s.fontWeight=a.fontWeight="bold",s.content=a.content=(r.length/ratio).toFixed(2);var o=(i.segments[1].point-i.segments[0].point)*handle_extension_ratio,c=new Path({segments:[point_echelle_left+new Point(0,10),point_echelle_left+o]});c.position=i.position;n.segments[1].point,n.segments[0].point;var h=new Path({segments:[point_echelle_right+new Point(0,10),point_echelle_right+o]});h.position=n.position,c.strokeColor=h.strokeColor="grey",c.stokeWidth=h.stokeWidth=5,c.dashArray=h.dashArray=[4,4],$("#ratio-input").val((r.length/ratio).toFixed(2)),echelle.addChild(c),echelle.addChild(h),echelle.addChild(t),echelle.addChild(e),echelle.addChild(i),echelle.addChild(n),echelle.addChild(s),echelle.addChild(a),echelle.transformContent=!1,echelle.position=view.center/2,i.attach("mouseenter",function(){$("#myCanvas").css("cursor","pointer"),this.strokeWidth=7}),n.attach("mouseenter",function(){$("#myCanvas").css("cursor","pointer"),this.strokeWidth=7}),i.attach("mouseleave",function(){$("#myCanvas").css("cursor","default"),this.strokeWidth=5}),n.attach("mouseleave",function(){$("#myCanvas").css("cursor","default"),this.strokeWidth=5}),a.attach("mouseenter",function(){$("#myCanvas").css("cursor","move")}),a.attach("mouseleave",function(){$("#myCanvas").css("cursor","default")}),i.attach("mousedrag",function(t){i.position+=t.delta,updateEchelle()}),n.attach("mousedrag",function(t){n.position+=t.delta,updateEchelle()}),i.attach("mousedown",function(t){cursorDown=!0}),i.attach("mouseup",function(t){cursorDown=!1}),n.attach("mousedown",function(t){cursorDown=!0}),n.attach("mouseup",function(t){cursorDown=!1}),a.attach("mousedown",function(t){cursorDown=!0}),a.attach("mouseup",function(t){cursorDown=!1}),a.attach("mousedrag",function(t){echelle.position+=t.delta})}function updateEchelle(){echelle.children[2].segments[0].point=echelle.children[4].position,echelle.children[2].segments[1].point=echelle.children[5].position,echelle.children[3].segments[0].point=echelle.children[4].position,echelle.children[3].segments[1].point=echelle.children[5].position;var t=echelle.children[4].position-echelle.children[5].position;echelle.children[6].position=new Point(echelle.children[5].position+t/2-new Point(0,0)),echelle.children[6].content=(t.length*ratio).toFixed(2),echelle.children[7].position=new Point(echelle.children[5].position+t/2-new Point(0,0)),echelle.children[7].content=(t.length*ratio).toFixed(2),echelle.children[4].rotate(t.angle-lastRotationLeftHandle-180),echelle.children[5].rotate(t.angle-lastRotationRightHandle-180),echelle.children[0].position=echelle.children[4].position,echelle.children[0].rotate(t.angle-lastRotationLeftHandle-180),echelle.children[1].position=echelle.children[5].position,echelle.children[1].rotate(t.angle-lastRotationRightHandle-180),lastRotationLeftHandle=t.angle-180,lastRotationRightHandle=t.angle-180,$("#ratio-input").val((t.length*ratio).toFixed(2))}function addSurface(){var t=Math.random().toString(36).substring(7),e=new Surface(t);surfaces.push(e),createLabels(e.path,t);var i="<div class='surface-box "+t+"'><div class='surface-box-bg' style='background-color:"+colors[colorIndex-1]+"'></div><div class='surface-box-content'><span class='span-delete-surface'><a href='' title='"+t+"' class='delete-surface'><i class='fa fa-trash-o'></i>&nbsp; Supprimer</a></span><span class='span-surface-size "+t+"'></span></div></div>";$("#surface-list").append(i),$(".delete-surface").click(function(t){t.preventDefault(),elementIdentifier=$(this).attr("title");var e=$.grep(surfaces,function(t){return t.nom===elementIdentifier})[0];e.path.remove();var i=$.inArray(e,surfaces);surfaces.splice(i,1),destroyLabels(elementIdentifier),$(this).parent().parent().parent().remove(),updateTotalSurfaceCount()}),refreshAreas(calculateAreas(e.path),e.path),updateTotalSurfaceCount()}function createLabels(t,e){segment_length=t.segments.length;for(var i=[],n=-1;n<=segment_length-2;n++){var r;if(-1==n){s=t.segments[segment_length-1].point-t.segments[n+1].point;r=new PointText(t.segments[n+1].point+s/2)}else{var s=t.segments[n+1].point-t.segments[n].point;r=new PointText(t.segments[n].point+s/2)}r.name=e,r.sendToBack(),r.fillColor="black",r.justification="center",r.content=(s.length/ratio).toFixed(2),i.push(r),r.attach("mouseenter",function(t){$("#myCanvas").css("cursor","pointer")}),r.attach("mouseleave",function(t){$("#myCanvas").css("cursor","default")}),r.attach("mousedrag",function(e){t.position+=e.delta}),r.attach("doubleclick",function(t){labelDoubleClicked=t.target;var e=t.target.name,i=labels[e].indexOf(t.target),n=$.grep(surfaces,function(t){return t.nom===e})[0];selectedSurfaceThroughLabel=n,i==n.path.segments.length-1?(labelPointA=n.path.segments[i],labelPointB=n.path.segments[0]):(labelPointA=n.path.segments[i],labelPointB=n.path.segments[i+1]),$("#new_size_input").val(null),$("#new_size_input").attr("placeholder",t.target.content),$("#modal_container").fadeIn("fast",function(){$("#new_size_input").focus()})})}labels[e]=i,updateLabels(t)}function resizeLineLength(t){var e=labelPointB.point-labelPointA.point,i=t/(e=labelPointA.point-labelPointB.point).length/ratio;labelPointB.point=labelPointA.point-e*i,updateLabels(selectedSurfaceThroughLabel.path)}function updateLabels(t){var e;if(e=t||globalScopeElement)for(var i=e.segments.length,n=(e.position,new Point(0,20),new Point(0,0),-1);n<=i-2;n++){var r;if(-1==n){r=(s=e.segments[i-1].point-e.segments[n+1].point).length;a=e.segments[n+1].point+s/2;(o=s).length=20,o.angle+=90,labels[e.name][i-1].position=a+o,labels[e.name][i-1].content=(r*ratio).toFixed(2)}else{var s=e.segments[n+1].point-e.segments[n].point;r=s.length;var a=e.segments[n].point+s/2,o=s;o.length=20,o.angle-=90,labels[e.name][n].position=a+o,labels[e.name][n].content=(r*ratio).toFixed(2)}}}function destroyLabels(t){arrayLength=labels[t].length;for(var e=0;e<arrayLength;e++)labels[t][e].remove()}function recreateLabels(t,e){destroyLabels(e),createLabels(t,e)}function checkStatus(t){t&&(classSelectedItem=event.className)}function drawTriangle(t,e){coords1=e.segments[t[0]],coords2=e.segments[t[1]],coords3=e.segments[t[2]];var i=new Path;i.add(coords1),i.add(coords2),i.add(coords3),i.closed=!0,i.fillColor="#dedede",i.isDraggable=!1,i.strokeColor="black",i.opacity=.5,i.sendToBack(),trianglesGroup.sendToBack(),trianglesGroup.addChild(i)}function destroyTempTriangles(){for(var t=0;t<trianglesGroup.length;t++)trianglesGroup[t].remove();trianglesGroup.removeChildren()}function refreshAreas(t,e){for(var i=0,n=0;n<t.length;n+=iTri)i+=heron((e.segments[t[n+1]].point-e.segments[t[n]].point).length,(e.segments[t[n+2]].point-e.segments[t[n+1]].point).length,(e.segments[t[n]].point-e.segments[t[n+2]].point).length),debug&&drawTriangle(new Array(t[n],t[n+1],t[n+2]),e);debug&&(delayedTrianglesDestruction=window.setTimeout(destroyTempTriangles,5e3)),$("span."+e.name).text(Math.round(100*i)/100)}function heron(t,e,i){var n=((t*=ratio)+(e*=ratio)+(i*=ratio))/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))/1e4}function calculateAreas(t){if(t){for(var e=t.segments.length,i=[],n=0;n<e;n++){var r=Math.round(100*t.segments[n].point.x)/100,s=Math.round(100*t.segments[n].point.y)/100;i.push(r),i.push(s)}return earcut(i)}updateTotalSurfaceCount()}function resizeCanvas(){canvas.setHeight(window.innerHeight),canvas.setWidth(window.innerWidth),canvas.renderAll()}function loadSpecificPdfPage(t){pdfObj.getPage(parseInt(t)).then(function(t){var e=t.getViewport(1.5),i=canvas_pdf.getContext("2d");canvas_pdf.height=e.height,canvas_pdf.width=e.width;var n={canvasContext:i,viewport:e};t.render(n).promise.then(function(){fabric.Image.fromURL(canvas_pdf.toDataURL(),function(t){var e=1;t.height>canvas_pdf.height&&(e=canvas_pdf.height/t.height),t.width*e>canvas_pdf.width&&(e=canvas_pdf.width/t.width),e-=.2;var i=t.set({left:canvas.width/2,top:canvas.height/2,angle:0,width:t.width,height:t.height,originX:"center",originY:"center",centeredScaling:!0}).scale(e);canvas.add(i).renderAll();canvas.setActiveObject(i),canvas.toDataURL({format:"png",quality:.8})}),i.clearRect(0,0,canvas.width,canvas.height)})})}function bringToFront(t){var e,i;switch(t){case"canvas-draw":fabric.Object.prototype.setControlsVisibility({mt:!1,mb:!1,tl:!1,tr:!1,bl:!1,br:!1}),i=$(".canvas-container"),e=$("#myCanvas"),$("#box-mesures").show(),$("#box-surfaces").show(),$("#box-download").show();break;case"canvas-plan":e=$(".canvas-container"),i=$("#myCanvas"),$("#box-mesures").hide(),$("#box-surfaces").hide(),$("#box-download").hide()}e.css("z-index",3e3),e.css("opacity",1),i.css("z-index",1e3),i.css("opacity",.5)}function updateTotalSurfaceCount(){var t=0;$.each($(".span-surface-size"),function(e,i){console.log($(this).text()),t+=Number($(this).text())}),t>0?($(".surface-totale span").text(t.toFixed(2)),$(".surface-totale").show()):$(".surface-totale").hide()}var paper=function(t,e){var i=(t=t||require("./node/self.js")).window,n=t.document,r=new function(){function t(t,e,r,s,a){function h(n,h){"string"==typeof(h=h||(h=o(e,n))&&(h.get?h:h.value))&&"#"===h[0]&&(h=t[h.substring(1)]||h);var u,f="function"==typeof h,d=h,g=a||f&&!h.base?h&&h.get?n in t:t[n]:null;a&&g||(f&&g&&(h.base=g),f&&!1!==s&&(u=n.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[u[3].toLowerCase()+u[4]]=u[2]),d&&!f&&d.get&&"function"==typeof d.get&&i.isPlainObject(d)||(d={value:d,writable:!0}),(o(t,n)||{configurable:!0}).configurable&&(d.configurable=!0,d.enumerable=null!=r?r:!u),c(t,n,d))}var l={};if(e){for(var u in e)e.hasOwnProperty(u)&&!n.test(u)&&h(u);for(var u in l){var f=l[u],d=t["set"+f],g=t["get"+f]||d&&t["is"+f];!g||!0!==s&&0!==g.length||h(u,{get:g,set:d})}}return t}function i(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&u(this,i)}return this}var n=/^(statics|enumerable|beans|preserve)$/,r=[],s=r.slice,a=Object.create,o=Object.getOwnPropertyDescriptor,c=Object.defineProperty,h=r.forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},l=function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)},u=Object.assign||function(t){for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t},f=function(t,e,i){if(t){var n=o(t,"length");(n&&"number"==typeof n.value?h:l).call(t,e,i=i||t)}return i};return t(i,{inject:function(e){if(e){var i=!0===e.statics?e:e.statics,n=e.beans,r=e.preserve;i!==e&&t(this.prototype,e,e.enumerable,n,r),t(this,i,null,n,r)}for(var s=1,a=arguments.length;s<a;s++)this.inject(arguments[s]);return this},extend:function(){for(var e,i,n,r=this,s=0,o=arguments.length;s<o&&(!e||!i);s++)n=arguments[s],e=e||n.initialize,i=i||n.prototype;return e=e||function(){r.apply(this,arguments)},i=e.prototype=i||a(this.prototype),c(i,"constructor",{value:e,writable:!0,configurable:!0}),t(e,this),arguments.length&&this.inject.apply(e,arguments),e.base=r,e}}).inject({enumerable:!1,initialize:i,set:i,inject:function(){for(var e=0,i=arguments.length;e<i;e++){var n=arguments[e];n&&t(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=a(this);return t.inject.apply(t,arguments)},each:function(t,e){return f(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:u,each:f,create:a,define:c,describe:o,clone:function(t){return u(new t.constructor,t)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===i||"Object"===e.name)},pick:function(t,i){return t!==e?t:i},slice:function(t,e,i){return s.call(t,e,i)}}})};"undefined"!=typeof module&&(module.exports=r),r.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?c.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},set:function(t,e){return t&&r.filter(this,t,e,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function t(){var e=t.base.apply(this,arguments),i=e.prototype._class;return i&&!r.exports[i]&&(r.exports[i]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((n=t.length)!==e.length)return!1;for(;n--;)if(!r.equals(t[n],e[n]))return!1}else{var i=Object.keys(t),n=i.length;if(n!==Object.keys(e).length)return!1;for(;n--;){var s=i[n];if(!e.hasOwnProperty(s)||!r.equals(t[s],e[s]))return!1}}return!0}return!1},read:function(t,i,n,s){if(this===r){var a=this.peek(t,i);return t.__index++,a}var o=this.prototype,c=o._readIndex,h=i||c&&t.__index||0,l=t.length,u=t[h];if(s=s||l-h,u instanceof this||n&&n.readNull&&null==u&&s<=1)return c&&(t.__index=h+1),u&&n&&n.clone?u.clone():u;if(u=r.create(o),c&&(u.__read=!0),u=u.initialize.apply(u,h>0||h+s<l?r.slice(t,h,h+s):t)||u,c){t.__index=h+u.__read;var f=u.__filtered;f&&(t.__filtered=f,u.__filtered=e),u.__read=e}return u},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,i,n){for(var r,s=[],a=e||0,o=n?a+n:t.length,c=a;c<o;c++)s.push(Array.isArray(r=t[c])?this.read(r,0,i):this.read(t,c,i,1));return s},readNamed:function(t,i,n,s,a){var o=this.getNamed(t,i),c=o!==e;if(c){var h=t.__filtered;h||((h=t.__filtered=r.create(t[0])).__unfiltered=t[0]),h[i]=e}var l=c?[o]:t;return this.read(l,n,s,a)},getNamed:function(t,i){var n=t[0];if(t._hasObject===e&&(t._hasObject=1===t.length&&r.isPlainObject(n)),t._hasObject)return i?n[i]:t.__filtered||n},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,i,n,r){function s(r){if(!(n&&r in n||a&&r in a)){var s=i[r];s!==e&&(t[r]=s)}}var a;if(r){for(var o,c={},h=0,l=r.length;h<l;h++)(o=r[h])in i&&(s(o),c[o]=!0);a=c}return Object.keys(i.__unfiltered||i).forEach(s),t},isPlainValue:function(t,e){return r.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var s,a=!n;if(a&&(e.formatter=new c(e.precision),n={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),s=t._class;s&&r[0]!==s&&r.unshift(s),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){s=t._serialize(e,n);var o=t._class;!o||t._compactSerialize||!a&&i||s[0]===o||s.unshift(o)}else if(Array.isArray(t)){s=[];for(var h=0,l=t.length;h<l;h++)s[h]=r.serialize(t[h],e,i,n)}else if(r.isPlainObject(t)){s={};for(var u=Object.keys(t),h=0,l=u.length;h<l;h++){var f=u[h];s[f]=r.serialize(t[f],e,i,n)}}else s="number"==typeof t?e.formatter.number(t,e.precision):t;return a&&n.length>0?[["dictionary",n.definitions],s]:s},deserialize:function(t,e,i,n,s){var a=t,o=!i,c=o&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var h=t[0],l="dictionary"===h;if(1==t.length&&/^#/.test(h))return i.dictionary[h];a=[];for(var u=(h=r.exports[h])?1:0,f=t.length;u<f;u++)a.push(r.deserialize(t[u],e,i,l,c));if(h){var d=a;e?a=e(h,d,o||s):(a=r.create(h.prototype),h.apply(a,d))}}else if(r.isPlainObject(t)){a={},n&&(i.dictionary=a);for(var g in t)a[g]=r.deserialize(t[g],e,i)}return c?a[1]:a},exportJSON:function(t,e){var i=r.serialize(t,e);return e&&0==e.asString?i:JSON.stringify(i)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,n){var s=n&&e&&e.constructor===t,a=s?e:r.create(t.prototype);if(1===i.length&&a instanceof y&&(s||!(a instanceof w))){var o=i[0];r.isPlainObject(o)&&(o.insert=!1)}return(s?a.set:t).apply(a,i),s&&(e=null),a})},splice:function(t,i,n,r){var s=i&&i.length,a=n===e;(n=a?t.length:n)>t.length&&(n=t.length);for(h=0;h<s;h++)i[h]._index=n+h;if(a)return t.push.apply(t,i),[];var o=[n,r];i&&o.push.apply(o,i);for(var c=t.splice.apply(t,o),h=0,l=c.length;h<l;h++)c[h]._index=e;for(var h=n+s,l=t.length;h<l;h++)t[h]._index=h;return c},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var s={on:function(t,e){if("string"!=typeof t)r.each(t,function(t,e){this.on(e,t)},this);else{var i=this._eventTypes,n=i&&i[t],s=this._callbacks=this._callbacks||{};-1===(s=s[t]=s[t]||[]).indexOf(e)&&(s.push(e),n&&n.install&&1===s.length&&n.install.call(this,t))}return this},off:function(t,e){if("string"==typeof t){var i,n=this._eventTypes,s=n&&n[t],a=this._callbacks&&this._callbacks[t];return a&&(!e||-1!==(i=a.indexOf(e))&&1===a.length?(s&&s.uninstall&&s.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&a.splice(i,1)),this}r.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=r.slice(arguments,1),s=e&&e.target&&!e.currentTarget;i=i.slice(),s&&(e.currentTarget=this);for(var a=0,o=i.length;a<o;a++)if(0==i[a].apply(this,n)){e&&e.stop&&e.stop();break}return s&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)if(i[r].length>0){var s=e[r],a=s&&s[n];a&&a.call(this,r)}},statics:{inject:function t(e){var i=e._events;if(i){var n={};r.each(i,function(t,i){var s="string"==typeof t,a=s?t:i,o=r.capitalize(a),c=a.substring(2).toLowerCase();n[c]=s?{}:t,a="_"+a,e["get"+o]=function(){return this[a]},e["set"+o]=function(t){var e=this[a];e&&this.off(c,e),t&&this.on(c,t),this[a]=t}}),e._eventTypes=n}return t.base.apply(this,arguments)}}},a=r.extend({_class:"PaperScope",initialize:function e(){paper=this,this.settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var n=tt.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:et.nativeModes},tt.release(n)}if(!this.agent){var s=t.navigator.userAgent.toLowerCase(),a=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(s)||[])[0],o="darwin"===a?"mac":a,c=i.agent=i.browser={platform:o};o&&(c[o]=!0),s.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,i,n,r){if(!c.chrome){var s="opera"===e?n:/^(node|trident)$/.test(e)?r:i;c.version=s,c.versionNumber=parseFloat(s),e="trident"===e?"msie":e,c.name=e,c[e]=!0}}),c.chrome&&delete c.webkit,c.atom&&delete c.chrome}},version:"0.11.4",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){paper.PaperScript.execute(t,this,e),V.updateFocus()},install:function(t){var e=this;r.each(["project","view","tool"],function(i){r.define(t,i,{configurable:!0,get:function(){return e[i]}})});for(var i in this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return paper=this,this.project=new b(t),this},createCanvas:function(t,e){return tt.getCanvas(t,e)},activate:function(){paper=this},clear:function(){for(var t=this.projects,e=this.tools,i=t.length-1;i>=0;i--)t[i].remove();for(i=e.length-1;i>=0;i--)e[i].remove()},remove:function(){this.clear(),delete a._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),o=r.extend(s,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),c=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});c.instance=new c;var h=new function(){function t(t,e,i){return t<e?e:t>i?i:t}function e(t,e,i){function n(t){var e=134217729*t,i=t-e+e;return[i,t-i]}var r=e*e-t*i,a=e*e+t*i;if(3*s(r)<a){var o=n(t),c=n(e),h=n(i),l=e*e,u=t*i;r=l-u+(c[0]*c[0]-l+2*c[0]*c[1]+c[1]*c[1]-(o[0]*h[0]-u+o[0]*h[1]+o[1]*h[0]+o[1]*h[1]))}return r}function i(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?o(2,-Math.round(c(t))):0}var n=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],r=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],s=Math.abs,a=Math.sqrt,o=Math.pow,c=Math.log2||function(t){return Math.log(t)*Math.LOG2E};return{EPSILON:1e-12,MACHINE_EPSILON:1.12e-16,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(a(2)-1)/3,isZero:function(t){return t>=-1e-12&&t<=1e-12},clamp:t,integrate:function(t,e,i,s){for(var a=n[s-2],o=r[s-2],c=.5*(i-e),h=c+e,l=0,u=s+1>>1,f=1&s?o[l++]*t(h):0;l<u;){var d=c*a[l];f+=o[l++]*(t(h+d)+t(h-d))}return c*f},findRoot:function(e,i,n,r,a,o,c){for(var h=0;h<o;h++){var l=e(n),u=l/i(n),f=n-u;if(s(u)<c){n=f;break}l>0?(a=n,n=f<=r?.5*(r+a):f):(r=n,n=f>=a?.5*(r+a):f)}return t(n,r,a)},solveQuadratic:function(n,r,o,c,h,l){var u,f=1/0;if(s(n)<1e-12){if(s(r)<1e-12)return s(o)<1e-12?-1:0;u=-o/r}else{var d=e(n,r*=-.5,o);if(d&&s(d)<1.12e-16){var g=i(s(n),s(r),s(o));g&&(d=e(n*=g,r*=g,o*=g))}if(d>=-1.12e-16){var p=d<0?0:a(d),v=r+(r<0?-p:p);0===v?f=-(u=o/n):(u=v/n,f=o/v)}}var m=0,_=null==h,b=h-1e-12,y=l+1e-12;return isFinite(u)&&(_||u>b&&u<y)&&(c[m++]=_?u:t(u,h,l)),f!==u&&isFinite(f)&&(_||f>b&&f<y)&&(c[m++]=_?f:t(f,h,l)),m},solveCubic:function(e,n,r,c,l,u,f){function d(t){var i=e*(g=t);m=(i+(p=i+n))*g+(v=p*g+r),_=v*g+c}var g,p,v,m,_,b=i(s(e),s(n),s(r),s(c));if(b&&(e*=b,n*=b,r*=b,c*=b),s(e)<1e-12)e=n,p=r,v=c,g=1/0;else if(s(c)<1e-12)p=n,v=r,g=0;else{d(-n/e/3);var y=_/e,x=o(s(y),1/3),w=y<0?-1:1,C=-m/e,A=C>0?1.324717957244746*Math.max(x,a(C)):x,S=g-w*A;if(S!==g){do{d(S),S=0===m?g:g-_/m/(1+1.12e-16)}while(w*S>w*g);s(e)*g*g>s(c/g)&&(p=((v=-c/g)-r)/g)}}var T=h.solveQuadratic(e,p,v,l,u,f),k=null==u;return isFinite(g)&&(0===T||T>0&&g!==l[0]&&g!==l[1])&&(k||g>u-1e-12&&g<f+1e-12)&&(l[T++]=k?g:t(g,u,f)),T}}},l={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},u=r.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var a="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"x"in a?this._set(a.x||0,a.y||0):"width"in a?this._set(a.width||0,a.height||0):"angle"in a?(this._set(a.length||0,0),this.setAngle(a.angle||0)):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new u(this.x,this.y)},toString:function(){var t=c.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();h.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=u.read(arguments),e=this.getLength()*t.getLength();if(h.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=u.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=u.read(arguments),e=t.x-this.x,i=t.y-this.y,n=e*e+i*i;return r.read(arguments)?n:Math.sqrt(n)},normalize:function(t){t===e&&(t=1);var i=this.getLength(),n=0!==i?t/i:0,r=new u(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new u(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=u.read(arguments);return new u(this.x+t.x,this.y+t.y)},subtract:function(){var t=u.read(arguments);return new u(this.x-t.x,this.y-t.y)},multiply:function(){var t=u.read(arguments);return new u(this.x*t.x,this.y*t.y)},divide:function(){var t=u.read(arguments);return new u(this.x/t.x,this.y/t.y)},modulo:function(){var t=u.read(arguments);return new u(this.x%t.x,this.y%t.y)},negate:function(){return new u(-this.x,-this.y)},isInside:function(){return p.read(arguments).contains(this)},isClose:function(){var t=u.read(arguments),e=r.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=u.read(arguments);return u.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=u.read(arguments);return u.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=h.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=u.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=u.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=u.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new u(t.x*e,t.y*e)},statics:{min:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=u.read(arguments),e=u.read(arguments);return new u(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new u(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new u(e(this.x),e(this.y))}},{})),f=u.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),d=r.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var a="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"width"in a?this._set(a.width||0,a.height||0):"x"in a?this._set(a.x||0,a.y||0):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new d(this.width,this.height)},toString:function(){var t=c.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=d.read(arguments);return new d(this.width+t.width,this.height+t.height)},subtract:function(){var t=d.read(arguments);return new d(this.width-t.width,this.height-t.height)},multiply:function(){var t=d.read(arguments);return new d(this.width*t.width,this.height*t.height)},divide:function(){var t=d.read(arguments);return new d(this.width/t.width,this.height/t.height)},modulo:function(){var t=d.read(arguments);return new d(this.width%t.width,this.height%t.height)},negate:function(){return new d(-this.width,-this.height)},isZero:function(){var t=h.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new d(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new d(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new d(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new d(e(this.width),e(this.height))}},{})),g=d.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),p=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,i,n,s){var a,o=typeof t;if("number"===o?(this._set(t,i,n,s),a=4):"undefined"===o||null===t?(this._set(0,0,0,0),a=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),a=1):t.x!==e||t.width!==e?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),a=1):t.from===e&&t.to===e&&(this._set(0,0,0,0),r.filter(this,t),a=1)),a===e){var c,h,l=u.readNamed(arguments,"from"),f=r.peek(arguments),g=l.x,p=l.y;if(f&&f.x!==e||r.hasNamed(arguments,"to")){var v=u.readNamed(arguments,"to");c=v.x-g,h=v.y-p,c<0&&(g=v.x,c=-c),h<0&&(p=v.y,h=-h)}else{var m=d.read(arguments);c=m.width,h=m.height}this._set(g,p,c,h),a=arguments.__index;var _=arguments.__filtered;_&&(this.__filtered=_)}return this.__read&&(this.__read=a),this},set:"#initialize",_set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new p(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?p.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=c.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?u:f)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?d:g)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var t=d.read(arguments),e=this._sx,i=this._sy,n=t.width,r=t.height;e&&(this.x+=(this.width-n)*e),i&&(this.y+=(this.height-r)*i),this.width=n,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fw){var e=t-this.x;this.width-=.5===this._sx?2*e:e}this.x=t,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(t){if(!this._fh){var e=t-this.y;this.height-=.5===this._sy?2*e:e}this.y=t,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(t){if(!this._fw){var e=t-this.x;this.width=.5===this._sx?2*e:e}this.x=t-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(t){if(!this._fh){var e=t-this.y;this.height=.5===this._sy?2*e:e}this.y=t-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(t){this._fw||.5===this._sx?this.x=t-this.width/2:(this._sx&&(this.x+=2*(t-this.x)*this._sx),this.width=2*(t-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(t){this._fh||.5===this._sy?this.y=t-this.height/2:(this._sy&&(this.y+=2*(t-this.y)*this._sy),this.height=2*(t-this.y)),this._sy=.5,this._fh=0},getCenter:function(t){return new(t?u:f)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=u.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(p.read(arguments)):this._containsPoint(u.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=p.read(arguments),e=r.read(arguments)||0;return t.x+t.width>this.x-e&&t.y+t.height>this.y-e&&t.x<this.x+this.width+e&&t.y<this.y+this.height+e},intersect:function(){var t=p.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new p(e,i,n-e,r-i)},unite:function(){var t=p.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new p(e,i,n-e,r-i)},include:function(){var t=u.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new p(e,i,n-e,r-i)},expand:function(){var t=d.read(arguments),e=t.width,i=t.height;return new p(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,i){return this.expand(this.width*t-this.width,this.height*(i===e?t:i)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],s=t[n?1:0],a="get"+r,o="get"+s,c="set"+r,h="set"+s,l="set"+i;this["get"+i]=function(t){return new(t?u:f)(this[a](),this[o](),this,l)},this[l]=function(){var t=u.read(arguments);this[c](t.x),this[h](t.y)}},{beans:!0})),v=p.extend({initialize:function(t,e,i,n,r,s){this._set(t,e,i,n,!0),this._owner=r,this._setter=s},_set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=p.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e._changeSelection&&e._changeSelection(2,t)}}))}),m=r.extend({_class:"Matrix",initialize:function t(e,i){var n=arguments.length,r=!0;if(n>=6?this._set.apply(this,arguments):1===n||2===n?e instanceof t?this._set(e._a,e._b,e._c,e._d,e._tx,e._ty,i):Array.isArray(e)?this._set.apply(this,i?e.concat([i]):e):r=!1:n?r=!1:this.reset(),!r)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,i,n,r,s,a){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=s,a||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new m(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=c.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,!0,r.pick(t,!0),e),this.isIdentity())},translate:function(){var t=u.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._c,this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=u.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),s=Math.sin(t),a=i-i*r+n*s,o=n-i*s-n*r,c=this._a,h=this._b,l=this._c,f=this._d;return this._a=r*c+s*l,this._b=r*h+s*f,this._c=-s*c+r*l,this._d=-s*h+r*f,this._tx+=a*c+o*l,this._ty+=a*h+o*f,this._changed(),this},shear:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=u.read(arguments),e=u.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new u(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},append:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,s=this._d,a=t._a,o=t._c,c=t._b,h=t._d,l=t._tx,u=t._ty;this._a=a*i+c*r,this._c=o*i+h*r,this._b=a*n+c*s,this._d=o*n+h*s,this._tx+=l*i+u*r,this._ty+=l*n+u*s,e||this._changed()}return this},prepend:function(t,e){if(t){var i=this._a,n=this._b,r=this._c,s=this._d,a=this._tx,o=this._ty,c=t._a,h=t._c,l=t._b,u=t._d,f=t._tx,d=t._ty;this._a=c*i+h*n,this._c=c*r+h*s,this._b=l*i+u*n,this._d=l*r+u*s,this._tx=c*a+h*o+f,this._ty=l*a+u*o+d,e||this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,s=this._ty,a=t*n-e*i,o=null;return a&&!isNaN(a)&&isFinite(r)&&isFinite(s)&&(this._a=n/a,this._b=-e/a,this._c=-i/a,this._d=t/a,this._tx=(i*s-n*r)/a,this._ty=(e*r-t*s)/a,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new m(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(u.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new u),e._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var s=t[n],a=t[n+1];e[n]=s*this._a+a*this._c+this._tx,e[n+1]=s*this._b+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,s=[e,i,n,i,n,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),s=r.slice(),a=2;a<8;a++){var o=n[a],c=1&a;o<r[c]?r[c]=o:o>s[c]&&(s[c]=o)}return e||(e=new p),e._set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(u.read(arguments))},_inverseTransform:function(t,e,i){var n=this._a,r=this._b,s=this._c,a=this._d,o=this._tx,c=this._ty,h=n*a-r*s,l=null;if(h&&!isNaN(h)&&isFinite(o)&&isFinite(c)){var f=t.x-this._tx,d=t.y-this._ty;e||(e=new u),l=e._set((f*a-d*s)/h,(d*n-f*r)/h,i)}return l},decompose:function(){var t,e,i,n=this._a,r=this._b,s=this._c,a=this._d,o=n*a-r*s,c=Math.sqrt,h=Math.atan2,l=180/Math.PI;if(0!==n||0!==r){var f=c(n*n+r*r);t=Math.acos(n/f)*(r>0?1:-1),e=[f,o/f],i=[h(n*s+r*a,f*f),0]}else if(0!==s||0!==a){var d=c(s*s+a*a);t=Math.asin(s/d)*(a>0?1:-1),e=[o/d,d],i=[0,h(n*s+r*a,d*d)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*l,scaling:new u(e),skewing:new u(i[0]*l,i[1]*l)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new u(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),_=r.extend({_class:"Line",initialize:function(t,e,i,n,r){var s=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,s=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=i),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new u(this._px,this._py)},getVector:function(){return new u(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return _.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return _.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(this.getSignedDistance(t))},getSignedDistance:function(t){return _.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0)},isCollinear:function(t){return u.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return u.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,s,a,o,c,l){c||(i-=t,n-=e,a-=r,o-=s);var f=i*o-n*a;if(!h.isZero(f)){var d=t-r,g=e-s,p=(a*g-o*d)/f,v=(i*g-n*d)/f;if(l||-1e-12<p&&p<1+1e-12&&-1e-12<v&&v<1+1e-12)return l||(p=p<=0?0:p>=1?1:p),new u(t+p*i,e+p*n)}},getSide:function(t,e,i,n,r,s,a,o){a||(i-=t,n-=e);var c=r-t,l=c*n-(s-e)*i;return!o&&h.isZero(l)&&(l=(c*i+c*i)/(i*i+n*n))>=0&&l<=1&&(l=0),l<0?-1:l>0?1:0},getSignedDistance:function(t,e,i,n,r,s,a){return a||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?s-e:e-s:((r-t)*n-(s-e)*i)/Math.sqrt(i*i+n*n)},getDistance:function(t,e,i,n,r,s,a){return Math.abs(_.getSignedDistance(t,e,i,n,r,s,a))}}}),b=o.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){o.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new X(null,null,this),this._view=V.create(this,t||tt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&e){var r=this._changesById,s=e._id,a=r[s];a?a.flags|=t:n.push(r[s]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new w({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:S,match:function(i){var n=i._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(t,e){if(e instanceof w){e._remove(!1,!0),r.splice(this._children,[e],t,0),e._setProject(this,!0);var i=e._name;i&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,i,n){return i=this.insertLayer(t,i)||(this._activeLayer||this._insertItem(e,new w(y.NO_INSERT),!0)).insertChild(t,i),n&&i.activate&&i.activate(),i},getItems:function(t){return y._getItems(this,t)},getItem:function(t){return y._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var r=i[n];for(var s in e){var a=e[s];a&&a!=i&&delete a[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,s=new r({offset:new u(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new m],updateMatrix:!0}),a=0,o=n.length;a<o;a++)n[a].draw(t,s);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var c=this._selectionItems,h=this._scope.settings.handleSize,l=this._updateVersion;for(var f in c)c[f]._drawSelection(t,e,h,c,l);t.restore()}}}),y=r.extend(s,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=r.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new m,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,i){var n=t&&r.isPlainObject(t),s=n&&!0===t.internal,a=this._matrix=new m,o=n&&t.project||paper.project,c=paper.settings;return this._id=s?null:l.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&c.applyMatrix,i&&a.translate(i),a._owner=this,this._style=new X(o._currentStyle,this,o),s||n&&0==t.insert||!c.insertItems&&(!n||!0!==t.insert)?this._setProject(o):(n&&t.parent||o)._insertItem(e,this,!0),n&&t!==y.NO_INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){function i(i){for(var a in i){var o=s[a];r.equals(o,"leading"===a?1.2*i.fontSize:i[a])||(n[a]=r.serialize(o,t,"data"!==a,e))}}var n={},s=this;return i(this._serializeFields),this instanceof x||i(this._style._defaults),[this._class,n]},_changed:function(t){var i=this._symbol,n=this._parent||i,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=e),n&&40&t&&y._clearBoundsCache(n),2&t&&y._clearBoundsCache(this),r&&r._changed(t,this),i&&i._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(t&&i){var n=i._children,r=i._namedChildren;(r[t]=r[t]||[]).push(this),t in n||(n[t]=this)}this._name=t||e,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide"],function(t){var e=r.capitalize(t),i="_"+t,n={locked:128,visible:137};this["get"+e]=function(){return this[i]},this["set"+e]=function(e){e!=this[i]&&(this[i]=e,this._changed(n[t]||129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(129))}},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this._changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this._changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?u:f;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(u.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var t=this._pivot;return t?new f(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=u.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof m,n=r.set({},i?e:t,this._boundsOptions);n.stroke&&!this.getStrokeScaling()||(n.cacheItem=this);var s=this._getCachedBounds(i&&t,n).rect;return arguments.length?s:new v(s.x,s.y,s.width,s.height,this,"setBounds")},setBounds:function(){var t=p.read(arguments),e=this.getBounds(),i=this._matrix,n=new m,r=t.getCenter();n.translate(r),t.width==e.width&&t.height==e.height||(i.isInvertible()||(i.set(i._backup||(new m).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&i.length?(y._updateBoundsCache(this,e.cacheItem),y._getBounds(i,t,e)):new p},_getBoundsCacheKey:function(t,e){return[t.stroke?1:0,t.handle?1:0,e?1:0].join("")},_getCachedBounds:function(t,e,i){t=t&&t._orNullIfIdentity();var n=e.internal&&!i,r=e.cacheItem,s=n?null:this._matrix._orNullIfIdentity(),a=r&&(!t||t.equals(s))&&this._getBoundsCacheKey(e,n),o=this._bounds;if(y._updateBoundsCache(this._parent||this._symbol,r),a&&o&&a in o)return{rect:(f=o[a]).rect.clone(),nonscaling:f.nonscaling};var c=this._getBounds(t||s,e),h=c.rect||c,l=this._style,u=c.nonscaling||l.hasStroke()&&!l.getStrokeScaling();if(a){o||(this._bounds=o={});var f=o[a]={rect:h.clone(),nonscaling:u,internal:n}}return{rect:h,nonscaling:u}},_getStrokeMatrix:function(t,e){var i=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():t;return n&&n._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(t){var i=t._boundsCache;if(i){t._bounds=t._position=t._boundsCache=e;for(var n=0,r=i.list,s=r.length;n<s;n++){var a=r[n];a!==t&&(a._bounds=a._position=e,a._boundsCache&&y._clearBoundsCache(a))}}},_getBounds:function(t,e,i){var n=1/0,r=-n,s=n,a=r,o=!1;i=i||{};for(var c=0,h=t.length;c<h;c++){var l=t[c];if(l._visible&&!l.isEmpty()){var u=l._getCachedBounds(e&&e.appended(l._matrix),i,!0),f=u.rect;n=Math.min(f.x,n),s=Math.min(f.y,s),r=Math.max(f.x+f.width,r),a=Math.max(f.y+f.height,a),u.nonscaling&&(o=!0)}}return{rect:isFinite(n)?new p(n,s,r-n,a-s):new p,nonscaling:o}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i&&(i.rotation=t,this._decomposed=i)}},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return new f(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});if(t&&e&&!t.equals(e)){var i=this.getRotation(),n=this._decomposed,r=new m,s=this.getPosition(!0);r.translate(s),i&&r.rotate(i),r.scale(e.x/t.x,e.y/t.y),i&&r.rotate(-i),r.translate(s.negate()),this.transform(r),n&&(n.scaling=e,this._decomposed=n)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;n&&e.prepend(n.getGlobalMatrix(!0)),e._updateVersion=i}return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof w)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(t){var i=new this.constructor(y.NO_INSERT),n=this._children,s=r.pick(t?t.insert:e,t===e||!0===t),a=r.pick(t?t.deep:e,!0);n&&i.copyAttributes(this),n&&!a||i.copyContent(this),n||i.copyAttributes(this),s&&i.insertAbove(this);var o=this._name,c=this._parent;if(o&&c){for(var n=c._children,h=o,l=1;n[o];)o=h+" "+l++;o!==h&&i.setName(o)}return i},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],n=0,s=i.length;n<s;n++){var a=i[n];t.hasOwnProperty(a)&&(this[a]=t[a])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var o=t._data,c=t._name;this._data=o?r.clone(o):null,c&&this.setName(c)},rasterize:function(t,i){var n=this.getStrokeBounds(),s=(t||this.getView().getResolution())/72,a=n.getTopLeft().floor(),o=n.getBottomRight().ceil(),c=new d(o.subtract(a)),h=new A(y.NO_INSERT);if(!c.isZero()){var l=tt.getCanvas(c.multiply(s)),u=l.getContext("2d"),f=(new m).scale(s).translate(a.negate());u.save(),f.applyToContext(u),this.draw(u,new r({matrices:[f]})),u.restore(),h.setCanvas(l)}return h.transform((new m).translate(a.add(c.divide(2))).scale(1/s)),(i===e||i)&&h.insertAbove(this),h},contains:function(){return!!this._contains(this._matrix._inverseTransform(u.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;i>=0;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return p.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new M.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof y&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){return this._hitTest(u.read(arguments),k.getOptions(arguments))}function e(){var t=u.read(arguments),e=k.getOptions(arguments),i=[];return this._hitTest(t,r.set({all:i},e)),i}function i(t,e,i,n){var r=this._children;if(r)for(var s=r.length-1;s>=0;s--){var a=r[s],o=a!==n&&a._hitTest(t,e,i);if(o&&!e.all)return o}return null}return b.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,i){function n(t){return t&&g&&!g(t)&&(t=null),t&&e.all&&e.all.push(t),t}function s(e,i){var n=i?l["get"+i]():p.getPosition();if(t.subtract(n).divide(h).length<=1)return new k(e,p,{name:i?r.hyphenate(i):e,point:n})}if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var a=this._matrix,o=i?i.appended(a):this.getGlobalMatrix().prepend(this.getView()._matrix),c=Math.max(e.tolerance,1e-12),h=e._tolerancePadding=new d(M._getStrokePadding(c,a._shiftless().invert()));if(!(t=a._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(h.multiply(2))._containsPoint(t))return null;var l,u,f=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),g=e.match,p=this,v=e.position,m=e.center,_=e.bounds;if(f&&this._parent&&(v||m||_)){if((m||_)&&(l=this.getInternalBounds()),!(u=v&&s("position")||m&&s("center","Center"))&&_)for(var b=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],y=0;y<8&&!u;y++)u=s("bounds",b[y]);u=n(u)}return u||(u=this._hitTestChildren(t,e,o)||f&&n(this._hitTestSelf(t,e,o,this.getStrokeScaling()?null:o._shiftless().invert()))||null),u&&u.point&&(u.point=a.transform(u.point)),u},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new k("fill",this)},matches:function(t,e){function i(t,e){for(var n in t)if(t.hasOwnProperty(n)){var s=t[n],a=e[n];if(r.isPlainObject(s)&&r.isPlainObject(a)){if(!i(s,a))return!1}else if(!r.equals(s,a))return!1}return!0}var n=typeof t;if("object"===n){for(var s in t)if(t.hasOwnProperty(s)&&!this.matches(s,t[s]))return!1;return!0}if("function"===n)return t(this);if("match"===t)return e(this);var a=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;a=this._class}if("function"==typeof e)return!!e(a);if(e){if(e.test)return e.test(a);if(r.isPlainObject(e))return i(e,a)}return r.equals(a,e)},getItems:function(t){return y._getItems(this,t,this._matrix)},getItem:function(t){return y._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,i,n,s,a){if(!s){var o="object"==typeof i&&i,c=o&&o.overlapping,h=o&&o.inside,l=(y=c||h)&&p.read([y]);s={items:[],recursive:o&&!1!==o.recursive,inside:!!h,overlapping:!!c,rect:l,path:c&&new M.Rectangle({rectangle:l,insert:!1})},o&&(i=r.filter({},i,{recursive:!0,inside:!0,overlapping:!0}))}var u=e._children,f=s.items;n=(l=s.rect)&&(n||new m);for(var d=0,g=u&&u.length;d<g;d++){var v=u[d],_=n&&n.appended(v._matrix),b=!0;if(l){var y=v.getBounds(_);if(!l.intersects(y))continue;l.contains(y)||s.overlapping&&(y.contains(l)||s.path.intersects(v,_))||(b=!1)}if(b&&v.matches(i)&&(f.push(v),a))break;if(!1!==s.recursive&&t(v,i,_,s,a),a&&f.length>0)break}return f}}},{importJSON:function(t){var e=r.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(e,t)},insertChild:function(t,e){var i=e?this.insertChildren(t,[e]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var i=this._children;if(i&&e&&e.length>0){for(var n={},s=(e=r.slice(e)).length-1;s>=0;s--){var a=(l=e[s])&&l._id;!l||n[a]?e.splice(s,1):(l._remove(!1,!0),n[a]=!0)}r.splice(i,e,t,0);for(var o=this._project,c=o._changes,s=0,h=e.length;s<h;s++){var l=e[s],u=l._name;l._parent=this,l._setProject(o,!0),u&&l.setName(u),c&&l._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var i=t&&t._getOwner(),n=t!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(t._index+e,n)),n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(t){return t._insertItem(e,this)},copyTo:function(t){return this.clone(!1).addTo(t)},reduce:function(t){var e=this._children;if(e&&1===e.length){var i=e[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],s=r?r.indexOf(this):-1;-1!==s&&(e[n]==this&&delete e[n],r.splice(s,1),r.length?e[n]=r[0]:delete i[n])}},_remove:function(t,e){var i=this._getOwner(),n=this._project,s=this._index;return!!i&&(this._name&&this._removeNamed(),null!=s&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(i._children,null,s,1)),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var i=r.splice(this._children,null,t,e-t),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:u).read(arguments),n=u.read(arguments,0,{readNull:!0});return this.transform((new m)[t](i,n||this.getPosition(!0)))}},{translate:function(){var t=new m;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,i,n){var r=this._matrix,s=t&&!t.isIdentity(),a=(e||this._applyMatrix)&&(!r.isIdentity()||s||e&&i&&this._children);if(!s&&!a)return this;if(s){!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t,!0);var o=this._style,c=o.getFillColor(!0),h=o.getStrokeColor(!0);c&&c.transform(t),h&&h.transform(t)}if(a&&(a=this._transformContent(r,i,n))){var l=this._pivot;l&&r._transformPoint(l,l,!0),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var u=this._bounds,f=this._position;(s||a)&&this._changed(9);var d=s&&u&&t.decompose();if(d&&d.skewing.isZero()&&d.rotation%90==0){for(var g in u){var p=u[g];if(p.nonscaling)delete u[g];else if(a||!p.internal){var v=p.rect;t._transformBounds(v,v)}}this._bounds=u;var m=u[this._getBoundsCacheKey(this._boundsOptions||{})];m&&(this._position=m.rect.getCenter(!0))}else s&&f&&this._pivot&&(this._position=t._transformPoint(f,f));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(u.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(u.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(u.read(arguments))},localToParent:function(){return this._matrix._transformPoint(u.read(arguments))},fitBounds:function(t,e){t=p.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,s=(e?n>r:n<r)?t.width/i.width:t.height/i.height,a=new p(new u,new d(i.width*s,i.height*s));a.setCenter(t.getCenter()),this.setBounds(a)}}),{_setStyles:function(t,e,i){var n=this._style,r=this._matrix;if(n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t,r)),n.hasStroke()){t.strokeStyle=n.getStrokeColor().toCanvasStyle(t,r),t.lineWidth=n.getStrokeWidth();var s=n.getStrokeJoin(),a=n.getStrokeCap(),o=n.getMiterLimit();if(s&&(t.lineJoin=s),a&&(t.lineCap=a),o&&(t.miterLimit=o),paper.support.nativeDash){var c=n.getDashArray(),h=n.getDashOffset();c&&c.length&&("setLineDash"in t?(t.setLineDash(c),t.lineDashOffset=h):(t.mozDash=c,t.mozDashOffset=h))}}if(n.hasShadow()){var l=e.pixelRatio||1,f=i._shiftless().prepend((new m).scale(l,l)),d=f.transform(new u(n.getShadowBlur(),0)),g=f.transform(this.getShadowOffset());t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=d.getLength(),t.shadowOffsetX=g.x,t.shadowOffsetY=g.y}},draw:function(t,e,i){var n=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var r=e.matrices,s=e.viewMatrix,a=this._matrix,o=r[r.length-1].appended(a);if(o.isInvertible()){s=s?s.appended(o):o,r.push(o),e.updateMatrix&&(o._updateVersion=n,this._globalMatrix=o);var c,h,l,u=this._blendMode,f=this._opacity,d="normal"===u,g=et.nativeModes[u],p=d&&1===f||e.dontStart||e.clip||(g||d&&f<1)&&this._canComposite(),v=e.pixelRatio||1;if(!p){var m=this.getStrokeBounds(s);if(!m.width||!m.height)return;l=e.offset,h=e.offset=m.getTopLeft().floor(),c=t,t=tt.getContext(m.getSize().ceil().add(1).multiply(v)),1!==v&&t.scale(v,v)}t.save();var _=i?i.appended(a):this._canScaleStroke&&!this.getStrokeScaling(!0)&&s,b=!p&&e.clipItem,y=!_||b;if(p?(t.globalAlpha=f,g&&(t.globalCompositeOperation=u)):y&&t.translate(-h.x,-h.y),y&&(p?a:s).applyToContext(t),b&&e.clipItem.draw(t,e.extend({clip:!0})),_){t.setTransform(v,0,0,v,0,0);var x=e.offset;x&&t.translate(-x.x,-x.y)}this._draw(t,e,s,_),t.restore(),r.pop(),e.clip&&!e.dontFinish&&t.clip(),p||(et.process(u,t,c,f,h.subtract(l).multiply(v)),tt.release(t),e.offset=l)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof D)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){var s=this._selection,a=1&s,o=2&s||a&&this._selectBounds,c=4&s;if(this._drawSelected||(a=!1),(a||o||c)&&this._isUpdated(r)){var h,l=this.getSelectedColor(!0)||(h=this.getLayer())&&h.getSelectedColor(!0),u=e.appended(this.getGlobalMatrix(!0)),f=i/2;if(t.strokeStyle=t.fillStyle=l?l.toCanvasStyle(t):"#009dec",a&&this._drawSelected(t,u,n),c){var d=this.getPosition(!0),g=d.x,p=d.y;t.beginPath(),t.arc(g,p,f,0,2*Math.PI,!0),t.stroke();for(var v=[[0,-1],[1,0],[0,1],[-1,0]],m=f,_=i+1,b=0;b<4;b++){var y=v[b],x=y[0],w=y[1];t.moveTo(g+x*m,p+w*m),t.lineTo(g+x*_,p+w*_),t.stroke()}}if(o){var C=u._transformCorners(this.getInternalBounds());t.beginPath();for(b=0;b<8;b++)t[b?"lineTo":"moveTo"](C[b],C[++b]);t.closePath(),t.stroke();for(b=0;b<8;b++)t.fillRect(C[b]-f,C[++b]-f,i,i)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),x=y.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(i){t.base.call(this,i),1026&i&&(this._clipItem=e)},_getClipItem:function(){var t=this._clipItem;if(t===e){t=null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._clipMask){t=i[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,i){var n=this._getClipItem();return n?n._getCachedBounds(e&&e.appended(n._matrix),r.set({},i,{stroke:!1})):t.base.call(this,e,i)},_hitTestChildren:function t(e,i,n){var r=this._getClipItem();return(!r||r.contains(e))&&t.base.call(this,e,i,n,r)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,s=0,a=r.length;s<a;s++){var o=r[s];o!==n&&o.draw(t,e)}}}),w=x.extend({_class:"Layer",initialize:function(){x.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),C=y.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t,e){this._initialize(t,e)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new g(t.width,t.height,this,"setSize")},setSize:function(){var t=d.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;"rectangle"===e?this._radius.set(d.min(this._radius,t.divide(2))):"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new g(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;i=2*t;this._radius=t,this._size._set(i,i)}else if(t=d.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t),"rectangle"===e){var i=d.max(this._size,t.multiply(2));this._size.set(i)}else"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=new(M[r.capitalize(this._type)])({center:new u,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),paper.settings.applyMatrix&&i.setApplyMatrix(!0),(t===e||t)&&i.insertAbove(this),i},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(t,e,i,n){var r=this._style,s=r.hasFill(),a=r.hasStroke(),o=e.dontFinish||e.clip,c=!n;if(s||a||o){var h=this._type,l=this._radius,u="circle"===h;if(e.dontStart||t.beginPath(),c&&u)t.arc(0,0,l,0,2*Math.PI,!0);else{var f=u?l:l.width,d=u?l:l.height,g=this._size,p=g.width,v=g.height;if(c&&"rectangle"===h&&0===f&&0===d)t.rect(-p/2,-v/2,p,v);else{var m=p/2,_=v/2,b=.44771525016920644,y=f*b,x=d*b,w=[-m,-_+d,-m,-_+x,-m+y,-_,-m+f,-_,m-f,-_,m-y,-_,m,-_+x,m,-_+d,m,_-d,m,_-x,m-y,_,m-f,_,-m+f,_,-m+y,_,-m,_-x,-m,_-d];n&&n.transform(w,w,32),t.moveTo(w[0],w[1]),t.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),m!==f&&t.lineTo(w[8],w[9]),t.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),_!==d&&t.lineTo(w[16],w[17]),t.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),m!==f&&t.lineTo(w[24],w[25]),t.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}t.closePath()}o||!s&&!a||(this._setStyles(t,e,i),s&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),a&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new p(this._size).setCenter(0,0),n=this._style,r=e.stroke&&n.hasStroke()&&n.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(M._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),s=1;s<=4;s++){var a=new u(s>1&&s<4?-1:1,s>2?-1:1),o=a.multiply(r),c=o.subtract(a.multiply(n));if(new p(i?o.add(a.multiply(i)):o,c).contains(e))return{point:c,quadrant:s}}}function e(t,e,i,n){var r=t.divide(e);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n.point).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r,s,a){var o=!1,c=this._style,h=r.stroke&&c.hasStroke(),l=r.fill&&c.hasFill();if(h||l){var u=this._type,f=this._radius,d=h?c.getStrokeWidth()/2:0,g=r._tolerancePadding.add(M._getStrokePadding(d,!c.getStrokeScaling()&&a));if("rectangle"===u){var v=g.multiply(2),m=t(this,n,v);if(m)o=e(n.subtract(m.point),f,g,m.quadrant);else{var _=new p(this._size).setCenter(0,0),b=_.expand(v),y=_.expand(v.negate());o=b._containsPoint(n)&&!y._containsPoint(n)}}else o=e(n,f,g)}return o?new k(h?"stroke":"fill",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,s){var a=new C(r.getNamed(s),e);return a._type=t,a._size=i,a._radius=n,a}return{Circle:function(){var e=u.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return t("circle",e,new d(2*i),i,arguments)},Rectangle:function(){var e=p.readNamed(arguments,"rectangle"),i=d.min(d.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=C._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var e,i;if(r.hasNamed(t,"radius"))e=u.readNamed(t,"center"),i=d.readNamed(t,"radius");else{var n=p.readNamed(t,"rectangle");e=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:e,radius:i}}}}}),A=y.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],initialize:function(t,i){if(!this._initialize(t,i!==e&&u.read(arguments,1))){var r="string"==typeof t?n.getElementById(t):t;r?this.setImage(r):this.setSource(t)}this._size||(this._size=new d,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,i=t._canvas;if(e)this._setImage(e);else if(i){var n=tt.getCanvas(t._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new g(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=d.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this._setImage(tt.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&tt.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new u(0,0).transform(t),i=new u(1,0).transform(t).subtract(e),n=new u(0,1).transform(t).subtract(e);return new d(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){function e(t){var e=i.getView(),n=t&&t.type||"load";e&&i.responds(n)&&(paper=e._scope,i.emit(n,new H(t)))}var i=this;this._setImage(t),this._loaded?setTimeout(e,0):t&&Y.add(t,{load:function(n){i._setImage(t),e(n)},error:e})},_setImage:function(t){this._canvas&&tt.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new d(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=tt.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){tt.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(e){var i=new t.Image,n=this._crossOrigin;n&&(i.crossOrigin=n),i.src=e,this.setImage(i)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=p.read(arguments),e=tt.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=p.read(arguments),e=new A(y.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=u.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,i;if(t?t instanceof I?(i=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new p(t):"x"in t&&(e=new p(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var n=Math.min(e.width,32),s=Math.min(e.height,32),a=A._sampleContext;a?a.clearRect(0,0,33,33):a=A._sampleContext=tt.getContext(new d(32)),a.save();var o=(new m).scale(n/e.width,s/e.height).translate(-e.x,-e.y);o.applyToContext(a),i&&i.draw(a,new r({clip:!0,matrices:[o]})),this._matrix.applyToContext(a);var c=this.getElement(),h=this._size;c&&a.drawImage(c,-h.width/2,-h.height/2),a.restore();for(var l=a.getImageData(.5,.5,Math.ceil(n),Math.ceil(s)).data,u=[0,0,0],f=0,g=0,v=l.length;g<v;g+=4){var _=l[g+3];f+=_,_/=255,u[0]+=l[g]*_,u[1]+=l[g+1]*_,u[2]+=l[g+2]*_}for(g=0;g<3;g++)u[g]/=f;return f?B.read(u):null},getPixel:function(){var t=u.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new B("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=u.read(arguments),e=B.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),s=r.createImageData(1,1),a=s.data;a[0]=255*i[0],a[1]=255*i[1],a[2]=255*i[2],a[3]=null!=n?255*n:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=d.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=p.read(arguments);return t.isEmpty()&&(t=new p(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=u.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new p(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new k("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),S=y.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,i){this._initialize(t,i!==e&&u.read(arguments,1))||this.setDefinition(t instanceof T?t:new T(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,i){var n=this._definition._item._hitTest(t,e,i);return n&&(n.item=this),n},_draw:function(t,e){this._definition._item.draw(t,e)}}),T=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=l.get(),this.project=paper.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&y._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new u),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new S(this,t)},clone:function(){return new T(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),k=r.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&this.inject(i)},statics:{getOptions:function(t){var e=t&&r.read(t);return r.set({type:null,tolerance:paper.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),O=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,i,n,r,s,a){var o,c,h,l,u=arguments.length;u>0&&(null==t||"object"==typeof t?1===u&&t&&"point"in t?(o=t.point,c=t.handleIn,h=t.handleOut,l=t.selection):(o=t,c=i,h=n,l=r):(o=[t,i],c=n!==e?[n,r]:null,h=s!==e?[s,a]:null)),new P(o,this,"_point"),new P(c,this,"_handleIn"),new P(h,this,"_handleOut"),l&&this.setSelection(l)},_serialize:function(t,e){var i=this._point,n=this._selection,s=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&s.push(n),r.serialize(s,t,!0,e)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(u.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(u.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(u.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(129))},_changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this._changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new L(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,i,n){var r=t||{},s=r.type,a=r.factor,o=this.getPrevious(),c=this.getNext(),h=(o||this)._point,l=this._point,f=(c||this)._point,d=h.getDistance(l),g=l.getDistance(f);if(s&&"catmull-rom"!==s){if("geometric"!==s)throw new Error("Smoothing method '"+s+"' not supported.");if(o&&c){var p=h.subtract(f),v=a===e?.4:a,m=v*d/(d+g);i||this.setHandleIn(p.multiply(m)),n||this.setHandleOut(p.multiply(m-v))}}else{var _=a===e?.5:a,b=Math.pow(d,_),y=b*b,x=Math.pow(g,_),w=x*x;if(!i&&o){var C=2*w+3*x*b+y,A=3*x*(x+b);this.setHandleIn(0!==A?new u((w*h._x+C*l._x-y*f._x)/A-l._x,(w*h._y+C*l._y-y*f._y)/A-l._y):new u)}if(!n&&c){var C=2*y+3*b*x+w,A=3*b*(b+x);this.setHandleOut(0!==A?new u((y*f._x+C*l._x-w*h._x)/A-l._x,(y*f._y+C*l._y-w*h._y)/A-l._y):new u)}}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t.clone();t.set(e),e.set(i)},reversed:function(){return new O(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new O(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,i){var n=1-i,r=i,s=t._point,a=e._point,o=t._handleIn,c=e._handleIn,h=e._handleOut,l=t._handleOut;this._point._set(n*s._x+r*a._x,n*s._y+r*a._y,!0),this._handleIn._set(n*o._x+r*c._x,n*o._y+r*c._y,!0),this._handleOut._set(n*l._x+r*h._x,n*l._y+r*h._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,s=i&&this._handleOut.isZero()?null:this._handleOut,a=n._x,o=n._y,c=2;return e[0]=a,e[1]=o,r&&(e[c++]=r._x+a,e[c++]=r._y+o),s&&(e[c++]=s._x+a,e[c++]=s._y+o),t&&(t._transformCoordinates(e,e,c/2),a=e[0],o=e[1],i?(n._x=a,n._y=o,c=2,r&&(r._x=e[c++]-a,r._y=e[c++]-o),s&&(s._x=e[c++]-a,s._y=e[c++]-o)):(r||(e[c++]=a,e[c++]=o),s||(e[c++]=a,e[c++]=o))),e}}),P=u.extend({initialize:function(t,i,n){var r,s,a;if(t)if((r=t[0])!==e)s=t[1];else{var o=t;(r=o.x)===e&&(r=(o=u.read(arguments)).x),s=o.y,a=o.selected}else r=s=0;this._x=r,this._y=s,this._owner=i,i[n]=this,a&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=h.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner._changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),E=r.extend({_class:"Curve",beans:!0,initialize:function(t,e,i,n,r,s,a,o){var c,h,l,u,f,d,g=arguments.length;3===g?(this._path=t,c=e,h=i):g?1===g?"segment1"in t?(c=new O(t.segment1),h=new O(t.segment2)):"point1"in t?(l=t.point1,f=t.handle1,d=t.handle2,u=t.point2):Array.isArray(t)&&(l=[t[0],t[1]],u=[t[6],t[7]],f=[t[2]-t[0],t[3]-t[1]],d=[t[4]-t[6],t[5]-t[7]]):2===g?(c=new O(t),h=new O(e)):4===g?(l=t,f=e,d=i,u=n):8===g&&(l=[t,e],u=[a,o],f=[i-t,n-e],d=[r-a,s-o]):(c=new O,h=new O),this._segment1=c||new O(l,null,f),this._segment2=h||new O(u,d,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new E(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return E.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;(t=e.remove())&&this._segment1._handleOut.set(i)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(u.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(u.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(u.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(u.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return E.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new u(t[i],t[i+1]));return e}},{getLength:function(){return null==this._length&&(this._length=E.getLength(this.getValues(),0,1)),this._length},getArea:function(){return E.getArea(this.getValues())},getLine:function(){return new _(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new E(E.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return E.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var i=null;if(t>=1e-8&&t<=1-1e-8){var n=E.subdivide(this.getValues(),t),r=n[0],s=n[1],a=e||this.hasHandles(),o=this._segment1,c=this._segment2,h=this._path;a&&(o._handleOut._set(r[2]-r[0],r[3]-r[1]),c._handleIn._set(s[4]-s[6],s[5]-s[7]));var l=r[6],f=r[7],d=new O(new u(l,f),a&&new u(r[4]-l,r[5]-f),a&&new u(s[2]-l,s[3]-f));h?(h.insert(o._index+1,d),i=this.getNext()):(this._segment2=d,this._changed(),i=new E(d,c))}return i},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,i){return this.divideAtTime(t===e?.5:i?t:this.getTimeAt(t))},split:function(t,i){return this.splitAtTime(t===e?.5:i?t:this.getTimeAt(t))},reversed:function(){return new E(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,i,n){var r=t._point,s=t._handleOut,a=e._handleIn,o=e._point,c=r.x,h=r.y,l=o.x,u=o.y,f=n?[c,h,c,h,l,u,l,u]:[c,h,c+s._x,h+s._y,l+a._x,u+a._y,l,u];return i&&i._transformCoordinates(f,f,4),f},subdivide:function(t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],c=t[5],h=t[6],l=t[7];i===e&&(i=.5);var u=1-i,f=u*n+i*s,d=u*r+i*a,g=u*s+i*o,p=u*a+i*c,v=u*o+i*h,m=u*c+i*l,_=u*f+i*g,b=u*d+i*p,y=u*g+i*v,x=u*p+i*m,w=u*_+i*y,C=u*b+i*x;return[[n,r,f,d,_,b,w,C],[w,C,y,x,v,m,h,l]]},getMonoCurves:function(t,e){var i=[],n=e?0:1,r=t[n+0],s=t[n+2],a=t[n+4],o=t[n+6];if(r>=s==s>=a&&s>=a==a>=o||E.isStraight(t))i.push(t);else{var c=3*(s-a)-r+o,l=2*(r+a)-4*s,u=s-r,f=[],d=h.solveQuadratic(c,l,u,f,1e-8,1-1e-8);if(d){f.sort();var g=f[0],p=E.subdivide(t,g);i.push(p[0]),d>1&&(g=(f[1]-g)/(1-g),p=E.subdivide(p[1],g),i.push(p[0])),i.push(p[1])}else i.push(t)}return i},solveCubic:function(t,e,i,n,r,s){var a=t[e],o=t[e+2],c=t[e+4],l=t[e+6],u=0;if(!(a<i&&l<i&&o<i&&c<i||a>i&&l>i&&o>i&&c>i)){var f=3*(o-a),d=3*(c-o)-f,g=l-a-f-d;u=h.solveCubic(g,d,f,a-i,n,r,s)}return u},getTimeOf:function(t,e){var i=new u(t[0],t[1]),n=new u(t[6],t[7]);if(null===(e.isClose(i,1e-12)?0:e.isClose(n,1e-12)?1:null))for(var r=[e.x,e.y],s=[],a=0;a<2;a++)for(var o=E.solveCubic(t,a,r[a],s,0,1),c=0;c<o;c++){var h=s[c];if(e.isClose(E.getPoint(t,h),1e-7))return h}return e.isClose(i,1e-7)?0:e.isClose(n,1e-7)?1:null},getNearestTime:function(t,e){function i(i){if(i>=0&&i<=1){var n=e.getDistance(E.getPoint(t,i),!0);if(n<h)return h=n,l=i,!0}}if(E.isStraight(t)){var n=t[0],r=t[1],s=t[6]-n,a=t[7]-r,o=s*s+a*a;if(0===o)return 0;var c=((e.x-n)*s+(e.y-r)*a)/o;return c<1e-12?0:c>.999999999999?1:E.getTimeOf(t,new u(n+c*s,r+c*a))}for(var h=1/0,l=0,f=0;f<=100;f++)i(f/100);for(var d=.005;d>1e-8;)i(l-d)||i(l+d)||(d/=2);return l},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=E.subdivide(t,e)[1]),i<1&&(t=E.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],c=t[6],h=t[7],l=3*r-2*i-c,u=3*s-2*n-h,f=3*a-2*c-i,d=3*o-2*h-n;return Math.max(l*l,f*f)+Math.max(u*u,d*d)<=16*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],c=t[7];return 3*((c-i)*(n+s)-(o-e)*(r+a)+r*(e-s)-n*(i-a)+c*(s+e/3)-o*(a+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)E._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new p(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,s,a,o,c){function l(t,e){var i=t-e,n=t+e;i<a[r]&&(a[r]=i),n>o[r]&&(o[r]=n)}s/=2;var u=a[r]-s,f=o[r]+s;if(t<u||e<u||i<u||n<u||t>f||e>f||i>f||n>f)if(e<t!=e<n&&i<t!=i<n)l(t,s),l(n,s);else{var d=3*(e-i)-t+n,g=2*(t+i)-4*e,p=e-t,v=h.solveQuadratic(d,g,p,c);l(n,0);for(var m=0;m<v;m++){var _=c[m],b=1-_;1e-8<=_&&_<=1-1e-8&&l(b*b*b*t+3*b*b*_*e+3*b*_*_*i+_*_*_*n,s)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=M[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),r.each({isStraight:function(t,e,i,n){if(e.isZero()&&i.isZero())return!0;var r=n.subtract(t);if(r.isZero())return!1;if(r.isCollinear(e)&&r.isCollinear(i)){var s=new _(t,n);if(s.getDistance(t.add(e))<1e-7&&s.getDistance(n.add(i))<1e-7){var a=r.dot(r),o=r.dot(e)/a,c=r.dot(i)/a;return o>=0&&o<=1&&c<=0&&c>=-1}}return!1},isLinear:function(t,e,i,n){var r=n.subtract(t).divide(3);return e.equals(r)&&i.negate().equals(r)}},function(t,e){this[e]=function(e){var i=this._segment1,n=this._segment2;return t(i._point,i._handleOut,n._handleIn,n._point,e)},this.statics[e]=function(e,i){var n=e[0],r=e[1],s=e[6],a=e[7];return t(new u(n,r),new u(e[2]-n,e[3]-r),new u(e[4]-s,e[5]-a),new u(s,a),i)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new L(this,t):null},getTimeAt:function(t,e){return E.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(u.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return E.getTimeOf(this.getValues(),u.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=u.read(arguments),e=this.getValues(),i=E.getNearestTime(e,t),n=E.getPoint(e,i);return new L(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return E[t](n,i?e:E.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return E[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=9*(n-s)+3*(t[6]-e),c=6*(e+s)-12*n,h=3*(n-e),l=9*(r-a)+3*(t[7]-i),u=6*(i+a)-12*r,f=3*(r-i);return function(t){var e=(o*t+c)*t+h,i=(l*t+u)*t+f;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r=t[0],s=t[1],a=t[2],o=t[3],c=t[4],l=t[5],f=t[6],d=t[7],g=h.isZero;g(a-r)&&g(o-s)&&(a=r,o=s),g(c-f)&&g(l-d)&&(c=f,l=d);var p,v,m=3*(a-r),_=3*(c-a)-m,b=f-r-m-_,y=3*(o-s),x=3*(l-o)-y,w=d-s-y-x;if(0===i)p=0===e?r:1===e?f:((b*e+_)*e+m)*e+r,v=0===e?s:1===e?d:((w*e+x)*e+y)*e+s;else{if(e<1e-8?(p=m,v=y):e>1-1e-8?(p=3*(f-c),v=3*(d-l)):(p=(3*b*e+2*_)*e+m,v=(3*w*e+2*x)*e+y),n){0===p&&0===v&&(e<1e-8||e>1-1e-8)&&(p=c-a,v=l-o);var C=Math.sqrt(p*p+v*v);C&&(p/=C,v/=C)}if(3===i){var c=6*b*e+2*_,l=6*w*e+2*x,A=Math.pow(p*p+v*v,1.5);p=0!==A?(p*l-v*c)/A:0,v=0}}return 2===i?new u(v,-p):new u(p,v)}return{statics:{classify:function(t){function i(t,i,n){var r=i!==e,s=r&&i>0&&i<1,a=r&&n>0&&n<1;return!r||(s||a)&&("loop"!==t||s&&a)||(t="arch",s=a=!1),{type:t,roots:s||a?s&&a?i<n?[i,n]:[n,i]:[s?i:n]:null}}var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],c=t[5],l=t[6],u=t[7],f=s*(r-u)+a*(l-n)+n*u-r*l,d=3*(o*(a-r)+c*(n-s)+s*r-a*n),g=d-f,p=g-f+(n*(u-c)+r*(o-l)+l*c-u*o),v=Math.sqrt(p*p+g*g+d*d),m=0!==v?1/v:0,_=h.isZero;if(p*=m,g*=m,d*=m,_(p))return _(g)?i(_(d)?"line":"quadratic"):i("serpentine",d/(3*g));var b=3*g*g-4*p*d;if(_(b))return i("cusp",g/(2*p));var y=b>0?Math.sqrt(b/3):Math.sqrt(-b),x=2*p;return i(b>0?"serpentine":"loop",(g+y)/x,(g-y)/x)},getLength:function(n,r,s,a){if(r===e&&(r=0),s===e&&(s=1),E.isStraight(n)){var o=n;s<1&&(o=E.subdivide(o,s)[0],r/=s),r>0&&(o=E.subdivide(o,r)[1]);var c=o[6]-o[0],l=o[7]-o[1];return Math.sqrt(c*c+l*l)}return h.integrate(a||t(n),r,s,i(r,s))},getTimeAt:function(n,r,s){if(s===e&&(s=r<0?1:0),0===r)return s;var a=Math.abs,o=r>0,c=o?s:0,l=o?1:s,u=t(n),f=E.getLength(n,c,l,u),d=a(r)-f;if(a(d)<1e-12)return o?l:c;if(d>1e-12)return null;var g=r/f,p=0;return h.findRoot(function(t){return p+=h.integrate(u,s,t,i(s,t)),s=t,p-r},u,s+g,c,l,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x},getPeaks:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=3*n-e-3*s+t[6],c=3*e-6*n+3*s,l=-3*e+3*n,u=3*r-i-3*a+t[7],f=3*i-6*r+3*a,d=-3*i+3*r,g=[];return h.solveCubic(9*(o*o+u*u),9*(o*c+f*u),2*(c*c+f*f)+3*(l*o+d*u),l*c+f*d,g,1e-8,1-1e-8),g.sort()}}}},new function(){function t(t,e,i,n,r,s,a){var o=!a&&i.getPrevious()===r,c=!a&&i!==r&&i.getNext()===r;if(null!==n&&n>=(o?1e-8:0)&&n<=(c?1-1e-8:1)&&null!==s&&s>=(c?1e-8:0)&&s<=(o?1-1e-8:1)){var h=new L(i,n,null,a),l=new L(r,s,null,a);h._intersection=l,l._intersection=h,e&&!e(h)||L.insert(t,h,!0)}}function e(r,s,a,o,c,h,l,u,f,d,g,p,v){if(++f>=4096||++u>=40)return f;var m,b,y=s[0],x=s[1],w=s[6],C=s[7],A=_.getSignedDistance,S=A(y,x,w,C,s[2],s[3]),T=A(y,x,w,C,s[4],s[5]),k=S*T>0?.75:4/9,O=k*Math.min(0,S,T),P=k*Math.max(0,S,T),L=A(y,x,w,C,r[0],r[1]),I=A(y,x,w,C,r[2],r[3]),M=A(y,x,w,C,r[4],r[5]),D=A(y,x,w,C,r[6],r[7]),F=i(L,I,M,D),j=F[0],R=F[1];if(0===S&&0===T&&0===L&&0===I&&0===M&&0===D||null==(m=n(j,R,O,P))||null==(b=n(j.reverse(),R.reverse(),O,P)))return f;var N=d+(g-d)*m,B=d+(g-d)*b;if(Math.max(v-p,B-N)<1e-9){var z=(N+B)/2,U=(p+v)/2;t(c,h,l?o:a,l?U:z,l?a:o,l?z:U)}else if(r=E.getPart(r,m,b),b-m>.8)if(B-N>v-p){z=(N+B)/2;f=e(s,(X=E.subdivide(r,.5))[0],o,a,c,h,!l,u,f,p,v,N,z),f=e(s,X[1],o,a,c,h,!l,u,f,p,v,z,B)}else{var X=E.subdivide(s,.5),U=(p+v)/2;f=e(X[0],r,o,a,c,h,!l,u,f,p,U,N,B),f=e(X[1],r,o,a,c,h,!l,u,f,U,v,N,B)}else f=v-p>=1e-9?e(s,r,o,a,c,h,!l,u,f,p,v,N,B):e(r,s,a,o,c,h,l,u,f,N,B,p,v);return f}function i(t,e,i,n){var r,s=[0,t],a=[1/3,e],o=[2/3,i],c=[1,n],h=e-(2*t+n)/3,l=i-(t+2*n)/3;if(h*l<0)r=[[s,a,c],[s,o,c]];else{var u=h/l;r=[u>=2?[s,a,c]:u<=.5?[s,o,c]:[s,a,o,c],[s,c]]}return(h||l)<0?r.reverse():r}function n(t,e,i,n){return t[0][1]<i?r(t,!0,i):e[0][1]>n?r(e,!1,n):t[0][0]}function r(t,e,i){for(var n=t[0][0],r=t[0][1],s=1,a=t.length;s<a;s++){var o=t[s][0],c=t[s][1];if(e?c>=i:c<=i)return c===i?o:n+(i-r)*(o-n)/(c-r);n=o,r=c}return null}function s(t,e,i,n,r){var s=h.isZero;if(s(n)&&s(r)){var a=E.getTimeOf(t,new u(e,i));return null===a?[]:[a]}for(var o=Math.atan2(-r,n),c=Math.sin(o),l=Math.cos(o),f=[],d=[],g=0;g<8;g+=2){var p=t[g]-e,v=t[g+1]-i;f.push(p*l-v*c,p*c+v*l)}return E.solveCubic(f,1,0,d,0,1),d}function a(e,i,n,r,a,o,c){for(var h=i[0],l=i[1],u=s(e,h,l,i[6]-h,i[7]-l),f=0,d=u.length;f<d;f++){var g=u[f],p=E.getPoint(e,g),v=E.getTimeOf(i,p);null!==v&&t(a,o,c?r:n,c?v:g,c?n:r,c?g:v)}}function o(e,i,n,r,s,a){var o=_.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);o&&t(s,a,n,E.getTimeOf(e,o),r,E.getTimeOf(i,o))}function c(i,n,r,s,c,h){var l=Math.min,d=Math.max;if(d(i[0],i[2],i[4],i[6])+1e-12>l(n[0],n[2],n[4],n[6])&&l(i[0],i[2],i[4],i[6])-1e-12<d(n[0],n[2],n[4],n[6])&&d(i[1],i[3],i[5],i[7])+1e-12>l(n[1],n[3],n[5],n[7])&&l(i[1],i[3],i[5],i[7])-1e-12<d(n[1],n[3],n[5],n[7])){var g=f(i,n);if(g)for(x=0;x<2;x++){var p=g[x];t(c,h,r,p[0],s,p[1],!0)}else{var v=E.isStraight(i),m=E.isStraight(n),_=v&&m,b=v&&!m,y=c.length;if((_?o:v||m?a:e)(b?n:i,b?i:n,b?s:r,b?r:s,c,h,b,0,0,0,1,0,1),!_||c.length===y)for(var x=0;x<4;x++){var w=x>>1,C=1&x,A=6*w,S=6*C,T=new u(i[A],i[A+1]),k=new u(n[S],n[S+1]);T.isClose(k,1e-12)&&t(c,h,r,w,s,C)}}}return c}function l(e,i,n,r){var s=E.classify(e);if("loop"===s.type){var a=s.roots;t(n,r,i,a[0],i,a[1])}return n}function f(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=_.getDistance,s=E.isStraight(t),a=E.isStraight(e),o=s&&a,c=i(t)<i(e),h=c?e:t,l=c?t:e,f=h[0],d=h[1],g=h[6]-f,p=h[7]-d;if(r(f,d,g,p,l[0],l[1],!0)<1e-7&&r(f,d,g,p,l[6],l[7],!0)<1e-7)!o&&r(f,d,g,p,h[2],h[3],!0)<1e-7&&r(f,d,g,p,h[4],h[5],!0)<1e-7&&r(f,d,g,p,l[2],l[3],!0)<1e-7&&r(f,d,g,p,l[4],l[5],!0)<1e-7&&(s=a=o=!0);else if(o)return null;if(s^a)return null;for(var v=[t,e],m=[],b=0;b<4&&m.length<2;b++){var y=1&b,x=1^y,w=b>>1,C=E.getTimeOf(v[y],new u(v[x][w?6:0],v[x][w?7:1]));if(null!=C){var A=y?[w,C]:[C,w];(!m.length||n(A[0]-m[0][0])>1e-8&&n(A[1]-m[0][1])>1e-8)&&m.push(A)}if(b>2&&!m.length)break}if(2!==m.length)m=null;else if(!o){var S=E.getPart(t,m[0][0],m[1][0]),T=E.getPart(e,m[0][1],m[1][1]);(n(T[2]-S[2])>1e-7||n(T[3]-S[3])>1e-7||n(T[4]-S[4])>1e-7||n(T[5]-S[5])>1e-7)&&(m=null)}return m}return{getIntersections:function(t){var e=this.getValues(),i=t&&t!==this&&t.getValues();return i?c(e,i,this,t,[]):l(e,this,[])},statics:{getOverlaps:f,getIntersections:function(t,e,i,n,r,s){var a=!e;a&&(e=t);for(var o,h,u=t.length,f=e.length,d=[],g=[],p=0;p<f;p++)d[p]=e[p].getValues(r);for(p=0;p<u;p++){var v=t[p],m=a?d[p]:v.getValues(n),_=v.getPath();_!==h&&(h=_,o=[],g.push(o)),a&&l(m,v,o,i);for(var b=a?p+1:0;b<f;b++){if(s&&o.length)return o;c(m,d[b],v,e[b],o,i)}}o=[];for(var p=0,y=g.length;p<y;p++)o.push.apply(o,g[p]);return o},getCurveLineIntersections:s}}}),L=r.extend({_class:"CurveLocation",initialize:function(t,e,i,n,r){if(e>=.99999999){var s=t.getNext();s&&(e=0,t=s)}this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var e=this.getCurve(),i=this.getTime();0===i?t=e._segment1:1===i?t=e._segment2:null!=i&&(t=e.getPartLength(0,i)<e.getPartLength(i,1)?e._segment1:e._segment2),this._segment=t}return t},getCurve:function(){function t(t){var e=t&&t.getCurve();if(e&&null!=(i._time=e.getTimeOf(i._point)))return i._setCurve(e),e}var e=this._path,i=this;return e&&e._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var e=this.getCurve(),i=this.getTime();this._curveOffset=t=null!=i&&e&&e.getPartLength(0,i)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=t&&t.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve(),e=t._path,i=t&&t.splitAtTime(this.getTime());return i&&this._setSegment(e.getLastSegment()),i},equals:function(t,e){var i=this===t;if(!i&&t instanceof L){var n=this.getCurve(),r=t.getCurve(),s=n._path;if(s===r._path){var a=Math.abs,o=a(this.getOffset()-t.getOffset()),c=!e&&this._intersection,h=!e&&t._intersection;i=(o<1e-7||s&&a(s.getLength()-o)<1e-7)&&(!c&&!h||c&&h&&c.equals(h,!0))}}return i},toString:function(){var t=[],e=this.getPoint(),i=c.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){function t(t,e){var i=t.getValues(),n=E.classify(i).roots||E.getPeaks(i),r=n.length,s=e&&r>1?n[r-1]:r>0?n[0]:.5;u.push(E.getLength(i,e?s:0,e?1:s)/2)}function e(t,e,i){return e<i?t>e&&t<i:t>e||t<i}var i=this._intersection;if(!i)return!1;var n=this.getTime(),r=i.getTime(),s=n>=1e-8&&n<=1-1e-8,a=r>=1e-8&&r<=1-1e-8;if(s&&a)return!this.isTouching();var o=this.getCurve(),c=n<1e-8?o.getPrevious():o,h=i.getCurve(),l=r<1e-8?h.getPrevious():h;if(n>1-1e-8&&(o=o.getNext()),r>1-1e-8&&(h=h.getNext()),!(c&&o&&l&&h))return!1;var u=[];s||(t(c,!0),t(o,!1)),a||(t(l,!0),t(h,!1));var f=this.getPoint(),d=Math.min.apply(Math,u),g=s?o.getTangentAtTime(n):o.getPointAt(d).subtract(f),p=s?g.negate():c.getPointAt(-d).subtract(f),v=a?h.getTangentAtTime(r):h.getPointAt(d).subtract(f),m=a?v.negate():l.getPointAt(-d).subtract(f),_=p.getAngle(),b=g.getAngle(),y=m.getAngle(),x=v.getAngle();return!!(s?e(_,y,x)^e(b,y,x)&&e(_,x,y)^e(b,x,y):e(y,_,b)^e(x,_,b)&&e(y,b,_)^e(x,b,_))},hasOverlap:function(){return!!this._overlap}},r.each(E._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){function n(i,n){for(var s=i+n;s>=-1&&s<=r;s+=n){var a=t[(s%r+r)%r];if(!e.getPoint().isClose(a.getPoint(),1e-7))break;if(e.equals(a))return a}return null}for(var r=t.length,s=0,a=r-1;s<=a;){var o,c=s+a>>>1,h=t[c];if(i&&(o=e.equals(h)?h:n(c,-1)||n(c,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var l=e.getPath(),u=h.getPath();(l!==u?l._id-u._id:e.getIndex()+e.getTime()-(h.getIndex()+h.getTime()))<0?a=c-1:s=c+1}return t.splice(s,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;n>=0;n--)t(i,e[n]._intersection,!1);return i}}}}),I=y.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,i,n;if(r.isPlainObject(t)?(i=t.segments,e=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(e=t),i){var s=i[0];n=s&&Array.isArray(s[0])}else e&&(n=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));return new(n?D:M)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){function e(t,e){var i=+n[t];return o&&(i+=c[e]),i}function i(t){return new u(e(t,"x"),e(t+1,"y"))}var n,r,s,a=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),o=!1,c=new u,h=new u;this.clear();for(var l=0,f=a&&a.length;l<f;l++){var g=a[l],p=g[0],v=p.toLowerCase(),m=(n=g.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&n.length;switch(o=p===v,"z"!==r||/[mz]/.test(v)||this.moveTo(c),v){case"m":case"l":for(var _="m"===v,b=0;b<m;b+=2)this[_?"moveTo":"lineTo"](c=i(b)),_&&(h=c,_=!1);s=c;break;case"h":case"v":var y="h"===v?"x":"y";c=c.clone();for(b=0;b<m;b++)c[y]=e(b,y),this.lineTo(c);s=c;break;case"c":for(b=0;b<m;b+=6)this.cubicCurveTo(i(b),s=i(b+2),c=i(b+4));break;case"s":for(b=0;b<m;b+=4)this.cubicCurveTo(/[cs]/.test(r)?c.multiply(2).subtract(s):c,s=i(b),c=i(b+2)),r=v;break;case"q":for(b=0;b<m;b+=4)this.quadraticCurveTo(s=i(b),c=i(b+2));break;case"t":for(b=0;b<m;b+=2)this.quadraticCurveTo(s=/[qt]/.test(r)?c.multiply(2).subtract(s):c,c=i(b)),r=v;break;case"a":for(b=0;b<m;b+=7)this.arcTo(c=i(b+5),new d(+n[b],+n[b+1]),+n[b+2],+n[b+4],+n[b+3]);break;case"z":this.closePath(1e-12),c=h}r=v}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,i,n){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),a=r?s:(i||t._matrix)._orNullIfIdentity();return r||this.getBounds(s).intersects(t.getBounds(a),1e-12)?E.getIntersections(this.getCurves(),!r&&t.getCurves(),e,s,a,n):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.hasOverlap()||t.isCrossing()})},getNearestLocation:function(){for(var t=u.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,s=e.length;r<s;r++){var a=e[r].getNearestLocation(t);a._distance<i&&(i=a._distance,n=a)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,i){var n=!this._children,r=n?"_segments":"_children",s=t[r],a=e[r],o=this[r];if(!s||!a||s.length!==a.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var c=o.length,h=a.length;if(c<h)for(var l=n?O:M,u=c;u<h;u++)this.add(new l);else c>h&&this[n?"removeSegments":"removeChildren"](h,c);for(u=0;u<h;u++)o[u].interpolate(s[u],a[u],i);n&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var i=this._children||[this],n=t._children?t._children.slice():[t],r=i.length,s=n.length,a=[],o=0;e=!0;for(var c=r-1;c>=0&&e;c--){var h=i[c];e=!1;for(var l=s-1;l>=0&&!e;l--)h.compare(n[l])&&(a[l]||(a[l]=!0,o++),e=!0)}e=e&&o===s}return e}}),M=I.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==e||t.x===e&&t.point===e?null:arguments;i&&i.length>0?this.setSegments(i):(this._curves=e,this._segmentSelection=0,i||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!i&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function t(i){if(t.base.call(this,i),8&i){if(this._length=this._area=e,16&i)this._version++;else if(this._curves)for(var n=0,r=this._curves.length;n<r;n++)this._curves[n]._changed()}else 32&i&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof D?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var i=this.isFullySelected(),n=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=e,n){var r=t[n-1];"boolean"==typeof r&&(this.setClosed(r),n--),this._add(O.readList(t,0,{},n))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new E(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new E(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){function i(e,i){if(e._transformCoordinates(t,p),n=p[0],r=p[1],v)m.push("M"+g.pair(n,r)),v=!1;else if(o=p[2],h=p[3],o===n&&h===r&&l===s&&u===a){if(!i){var c=n-s,f=r-a;m.push(0===c?"v"+g.number(f):0===f?"h"+g.number(c):"l"+g.pair(c,f))}}else m.push("c"+g.pair(l-s,u-a)+" "+g.pair(o-s,h-a)+" "+g.pair(n-s,r-a));s=n,a=r,l=p[4],u=p[5]}var n,r,s,a,o,h,l,u,f=this._segments,d=f.length,g=new c(e),p=new Array(6),v=!0,m=[];if(!d)return"";for(var _=0;_<d;_++)i(f[_]);return this._closed&&d>0&&(i(f[0],!0),m.push("z")),m.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,s=null==e,e=s?i.length:e,a=0;a<r;a++){var o=t[a];o._path&&(o=t[a]=o.clone()),o._path=this,o._index=e+a,o._selection&&this._updateSelection(o,0,o._selection)}if(s)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));for(var a=e+r,c=i.length;a<c;a++)i[a]._index=a}if(n){var h=this._countCurves(),l=e>0&&e+r-1===h?e-1:e,u=l,f=Math.min(l+r,h);t._curves&&(n.splice.apply(n,[l,0].concat(t._curves)),u+=t._curves.length);for(a=u;a<f;a++)n.splice(a,0,new E(this,null,null));this._adjustCurves(l,f)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,s=t;s<e;s++)(i=r[s])._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();(i=r[this._closed&&!t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(O.readList(arguments)):this._add([O.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(O.readList(arguments,1),t):this._add([O.read(arguments,1)],t)[0]},addSegment:function(){return this._add([O.read(arguments)])[0]},insertSegment:function(t){return this._add([O.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(O.readList(t))},insertSegments:function(t,e){return this._add(O.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,i){t=t||0,e=r.pick(e,this._segments.length);var n=this._segments,s=this._curves,a=n.length,o=n.splice(t,e-t),c=o.length;if(!c)return o;for(l=0;l<c;l++){var h=o[l];h._selection&&this._updateSelection(h,h._selection,0),h._index=h._path=null}for(var l=t,u=n.length;l<u;l++)n[l]._index=l;if(s){for(var f=t>0&&e===a+(this._closed?1:0)?t-1:t,l=(s=s.splice(f,c)).length-1;l>=0;l--)s[l]._path=null;i&&(o._curves=s.slice(1)),this._adjustCurves(f,f)}return this._changed(25),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){var t=this._area;if(null==t){var e=this._segments,i=this._closed;t=0;for(var n=0,r=e.length;n<r;n++){var s=n+1===r;t+=E.getArea(E.getValues(e[n],e[s?0:n+1],null,s&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i,(this._segmentSelection+=i-e)>0&&this.setSelected(!0)},divideAt:function(t){var e,i=this.getLocationAt(t);return i&&(e=i.getCurve().divideAt(i.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e=this.getLocationAt(t),i=e&&e.index,n=e&&e.time;n>1-1e-8&&(i++,n=0);var r=this.getCurves();if(i>=0&&i<r.length){n>=1e-8&&r[i++].divideAtTime(n);var s,a=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),s=this):((s=new M(y.NO_INSERT)).insertAbove(this),s.copyAttributes(this)),s._add(a,0),this.addSegment(a[0]),s}return null},split:function(t,i){var n,r=i===e?t:(n=this.getCurves()[t])&&n.getLocationAtTime(i);return null!=r?this.splitAt(r):null},join:function(t,e){var i=e||0;if(t&&t!==this){var n=t._segments,r=this.getLastSegment(),s=t.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,i)&&t.reverse();var a=t.getFirstSegment();if(r&&r._point.isClose(a._point,i))r.setHandleOut(a._handleOut),this._add(n.slice(1));else{var o=this.getFirstSegment();o&&o._point.isClose(a._point,i)&&t.reverse(),s=t.getLastSegment(),o&&o._point.isClose(s._point,i)?(o.setHandleIn(s._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}t._closed&&this._add([n[0]]),t.remove()}var c=this.getFirstSegment(),h=this.getLastSegment();return c!==h&&c._point.isClose(h._point,i)&&(c.setHandleIn(h._handleIn),h.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?1e-7:0,r=e.length-1;r>=0;r--){var s=e[r];!s.hasHandles()&&(!s.hasLength(n)||i&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var i=this._segments[t],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var e=new F(this,t||.25,256,!0).parts,i=e.length,n=[],r=0;r<i;r++)n.push(new O(e[r].curve.slice(0,2)));!this._closed&&i>0&&n.push(new O(e[i-1].curve.slice(6))),this.setSegments(n)},simplify:function(t){var e=new j(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){function i(t,e){var i=t&&t.index;if(null!=i){var r=t.path;if(r&&r!==n)throw new Error(t._class+" "+i+" of "+r+" is not part of "+n);e&&t instanceof E&&i++}else i="number"==typeof t?t:e;return Math.min(i<0&&c?i%o:i<0?i+o:i,o-1)}var n=this,r=t||{},s=r.type||"asymmetric",a=this._segments,o=a.length,c=this._closed,h=c&&r.from===e&&r.to===e,l=i(r.from,0),u=i(r.to,o-1);if(l>u)if(c)l-=o;else{var f=l;l=u,u=f}if(/^(?:asymmetric|continuous)$/.test(s)){var d="asymmetric"===s,g=Math.min,p=u-l+1,v=p-1,m=h?g(p,4):1,_=m,b=m,y=[];if(c||(_=g(1,l),b=g(1,o-u-1)),(v+=_+b)<=1)return;for(var x=0,w=l-_;x<=v;x++,w++)y[x]=a[(w<0?w+o:w)%o]._point;for(var C=y[0]._x+2*y[1]._x,A=y[0]._y+2*y[1]._y,S=2,T=v-1,k=[C],O=[A],P=[S],L=[],I=[],x=1;x<v;x++){var M=x<T,D=M?1:d?1:2,F=M?4:d?2:7,j=M?4:d?3:8,R=M?2:d?0:1,N=D/S;S=P[x]=F-N,C=k[x]=j*y[x]._x+R*y[x+1]._x-N*C,A=O[x]=j*y[x]._y+R*y[x+1]._y-N*A}L[T]=k[T]/P[T],I[T]=O[T]/P[T];for(x=v-2;x>=0;x--)L[x]=(k[x]-L[x+1])/P[x],I[x]=(O[x]-I[x+1])/P[x];L[v]=(3*y[v]._x-L[T])/2,I[v]=(3*y[v]._y-I[T])/2;for(var x=_,B=v-b,w=l;x<=B;x++,w++){var z=a[w<0?w+o:w],U=z._point,X=L[x]-U._x,W=I[x]-U._y;(h||x<B)&&z.setHandleOut(X,W),(h||x>_)&&z.setHandleIn(-X,-W)}}else for(x=l;x<=u;x++)a[x<0?x+o:x].smooth(r,!h&&x===l,!h&&x===u)},toShape:function(t){function i(t,e){var i=l[t],n=i.getNext(),r=l[e],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function n(t){var e=l[t],i=e.getNext(),n=e._handleOut,r=i._handleIn;if(n.isOrthogonal(r)){var s=e._point,a=i._point,o=new _(s,n,!0).intersect(new _(a,r,!0),!0);return o&&h.isZero(n.getLength()/o.subtract(s).getLength()-.5522847498307936)&&h.isZero(r.getLength()/o.subtract(a).getLength()-.5522847498307936)}return!1}function r(t,e){return l[t]._point.getDistance(l[e]._point)}if(!this._closed)return null;var s,a,o,c,l=this._segments;if(!this.hasHandles()&&4===l.length&&i(0,2)&&i(1,3)&&function(t){var e=l[t],i=e.getPrevious(),n=e.getNext();return i._handleOut.isZero()&&e._handleIn.isZero()&&e._handleOut.isZero()&&n._handleIn.isZero()&&e._point.subtract(i._point).isOrthogonal(n._point.subtract(e._point))}(1)?(s=C.Rectangle,a=new d(r(0,3),r(0,1)),c=l[1]._point.add(l[2]._point).divide(2)):8===l.length&&n(0)&&n(2)&&n(4)&&n(6)&&i(1,5)&&i(3,7)?(s=C.Rectangle,o=(a=new d(r(1,6),r(0,3))).subtract(new d(r(0,7),r(1,2))).divide(2),c=l[3]._point.add(l[4]._point).divide(2)):4===l.length&&n(0)&&n(1)&&n(2)&&n(3)&&(h.isZero(r(0,2)-r(1,3))?(s=C.Circle,o=r(0,2)/2):(s=C.Ellipse,o=new d(r(2,0)/2,r(3,1)/2)),c=l[1]._point),s){var u=this.getPosition(!0),f=new s({center:u,size:a,radius:o,insert:!1});return f.copyAttributes(this,!0),f._matrix.prepend(this._matrix),f.rotate(c.subtract(u).getAngle()+90),(t===e||t)&&f.insertAbove(this),f}return null},toPath:"#clone",compare:function t(e){if(!e||e instanceof D)return t.base.call(this,e);var i=this.getCurves(),n=e.getCurves(),r=i.length,s=n.length;if(!r||!s)return r==s;for(var a,o,c=i[0].getValues(),h=[],l=0,u=0,f=0;f<s;f++){p=n[f].getValues();if(h.push(p),v=E.getOverlaps(c,p)){a=!f&&v[0][0]>0?s-1:f,o=v[0][1];break}}for(var d,g=Math.abs,p=h[a];c&&p;){var v=E.getOverlaps(c,p);if(v&&g(v[0][0]-u)<1e-8){1===(u=v[1][0])&&(c=++l<r?i[l].getValues():null,u=0);var m=v[0][1];if(g(m-o)<1e-8){if(d||(d=[a,m]),1===(o=v[1][1])&&(++a>=s&&(a=0),p=h[a]||n[a].getValues(),o=0),!c)return d[0]===a&&d[1]===o;continue}}break}return!1},_hitTestSelf:function(t,e,i,n){function r(e,i){return t.subtract(e).divide(i).length<=1}function s(t,i,n){if(!e.selected||i.isSelected()){var s=t._point;if(i!==s&&(i=i.add(s)),r(i,x))return new k(n,p,{segment:t,point:i})}}function a(t,i){return(i||e.segments)&&s(t,t._point,"segment")||!i&&e.handles&&(s(t,t._handleIn,"handle-in")||s(t,t._handleOut,"handle-out"))}function o(t){f.add(t)}function c(e){var i=b||e._index>0&&e._index<_-1;if("round"===(i?h:l))return r(e._point,x);if(f=new M({internal:!0,closed:!0}),i?e.isSmooth()||M._addBevelJoin(e,h,S,u,null,n,o,!0):"square"===l&&M._addSquareCap(e,l,S,null,n,o,!0),!f.isEmpty()){var s;return f.contains(t)||(s=f.getNearestLocation(t))&&r(s.getPoint(),y)}}var h,l,u,f,d,g,p=this,v=this.getStyle(),m=this._segments,_=m.length,b=this._closed,y=e._tolerancePadding,x=y,w=e.stroke&&v.hasStroke(),C=e.fill&&v.hasFill(),A=e.curves,S=w?v.getStrokeWidth()/2:C&&e.tolerance>0||A?0:null;if(null!==S&&(S>0?(h=v.getStrokeJoin(),l=v.getStrokeCap(),u=v.getMiterLimit(),x=x.add(M._getStrokePadding(S,n))):h=l="round"),!e.ends||e.segments||b){if(e.segments||e.handles)for(O=0;O<_;O++)if(g=a(m[O]))return g}else if(g=a(m[0],!0)||a(m[_-1],!0))return g;if(null!==S){if(d=this.getNearestLocation(t)){var T=d.getTime();0===T||1===T&&_>1?c(d.getSegment())||(d=null):r(d.getPoint(),x)||(d=null)}if(!d&&"miter"===h&&_>1)for(var O=0;O<_;O++){var P=m[O];if(t.getDistance(P._point)<=u*S&&c(P)){d=P.getLocation();break}}}return!d&&C&&this._contains(t)||d&&!w&&!A?new k("fill",this):d?new k(w?"stroke":"curve",this,{location:d,point:d.getPoint()}):null}},r.each(E._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this.getLocationAt(e);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=u.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var s=i,a=e[n];if((i+=a.getLength())>t)return a.getLocationAt(t-s)}if(e.length>0&&t<=this.getLength())return new L(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null}}),new function(){function t(t,e,i,n){function r(e){var i=c[e],n=c[e+1];s==i&&a==n||(t.beginPath(),t.moveTo(s,a),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,o,0,2*Math.PI,!0),t.fill())}for(var s,a,o=n/2,c=new Array(6),h=0,l=e.length;h<l;h++){var u=e[h],f=u._selection;if(u._transformCoordinates(i,c),s=c[0],a=c[1],2&f&&r(2),4&f&&r(4),t.fillRect(s-o,a-o,n,n),!(1&f)){var d=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(s-o+1,a-o+1,n-2,n-2),t.fillStyle=d}}}function e(t,e,i){function n(e){if(i)e._transformCoordinates(i,g),r=g[0],s=g[1];else{var n=e._point;r=n._x,s=n._y}if(p)t.moveTo(r,s),p=!1;else{if(i)c=g[2],h=g[3];else{f=e._handleIn;c=r+f._x,h=s+f._y}c===r&&h===s&&l===a&&u===o?t.lineTo(r,s):t.bezierCurveTo(l,u,c,h,r,s)}if(a=r,o=s,i)l=g[4],u=g[5];else{var f=e._handleOut;l=a+f._x,u=o+f._y}}for(var r,s,a,o,c,h,l,u,f=e._segments,d=f.length,g=new Array(6),p=!0,v=0;v<d;v++)n(f[v]);e._closed&&d>0&&n(f[0])}return{_draw:function(t,i,n,r){function s(t){return u[(t%f+f)%f]}var a=i.dontStart,o=i.dontFinish||i.clip,c=this.getStyle(),h=c.hasFill(),l=c.hasStroke(),u=c.getDashArray(),f=!paper.support.nativeDash&&l&&u&&u.length;if(a||t.beginPath(),(h||l&&!f||o)&&(e(t,this,r),this._closed&&t.closePath()),!o&&(h||l)&&(this._setStyles(t,i,n),h&&(t.fill(c.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),l)){if(f){a||t.beginPath();var d,g=new F(this,.25,32,!1,r),p=g.length,v=-c.getDashOffset(),m=0;for(v%=p;v>0;)v-=s(m--)+s(m--);for(;v<p;)d=v+s(m++),(v>0||d>0)&&g.drawPart(t,Math.max(v,0),Math.max(d,0)),v=d+s(m++)}t.stroke()}},_drawSelected:function(i,n){i.beginPath(),e(i,this,n),i.stroke(),t(i,this._segments,n,paper.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new O(u.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new O(u.read(arguments))])},cubicCurveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=u.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new O(n,i.subtract(n))])},quadraticCurveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var e=u.read(arguments),i=u.read(arguments),n=r.pick(r.read(arguments),.5),s=1-n,a=t(this)._point,o=e.subtract(a.multiply(s*s)).subtract(i.multiply(n*n)).divide(2*n*s);if(o.isNaN())throw new Error("Cannot put a curve through points with parameter = "+n);this.quadraticCurveTo(o,i)},arcTo:function(){var e,i,n,s,a=Math.abs,o=Math.sqrt,c=t(this),l=c._point,f=u.read(arguments),g=r.peek(arguments);if("boolean"==typeof(x=r.pick(g,!0)))var p=(C=l.add(f).divide(2)).add(C.subtract(l).rotate(x?-90:90));else if(r.remain(arguments)<=2)p=f,f=u.read(arguments);else{var v=d.read(arguments),b=h.isZero;if(b(v.width)||b(v.height))return this.lineTo(f);var y=r.read(arguments),x=!!r.read(arguments),w=!!r.read(arguments),C=l.add(f).divide(2),A=(G=l.subtract(C).rotate(-y)).x,S=G.y,T=a(v.width),k=a(v.height),P=T*T,E=k*k,L=A*A,I=S*S,M=o(L/P+I/E);if(M>1&&(P=(T*=M)*T,E=(k*=M)*k),M=(P*E-P*I-E*L)/(P*I+E*L),a(M)<1e-12&&(M=0),M<0)throw new Error("Cannot create an arc with the given arguments");e=new u(T*S/k,-k*A/T).multiply((w===x?-1:1)*o(M)).rotate(y).add(C),i=(n=(s=(new m).translate(e).rotate(y).scale(T,k))._inverseTransform(l)).getDirectedAngle(s._inverseTransform(f)),!x&&i>0?i-=360:x&&i<0&&(i+=360)}if(p){var D=new _(l.add(p).divide(2),p.subtract(l).rotate(90),!0),F=new _(p.add(f).divide(2),f.subtract(p).rotate(90),!0),j=new _(l,f),R=j.getSide(p);if(!(e=D.intersect(F,!0))){if(!R)return this.lineTo(f);throw new Error("Cannot create an arc with the given arguments")}i=(n=l.subtract(e)).getDirectedAngle(f.subtract(e));var N=j.getSide(e);0===N?i=R*a(i):R===N&&(i+=i<0?360:-360)}for(var B=a(i),z=B>=360?4:Math.ceil((B-1e-7)/90),U=i/z,X=U*Math.PI/360,W=4/3*Math.sin(X)/(1+Math.cos(X)),Y=[],V=0;V<=z;V++){var G=f,H=null;if(V<z&&(H=n.rotate(90).multiply(W),s?(G=s._transformPoint(n),H=s._transformPoint(n.add(H)).subtract(G)):G=e.add(n)),V){var q=n.rotate(-90).multiply(W);s&&(q=s._transformPoint(n.add(q)).subtract(G)),Y.push(new O(G,q,H))}else c.setHandleOut(H);n=n.rotate(U)}this._add(Y)},lineBy:function(){var e=u.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=r.read(arguments),s=t(this)._point;this.curveTo(s.add(e),s.add(i),n)},cubicCurveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=u.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=u.read(arguments),i=u.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var e=t(this)._point,i=e.add(u.read(arguments)),n=r.pick(r.peek(arguments),!0);"boolean"==typeof n?this.arcTo(i,n):this.arcTo(i,e.add(u.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return M[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,s){function a(t){t._transformCoordinates(n,c);for(var e=0;e<2;e++)E._addBounds(h[e],h[e+4],c[e+2],c[e],e,s?s[e]:0,l,u,f);var i=h;h=c,c=i}var o=t[0];if(!o)return new p;for(var c=new Array(6),h=o._transformCoordinates(n,new Array(6)),l=h.slice(0,2),u=l.slice(),f=new Array(2),d=1,g=t.length;d<g;d++)a(t[d]);return e&&a(o),new p(l[0],l[1],u[0]-l[0],u[1]-l[1])},getStrokeBounds:function(t,e,i,n,r){function s(t){v=v.include(t)}function a(t){v=v.unite(x.setCenter(t._point.transform(n)))}function o(t,e){"round"===e||t.isSmooth()?a(t):M._addBevelJoin(t,e,m,y,n,f,s)}function c(t,e){"round"===e?a(t):M._addSquareCap(t,e,m,n,f,s)}var h=i.getStyle(),l=h.hasStroke(),u=h.getStrokeWidth(),f=l&&i._getStrokeMatrix(n,r),g=l&&M._getStrokePadding(u,f),v=M.getBounds(t,e,i,n,r,g);if(!l)return v;for(var m=u/2,_=h.getStrokeJoin(),b=h.getStrokeCap(),y=h.getMiterLimit(),x=new p(new d(g)),w=t.length-(e?0:1),C=1;C<w;C++)o(t[C],_);return e?o(t[0],_):w>0&&(c(t[0],b),c(t[t.length-1],b)),v},_getStrokePadding:function(t,e){if(!e)return[t,t];var i=new u(t,0).transform(e),n=new u(0,t).transform(e),r=i.getAngleInRadians(),s=i.getLength(),a=n.getLength(),o=Math.sin(r),c=Math.cos(r),h=Math.tan(r),l=Math.atan2(a*h,s),f=Math.atan2(a,h*s);return[Math.abs(s*Math.cos(l)*c+a*Math.sin(l)*o),Math.abs(a*Math.sin(f)*c+s*Math.cos(f)*o)]},_addBevelJoin:function(t,e,i,n,r,s,a,o){var c=t.getCurve(),h=c.getPrevious(),l=c.getPoint1().transform(r),f=h.getNormalAtTime(1).multiply(i).transform(s),d=c.getNormalAtTime(0).multiply(i).transform(s);if(f.getDirectedAngle(d)<0&&(f=f.negate(),d=d.negate()),o&&a(l),a(l.add(f)),"miter"===e){var g=new _(l.add(f),new u(-f.y,f.x),!0).intersect(new _(l.add(d),new u(-d.y,d.x),!0),!0);g&&l.getDistance(g)<=n*i&&a(g)}a(l.add(d))},_addSquareCap:function(t,e,i,n,r,s,a){var o=t._point.transform(n),c=t.getLocation(),h=c.getNormal().multiply(0===c.getTime()?i:-i).transform(r);"square"===e&&(a&&(s(o.subtract(h)),s(o.add(h))),o=o.add(h.rotate(-90))),s(o.add(h)),s(o.subtract(h))},getHandleBounds:function(t,e,i,n,r){var s,a,o=i.getStyle();if(r.stroke&&o.hasStroke()){var c=i._getStrokeMatrix(n,r),h=o.getStrokeWidth()/2,l=h;"miter"===o.getStrokeJoin()&&(l=h*o.getMiterLimit()),"square"===o.getStrokeCap()&&(l=Math.max(l,h*Math.SQRT2)),s=M._getStrokePadding(h,c),a=M._getStrokePadding(l,c)}for(var u=new Array(6),f=1/0,d=-f,g=f,v=d,m=0,_=t.length;m<_;m++){t[m]._transformCoordinates(n,u);for(var b=0;b<6;b+=2){var y=b?s:a,x=y?y[0]:0,w=y?y[1]:0,C=u[b],A=u[b+1],S=C-x,T=C+x,k=A-w,O=A+w;S<f&&(f=S),T>d&&(d=T),k<g&&(g=k),O>v&&(v=O)}}return new p(f,g,d-f,v-g)}}});M.inject({statics:new function(){function t(t,e,i){var n=r.getNamed(i),s=new M(n&&0==n.insert&&y.NO_INSERT);return s._add(t),s._closed=e,s.set(n,{insert:!0})}function e(e,i,r){for(var s=new Array(4),a=0;a<4;a++){var o=n[a];s[a]=new O(o._point.multiply(i).add(e),o._handleIn.multiply(i),o._handleOut.multiply(i))}return t(s,!0,r)}var i=.5522847498307936,n=[new O([-1,0],[0,i],[0,-i]),new O([0,-1],[-i,0],[i,0]),new O([1,0],[0,-i],[0,i]),new O([0,1],[i,0],[-i,0])];return{Line:function(){return t([new O(u.readNamed(arguments,"from")),new O(u.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=u.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return e(t,new d(i),arguments)},Rectangle:function(){var e,n=p.readNamed(arguments,"rectangle"),r=d.readNamed(arguments,"radius",0,{readNull:!0}),s=n.getBottomLeft(!0),a=n.getTopLeft(!0),o=n.getTopRight(!0),c=n.getBottomRight(!0);if(!r||r.isZero())e=[new O(s),new O(a),new O(o),new O(c)];else{var h=(r=d.min(r,n.getSize(!0).divide(2))).width,l=r.height,u=h*i,f=l*i;e=[new O(s.add(h,0),null,[-u,0]),new O(s.subtract(0,l),[0,f]),new O(a.add(0,l),null,[0,-f]),new O(a.add(h,0),[-u,0],null),new O(o.subtract(h,0),null,[u,0]),new O(o.add(0,l),[0,-f],null),new O(c.subtract(0,l),null,[0,f]),new O(c.subtract(h,0),[u,0])]}return t(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=C._readEllipse(arguments);return e(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=u.readNamed(arguments,"from"),e=u.readNamed(arguments,"through"),i=u.readNamed(arguments,"to"),n=r.getNamed(arguments),s=new M(n&&0==n.insert&&y.NO_INSERT);return s.moveTo(t),s.arcTo(e,i),s.set(n)},RegularPolygon:function(){for(var e=u.readNamed(arguments,"center"),i=r.readNamed(arguments,"sides"),n=r.readNamed(arguments,"radius"),s=360/i,a=i%3==0,o=new u(0,a?-n:n),c=a?-1:.5,h=new Array(i),l=0;l<i;l++)h[l]=new O(e.add(o.rotate((l+c)*s)));return t(h,!0,arguments)},Star:function(){for(var e=u.readNamed(arguments,"center"),i=2*r.readNamed(arguments,"points"),n=r.readNamed(arguments,"radius1"),s=r.readNamed(arguments,"radius2"),a=360/i,o=new u(0,-1),c=new Array(i),h=0;h<i;h++)c[h]=new O(e.add(o.rotate(a*h).multiply(h%2?s:n)));return t(c,!0,arguments)}}}});var D=I.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(e,i){var n=i,s=n[0];s&&"number"==typeof s[0]&&(n=[n]);for(var a=i.length-1;a>=0;a--){var o=n[a];n!==i||o instanceof M||(n=r.slice(n)),Array.isArray(o)?n[a]=new M({segments:o,insert:!1}):o instanceof D&&(n.splice.apply(n,[a,1].concat(o.removeChildren())),o.remove())}return t.base.call(this,e,n)},reduce:function t(e){for(var i=this._children,n=i.length-1;n>=0;n--)(r=i[n].reduce(e)).isEmpty()&&r.remove();if(!i.length){var r=new M(y.NO_INSERT);return r.copyAttributes(this),r.insertAbove(this),this.remove(),r}return t.base.call(this)},isClosed:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e},getLength:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();return e},getPathData:function(t,e){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var a=i[r],o=a._matrix;n.push(a.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return n.join("")},_hitTestChildren:function t(e,i,n){return t.base.call(this,e,i.class===M||"path"===i.type?i:r.set({},i,{fill:!1}),n)},_draw:function(t,e,i,n){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,a=r.length;s<a;s++)r[s].draw(t,e,n);if(!e.clip){this._setStyles(t,e,i);var o=this._style;o.hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var a=n[r],o=a._matrix;i[a._id]||a._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(t,e){var i=t._children;if(e&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new M(y.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=u.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,s=n.length;r<s;r++)i=n[r][t](e)||i;return i}},{}));I.inject(new function(){function t(t,e){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0):i}function i(t,e,i,n,r){var s=new D(y.NO_INSERT);return s.addChildren(t,!0),s=s.reduce({simplify:e}),r&&0==r.insert||s.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),s.copyAttributes(i,!0),s}function n(e,n,r,a){function o(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];y.push.apply(y,n._segments),x.push.apply(x,n.getCurves()),n._overlapsOnly=!0}}if(a&&(0==a.trace||a.stroke)&&/^(subtract|intersect)$/.test(r))return s(e,n,r);var h=t(e,!0),u=n&&e!==n&&t(n,!0),g=m[r];g[r]=!0,u&&(g.subtract||g.exclude)^u.isClockwise()^h.isClockwise()&&u.reverse();var p,v=l(L.expand(h.getCrossings(u))),_=h._children||[h],b=u&&(u._children||[u]),y=[],x=[];if(v.length){o(_),b&&o(b);for(var w=0,C=v.length;w<C;w++)f(v[w]._segment,h,u,x,g);for(var w=0,C=y.length;w<C;w++){var A=y[w],S=A._intersection;A._winding||f(A,h,u,x,g),S&&S._overlap||(A._path._overlapsOnly=!1)}p=d(y,g)}else p=c(b?_.concat(b):_.slice(),function(t){return!!g[t]});return i(p,!0,e,n,a)}function s(e,n,r){function s(t){if(!u[t._id]&&(l||o.contains(t.getPointAt(t.getLength()/2))^h))return f.unshift(t),u[t._id]=!0}for(var a=t(e),o=t(n),c=a.getCrossings(o),h="subtract"===r,l="divide"===r,u={},f=[],d=c.length-1;d>=0;d--){var g=c[d].split();g&&(s(g)&&g.getFirstSegment().setHandleIn(0,0),a.getLastSegment().setHandleOut(0,0))}return s(a),i(f,!1,e,n)}function a(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function o(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function c(t,e,i){var n=t&&t.length;if(n){var s=r.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),a=t.slice().sort(function(t,e){return v(e.getArea())-v(t.getArea())}),o=a[0];null==i&&(i=o.isClockwise());for(var c=0;c<n;c++){for(var h=a[c],l=s[h._id],u=h.getInteriorPoint(),f=0,d=c-1;d>=0;d--){var g=a[d];if(g.contains(u)){var p=s[g._id];f=p.winding,l.winding+=f,l.container=p.exclude?p.container:g;break}}if(e(l.winding)===e(f))l.exclude=!0,t[l.index]=null;else{var m=l.container;h.setClockwise(m?!m.isClockwise():i)}}}return t}function l(t,e,i){function n(t){return t._path._id+"."+t._segment1._index}for(var r,s,c,h=e&&[],l=!1,u=i||[],f=i&&{},d=(i&&i.length)-1;d>=0;d--)(b=i[d])._path&&(f[n(b)]=!0);for(d=t.length-1;d>=0;d--){var g,p=t[d],v=p._time,m=v,_=e&&!e(p),b=p._curve;if(b&&(b!==s?(l=!b.hasHandles()||f&&f[n(b)],r=[],c=null,s=b):c>=1e-8&&(v/=c)),_)r&&r.push(p);else{if(e&&h.unshift(p),c=m,v<1e-8)g=b._segment1;else if(v>1-1e-8)g=b._segment2;else{var y=b.divideAtTime(v,!0);l&&u.push(b,y),g=y._segment1;for(var x=r.length-1;x>=0;x--){var w=r[x];w._time=(w._time-v)/(1-v)}}p._setSegment(g);var C=g._intersection,A=p._intersection;if(C){a(C,A);for(var S=C;S;)a(S._intersection,C),S=S._next}else g._intersection=A}}return i||o(u),h||t}function u(t,e,i,n,r){function s(s){var a=s[l+0],c=s[l+6];if(!(m<g(a,c)||m>p(a,c))){var f=s[h+0],v=s[h+2],x=s[h+4],w=s[h+6];if(a!==c){var T=m===a?0:m===c?1:b>p(f,v,x,w)||y<g(f,v,x,w)?1:E.solveCubic(s,l,m,O,0,1)>0?O[0]:1,P=0===T?f:1===T?w:E.getPoint(s,T)[i?"y":"x"],L=a>c?1:-1,I=o[l]>o[l+6]?1:-1,M=o[h+6];return m!==a?(P<b?C+=L:P>y?A+=L:S=!0,P>d-_&&P<d+_&&(k/=2)):(L!==I?f<b?C+=L:f>y&&(A+=L):f!=M&&(M<y&&P>y?(A+=L,S=!0):M>b&&P<b&&(C+=L,S=!0)),k=0),o=s,!r&&P>b&&P<y&&0===E.getTangent(s,T)[i?"x":"y"]&&u(t,e,!i,n,!0)}(f<y&&w>b||w<y&&f>b)&&(S=!0)}}function a(t){var e=t[l+0],n=t[l+2],r=t[l+4],a=t[l+6];if(m<=p(e,n,r,a)&&m>=g(e,n,r,a))for(var o,c=t[h+0],u=t[h+2],f=t[h+4],d=t[h+6],v=b>p(c,u,f,d)||y<g(c,u,f,d)?[t]:E.getMonoCurves(t,i),_=0,x=v.length;_<x;_++)if(o=s(v[_]))return o}for(var o,c,h=i?1:0,l=1^h,f=[t.x,t.y],d=f[h],m=f[l],_=1e-6,b=d-1e-9,y=d+1e-9,x=0,w=0,C=0,A=0,S=!1,T=!1,k=1,O=[],P=0,L=e.length;P<L;P++){var I,M=e[P],D=M._path,F=M.getValues();if(!(P&&e[P-1]._path===D||(o=null,D._closed||(c=E.getValues(D.getLastCurve().getSegment2(),M.getSegment1(),null,!n))[l]!==c[l+6]&&(o=c),o))){o=F;for(var j=D.getLastCurve();j&&j!==M;){var R=j.getValues();if(R[l]!==R[l+6]){o=R;break}j=j.getPrevious()}}if(I=a(F))return I;if(P+1===L||e[P+1]._path!==D){if(c&&(I=a(c)))return I;!S||C||A||(C=A=D.isClockwise(n)^i?1:-1),x+=C,w+=A,C=A=0,S&&(T=!0,S=!1),c=null}}return x=v(x),w=v(w),{winding:p(x,w),windingL:x,windingR:w,quality:k,onPath:T}}function f(t,e,i,n,r){var s=[],a=t,o=0;do{d=(b=t.getCurve()).getLength();s.push({segment:t,curve:b,length:d}),o+=d,t=t.getNext()}while(t&&!t._intersection&&t!==a);for(var c=[.5,.25,.75],l={winding:0,quality:-1},f=0;f<c.length&&l.quality<.5;f++)for(var d=o*c[f],g=0,p=s.length;g<p;g++){var m=s[g],_=m.length;if(d<=_){var b=m.curve,y=b._path,x=y._parent,w=x instanceof D?x:y,C=h.clamp(b.getTimeAt(d),1e-8,1-1e-8),A=b.getPointAtTime(C),S=v(b.getTangentAtTime(C).y)<Math.SQRT1_2,T=r.subtract&&i&&(w===e&&i._getWinding(A,S,!0).winding||w===i&&!e._getWinding(A,S,!0).winding)?{winding:0,quality:1}:u(A,n,S,!0);T.quality>l.quality&&(l=T);break}d-=_}for(g=s.length-1;g>=0;g--)s[g].segment._winding=l}function d(t,e){function i(t){var i;return!(!t||t._visited||e&&(!e[(i=t._winding||{}).winding]||e.unite&&2===i.winding&&i.windingL&&i.windingR))}function n(t){if(t)for(var e=0,i=s.length;e<i;e++)if(t===s[e])return!0;return!1}function r(t){for(var e=t._segments,i=0,n=e.length;i<n;i++)e[i]._visited=!0}var s,a=[];t.sort(function(t,e){var i=t._intersection,n=e._intersection,r=!(!i||!i._overlap),s=!(!n||!n._overlap),a=t._path,o=e._path;return r^s?r?1:-1:!i^!n?i?1:-1:a!==o?a._id-o._id:t._index-e._index});for(var o=0,c=t.length;o<c;o++){var h,l,u,f=t[o],d=i(f),g=null,p=!1,v=!0,m=[];if(d&&f._path._overlapsOnly){var _=f._path,b=f._intersection._segment._path;_.compare(b)&&(_.getArea()&&a.push(_.clone(!1)),r(_),r(b),d=!1)}for(;d;){var x=!g,w=function(t,e){function r(r,a){for(;r&&r!==a;){var o=r._segment,h=o._path,l=o.getNext()||h&&h.getFirstSegment(),u=l&&l._intersection;o!==t&&(n(o)||n(l)||l&&i(o)&&(i(l)||u&&i(u._segment)))&&c.push(o),e&&s.push(o),r=r._next}}var a=t._intersection,o=a,c=[];if(e&&(s=[t]),a){for(r(a);a&&a._prev;)a=a._prev;r(a,o)}return c}(f,x),C=w.shift(),A=!(p=!x&&(n(f)||n(C)))&&C;if(x&&(g=new M(y.NO_INSERT),h=null),p){(f.isFirst()||f.isLast())&&(v=f._path._closed),f._visited=!0;break}if(A&&h&&(m.push(h),h=null),h||(A&&w.push(f),h={start:g._segments.length,crossings:w,visited:l=[],handleIn:u}),A&&(f=C),!i(f)){g.removeSegments(h.start);for(var S=0,T=l.length;S<T;S++)l[S]._visited=!1;l.length=0;do{(f=h&&h.crossings.shift())||(h=m.pop())&&(l=h.visited,u=h.handleIn)}while(h&&!i(f));if(!f)break}var k=f.getNext();g.add(new O(f._point,u,k&&f._handleOut)),f._visited=!0,l.push(f),f=k||f._path.getFirstSegment(),u=k&&k._handleIn}p&&(v&&(g.getFirstSegment().setHandleIn(u),g.setClosed(v)),0!==g.getArea()&&a.push(g))}return a}var g=Math.min,p=Math.max,v=Math.abs,m={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};return{_getWinding:function(t,e,i){return u(t,this.getCurves(),e,i)},unite:function(t,e){return n(this,t,"unite",e)},intersect:function(t,e){return n(this,t,"intersect",e)},subtract:function(t,e){return n(this,t,"subtract",e)},exclude:function(t,e){return n(this,t,"exclude",e)},divide:function(t,e){return e&&(0==e.trace||e.stroke)?s(this,t,"divide"):i([this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){function t(t){var e=t&&t._intersection;return e&&e._overlap}var e=this._children,i=e||[this],n=!1,s=!1,a=this.getIntersections(null,function(t){return t.hasOverlap()&&(n=!0)||t.isCrossing()&&(s=!0)}),c=n&&s&&[];if(a=L.expand(a),n)for(var h=l(a,function(t){return t.hasOverlap()},c),u=h.length-1;u>=0;u--){var f=h[u]._segment,g=f.getPrevious(),p=f.getNext();t(g)&&t(p)&&(f.remove(),g._handleOut._set(0,0),p._handleIn._set(0,0),g===f||g.getCurve().hasLength()||(p._handleIn.set(g._handleIn),g.remove()))}s&&(l(a,n&&function(t){var e=t.getCurve(),i=t.getSegment(),n=t._intersection,r=n._curve,s=n._segment;if(e&&r&&e._path&&r._path)return!0;i&&(i._intersection=null),s&&(s._intersection=null)},c),c&&o(c),i=d(r.each(i,function(t){this.push.apply(this,t._segments)},[])));var v,m=i.length;return m>1&&e?(i!==e&&this.setChildren(i),v=this):1!==m||e||(i[0]!==this&&this.setSegments(i[0].removeSegments()),v=this),v||((v=new D(y.NO_INSERT)).addChildren(i),(v=v.reduce()).copyAttributes(this),this.replaceWith(v)),v},reorient:function(t,i){var n=this._children;return n&&n.length?this.setChildren(c(this.removeChildren(),function(e){return!!(t?e:1&e)},i)):i!==e&&this.setClockwise(i),this},getInteriorPoint:function(){var t=this.getBounds().getCenter(!0);if(!this.contains(t)){for(var e=this.getCurves(),i=t.y,n=[],r=[],s=0,a=e.length;s<a;s++){var o=e[s].getValues(),c=o[1],h=o[3],l=o[5],u=o[7];if(i>=g(c,h,l,u)&&i<=p(c,h,l,u))for(var f=E.getMonoCurves(o),d=0,v=f.length;d<v;d++){var m=f[d],_=m[1],b=m[7];if(_!==b&&(i>=_&&i<=b||i>=b&&i<=_)){var y=i===_?m[0]:i===b?m[6]:1===E.solveCubic(m,1,i,r,0,1)?E.getPoint(m,r[0]).x:(m[0]+m[6])/2;n.push(y)}}}n.length>1&&(n.sort(function(t,e){return t-e}),t.x=(n[0]+n[1])/2)}return t}}});var F=r.extend({_class:"PathFlattener",initialize:function(t,e,i,n,r){function s(t,e){var i=E.getValues(t,e,r);c.push(i),a(i,t._index,0,1)}function a(t,i,r,s){if(!(s-r>u)||n&&E.isStraight(t)||E.isFlatEnough(t,e||.25)){var o=t[6]-t[0],c=t[7]-t[1],f=Math.sqrt(o*o+c*c);f>0&&(l+=f,h.push({offset:l,curve:t,index:i,time:s}))}else{var d=E.subdivide(t,.5),g=(r+s)/2;a(d[0],i,r,g),a(d[1],i,g,s)}}for(var o,c=[],h=[],l=0,u=1/(i||32),f=t._segments,d=f[0],g=1,p=f.length;g<p;g++)s(d,o=f[g]),d=o;t._closed&&s(o,f[0]),this.curves=c,this.parts=h,this.length=l,this.index=0},_get:function(t){for(var e,i=this.parts,n=i.length,r=this.index;e=r,r&&!(i[--r].offset<t););for(;e<n;e++){var s=i[e];if(s.offset>=t){this.index=e;var a=i[e-1],o=a&&a.index===s.index?a.time:0,c=a?a.offset:0;return{index:s.index,time:o+(s.time-o)*(t-c)/(s.offset-c)}}}return{index:i[n-1].index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),s=n.index,a=r.index;s<=a;s++){var o=E.getPart(this.curves[s],s===n.index?n.time:0,s===r.index?r.time:1);s===n.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},r.each(E._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this._get(e);return E[t](this.curves[i.index],i.time)}},{})),j=r.extend({initialize:function(t){for(var e,i=this.points=[],n=t._segments,r=t._closed,s=0,a=n.length;s<a;s++){var o=n[s].point;e&&e.equals(o)||i.push(e=o.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return i>0&&(n=[new O(e[0])],i>1&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,s){var a=this.points;if(n-i!=1){for(var o,c=this.chordLengthParameterize(i,n),h=Math.max(e,e*e),l=!0,u=0;u<=4;u++){var f=this.generateBezier(i,n,c,r,s),d=this.findMaxError(i,n,f,c);if(d.error<e&&l)return void this.addCurve(t,f);if(o=d.index,d.error>=h)break;l=this.reparameterize(i,n,c,f),h=d.error}var g=a[o-1].subtract(a[o+1]);this.fitCubic(t,e,i,o,r,g),this.fitCubic(t,e,o,n,g.negate(),s)}else{var p=a[i],v=a[n],m=p.getDistance(v)/3;this.addCurve(t,[p,p.add(r.normalize(m)),v.add(s.normalize(m)),v])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new O(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,i,n,r){for(var s=Math.abs,a=this.points,o=a[t],c=a[e],h=[[0,0],[0,0]],l=[0,0],u=0,f=e-t+1;u<f;u++){var d=i[u],g=1-d,p=3*d*g,v=g*g*g,m=p*g,_=p*d,b=d*d*d,y=n.normalize(m),x=r.normalize(_),w=a[t+u].subtract(o.multiply(v+m)).subtract(c.multiply(_+b));h[0][0]+=y.dot(y),h[0][1]+=y.dot(x),h[1][0]=h[0][1],h[1][1]+=x.dot(x),l[0]+=y.dot(w),l[1]+=x.dot(w)}var C,A,S=h[0][0]*h[1][1]-h[1][0]*h[0][1];if(s(S)>1e-12){var T=h[0][0]*l[1]-h[1][0]*l[0];C=(l[0]*h[1][1]-l[1]*h[0][1])/S,A=T/S}else{var k=h[0][0]+h[0][1],O=h[1][0]+h[1][1];C=A=s(k)>1e-12?l[0]/k:s(O)>1e-12?l[1]/O:0}var P,E,L=c.getDistance(o),I=1e-12*L;if(C<I||A<I)C=A=L/3;else{var M=c.subtract(o);P=n.normalize(C),E=r.normalize(A),P.dot(M)-E.dot(M)>L*L&&(C=A=L/3,P=E=null)}return[o,o.add(P||n.normalize(C)),c.add(E||r.normalize(A)),c]},reparameterize:function(t,e,i,n){for(r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);for(var r=1,s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=t[s+1].subtract(t[s]).multiply(3);for(s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var a=this.evaluate(3,t,i),o=this.evaluate(2,n,i),c=this.evaluate(1,r,i),l=a.subtract(e),u=o.dot(o)+l.dot(c);return h.isZero(u)?i:i-l.dot(o)/u},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);for(var n=1,r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),s=0,a=t+1;a<e;a++){var o=this.evaluate(3,i,n[a-t]).subtract(this.points[a]),c=o.x*o.x+o.y*o.y;c>=s&&(s=c,r=a)}return{error:s,index:r}}}),R=y.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var i=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(i&&t,!i&&u.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),N=R.extend({_class:"PointText",initialize:function(){R.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new f(t.x,t.y,this,"setPoint")},setPoint:function(){var t=u.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,i){if(this._content){this._setStyles(t,e,i);var n=this._lines,r=this._style,s=r.hasFill(),a=r.hasStroke(),o=r.getLeading(),c=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var h=0,l=n.length;h<l;h++){t.shadowColor=c;var u=n[h];s&&(t.fillText(u,0,0),t.shadowColor="rgba(0,0,0,0)"),a&&t.strokeText(u,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,s=i.getJustification(),a=i.getLeading(),o=this.getView().getTextWidth(i.getFontStyle(),n),c=0;"left"!==s&&(c-=o/("center"===s?2:1));var h=new p(c,r?-.75*a:0,o,r*a);return t?t._transformBounds(h,h):h}}),B=r.extend(new function(){function t(t){var n,r=t.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(r){n=[0,0,0];for(s=0;s<3;s++){c=r[s+1];n[s]=parseInt(1==c.length?c+c:c,16)/255}}else if(r=t.match(/^rgba?\((.*)\)$/))for(var s=0,o=(n=r[1].split(",")).length;s<o;s++){var c=+n[s];n[s]=s<3?c/255:c}else if(i){var h=a[t];if(!h){e||((e=tt.getContext(1,1)).globalCompositeOperation="copy"),e.fillStyle="rgba(0,0,0,0)",e.fillStyle=t,e.fillRect(0,0,1,1);var l=e.getImageData(0,0,1,1).data;h=a[t]=[l[0]/255,l[1]/255,l[2]/255]}n=h.slice()}else n=[0,0,0];return n}var e,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},s={},a={},o=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],h={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=n-Math.min(t,e,i);return[0===r?0:60*(n==t?(e-i)/r+(e<i?6:0):n==e?(i-t)/r+2:(t-e)/r+4),0===n?0:r/n,n]},"hsb-rgb":function(t,e,i){t=(t/60%6+6)%6;var n=Math.floor(t),r=t-n,s=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[s[(n=o[n])[0]],s[n[1]],s[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,a=0===s,o=(n+r)/2;return[a?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),a?0:o<.5?s/(n+r):s/(2-n-r),o]},"hsl-rgb":function(t,e,i){if(t=(t/360%1+1)%1,0===e)return[i,i,i];for(var n=[t+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,a=[],o=0;o<3;o++){var c=n[o];c<0&&(c+=1),c>1&&(c-=1),a[o]=6*c<1?s+6*(r-s)*c:2*c<1?r:3*c<2?s+(r-s)*(2/3-c)*6:s}return a},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(n,function(t,e){s[e]=[],r.each(t,function(t,i){var a=r.capitalize(t),o=/^(hue|saturation)$/.test(t),c=s[e][i]="gradient"===t?function(t){var e=this._components[0];return t=z.read(Array.isArray(t)?t:arguments,0,{readNull:!0}),e!==t&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===e?function(){return u.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+a]=function(){return this._type===e||o&&/^hs[bl]$/.test(this._type)?this._components[i]:this._convert(e)[i]},this["set"+a]=function(t){this._type===e||o&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(e),this._properties=n[e],this._type=e),this._components[i]=c.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function e(i){var a,o,c,h,l=arguments,u=this.__read,f=0;Array.isArray(i)&&(i=(l=i)[0]);var d=null!=i&&typeof i;if("string"===d&&i in n&&(a=i,i=l[1],Array.isArray(i)?(o=i,c=l[2]):(u&&(f=1),l=r.slice(l,1),d=typeof i)),!o){if(h="number"===d?l:"object"===d&&null!=i.length?i:null){a||(a=h.length>=3?"rgb":"gray");var g=n[a].length;c=h[g],u&&(f+=h===arguments?g+(null!=c?1:0):1),h.length>g&&(h=r.slice(h,0,g))}else if("string"===d)a="rgb",4===(o=t(i)).length&&(c=o[3],o.length--);else if("object"===d)if(i.constructor===e){if(a=i._type,o=i._components.slice(),c=i._alpha,"gradient"===a)for(var p=1,v=o.length;p<v;p++){var m=o[p];m&&(o[p]=m.clone())}}else if(i.constructor===z)a="gradient",h=l;else{var _=n[a="hue"in i?"lightness"in i?"hsl":"hsb":"gradient"in i||"stops"in i||"radial"in i?"gradient":"gray"in i?"gray":"rgb"],b=s[a];this._components=o=[];for(var p=0,v=_.length;p<v;p++)null==(y=i[_[p]])&&!p&&"gradient"===a&&"stops"in i&&(y={stops:i.stops,radial:i.radial}),null!=(y=b[p].call(this,y))&&(o[p]=y);c=i.alpha}u&&a&&(f=1)}if(this._type=a||"rgb",!o){this._components=o=[];for(var p=0,v=(b=s[this._type]).length;p<v;p++){var y=b[p].call(this,h&&h[p]);null!=y&&(o[p]=y)}}return this._components=o,this._properties=n[this._type],this._alpha=c,u&&(this.__read=f),this},set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=h[this._type+"-"+t])?e.apply(this,this._components):h["rgb-"+t].apply(this,h[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new B(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?B.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=c.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(i?a:n.number(a)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){function e(t){return Math.round(255*(t<0?0:t>1?1:t))}var i=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;return i=[e(i[0]),e(i[1]),e(i[2])],n<1&&i.push(n<0?0:n),t?"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).slice(1):(4==i.length?"rgba(":"rgb(")+i.join(",")+")"},toCanvasStyle:function(t,e){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var i,n=this._components,r=n[0],s=r._stops,a=n[1],o=n[2],c=n[3],h=e&&e.inverted();if(h&&(a=h._transformPoint(a),o=h._transformPoint(o),c&&(c=h._transformPoint(c))),r._radial){var l=o.getDistance(a);if(c){var u=c.subtract(a);u.getLength()>l&&(c=a.add(u.normalize(l-.1)))}var f=c||a;i=t.createRadialGradient(f.x,f.y,0,a.x,a.y,l)}else i=t.createLinearGradient(a.x,a.y,o.x,o.y);for(var d=0,g=s.length;d<g;d++){var p=s[d],v=p._offset;i.addColorStop(null==v?d/(g-1):v,p._color.toCanvasStyle())}return this._canvasStyle=i},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new B(t(),t(),t())}}})},new function(){var t={add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}};return r.each(t,function(t,e){this[e]=function(e){e=B.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),s=0,a=n.length;s<a;s++)r[s]=t(n[s],r[s]);return new B(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),z=r.extend({_class:"Gradient",initialize:function(t,e){this._id=l.get(),t&&r.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var i=this._owners?this._owners.indexOf(t):-1;-1!=i&&(this._owners.splice(i,1),this._owners.length||(this._owners=e))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new z(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var n=0,r=i.length;n<r;n++)i[n]._owner=e;for(var n=0,r=(i=this._stops=U.readList(t,0,{clone:!0})).length;n<r;n++)i[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),U=r.extend({_class:"GradientStop",initialize:function(t,i){var n=t,r=i;"object"==typeof t&&i===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,r=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(r)},clone:function(){return new U(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return r.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=B.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),X=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new u,selectedColor:null},i=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),n=r.set({},i,{fillColor:new B}),s={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},a={beans:!0},o={_class:"Style",beans:!0,initialize:function(e,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||paper.project,this._defaults=!r||r instanceof x?i:r instanceof R?n:t,e&&this.set(e)}};return r.each(i,function(t,i){var n=/Color$/.test(i),c="shadowOffset"===i,h=r.capitalize(i),l=s[i],f="set"+h,d="get"+h;o[f]=function(t){var r=this._owner,s=r&&r._children;if(s&&s.length>0&&!(r instanceof D))for(var a=0,o=s.length;a<o;a++)s[a]._style[f](t);else if(i in this._defaults){var c=this._values[i];c!==t&&(n&&(c&&c._owner!==e&&(c._owner=e),t&&t.constructor===B&&(t._owner&&(t=t.clone()),t._owner=r)),this._values[i]=t,r&&r._changed(l||65))}},o[d]=function(t){var s,a=this._owner,o=a&&a._children;if(i in this._defaults&&(!o||!o.length||t||a instanceof D))if((s=this._values[i])===e)(s=this._defaults[i])&&s.clone&&(s=s.clone());else{var h=n?B:c?u:null;!h||s&&s.constructor===h||(this._values[i]=s=h.read([s],0,{readNull:!0,clone:!0}),s&&n&&(s._owner=a))}else if(o)for(var l=0,f=o.length;l<f;l++){var g=o[l]._style[d]();if(l){if(!r.equals(s,g))return e}else s=g}return s},a[d]=function(t){return this._style[d](t)},a[f]=function(t){this._style[f](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var i="get"+e,n="set"+e;o[i]=a[i]="#get"+t,o[n]=a[n]="#set"+t}),y.inject(a),o},{set:function(t){var e=t instanceof X,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){function i(t,i,n){var s=t._values,a=i._values,o=i._defaults;for(var c in s){var h=s[c],l=a[c];if(!(n&&c in a||r.equals(h,l===e?o[c]:l)))return!1}return!0}return t===this||t&&this._class===t._class&&i(this,t)&&i(t,this,!0)||!1},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),W=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),a=0;a<6;a++){var o=r[a],c=o?o+s:e;if(c in t){if(!i)return t[c];t[c]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,s=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var a=i.left-(s.clientLeft||r.clientLeft||0),o=i.top-(s.clientTop||r.clientTop||0);if(!e){var c=n.defaultView;a+=c.pageXOffset||s.scrollLeft||r.scrollLeft,o+=c.pageYOffset||s.scrollTop||r.scrollTop}return new p(a,o,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new p(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return W.getBounds(t,e).getPoint()},getSize:function(t){return W.getBounds(t,!0).getSize()},isInvisible:function(t){return W.getSize(t).equals(new d(0,0))},isInView:function(t){return!W.isInvisible(t)&&W.getViewportBounds(t).intersects(W.getBounds(t,!0))},isInserted:function(t){return n.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},Y={add:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.addEventListener(r[s],n,!1)},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.removeEventListener(r[s],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new u(e.pageX||e.clientX+n.documentElement.scrollLeft,e.pageY||e.clientY+n.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return Y.getPoint(t).subtract(W.getOffset(e||Y.getTarget(t)))}};Y.requestAnimationFrame=new function(){function t(){var e=s;s=[];for(var i=0,a=e.length;i<a;i++)e[i]();(r=n&&s.length)&&n(t)}var e,n=W.getPrefixed(i,"requestAnimationFrame"),r=!1,s=[];return function(i){s.push(i),n?r||(n(t),r=!0):e||(e=setInterval(t,1e3/60))}};var V=r.extend(s,{_class:"View",initialize:function t(e,r){function s(t){return r[t]||parseInt(r.getAttribute(t),10)}function o(){var t=W.getSize(r);return t.isNaN()||t.isZero()?new d(s("width"),s("height")):t}var c;if(i&&r){this._id=r.getAttribute("id"),null==this._id&&r.setAttribute("id",this._id="view-"+t._id++),Y.add(r,this._viewEvents);if(W.setPrefixed(r.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"}),a.hasAttribute(r,"resize")){var h=this;Y.add(i,this._windowEvents={resize:function(){h.setViewSize(o())}})}if(c=o(),a.hasAttribute(r,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var l=this._stats.domElement,u=l.style,f=W.getOffset(r);u.position="absolute",u.left=f.x+"px",u.top=f.y+"px",n.body.appendChild(l)}}else c=new d(r),r=null;this._project=e,this._scope=e._scope,this._element=r,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(c.width,c.height),this._viewSize=c,t._views.push(this),t._viewsById[this._id]=this,(this._matrix=new m)._owner=this,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;V._focused===this&&(V._focused=null),V._views.splice(V._views.indexOf(this),1),delete V._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),Y.remove(this._element,this._viewEvents),Y.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(y._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;Y.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;W.getPrefixed(n,"hidden")&&"true"!==a.getAttribute(e,"keepalive")||!W.isInView(e)||t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var i=this._frameItems[e];i.item.emit("frame",new r(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(2049),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new g(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=d.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new p(new u,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return W.isInView(this._element)},isInserted:function(){return W.isInserted(this._element)},getPixelSize:function(t){var e,i=this._element;if(i){var r=i.parentNode,s=n.createElement("div");s.style.fontSize=t,r.appendChild(s),e=parseFloat(W.getStyles(s).fontSize),r.removeChild(s)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:u).read(arguments),n=u.read(arguments,0,{readNull:!0});return this.transform((new m)[t](i,n||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new m;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=u.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose(),e=t&&t.scaling;return e?(e.x+e.y)/2:0},setZoom:function(t){this.transform((new m).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose(),i=t&&t.scaling;return i?new f(i.x,i.y,this,"setScaling"):e},setScaling:function(){var t=this.getScaling(),e=u.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(u.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(u.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(u.read(arguments))},getEventPoint:function(t){return this.viewToProject(Y.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){return n&&"string"==typeof e&&(e=n.getElementById(e)),new(i?G:V)(t,e)}}},new function(){function t(t){var e=Y.getTarget(t);return e.getAttribute&&V._viewsById[e.getAttribute("id")]}function e(){var t=V._focused;if(!t||!t.isVisible())for(var e=0,i=V._views.length;e<i;e++)if((t=V._views[e]).isVisible()){V._focused=c=t;break}}function r(t,e,i){t._handleMouseEvent("mousemove",e,i)}function s(t,e,i,n,r,s,a){function o(t,i){if(t.responds(i)){if(c||(c=new J(i,n,r,e||t,s?r.subtract(s):null)),t.emit(i,c)&&(T=!0,c.prevented&&(k=!0),c.stopped))return h=!0}else{var a=O[i];if(a)return o(t,a)}}for(var c,h=!1;t&&t!==a&&!o(t,i);)t=t._parent;return h}function a(t,e,i,n,r,a){return t._project.removeOn(i),k=T=!1,w&&s(w,null,i,n,r,a)||e&&e!==w&&!e.isDescendant(w)&&s(e,null,i,n,r,a,w)||s(t,w||e||t,i,n,r,a)}if(i){var o,c,h,l,u,f=!1,d=!1,g=i.navigator;g.pointerEnabled||g.msPointerEnabled?(h="pointerdown MSPointerDown",l="pointermove MSPointerMove",u="pointerup pointercancel MSPointerUp MSPointerCancel"):(h="touchstart",l="touchmove",u="touchend touchcancel","ontouchstart"in i&&g.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(h+=" mousedown",l+=" mousemove",u+=" mouseup"));var p={},v={mouseout:function(t){var e=V._focused,i=Y.getRelatedTarget(t);if(e&&(!i||"HTML"===i.nodeName)){var n=Y.getOffset(t,e._element),s=n.x,a=Math.abs,o=a(s),c=o-(1<<25);n.x=a(c)<o?c*(s<0?-1:1):s,r(e,t,e.viewToProject(n))}},scroll:e};p[h]=function(e){var i=V._focused=t(e);f||(f=!0,i._handleMouseEvent("mousedown",e))},v[l]=function(i){var n=V._focused;if(!d){var s=t(i);s?n!==s&&(n&&r(n,i),o||(o=n),n=V._focused=c=s):c&&c===n&&(o&&!o.isInserted()&&(o=null),n=V._focused=o,o=null,e())}n&&r(n,i)},v[h]=function(){d=!0},v[u]=function(t){var e=V._focused;e&&f&&e._handleMouseEvent("mouseup",t),d=f=!1},Y.add(n,v),Y.add(i,{load:e});var m,_,b,y,x,w,C,A,S,T=!1,k=!1,O={doubleclick:"click",mousedrag:"mousemove"},P=!1,E={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:p,_handleMouseEvent:function(t,e,i){function n(t){return r.virtual[t]||l.responds(t)||h&&h.responds(t)}var r=this._itemEvents,o=r.native[t],c="mousemove"===t,h=this._scope.tool,l=this;c&&f&&n("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(e));var u=this.getBounds().contains(i),d=o&&u&&l._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),g=d&&d.item||null,p=!1,v={};if(v[t.substr(5)]=!0,o&&g!==x&&(x&&s(x,null,"mouseleave",e,i),g&&s(g,null,"mouseenter",e,i),x=g),P^u&&(s(this,null,u?"mouseenter":"mouseleave",e,i),m=u?this:null,p=!0),!u&&!v.drag||i.equals(b)||(a(this,g,c?t:"mousemove",e,i,b),p=!0),P=u,v.down&&u||v.up&&_){if(a(this,g,t,e,i,_),v.down){if(S=g===C&&Date.now()-A<300,y=C=g,!k&&g){for(var O=g;O&&!O.responds("mousedrag");)O=O._parent;O&&(w=g)}_=i}else v.up&&(k||g!==y||(A=Date.now(),a(this,g,S?"doubleclick":"click",e,i,_),S=!1),y=w=null);P=!1,p=!0}b=i,p&&h&&(T=h._handleMouseEvent(t,e,i,v)||T),(T&&!v.move||v.down&&n("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){function r(r){r.responds(t)&&(paper=a,r.emit(t,s=s||new q(t,e,i,n)))}var s,a=this._scope,o=a.tool;this.isVisible()&&(r(this),o&&o.responds(t)&&r(o))},_countItemEvent:function(t,e){var i=this._itemEvents,n=i.native,r=i.virtual;for(var s in E)n[s]=(n[s]||0)+(E[s][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:e}}}}),G=V.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof i.HTMLCanvasElement)){var n=d.read(arguments,1);if(n.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+r.slice(arguments,1));e=tt.getCanvas(n)}var s=this._context=e.getContext("2d");if(s.save(),this._pixelRatio=1,!/^off|false$/.test(a.getAttribute(e,"hidpi"))){var o=i.devicePixelRatio||1,c=W.getPrefixed(s,"backingStorePixelRatio")||1;this._pixelRatio=o/c}V.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,i){var n=this._pixelRatio;if(t.base.call(this,e*n,i*n),1!==n){var r=this._element,s=this._context;if(!a.hasAttribute(r,"resize")){var o=r.style;o.width=e+"px",o.height=i+"px"}s.restore(),s.save(),s.scale(n,n)}},getPixelSize:function t(e){var i,n=paper.agent;if(n&&n.firefox)i=t.base.call(this,e);else{var r=this._context,s=r.font;r.font=e+" serif",i=parseFloat(r.font),r.font=s}return i},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var s=0,a=e.length;s<a;s++)r=Math.max(r,i.measureText(e[s]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),H=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return $.modifiers}}),q=H.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),$=new function(){function t(t){var e=t.key||t.keyIdentifier;return e=/^U\+/.test(e)?String.fromCharCode(parseInt(e.substr(2),16)):/^Arrow[A-Z]/.test(e)?e.substr(5):"Unidentified"===e?String.fromCharCode(t.keyCode):e,o[e]||(e.length>1?r.hyphenate(e):e.toLowerCase())}function e(t,i,n,a){var o,c=V._focused;if(h[i]=t,t?l[i]=n:delete l[i],i.length>1&&(o=r.camelize(i))in u){u[o]=t;var f=paper&&paper.agent;if("meta"===o&&f&&f.mac)if(t)s={};else{for(var d in s)d in l&&e(!1,d,s[d],a);s=null}}else t&&s&&(s[i]=n);c&&c._handleKeyEvent(t?"keydown":"keyup",a,i,n)}var s,a,o={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},c={tab:"\t",space:" ",enter:"\r"},h={},l={},u=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=paper&&paper.agent;return t&&t.mac?this.meta:this.control}}});return Y.add(n,{keydown:function(i){var n=t(i),r=paper&&paper.agent;n.length>1||r&&r.chrome&&(i.altKey||r.mac&&i.metaKey||!r.mac&&i.ctrlKey)?e(!0,n,c[n]||(n.length>1?"":n),i):a=n},keypress:function(i){if(a){var n=t(i),r=i.charCode,s=r>=32?String.fromCharCode(r):n.length>1?"":n;n!==a&&(n=s.toLowerCase()),e(!0,n,s,i),a=null}},keyup:function(i){var n=t(i);n in l&&e(!1,n,l[n],i)}}),Y.add(i,{blur:function(t){for(var i in l)e(!1,i,l[i],t)}}),{modifiers:u,isDown:function(t){return!!h[t]}}},J=H.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Z=H.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),K=o.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){o.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){function r(t,e){var r=i,s=a?u._point:u._downPoint||r;if(a){if(u._moveCount&&r.equals(s))return!1;if(s&&(null!=t||null!=e)){var o=r.subtract(s),c=o.getLength();if(c<(t||0))return!1;e&&(r=s.add(o.normalize(Math.min(c,e))))}u._moveCount++}return u._point=r,u._lastPoint=s||r,n.down&&(u._moveCount=-1,u._downPoint=r,u._downCount++),!0}function s(){o&&(l=u.emit(t,new Z(u,t,e))||l)}paper=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var a=n.move||n.drag,o=this.responds(t),c=this.minDistance,h=this.maxDistance,l=!1,u=this;if(n.down)r(),s();else if(n.up)r(null,h),s();else if(o)for(;r(c,h);)s();return l}}),Q={request:function(e){var i=new t.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,r.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var t=i.status;0===t||200===t?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var t=i.status,n='Could not load "'+e.url+'" (Status: '+t+")";if(!e.onError)throw new Error(n);e.onError(n,t)},i.send(null)}},tt={canvases:[],getCanvas:function(t,e){if(!i)return null;var r,s=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?r=this.canvases.pop():(r=n.createElement("canvas"),s=!1);var a=r.getContext("2d");if(!a)throw new Error("Canvas "+r+" is unable to provide a 2D context.");return r.width===t&&r.height===e?s&&a.clearRect(0,0,t+1,e+1):(r.width=t,r.height=e),a.save(),r},getContext:function(t,e){var i=this.getCanvas(t,e);return i?i.getContext("2d"):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},et=new function(){function t(t,e,i){return.2989*t+.587*e+.114*i}function e(e,i,n,r){var s=r-t(e,i,n),r=t(d=e+s,g=i+s,p=n+s),a=v(d,g,p),o=m(d,g,p);if(a<0){var c=r-a;d=r+(d-r)*r/c,g=r+(g-r)*r/c,p=r+(p-r)*r/c}if(o>255){var h=255-r,l=o-r;d=r+(d-r)*h/l,g=r+(g-r)*h/l,p=r+(p-r)*h/l}}function i(t,e,i){return m(t,e,i)-v(t,e,i)}function n(t,e,i,n){var r,s=[t,e,i],a=m(t,e,i),o=v(t,e,i);r=0===v(o=o===t?0:o===e?1:2,a=a===t?0:a===e?1:2)?1===m(o,a)?2:1:0,s[a]>s[o]?(s[r]=(s[r]-s[o])*n/(s[a]-s[o]),s[a]=n):s[r]=s[a]=0,s[o]=0,d=s[0],g=s[1],p=s[2]}var s,a,o,c,h,l,u,f,d,g,p,v=Math.min,m=Math.max,_=Math.abs,b={multiply:function(){d=h*s/255,g=l*a/255,p=u*o/255},screen:function(){d=h+s-h*s/255,g=l+a-l*a/255,p=u+o-u*o/255},overlay:function(){d=h<128?2*h*s/255:255-2*(255-h)*(255-s)/255,g=l<128?2*l*a/255:255-2*(255-l)*(255-a)/255,p=u<128?2*u*o/255:255-2*(255-u)*(255-o)/255},"soft-light":function(){var t=s*h/255;d=t+h*(255-(255-h)*(255-s)/255-t)/255,g=(t=a*l/255)+l*(255-(255-l)*(255-a)/255-t)/255,p=(t=o*u/255)+u*(255-(255-u)*(255-o)/255-t)/255},"hard-light":function(){d=s<128?2*s*h/255:255-2*(255-s)*(255-h)/255,g=a<128?2*a*l/255:255-2*(255-a)*(255-l)/255,p=o<128?2*o*u/255:255-2*(255-o)*(255-u)/255},"color-dodge":function(){d=0===h?0:255===s?255:v(255,255*h/(255-s)),g=0===l?0:255===a?255:v(255,255*l/(255-a)),p=0===u?0:255===o?255:v(255,255*u/(255-o))},"color-burn":function(){d=255===h?255:0===s?0:m(0,255-255*(255-h)/s),g=255===l?255:0===a?0:m(0,255-255*(255-l)/a),p=255===u?255:0===o?0:m(0,255-255*(255-u)/o)},darken:function(){d=h<s?h:s,g=l<a?l:a,p=u<o?u:o},lighten:function(){d=h>s?h:s,g=l>a?l:a,p=u>o?u:o},difference:function(){(d=h-s)<0&&(d=-d),(g=l-a)<0&&(g=-g),(p=u-o)<0&&(p=-p)},exclusion:function(){d=h+s*(255-h-h)/255,g=l+a*(255-l-l)/255,p=u+o*(255-u-u)/255},hue:function(){n(s,a,o,i(h,l,u)),e(d,g,p,t(h,l,u))},saturation:function(){n(h,l,u,i(s,a,o)),e(d,g,p,t(h,l,u))},luminosity:function(){e(h,l,u,t(s,a,o))},color:function(){e(s,a,o,t(h,l,u))},add:function(){d=v(h+s,255),g=v(l+a,255),p=v(u+o,255)},subtract:function(){d=m(h-s,0),g=m(l-a,0),p=m(u-o,0)},average:function(){d=(h+s)/2,g=(l+a)/2,p=(u+o)/2},negation:function(){d=255-_(255-s-h),g=255-_(255-a-l),p=255-_(255-o-u)}},y=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),x=tt.getContext(1,1);x&&(r.each(b,function(t,e){var i="darken"===e,n=!1;x.save();try{x.fillStyle=i?"#300":"#a00",x.fillRect(0,0,1,1),x.globalCompositeOperation=e,x.globalCompositeOperation===e&&(x.fillStyle=i?"#a00":"#300",x.fillRect(0,0,1,1),n=x.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}x.restore(),y[e]=n}),tt.release(x)),this.process=function(t,e,i,n,r){var v=e.canvas,m="normal"===t;if(m||y[t])i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=n,m||(i.globalCompositeOperation=t),i.drawImage(v,r.x,r.y),i.restore();else{var _=b[t];if(!_)return;for(var x=i.getImageData(r.x,r.y,v.width,v.height),w=x.data,C=e.getImageData(0,0,v.width,v.height).data,A=0,S=w.length;A<S;A+=4){s=C[A],h=w[A],a=C[A+1],l=w[A+1],o=C[A+2],u=w[A+2],c=C[A+3],f=w[A+3],_();var T=c*n/255,k=1-T;w[A]=T*d+k*h,w[A+1]=T*g+k*l,w[A+2]=T*p+k*u,w[A+3]=c*n+k*f}i.putImageData(x,r.x,r.y)}}},it=new function(){function t(t,e,i){for(var n in e){var r=e[n],a=s[n];"number"==typeof r&&i&&(r=i.number(r)),a?t.setAttributeNS(a,n,r):t.setAttribute(n,r)}return t}var e="http://www.w3.org/2000/svg",i="http://www.w3.org/2000/xmlns",r="http://www.w3.org/1999/xlink",s={href:r,xlink:i,xmlns:i+"/","xmlns:xlink":i+"/"};return{svg:e,xmlns:i,xlink:r,create:function(i,r,s){return t(n.createElementNS(e,i),r,s)},get:function(t,e){var i=s[e],n=i?t.getAttributeNS(i,e):t.getAttribute(e);return"null"===n?null:n},set:t}},nt=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof I||t instanceof C||t instanceof R)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=r.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&r.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});return new function(){function e(t,e,i){var n=new r,s=t.getTranslation();if(e){var a=(t=t._shiftless())._inverseTransform(s);n[i?"cx":"x"]=a.x,n[i?"cy":"y"]=a.y,s=null}if(!t.isIdentity()){var o=t.decompose();if(o){var c=[],l=o.rotation,u=o.scaling,f=o.skewing;s&&!s.isZero()&&c.push("translate("+v.point(s)+")"),l&&c.push("rotate("+v.number(l)+")"),h.isZero(u.x-1)&&h.isZero(u.y-1)||c.push("scale("+v.point(u)+")"),f.x&&c.push("skewX("+v.number(f.x)+")"),f.y&&c.push("skewY("+v.number(f.y)+")"),n.transform=c.join(" ")}else n.transform="matrix("+t.getValues().join(",")+")"}return n}function i(t,i){for(var n=e(t._matrix),r=t._children,s=it.create("g",n,v),a=0,o=r.length;a<o;a++){var c=r[a],h=d(c,i);if(h)if(c.isClipMask()){var l=it.create("clipPath");l.appendChild(h),u(c,l,"clip"),it.set(s,{"clip-path":"url(#"+l.id+")"})}else s.appendChild(h)}return s}function n(t){var i=t._type,n=t._radius,r=e(t._matrix,!0,"rectangle"!==i);if("rectangle"===i){i="rect";var s=t._size,a=s.width,o=s.height;r.x-=a/2,r.y-=o/2,r.width=a,r.height=o,n.isZero()&&(n=null)}return n&&("circle"===i?r.r=n:(r.rx=n.width,r.ry=n.height)),it.create(i,r,v)}function s(t){var e=o(t,"color");if(!e){var i,n=t.getGradient(),r=n._radial,s=t.getOrigin(),a=t.getDestination();if(r){i={cx:s.x,cy:s.y,r:s.getDistance(a)};var c=t.getHighlight();c&&(i.fx=c.x,i.fy=c.y)}else i={x1:s.x,y1:s.y,x2:a.x,y2:a.y};i.gradientUnits="userSpaceOnUse",e=it.create((r?"radial":"linear")+"Gradient",i,v);for(var h=n._stops,l=0,f=h.length;l<f;l++){var d=h[l],g=d._color,p=g.getAlpha(),m=d._offset;i={offset:null==m?l/(f-1):m},g&&(i["stop-color"]=g.toCSS(!0)),p<1&&(i["stop-opacity"]=p),e.appendChild(it.create("stop",i,v))}u(t,e,"color")}return"url(#"+e.id+")"}function a(t,e,i){var n={},a=!i&&t.getParent(),o=[];return null!=t._name&&(n.id=t._name),r.each(nt,function(e){var i=e.get,c=e.type,h=t[i]();if(e.exportFilter?e.exportFilter(t,h):!a||!r.equals(a[i](),h)){if("color"===c&&null!=h){var l=h.getAlpha();l<1&&(n[e.attribute+"-opacity"]=l)}"style"===c?o.push(e.attribute+": "+h):n[e.attribute]=null==h?"none":"color"===c?h.gradient?s(h,t):h.toCSS(!0):"array"===c?h.join(","):"lookup"===c?e.toSVG[h]:h}}),o.length&&(n.style=o.join(";")),1===n.opacity&&delete n.opacity,t._visible||(n.visibility="hidden"),it.set(e,n,v)}function o(t,e){return _||(_={ids:{},svgs:{}}),t&&_.svgs[e+"-"+(t._id||t.__id||(t.__id=l.get("svg")))]}function u(t,e,i){_||o();var n=_.ids[i]=(_.ids[i]||0)+1;e.id=i+"-"+n,_.svgs[i+"-"+(t._id||t.__id)]=e}function f(e,i){var n=e,r=null;if(_){n="svg"===e.nodeName.toLowerCase()&&e;for(var s in _.svgs)r||(n||(n=it.create("svg")).appendChild(e),r=n.insertBefore(it.create("defs"),n.firstChild)),r.appendChild(_.svgs[s]);_=null}return i.asString?(new t.XMLSerializer).serializeToString(n):n}function d(t,e,i){var n=x[t._class],r=n&&n(t,e);if(r){var s=e.onExport;s&&(r=s(t,r,e)||r);var o=JSON.stringify(t._data);o&&"{}"!==o&&"null"!==o&&r.setAttribute("data-paper-data",o)}return r&&a(t,r,i)}function g(t){return t||(t={}),v=new c(t.precision),t}var v,_,x={Group:i,Layer:i,Raster:function(t,i){var n=e(t._matrix,!0),r=t.getSize(),s=t.getImage();return n.x-=r.width/2,n.y-=r.height/2,n.width=r.width,n.height=r.height,n.href=0==i.embedImages&&s&&s.src||t.toDataURL(),it.create("image",n,v)},Path:function(t,i){var r=i.matchShapes;if(r){var s=t.toShape(!1);if(s)return n(s)}var a,o=t._segments,c=o.length,h=e(t._matrix);if(r&&c>=2&&!t.hasHandles())if(c>2){a=t._closed?"polygon":"polyline";for(var l=[],u=0;u<c;u++)l.push(v.point(o[u]._point));h.points=l.join(" ")}else{a="line";var f=o[0]._point,d=o[1]._point;h.set({x1:f.x,y1:f.y,x2:d.x,y2:d.y})}else a="path",h.d=t.getPathData(null,i.precision);return it.create(a,h,v)},Shape:n,CompoundPath:function(t,i){var n=e(t._matrix),r=t.getPathData(null,i.precision);return r&&(n.d=r),it.create("path",n,v)},SymbolItem:function(t,i){var n=e(t._matrix,!0),r=t._definition,s=o(r,"symbol"),a=r._item,c=a.getBounds();return s||((s=it.create("symbol",{viewBox:v.rectangle(c)})).appendChild(d(a,i)),u(r,s,"symbol")),n.href="#"+s.id,n.x+=c.x,n.y+=c.y,n.width=c.width,n.height=c.height,n.overflow="visible",it.create("use",n,v)},PointText:function(t){var i=it.create("text",e(t._matrix,!0),v);return i.textContent=t._content,i}};y.inject({exportSVG:function(t){return t=g(t),f(d(this,t,!0),t)}}),b.inject({exportSVG:function(t){t=g(t);var i=this._children,n=this.getView(),s=r.pick(t.bounds,"view"),a=t.matrix||"view"===s&&n._matrix,o=a&&m.read([a]),c="view"===s?new p([0,0],n.getViewSize()):"content"===s?y._getBounds(i,o,{stroke:!0}).rect:p.read([s],0,{readNull:!0}),h={version:"1.1",xmlns:it.svg,"xmlns:xlink":it.xlink};c&&(h.width=c.width,h.height=c.height,(c.x||c.y)&&(h.viewBox=v.rectangle(c)));var l=it.create("svg",h,v),u=l;o&&!o.isIdentity()&&(u=l.appendChild(it.create("g",e(o),v)));for(var _=0,b=i.length;_<b;_++)u.appendChild(d(i[_],t,!0));return f(l,t)}})},new function(){function s(t,e,i,n,r){var s=it.get(t,e),a=null==s?n?null:i?"":0:i?s:parseFloat(s);return/%\s*$/.test(s)?a/100*(r?1:P[/x|^width/.test(e)?"width":"height"]):a}function a(t,e,i,n,r){return e=s(t,e||"x",!1,n,r),i=s(t,i||"y",!1,n,r),!n||null!=e&&null!=i?new u(e,i):null}function o(t,e,i,n,r){return e=s(t,e||"width",!1,n,r),i=s(t,i||"height",!1,n,r),!n||null!=e&&null!=i?new d(e,i):null}function c(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?S(t)||t:"lookup"===e?i[t]:t}function h(t,e,i,n){var r=t.childNodes,s="clippath"===e,a="defs"===e,o=new x,c=o._project,h=c._currentStyle,l=[];if(s||a||(o=w(o,t,n),c._currentStyle=o._style.clone()),n)for(var u=t.querySelectorAll("defs"),f=0,d=u.length;f<d;f++)k(u[f],i,!1);for(var f=0,d=r.length;f<d;f++){var g,p=r[f];1!==p.nodeType||/^defs$/i.test(p.nodeName)||!(g=k(p,i,!1))||g instanceof T||l.push(g)}return o.addChildren(l),s&&(o=w(o.reduce(),t,n)),c._currentStyle=h,(s||a)&&(o.remove(),o=null),o}function l(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new u(parseFloat(i[r]),parseFloat(i[r+1])));var a=new M(n);return"polygon"===e&&a.closePath(),a}function f(t,e){var i,n=(s(t,"href",!0)||"").substring(1),r="radialgradient"===e;if(n)(i=E[n].getGradient())._radial^r&&((i=i.clone())._radial=r);else{for(var o=t.childNodes,c=[],h=0,l=o.length;h<l;h++){var u=o[h];1===u.nodeType&&c.push(w(new U,u))}i=new z(c,r)}var f,d,g,p="userSpaceOnUse"!==s(t,"gradientUnits",!0);return r?(d=(f=a(t,"cx","cy",!1,p)).add(s(t,"r",!1,!1,p),0),g=a(t,"fx","fy",!0,p)):(f=a(t,"x1","y1",!1,p),d=a(t,"x2","y2",!1,p)),w(new B(i,f,d,g),t)._scaleToBounds=p,null}function g(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new m,a=0,o=r.length;a<o;a++){var c=r[a];if(!c)break;for(var h=c.split(/\(\s*/),l=h[0],u=h[1].split(/[\s,]+/g),f=0,d=u.length;f<d;f++)u[f]=parseFloat(u[f]);switch(l){case"matrix":s.append(new m(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":s.rotate(u[0],u[1],u[2]);break;case"translate":s.translate(u[0],u[1]);break;case"scale":s.scale(u);break;case"skewX":s.skew(u[0],0);break;case"skewY":s.skew(0,u[0])}}t.transform(s)}}function v(t,e,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=t[n]&&t[n]();r&&r.setAlpha(parseFloat(e))}function _(t,i,n){var s=t.attributes[i],a=s&&s.value;if(!a){var o=r.camelize(i);(a=t.style[o])||n.node[o]===n.parent[o]||(a=n.node[o])}return a?"none"===a?null:a:e}function w(t,i,n){if(i.style){var s=i.parentNode,a={node:W.getStyles(i)||{},parent:!n&&!/^defs$/i.test(s.tagName)&&W.getStyles(s)||{}};r.each(D,function(n,r){var s=_(i,r,a);t=s!==e&&n(t,s,r,i,a)||t})}return t}function S(t){var e=t&&t.match(/\((?:["'#]*)([^"')]+)/),n=e&&e[1],r=n&&E[i?n.replace(i.location.href.split("#")[0]+"#",""):n];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function k(t,e,i){var s,a,c,h=t.nodeName.toLowerCase(),l="#document"!==h,u=n.body;i&&l&&(P=paper.getView().getSize(),P=o(t,null,null,!0)||P,s=it.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),a=t.parentNode,c=t.nextSibling,s.appendChild(t),u.appendChild(s));var f=paper.settings,d=f.applyMatrix,g=f.insertItems;f.applyMatrix=!1,f.insertItems=!1;var p=L[h],v=p&&p(t,h,e,i)||null;if(f.insertItems=g,f.applyMatrix=d,v){!l||v instanceof x||(v=w(v,t,i));var m=e.onImport,_=l&&t.getAttribute("data-paper-data");m&&(v=m(t,v,e)||v),e.expandShapes&&v instanceof C&&(v.remove(),v=v.toPath()),_&&(v._data=JSON.parse(_))}return s&&(u.removeChild(s),a&&(c?a.insertBefore(t,c):a.appendChild(t))),i&&(E={},v&&r.pick(e.applyMatrix,d)&&v.matrix.apply(!0,!0)),v}function O(i,r,s){function a(n){try{var a="object"==typeof n?n:(new t.DOMParser).parseFromString(n,"image/svg+xml");if(!a.nodeName)throw a=null,new Error("Unsupported SVG source: "+i);paper=c,h=k(a,r,!0),r&&!1===r.insert||s._insertItem(e,h);var l=r.onLoad;l&&l(h,n)}catch(t){o(t)}}function o(t,e){var i=r.onError;if(!i)throw new Error(t);i(t,e)}if(!i)return null;r="function"==typeof r?{onLoad:r}:r||{};var c=paper,h=null;if("string"!=typeof i||/^.*</.test(i)){if("undefined"!=typeof File&&i instanceof File){var l=new FileReader;return l.onload=function(){a(l.result)},l.onerror=function(){o(l.error)},l.readAsText(i)}a(i)}else{var u=n.getElementById(i);u?a(u):Q.request({url:i,async:!0,onLoad:a,onError:o})}return h}var P,E={},L={"#document":function(t,e,i,n){for(var r=t.childNodes,s=0,a=r.length;s<a;s++){var o=r[s];if(1===o.nodeType)return k(o,i,n)}},g:h,svg:h,clippath:h,polygon:l,polyline:l,path:function(t){return I.create(t.getAttribute("d"))},lineargradient:f,radialgradient:f,image:function(t){var e=new A(s(t,"href",!0));return e.on("load",function(){var e=o(t);this.setSize(e);var i=this._matrix._transformPoint(a(t).add(e.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new T(h(t,e,i,n),!0)},defs:h,use:function(t){var e=(s(t,"href",!0)||"").substring(1),i=E[e],n=a(t);return i?i instanceof T?i.place(n):i.clone().translate(n):null},circle:function(t){return new C.Circle(a(t,"cx","cy"),s(t,"r"))},ellipse:function(t){return new C.Ellipse({center:a(t,"cx","cy"),radius:o(t,"rx","ry")})},rect:function(t){return new C.Rectangle(new p(a(t),o(t)),o(t,"rx","ry"))},line:function(t){return new M.Line(a(t,"x1","y1"),a(t,"x2","y2"))},text:function(t){var e=new N(a(t).add(a(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}},D=r.set(r.each(nt,function(t){this[t.attribute]=function(e,i){if(e[t.set]&&(e[t.set](c(i,t.type,t.fromSVG)),"color"===t.type)){var n=e[t.get]();if(n&&n._scaleToBounds){var r=e.getBounds();n.transform((new m).translate(r.getPoint()).scale(r.getSize()))}}}},{}),{id:function(t,e){E[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=S(e);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof x))return new x(i,t);t.insertChild(0,i)}},gradientTransform:g,transform:g,"fill-opacity":v,"stroke-opacity":v,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var i=e.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(e))}},viewBox:function(t,e,i,n,r){var s,a=new p(c(e,"array")),h=o(n,null,null,!0);if(t instanceof x){var l=h?h.divide(a.getSize()):1,u=(new m).scale(l).translate(a.getPoint().negate());s=t}else t instanceof T&&(h&&a.setSize(h),s=t._item);if(s){if("visible"!==_(n,"overflow",r)){var f=new C.Rectangle(a);f.setClipMask(!0),s.addChild(f)}u&&s.transform(u)}}});y.inject({importSVG:function(t,e){return O(t,e,this)}}),b.inject({importSVG:function(t,e){return this.activate(),O(t,e,this)}})},r.exports.PaperScript=function(){function e(t,e){return(g.acorn||p).parse(t,e)}function s(t,e,i){var n=_[e];if(t&&t[n]){var r=t[n](i);return"!="===e?!r:r}switch(e){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;case"%":return t%i;case"==":return t==i;case"!=":return t!=i}}function o(t,e){var i=b[t];if(e&&e[i])return e[i]();switch(t){case"+":return+e;case"-":return-e}}function c(r,s){function a(t){for(var e=0,i=f.length;e<i;e++){var n=f[e];if(n[0]>=t)break;t+=n[1]}return t}function o(t){return r.substring(a(t.range[0]),a(t.range[1]))}function c(t,e){return r.substring(a(t.range[1]),a(e.range[0]))}function h(t,e){for(var i=a(t.range[0]),n=a(t.range[1]),s=0,o=f.length-1;o>=0;o--)if(i>f[o][0]){s=o+1;break}f.splice(s,0,[i,e.length-n+i]),r=r.substring(0,i)+e+r.substring(n)}function l(t,e){if(t){for(var i in t)if("range"!==i&&"loc"!==i){var n=t[i];if(Array.isArray(n))for(var r=0,s=n.length;r<s;r++)l(n[r],t);else n&&"object"==typeof n&&l(n,t)}switch(t.type){case"UnaryExpression":if(t.operator in b&&"Literal"!==t.argument.type){var a=o(t.argument);h(t,'$__("'+t.operator+'", '+a+")")}break;case"BinaryExpression":if(t.operator in _&&"Literal"!==t.left.type){var u=o(t.left),f=o(t.right),d=c(t.left,t.right),g=t.operator;h(t,"__$__("+u+","+d.replace(new RegExp("\\"+g),'"'+g+'"')+", "+f+")")}break;case"UpdateExpression":case"AssignmentExpression":var p=e&&e.type;if(!("ForStatement"===p||"BinaryExpression"===p&&/^[=!<>]/.test(e.operator)||"MemberExpression"===p&&e.computed))if("UpdateExpression"===t.type){var v=(a=o(t.argument))+" = "+(m="__$__("+a+', "'+t.operator[0]+'", 1)');t.prefix||"AssignmentExpression"!==p&&"VariableDeclarator"!==p||(o(e.left||e.id)===a&&(v=m),v=a+"; "+v),h(t,v)}else if(/^.=$/.test(t.operator)&&"Literal"!==t.left.type){var u=o(t.left),f=o(t.right),m=u+" = __$__("+u+', "'+t.operator[0]+'", '+f+")";h(t,/^\(.*\)$/.test(o(t))?"("+m+")":m)}}}}if(!r)return"";var u,f=[],d=(s=s||{}).url||"",g=paper.agent,p=g.versionNumber,v=!1,m=s.sourceMaps,y=s.source||r,x=/\r\n|\n|\r/gm,w=s.offset||0;if(m&&(g.chrome&&p>=30||g.webkit&&p>=537.76||g.firefox&&p>=23||g.node)){if(g.node)w-=2;else if(i&&d&&!i.location.href.indexOf(d)){var C=n.getElementsByTagName("html")[0].innerHTML;w=C.substr(0,C.indexOf(r)+1).match(x).length+1}var A=["AA"+function(t){var e="";for(t=(Math.abs(t)<<1)+(t<0?1:0);t||!e;){var i=31&t;(t>>=5)&&(i|=32),e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[i]}return e}((v=w>0&&!(g.chrome&&p>=36||g.safari&&p>=600||g.firefox&&p>=40||g.node))?0:w)+"A"];A.length=(r.match(x)||[]).length+1+(v?w:0),u={version:3,file:d,names:[],mappings:A.join(";AACA"),sourceRoot:"",sources:[d],sourcesContent:[y]}}return l(e(r,{ranges:!0,preserveParens:!0})),u&&(v&&(r=new Array(w+1).join("\n")+r),/^(inline|both)$/.test(m)&&(r+="\n//# sourceMappingURL=data:application/json;base64,"+t.btoa(unescape(encodeURIComponent(JSON.stringify(u))))),r+="\n//# sourceURL="+(d||"paperscript")),{url:d,source:y,code:r,map:u}}function h(t,e,i){function a(e,i){for(var n in e)!i&&/^_/.test(n)||!new RegExp("([\\b\\s\\W]|^)"+n.replace(/\$/g,"\\$")+"\\b").test(t)||(p.push(n),v.push(e[n]))}paper=e;var h,l=e.getView(),f=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(t)&&!/\bnew\s+Tool\b/.test(t)?new K:null,d=f?f._events:[],g=["onFrame","onResize"].concat(d),p=[],v=[],m="object"==typeof t?t:c(t,i);t=m.code,a({__$__:s,$__:o,paper:e,view:l,tool:f},!0),a(e),(g=r.each(g,function(e){new RegExp("\\s+"+e+"\\b").test(t)&&(p.push(e),this.push(e+": "+e))},[]).join(", "))&&(t+="\nreturn { "+g+" };");var _=paper.agent;if(n&&(_.chrome||_.firefox&&_.versionNumber<40)){var b=n.createElement("script"),y=n.head||n.getElementsByTagName("head")[0];_.firefox&&(t="\n"+t),b.appendChild(n.createTextNode("paper._execute = function("+p+") {"+t+"\n}")),y.appendChild(b),h=paper._execute,delete paper._execute,y.removeChild(b)}else h=Function(p,t);var x=h.apply(e,v)||{};return r.each(d,function(t){var e=x[t];e&&(f[t]=e)}),l&&(x.onResize&&l.setOnResize(x.onResize),l.emit("resize",{size:l.size,delta:new u}),x.onFrame&&l.setOnFrame(x.onFrame),l.requestUpdate()),m}function l(t){if(/^text\/(?:x-|)paperscript$/.test(t.type)&&"true"!==a.getAttribute(t,"ignore")){var e=a.getAttribute(t,"canvas"),i=n.getElementById(e),r=t.src||t.getAttribute("data-src"),s=a.hasAttribute(t,"async");if(!i)throw new Error('Unable to find canvas with id "'+e+'"');var o=a.get(i.getAttribute("data-paper-scope"))||(new a).setup(i);return i.setAttribute("data-paper-scope",o._id),r?Q.request({url:r,async:s,mimeType:"text/plain",onLoad:function(t){h(t,o,r)}}):h(t.innerHTML,o,t.baseURI),t.setAttribute("data-paper-ignore","true"),o}}function f(){r.each(n&&n.getElementsByTagName("script"),l)}var g=this,p=g.acorn;if(!p&&"undefined"!=typeof require)try{p=require("acorn")}catch(t){}if(!p){var v,m;p=v=m={},function(t,e){"object"==typeof v&&"object"==typeof m?e(v):"function"==typeof define&&define.amd?define(["exports"],e):e(t.acorn||(t.acorn={}))}(this,function(t){"use strict";function e(t){ut=t||{};for(var e in pt)Object.prototype.hasOwnProperty.call(ut,e)||(ut[e]=pt[e]);gt=ut.sourceFile||null}function i(t,e){var i=vt(ft,t);e+=" ("+i.line+":"+i.column+")";var n=new SyntaxError(e);throw n.pos=t,n.loc=i,n.raisedAt=mt,n}function n(t){function e(t){if(1==t.length)return i+="return str === "+JSON.stringify(t[0])+";";i+="switch(str){";for(var e=0;e<t.length;++e)i+="case "+JSON.stringify(t[e])+":";i+="return true}return false;"}t=t.split(" ");var i="",n=[];t:for(s=0;s<t.length;++s){for(var r=0;r<n.length;++r)if(n[r][0].length==t[s].length){n[r].push(t[s]);continue t}n.push([t[s]])}if(n.length>3){n.sort(function(t,e){return e.length-t.length}),i+="switch(str.length){";for(var s=0;s<n.length;++s){var a=n[s];i+="case "+a[0].length+":",e(a)}i+="}"}else e(t);return new Function("str",i)}function r(){this.line=St,this.column=mt-Tt}function s(){St=1,mt=Tt=0,At=!0,h()}function a(t,e){bt=mt,ut.locations&&(xt=new r),wt=t,h(),Ct=e,At=t.beforeExpr}function o(){var t=ut.onComment&&ut.locations&&new r,e=mt,n=ft.indexOf("*/",mt+=2);if(-1===n&&i(mt-2,"Unterminated comment"),mt=n+2,ut.locations){$e.lastIndex=e;for(var s;(s=$e.exec(ft))&&s.index<mt;)++St,Tt=s.index+s[0].length}ut.onComment&&ut.onComment(!0,ft.slice(e+2,n),e,mt,t,ut.locations&&new r)}function c(){for(var t=mt,e=ut.onComment&&ut.locations&&new r,i=ft.charCodeAt(mt+=2);mt<dt&&10!==i&&13!==i&&8232!==i&&8233!==i;)++mt,i=ft.charCodeAt(mt);ut.onComment&&ut.onComment(!1,ft.slice(t+2,mt),t,mt,e,ut.locations&&new r)}function h(){for(;mt<dt;){var t=ft.charCodeAt(mt);if(32===t)++mt;else if(13===t)++mt,10===(e=ft.charCodeAt(mt))&&++mt,ut.locations&&(++St,Tt=mt);else if(10===t||8232===t||8233===t)++mt,ut.locations&&(++St,Tt=mt);else if(t>8&&t<14)++mt;else if(47===t){var e=ft.charCodeAt(mt+1);if(42===e)o();else{if(47!==e)break;c()}}else if(160===t)++mt;else{if(!(t>=5760&&Ye.test(String.fromCharCode(t))))break;++mt}}}function l(){var t=ft.charCodeAt(mt+1);return t>=48&&t<=57?A(!0):(++mt,a(ye))}function u(){var t=ft.charCodeAt(mt+1);return At?(++mt,x()):61===t?y(Ae,2):y(we,1)}function f(){return 61===ft.charCodeAt(mt+1)?y(Ae,2):y(je,1)}function d(t){var e=ft.charCodeAt(mt+1);return e===t?y(124===t?ke:Oe,2):61===e?y(Ae,2):y(124===t?Pe:Le,1)}function g(){return 61===ft.charCodeAt(mt+1)?y(Ae,2):y(Ee,1)}function p(t){var e=ft.charCodeAt(mt+1);return e===t?45==e&&62==ft.charCodeAt(mt+2)&&qe.test(ft.slice(Ot,mt))?(mt+=3,c(),h(),b()):y(Se,2):61===e?y(Ae,2):y(Fe,1)}function v(t){var e=ft.charCodeAt(mt+1),i=1;return e===t?(i=62===t&&62===ft.charCodeAt(mt+2)?3:2,61===ft.charCodeAt(mt+i)?y(Ae,i+1):y(De,i)):33==e&&60==t&&45==ft.charCodeAt(mt+2)&&45==ft.charCodeAt(mt+3)?(mt+=4,c(),h(),b()):(61===e&&(i=61===ft.charCodeAt(mt+2)?3:2),y(Me,i))}function m(t){return 61===ft.charCodeAt(mt+1)?y(Ie,61===ft.charCodeAt(mt+2)?3:2):y(61===t?Ce:Te,1)}function _(t){switch(t){case 46:return l();case 40:return++mt,a(pe);case 41:return++mt,a(ve);case 59:return++mt,a(_e);case 44:return++mt,a(me);case 91:return++mt,a(ue);case 93:return++mt,a(fe);case 123:return++mt,a(de);case 125:return++mt,a(ge);case 58:return++mt,a(be);case 63:return++mt,a(xe);case 48:var e=ft.charCodeAt(mt+1);if(120===e||88===e)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return A(!1);case 34:case 39:return S(t);case 47:return u(t);case 37:case 42:return f();case 124:case 38:return d(t);case 94:return g();case 43:case 45:return p(t);case 60:case 62:return v(t);case 61:case 33:return m(t);case 126:return y(Te,1)}return!1}function b(t){if(t?mt=_t+1:_t=mt,ut.locations&&(yt=new r),t)return x();if(mt>=dt)return a(Nt);var e=ft.charCodeAt(mt);if(Je(e)||92===e)return O();var n=_(e);if(!1===n){var s=String.fromCharCode(e);if("\\"===s||Ge.test(s))return O();i(mt,"Unexpected character '"+s+"'")}return n}function y(t,e){var i=ft.slice(mt,mt+e);mt+=e,a(t,i)}function x(){for(var t,e,n="",r=mt;;){mt>=dt&&i(r,"Unterminated regular expression");var s=ft.charAt(mt);if(qe.test(s)&&i(r,"Unterminated regular expression"),t)t=!1;else{if("["===s)e=!0;else if("]"===s&&e)e=!1;else if("/"===s&&!e)break;t="\\"===s}++mt}n=ft.slice(r,mt);++mt;var o=k();o&&!/^[gmsiy]*$/.test(o)&&i(r,"Invalid regexp flag");try{var c=new RegExp(n,o)}catch(t){t instanceof SyntaxError&&i(r,t.message),i(t)}return a(Ft,c)}function w(t,e){for(var i=mt,n=0,r=0,s=null==e?1/0:e;r<s;++r){var a,o=ft.charCodeAt(mt);if((a=o>=97?o-97+10:o>=65?o-65+10:o>=48&&o<=57?o-48:1/0)>=t)break;++mt,n=n*t+a}return mt===i||null!=e&&mt-i!==e?null:n}function C(){mt+=2;var t=w(16);return null==t&&i(_t+2,"Expected hexadecimal number"),Je(ft.charCodeAt(mt))&&i(mt,"Identifier directly after number"),a(Dt,t)}function A(t){var e=mt,n=!1,r=48===ft.charCodeAt(mt);t||null!==w(10)||i(e,"Invalid number"),46===ft.charCodeAt(mt)&&(++mt,w(10),n=!0);var s=ft.charCodeAt(mt);69!==s&&101!==s||(43!==(s=ft.charCodeAt(++mt))&&45!==s||++mt,null===w(10)&&i(e,"Invalid number"),n=!0),Je(ft.charCodeAt(mt))&&i(mt,"Identifier directly after number");var o,c=ft.slice(e,mt);return n?o=parseFloat(c):r&&1!==c.length?/[89]/.test(c)||It?i(e,"Invalid number"):o=parseInt(c,8):o=parseInt(c,10),a(Dt,o)}function S(t){mt++;for(var e="";;){mt>=dt&&i(_t,"Unterminated string constant");var n=ft.charCodeAt(mt);if(n===t)return++mt,a(jt,e);if(92===n){n=ft.charCodeAt(++mt);var r=/^[0-7]+/.exec(ft.slice(mt,mt+3));for(r&&(r=r[0]);r&&parseInt(r,8)>255;)r=r.slice(0,-1);if("0"===r&&(r=null),++mt,r)It&&i(mt-2,"Octal literal in strict mode"),e+=String.fromCharCode(parseInt(r,8)),mt+=r.length-1;else switch(n){case 110:e+="\n";break;case 114:e+="\r";break;case 120:e+=String.fromCharCode(T(2));break;case 117:e+=String.fromCharCode(T(4));break;case 85:e+=String.fromCharCode(T(8));break;case 116:e+="\t";break;case 98:e+="\b";break;case 118:e+="\v";break;case 102:e+="\f";break;case 48:e+="\0";break;case 13:10===ft.charCodeAt(mt)&&++mt;case 10:ut.locations&&(Tt=mt,++St);break;default:e+=String.fromCharCode(n)}}else 13!==n&&10!==n&&8232!==n&&8233!==n||i(_t,"Unterminated string constant"),e+=String.fromCharCode(n),++mt}}function T(t){var e=w(16,t);return null===e&&i(_t,"Bad character escape sequence"),e}function k(){Ne=!1;for(var t,e=!0,n=mt;;){var r=ft.charCodeAt(mt);if(Ze(r))Ne&&(t+=ft.charAt(mt)),++mt;else{if(92!==r)break;Ne||(t=ft.slice(n,mt)),Ne=!0,117!=ft.charCodeAt(++mt)&&i(mt,"Expecting Unicode escape sequence \\uXXXX"),++mt;var s=T(4),a=String.fromCharCode(s);a||i(mt-1,"Invalid Unicode escape"),(e?Je(s):Ze(s))||i(mt-4,"Invalid Unicode escape"),t+=a}e=!1}return Ne?t:ft.slice(n,mt)}function O(){var t=k(),e=Rt;return!Ne&&We(t)&&(e=le[t]),a(e,t)}function P(){kt=_t,Ot=bt,Pt=xt,b()}function E(t){if(It=t,mt=_t,ut.locations)for(;mt<Tt;)Tt=ft.lastIndexOf("\n",Tt-2)+1,--St;h(),b()}function L(){this.type=null,this.start=_t,this.end=null}function I(){this.start=yt,this.end=null,null!==gt&&(this.source=gt)}function M(){var t=new L;return ut.locations&&(t.loc=new I),ut.directSourceFile&&(t.sourceFile=ut.directSourceFile),ut.ranges&&(t.range=[_t,0]),t}function D(t){var e=new L;return e.start=t.start,ut.locations&&(e.loc=new I,e.loc.start=t.loc.start),ut.ranges&&(e.range=[t.range[0],0]),e}function F(t,e){return t.type=e,t.end=Ot,ut.locations&&(t.loc.end=Pt),ut.ranges&&(t.range[1]=Ot),t}function j(t){return ut.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function R(t){if(wt===t)return P(),!0}function N(){return!ut.strictSemicolons&&(wt===Nt||wt===ge||qe.test(ft.slice(Ot,_t)))}function B(){R(_e)||N()||U()}function z(t){wt===t?P():U()}function U(){i(_t,"Unexpected token")}function X(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&i(t.start,"Assigning to rvalue"),It&&"Identifier"===t.type&&Xe(t.name)&&i(t.start,"Assigning to "+t.name+" in strict mode")}function W(t){kt=Ot=mt,ut.locations&&(Pt=new r),Et=It=null,Lt=[],b();var e=t||M(),i=!0;for(t||(e.body=[]);wt!==Nt;){var n=Y();e.body.push(n),i&&j(n)&&E(!0),i=!1}return F(e,"Program")}function Y(){(wt===we||wt===Ae&&"/="==Ct)&&b(!0);var t=wt,e=M();switch(t){case Bt:case Xt:P();var n=t===Bt;R(_e)||N()?e.label=null:wt!==Rt?U():(e.label=lt(),B());for(f=0;f<Lt.length;++f){var r=Lt[f];if(null==e.label||r.name===e.label.name){if(null!=r.kind&&(n||"loop"===r.kind))break;if(e.label&&n)break}}return f===Lt.length&&i(e.start,"Unsyntactic "+t.keyword),F(e,n?"BreakStatement":"ContinueStatement");case Wt:return P(),B(),F(e,"DebuggerStatement");case Vt:return P(),Lt.push(Ke),e.body=Y(),Lt.pop(),z(ie),e.test=V(),B(),F(e,"DoWhileStatement");case qt:if(P(),Lt.push(Ke),z(pe),wt===_e)return H(e,null);if(wt===ee){s=M();return P(),$(s,!0),F(s,"VariableDeclaration"),1===s.declarations.length&&R(he)?q(e,s):H(e,s)}var s=J(!1,!0);return R(he)?(X(s),q(e,s)):H(e,s);case $t:return P(),ct(e,!0);case Jt:return P(),e.test=V(),e.consequent=Y(),e.alternate=R(Gt)?Y():null,F(e,"IfStatement");case Zt:return Et||ut.allowReturnOutsideFunction||i(_t,"'return' outside of function"),P(),R(_e)||N()?e.argument=null:(e.argument=J(),B()),F(e,"ReturnStatement");case Kt:P(),e.discriminant=V(),e.cases=[],z(de),Lt.push(Qe);for(var a,o;wt!=ge;)if(wt===zt||wt===Yt){var c=wt===zt;a&&F(a,"SwitchCase"),e.cases.push(a=M()),a.consequent=[],P(),c?a.test=J():(o&&i(kt,"Multiple default clauses"),o=!0,a.test=null),z(be)}else a||U(),a.consequent.push(Y());return a&&F(a,"SwitchCase"),P(),Lt.pop(),F(e,"SwitchStatement");case Qt:return P(),qe.test(ft.slice(Ot,_t))&&i(Ot,"Illegal newline after throw"),e.argument=J(),B(),F(e,"ThrowStatement");case te:if(P(),e.block=G(),e.handler=null,wt===Ut){var h=M();P(),z(pe),h.param=lt(),It&&Xe(h.param.name)&&i(h.param.start,"Binding "+h.param.name+" in strict mode"),z(ve),h.guard=null,h.body=G(),e.handler=F(h,"CatchClause")}return e.guardedHandlers=Mt,e.finalizer=R(Ht)?G():null,e.handler||e.finalizer||i(e.start,"Missing catch or finally clause"),F(e,"TryStatement");case ee:return P(),$(e),B(),F(e,"VariableDeclaration");case ie:return P(),e.test=V(),Lt.push(Ke),e.body=Y(),Lt.pop(),F(e,"WhileStatement");case ne:return It&&i(_t,"'with' in strict mode"),P(),e.object=V(),e.body=Y(),F(e,"WithStatement");case de:return G();case _e:return P(),F(e,"EmptyStatement");default:var l=Ct,u=J();if(t===Rt&&"Identifier"===u.type&&R(be)){for(var f=0;f<Lt.length;++f)Lt[f].name===l&&i(u.start,"Label '"+l+"' is already declared");var d=wt.isLoop?"loop":wt===Kt?"switch":null;return Lt.push({name:l,kind:d}),e.body=Y(),Lt.pop(),e.label=u,F(e,"LabeledStatement")}return e.expression=u,B(),F(e,"ExpressionStatement")}}function V(){z(pe);var t=J();return z(ve),t}function G(t){var e,i=M(),n=!0,r=!1;for(i.body=[],z(de);!R(ge);){var s=Y();i.body.push(s),n&&t&&j(s)&&(e=r,E(r=!0)),n=!1}return r&&!e&&E(!1),F(i,"BlockStatement")}function H(t,e){return t.init=e,z(_e),t.test=wt===_e?null:J(),z(_e),t.update=wt===ve?null:J(),z(ve),t.body=Y(),Lt.pop(),F(t,"ForStatement")}function q(t,e){return t.left=e,t.right=J(),z(ve),t.body=Y(),Lt.pop(),F(t,"ForInStatement")}function $(t,e){for(t.declarations=[],t.kind="var";;){var n=M();if(n.id=lt(),It&&Xe(n.id.name)&&i(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=R(Ce)?J(!0,e):null,t.declarations.push(F(n,"VariableDeclarator")),!R(me))break}return t}function J(t,e){var i=Z(e);if(!t&&wt===me){var n=D(i);for(n.expressions=[i];R(me);)n.expressions.push(Z(e));return F(n,"SequenceExpression")}return i}function Z(t){var e=K(t);if(wt.isAssign){var i=D(e);return i.operator=Ct,i.left=e,P(),i.right=Z(t),X(e),F(i,"AssignmentExpression")}return e}function K(t){var e=Q(t);if(R(xe)){var i=D(e);return i.test=e,i.consequent=J(!0),z(be),i.alternate=J(!0,t),F(i,"ConditionalExpression")}return e}function Q(t){return tt(et(),-1,t)}function tt(t,e,i){var n=wt.binop;if(null!=n&&(!i||wt!==he)&&n>e){var r=D(t);r.left=t,r.operator=Ct;var s=wt;return P(),r.right=tt(et(),n,i),tt(F(r,s===ke||s===Oe?"LogicalExpression":"BinaryExpression"),e,i)}return t}function et(){if(wt.prefix){var t=M(),e=wt.isUpdate;return t.operator=Ct,t.prefix=!0,At=!0,P(),t.argument=et(),e?X(t.argument):It&&"delete"===t.operator&&"Identifier"===t.argument.type&&i(t.start,"Deleting local variable in strict mode"),F(t,e?"UpdateExpression":"UnaryExpression")}for(var n=it();wt.postfix&&!N();)(t=D(n)).operator=Ct,t.prefix=!1,t.argument=n,X(n),P(),n=F(t,"UpdateExpression");return n}function it(){return nt(rt())}function nt(t,e){if(R(ye))return(i=D(t)).object=t,i.property=lt(!0),i.computed=!1,nt(F(i,"MemberExpression"),e);if(R(ue))return(i=D(t)).object=t,i.property=J(),i.computed=!0,z(fe),nt(F(i,"MemberExpression"),e);if(!e&&R(pe)){var i=D(t);return i.callee=t,i.arguments=ht(ve,!1),nt(F(i,"CallExpression"),e)}return t}function rt(){switch(wt){case se:n=M();return P(),F(n,"ThisExpression");case Rt:return lt();case Dt:case jt:case Ft:return(n=M()).value=Ct,n.raw=ft.slice(_t,bt),P(),F(n,"Literal");case ae:case oe:case ce:return(n=M()).value=wt.atomValue,n.raw=wt.keyword,P(),F(n,"Literal");case pe:var t=yt,e=_t;P();var i=J();return i.start=e,i.end=bt,ut.locations&&(i.loc.start=t,i.loc.end=xt),ut.ranges&&(i.range=[e,bt]),z(ve),i;case ue:n=M();return P(),n.elements=ht(fe,!0,!0),F(n,"ArrayExpression");case de:return at();case $t:var n=M();return P(),ct(n,!1);case re:return st();default:U()}}function st(){var t=M();return P(),t.callee=nt(rt(),!0),R(pe)?t.arguments=ht(ve,!1):t.arguments=Mt,F(t,"NewExpression")}function at(){var t=M(),e=!0,n=!1;for(t.properties=[],P();!R(ge);){if(e)e=!1;else if(z(me),ut.allowTrailingCommas&&R(ge))break;var r,s={key:ot()},a=!1;if(R(be)?(s.value=J(!0),r=s.kind="init"):ut.ecmaVersion>=5&&"Identifier"===s.key.type&&("get"===s.key.name||"set"===s.key.name)?(a=n=!0,r=s.kind=s.key.name,s.key=ot(),wt!==pe&&U(),s.value=ct(M(),!1)):U(),"Identifier"===s.key.type&&(It||n))for(var o=0;o<t.properties.length;++o){var c=t.properties[o];if(c.key.name===s.key.name){var h=r==c.kind||a&&"init"===c.kind||"init"===r&&("get"===c.kind||"set"===c.kind);h&&!It&&"init"===r&&"init"===c.kind&&(h=!1),h&&i(s.key.start,"Redefinition of property")}}t.properties.push(s)}return F(t,"ObjectExpression")}function ot(){return wt===Dt||wt===jt?rt():lt(!0)}function ct(t,e){wt===Rt?t.id=lt():e?U():t.id=null,t.params=[];var n=!0;for(z(pe);!R(ve);)n?n=!1:z(me),t.params.push(lt());var r=Et,s=Lt;if(Et=!0,Lt=[],t.body=G(!0),Et=r,Lt=s,It||t.body.body.length&&j(t.body.body[0]))for(var a=t.id?-1:0;a<t.params.length;++a){var o=a<0?t.id:t.params[a];if((Ue(o.name)||Xe(o.name))&&i(o.start,"Defining '"+o.name+"' in strict mode"),a>=0)for(var c=0;c<a;++c)o.name===t.params[c].name&&i(o.start,"Argument name clash in strict mode")}return F(t,e?"FunctionDeclaration":"FunctionExpression")}function ht(t,e,i){for(var n=[],r=!0;!R(t);){if(r)r=!1;else if(z(me),e&&ut.allowTrailingCommas&&R(t))break;i&&wt===me?n.push(null):n.push(J(!0))}return n}function lt(t){var e=M();return t&&"everywhere"==ut.forbidReserved&&(t=!1),wt===Rt?(!t&&(ut.forbidReserved&&(3===ut.ecmaVersion?Be:ze)(Ct)||It&&Ue(Ct))&&-1==ft.slice(_t,bt).indexOf("\\")&&i(_t,"The keyword '"+Ct+"' is reserved"),e.name=Ct):t&&wt.keyword?e.name=wt.keyword:U(),At=!1,P(),F(e,"Identifier")}t.version="0.5.0";var ut,ft,dt,gt;t.parse=function(t,i){return ft=String(t),dt=ft.length,e(i),s(),W(ut.program)};var pt=t.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null},vt=t.getLineInfo=function(t,e){for(var i=1,n=0;;){$e.lastIndex=n;var r=$e.exec(t);if(!(r&&r.index<e))break;++i,n=r.index+r[0].length}return{line:i,column:e-n}};t.tokenize=function(t,i){function n(t){return Ot=bt,b(t),r.start=_t,r.end=bt,r.startLoc=yt,r.endLoc=xt,r.type=wt,r.value=Ct,r}ft=String(t),dt=ft.length,e(i),s();var r={};return n.jumpTo=function(t,e){if(mt=t,ut.locations){St=1,Tt=$e.lastIndex=0;for(var i;(i=$e.exec(ft))&&i.index<t;)++St,Tt=i.index+i[0].length}At=e,h()},n};var mt,_t,bt,yt,xt,wt,Ct,At,St,Tt,kt,Ot,Pt,Et,Lt,It,Mt=[],Dt={type:"num"},Ft={type:"regexp"},jt={type:"string"},Rt={type:"name"},Nt={type:"eof"},Bt={keyword:"break"},zt={keyword:"case",beforeExpr:!0},Ut={keyword:"catch"},Xt={keyword:"continue"},Wt={keyword:"debugger"},Yt={keyword:"default"},Vt={keyword:"do",isLoop:!0},Gt={keyword:"else",beforeExpr:!0},Ht={keyword:"finally"},qt={keyword:"for",isLoop:!0},$t={keyword:"function"},Jt={keyword:"if"},Zt={keyword:"return",beforeExpr:!0},Kt={keyword:"switch"},Qt={keyword:"throw",beforeExpr:!0},te={keyword:"try"},ee={keyword:"var"},ie={keyword:"while",isLoop:!0},ne={keyword:"with"},re={keyword:"new",beforeExpr:!0},se={keyword:"this"},ae={keyword:"null",atomValue:null},oe={keyword:"true",atomValue:!0},ce={keyword:"false",atomValue:!1},he={keyword:"in",binop:7,beforeExpr:!0},le={break:Bt,case:zt,catch:Ut,continue:Xt,debugger:Wt,default:Yt,do:Vt,else:Gt,finally:Ht,for:qt,function:$t,if:Jt,return:Zt,switch:Kt,throw:Qt,try:te,var:ee,while:ie,with:ne,null:ae,true:oe,false:ce,new:re,in:he,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:se,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ue={type:"[",beforeExpr:!0},fe={type:"]"},de={type:"{",beforeExpr:!0},ge={type:"}"},pe={type:"(",beforeExpr:!0},ve={type:")"},me={type:",",beforeExpr:!0},_e={type:";",beforeExpr:!0},be={type:":",beforeExpr:!0},ye={type:"."},xe={type:"?",beforeExpr:!0},we={binop:10,beforeExpr:!0},Ce={isAssign:!0,beforeExpr:!0},Ae={isAssign:!0,beforeExpr:!0},Se={postfix:!0,prefix:!0,isUpdate:!0},Te={prefix:!0,beforeExpr:!0},ke={binop:1,beforeExpr:!0},Oe={binop:2,beforeExpr:!0},Pe={binop:3,beforeExpr:!0},Ee={binop:4,beforeExpr:!0},Le={binop:5,beforeExpr:!0},Ie={binop:6,beforeExpr:!0},Me={binop:7,beforeExpr:!0},De={binop:8,beforeExpr:!0},Fe={binop:9,prefix:!0,beforeExpr:!0},je={binop:10,beforeExpr:!0};t.tokTypes={bracketL:ue,bracketR:fe,braceL:de,braceR:ge,parenL:pe,parenR:ve,comma:me,semi:_e,colon:be,dot:ye,question:xe,slash:we,eq:Ce,name:Rt,eof:Nt,num:Dt,regexp:Ft,string:jt};for(var Re in le)t.tokTypes["_"+Re]=le[Re];var Ne,Be=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),ze=n("class enum extends super const export import"),Ue=n("implements interface let package private protected public static yield"),Xe=n("eval arguments"),We=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Ye=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ve="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Ge=new RegExp("["+Ve+"]"),He=new RegExp("["+Ve+"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),qe=/[\n\r\u2028\u2029]/,$e=/\r\n|[\n\r\u2028\u2029]/g,Je=t.isIdentifierStart=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&Ge.test(String.fromCharCode(t)))},Ze=t.isIdentifierChar=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&He.test(String.fromCharCode(t))))},Ke={kind:"loop"},Qe={kind:"switch"}}),p.version||(p=null)}var _={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},b={"-":"__negate","+":"__self"},y=r.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(t){this["__"+t]="#"+t},{__self:function(){return this}});return u.inject(y),d.inject(y),B.inject(y),i&&("complete"===n.readyState?setTimeout(f):Y.add(i,{load:f})),{compile:c,execute:h,load:function(t){return t?l(t):f()},parse:e}}.call(this),(paper=new(a.inject(r.exports,{Base:r,Numerical:h,Key:$,DomEvent:Y,DomElement:W,document:n,window:i,Symbol:T,PlacedSymbol:S}))).agent.node&&require("./node/extend.js")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);earcut.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,a=Math.abs(signedArea(t,0,s,i));if(r)for(var o=0,c=e.length;o<c;o++){var h=e[o]*i,l=o<c-1?e[o+1]*i:t.length;a-=Math.abs(signedArea(t,h,l,i))}var u=0;for(o=0;o<n.length;o+=3){var f=n[o]*i,d=n[o+1]*i,g=n[o+2]*i;u+=Math.abs((t[f]-t[g])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[g+1]-t[f+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},earcut.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var a=0;a<e;a++)i.vertices.push(t[r][s][a]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i};var fabric=fabric||{version:"2.0.0-beta7"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),fabric.window=fabric.document.defaultView),fabric.isTouchSupported="ontouchstart"in fabric.window,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.canvasModule="canvas",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=fabric),function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:fabric.util.array.fill(i,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;r>n;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;e>t;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=!1,n=0,r=arguments.length;r>n;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,r=i.length;r>n;n++)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},fabric.CommonMethods={_setOptions:function(t){for(var e in t)this.set(e,t[e])},_initGradient:function(t,e){!t||!t.colorStops||t instanceof fabric.Gradient||this.set(e,new fabric.Gradient(t))},_initPattern:function(t,e,i){!t||!t.source||t instanceof fabric.Pattern?i&&i():this.set(e,new fabric.Pattern(t,i))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var e=fabric.util.getFunctionBody(t.clipTo);void 0!==e&&(this.clipTo=new Function("ctx",e))}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,e){this[t]=e},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},get:function(t){return this[t]}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.pow,r=Math.abs,s=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*s},radiansToDegrees:function(t){return t/s},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=fabric.util.rotateVector(t,i);return new fabric.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),n=Math.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),n=fabric.util.array.max(e)-i,r=[t[0].y,t[1].y,t[2].y,t[3].y],s=fabric.util.array.min(r);return{left:i,top:s,width:n,height:fabric.util.array.max(r)-s}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},resolveNamespace:function(e){if(!e)return fabric;var i,n=e.split("."),r=n.length,s=t||fabric.window;for(i=0;r>i;++i)s=s[n[i]];return s},loadImage:function(t,e,i,n){if(t){var r=fabric.util.createImage(),s=function(){e&&e.call(i,r),r=r.onload=r.onerror=null};r.onload=s,r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),"data:image/svg"===t.substring(0,14)&&(r.onload=null,fabric.util.loadImageInDom(r,s)),r.src=t}else e&&e.call(i,t)},loadImageInDom:function(t,e){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(t),fabric.document.querySelector("body").appendChild(i),t.onload=function(){e(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(t,e,i,n){function r(){++a===o&&e&&e(s)}var s=[],a=0,o=(t=t||[]).length;return o?void t.forEach(function(t,e){t&&t.type?fabric.util.getKlass(t.type,i).fromObject(t,function(i,a){a||(s[e]=i),n&&n(t,i,a),r()}):r()}):void(e&&e(s))},enlivenPatterns:function(t,e){function i(){++r===s&&e&&e(n)}var n=[],r=0,s=(t=t||[]).length;return s?void t.forEach(function(t,e){t&&t.source?new fabric.Pattern(t,function(t){n[e]=t,i()}):(n[e]=t,i())}):void(e&&e(n))},groupSVGElements:function(t,e,i){var n;return 1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),n=new fabric.Group(t,e),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;r>n;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,s,a,o){var c=s-n,h=a-r,l=e(c*c+h*h),u=i(h,c),f=o.length,d=0,g=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;l>n;)(n+=o[d++%f])>l&&(n=l),t[g?"lineTo":"moveTo"](n,0),g=!g;t.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},createImage:function(){return fabric.document.createElement("img")},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var r=i(t[1],t[0]),a=n(t[0],2)+n(t[1],2),o=e(a),c=(t[0]*t[3]-t[2]*t[1])/o,h=i(t[0]*t[2]+t[1]*t[3],a);return{angle:r/s,scaleX:o,scaleY:c,skewX:h/s,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var n=[1,0,r(Math.tan(i*s)),1],a=[r(t),0,0,r(e)];return fabric.util.multiplyTransformMatrices(a,n,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);var r,s,a=!0,o=t.getImageData(e,i,2*n||1,2*n||1),c=o.data.length;for(r=3;c>r&&(s=o.data[r],!1!==(a=0>=s));r+=4);return o=null,a},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n="Mid",r="Mid",s=t.split(" ");return s&&s.length&&("meet"!==(i=s.pop())&&"slice"!==i?(e=i,i="meet"):s.length&&(e=s.pop())),n="none"!==e?e.slice(1,4):"none",r="none"!==e?e.slice(5,8):"none",{meetOrSlice:i,alignX:n,alignY:r}},clearFabricFontCache:function(t){t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}},limitDimsByArea:function(t,e){var i=Math.sqrt(e*t),n=Math.floor(e/i);return{x:Math.floor(i),y:n}},capValue:function(t,e,i){return Math.max(t,Math.min(e,i))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)}}}("undefined"!=typeof exports?exports:this),"undefined"!=typeof exports&&exports,fabric.util.createAccessors=function(t){var e,i,n,r,s,a=t.prototype;for(e=a.stateProperties.length;e--;)i=a.stateProperties[e],n=i.charAt(0).toUpperCase()+i.slice(1),r="set"+n,s="get"+n,a[s]||(a[s]=function(t){return new Function('return this.get("'+t+'")')}(i)),a[r]||(a[r]=function(t){return new Function("value",'return this.set("'+t+'", value)')}(i))},function(){function t(t,n,s,a,c,h,l){var u=o.call(arguments);if(r[u])return r[u];var f=Math.PI,d=l*f/180,g=Math.sin(d),p=Math.cos(d),v=0,m=0,_=-p*t*.5-g*n*.5,b=-p*n*.5+g*t*.5,y=(s=Math.abs(s))*s,x=(a=Math.abs(a))*a,w=b*b,C=_*_,A=y*x-y*w-x*C,S=0;if(0>A){var T=Math.sqrt(1-A/(y*x));s*=T,a*=T}else S=(c===h?-1:1)*Math.sqrt(A/(y*w+x*C));var k=S*s*b/a,O=-S*a*_/s,P=p*k-g*O+.5*t,E=g*k+p*O+.5*n,L=i(1,0,(_-k)/s,(b-O)/a),I=i((_-k)/s,(b-O)/a,(-_-k)/s,(-b-O)/a);0===h&&I>0?I-=2*f:1===h&&0>I&&(I+=2*f);for(var M=Math.ceil(Math.abs(I/f*2)),D=[],F=I/M,j=8/3*Math.sin(F/4)*Math.sin(F/4)/Math.sin(F/2),R=L+F,N=0;M>N;N++)D[N]=e(L,R,p,g,s,a,P,E,j,v,m),v=D[N][4],m=D[N][5],L=R,R+=F;return r[u]=D,D}function e(t,e,i,n,r,a,c,h,l,u,f){var d=o.call(arguments);if(s[d])return s[d];var g=Math.cos(t),p=Math.sin(t),v=Math.cos(e),m=Math.sin(e),_=i*r*v-n*a*m+c,b=n*r*v+i*a*m+h,y=u+l*(-i*r*p-n*a*g),x=f+l*(-n*r*p+i*a*g),w=_+l*(i*r*m+n*a*v),C=b+l*(n*r*m-i*a*v);return s[d]=[y,x,w,C,_,b],s[d]}function i(t,e,i,n){var r=Math.atan2(e,t),s=Math.atan2(n,i);return s>=r?s-r:2*Math.PI-(r-s)}function n(t,e,i,n,r,s,c,h){var l=o.call(arguments);if(a[l])return a[l];var u,f,d,g,p,v,m,_,b=Math.sqrt,y=Math.min,x=Math.max,w=Math.abs,C=[],A=[[],[]];f=6*t-12*i+6*r,u=-3*t+9*i-9*r+3*c,d=3*i-3*t;for(var S=0;2>S;++S)if(S>0&&(f=6*e-12*n+6*s,u=-3*e+9*n-9*s+3*h,d=3*n-3*e),w(u)<1e-12){if(w(f)<1e-12)continue;(g=-d/f)>0&&1>g&&C.push(g)}else 0>(m=f*f-4*d*u)||(_=b(m),(p=(-f+_)/(2*u))>0&&1>p&&C.push(p),(v=(-f-_)/(2*u))>0&&1>v&&C.push(v));for(var T,k,O,P=C.length,E=P;P--;)g=C[P],O=1-g,T=O*O*O*t+3*O*O*g*i+3*O*g*g*r+g*g*g*c,A[0][P]=T,k=O*O*O*e+3*O*O*g*n+3*O*g*g*s+g*g*g*h,A[1][P]=k;A[0][E]=t,A[1][E]=e,A[0][E+1]=c,A[1][E+1]=h;var L=[{x:y.apply(null,A[0]),y:y.apply(null,A[1])},{x:x.apply(null,A[0]),y:x.apply(null,A[1])}];return a[l]=L,L}var r={},s={},a={},o=Array.prototype.join;fabric.util.drawArc=function(e,i,n,r){for(var s=r[0],a=r[1],o=r[2],c=r[3],h=r[4],l=[[],[],[],[]],u=t(r[5]-i,r[6]-n,s,a,c,h,o),f=0,d=u.length;d>f;f++)l[f][0]=u[f][0]+i,l[f][1]=u[f][1]+n,l[f][2]=u[f][2]+i,l[f][3]=u[f][3]+n,l[f][4]=u[f][4]+i,l[f][5]=u[f][5]+n,e.bezierCurveTo.apply(e,l[f])},fabric.util.getBoundsOfArc=function(e,i,r,s,a,o,c,h,l){for(var u,f=0,d=0,g=[],p=t(h-e,l-i,r,s,o,c,a),v=0,m=p.length;m>v;v++)u=n(f,d,p[v][0],p[v][1],p[v][2],p[v][3],p[v][4],p[v][5]),g.push({x:u[0].x+e,y:u[0].y+i}),g.push({x:u[1].x+e,y:u[1].y+i}),f=p[v][4],d=p[v][5];return g},fabric.util.getBoundsOfCurve=n}(),function(){function t(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}var e=Array.prototype.slice;fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(t,i){for(var n=e.call(arguments,2),r=[],s=0,a=t.length;a>s;s++)r[s]=n.length?t[s][i].apply(t[s],n):t[s][i].call(t[s]);return r},min:function(e,i){return t(e,i,function(t,e){return e>t})},max:function(e,i){return t(e,i,function(t,e){return t>=e})}}}(),function(){function t(e,i,n){if(n)if(!fabric.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var r=0,s=i.length;s>r;r++)e[r]=t({},i[r],n)}else if(i&&"object"==typeof i)for(var a in i)i.hasOwnProperty(a)&&(e[a]=t({},i[a],n));else e=i;else for(var a in i)e[a]=i[a];return e}fabric.util.object={extend:t,clone:function(e,i){return t({},e,i)}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function t(t,e){var i=t.charCodeAt(e);if(isNaN(i))return"";if(55296>i||i>57343)return t.charAt(e);if(i>=55296&&56319>=i){if(t.length<=e+1)throw"High surrogate without following low surrogate";var n=t.charCodeAt(e+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var r=t.charCodeAt(e-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(e){var i,n=0,r=[];for(n=0,i;n<e.length;n++)!1!==(i=t(e,n))&&r.push(i);return r}}}(),function(){function t(){}function e(t){for(var e=null,n=this;n.constructor.superclass;){var r=n.constructor.superclass.prototype[t];if(n[t]!==r){e=r;break}n=n.constructor.superclass.prototype}return e?arguments.length>1?e.apply(this,i.call(arguments,1)):e.call(this):console.log("tried to callSuper "+t+", method not found in prototype chain",this)}var i=Array.prototype.slice,n=function(){},r=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),s=function(t,e,i){for(var n in e)t.prototype[n]=n in t.prototype&&"function"==typeof t.prototype[n]&&(e[n]+"").indexOf("callSuper")>-1?function(t){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var r=e[t].apply(this,arguments);return this.constructor.superclass=n,"initialize"!==t?r:void 0}}(n):e[n],r&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};fabric.util.createClass=function(){function r(){this.initialize.apply(this,arguments)}var a=null,o=i.call(arguments,0);"function"==typeof o[0]&&(a=o.shift()),r.superclass=a,r.subclasses=[],a&&(t.prototype=a.prototype,r.prototype=new t,a.subclasses.push(r));for(var c=0,h=o.length;h>c;c++)s(r,o[c],a);return r.prototype.initialize||(r.prototype.initialize=n),r.prototype.constructor=r,r.prototype.callSuper=e,r}}(),function(){function t(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;r>i;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}function e(t,e){return{handler:e,wrappedHandler:i(t,e)}}function i(t,e){return function(i){e.call(s(t),i||fabric.window.event)}}function n(t,e){return function(i){if(g[t]&&g[t][e])for(var n=g[t][e],r=0,s=n.length;s>r;r++)n[r].call(this,i||fabric.window.event)}}function r(t,e,i){var n="touchend"===t.type?"changedTouches":"touches";return t[n]&&t[n][0]?t[n][0][e]-(t[n][0][e]-t[n][0][i])||t[i]:t[i]}var s,a,o="unknown",c=function(){var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();!function(){var t={};s=function(e){return t[e]},a=function(e,i){t[e]=i}}();var h,l,u=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),f=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),d={},g={};u?(h=function(t,e,i,n){t&&t.addEventListener(e,i,!f&&n)},l=function(t,e,i,n){t&&t.removeEventListener(e,i,!f&&n)}):f?(h=function(t,i,n){if(t){var r=c(t);a(r,t),d[r]||(d[r]={}),d[r][i]||(d[r][i]=[]);var s=e(r,n);d[r][i].push(s),t.attachEvent("on"+i,s.wrappedHandler)}},l=function(t,e,i){if(t){var n,r=c(t);if(d[r]&&d[r][e])for(var s=0,a=d[r][e].length;a>s;s++)(n=d[r][e][s])&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),d[r][e][s]=null)}}):(h=function(t,e,i){if(t){var r=c(t);if(g[r]||(g[r]={}),!g[r][e]){g[r][e]=[];var s=t["on"+e];s&&g[r][e].push(s),t["on"+e]=n(r,e)}g[r][e].push(i)}},l=function(t,e,i){if(t){var n=c(t);if(g[n]&&g[n][e])for(var r=g[n][e],s=0,a=r.length;a>s;s++)r[s]===i&&r.splice(s,1)}}),fabric.util.addListener=h,fabric.util.removeListener=l;var p=function(t){return t.clientX},v=function(t){return t.clientY};fabric.isTouchSupported&&(p=function(t){return r(t,"pageX","clientX")},v=function(t){return r(t,"pageY","clientY")}),fabric.util.getPointer=function(t){t||(t=fabric.window.event);var e=t.target||(typeof t.srcElement!==o?t.srcElement:null),i=fabric.util.getScrollLeftTop(e);return{x:p(t)+i.left,y:v(t)+i.top}}}(),function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(t){return t};e?r=function(t,e){return t.style.opacity=e,t}:i&&(r=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),n.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(n,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?r(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"===n?r(t,e[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n];return t}}(),function(){function t(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function e(t){for(var e=0,i=0,n=fabric.document.documentElement,r=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==fabric.util.getElementStyle(t,"position")););return{left:e,top:i}}var i,n=Array.prototype.slice,r=function(t){return n.call(t,0)};try{i=r(fabric.document.childNodes)instanceof Array}catch(t){}i||(r=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e});var s;s=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){var t=fabric.document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),e?t.style[e]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),e?t.style[e]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}}(),function(){fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}}(),fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=r,fabric.util.makeElement=t,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(e,i,n){return"string"==typeof i&&(i=t(i,n)),e.parentNode&&e.parentNode.replaceChild(i,e),i.appendChild(e),i},fabric.util.getScrollLeftTop=e,fabric.util.getElementOffset=function(t){var i,n,r=t&&t.ownerDocument,a={left:0,top:0},o={left:0,top:0},c={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return o;for(var h in c)o[c[h]]+=parseInt(s(t,h),10)||0;return i=r.documentElement,void 0!==t.getBoundingClientRect&&(a=t.getBoundingClientRect()),n=e(t),{left:a.left+n.left-(i.clientLeft||0)+o.left,top:a.top+n.top-(i.clientTop||0)+o.top}},fabric.util.getElementStyle=s}(),function(){function t(t,e){return t+(/\?/.test(t)?"&":"?")+e}function e(){}var i=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();fabric.util.request=function(n,r){r||(r={});var s=r.method?r.method.toUpperCase():"GET",a=r.onComplete||function(){},o=i(),c=r.body||r.parameters;return o.onreadystatechange=function(){4===o.readyState&&(a(o),o.onreadystatechange=e)},"GET"===s&&(c=null,"string"==typeof r.parameters&&(n=t(n,r.parameters))),o.open(s,n,!0),("POST"===s||"PUT"===s)&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(c),o}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){function t(){return!1}function e(){return i.apply(fabric.window,arguments)}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){return fabric.window.setTimeout(t,1e3/60)},n=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=function(i){e(function(n){i||(i={});var r,s=n||+new Date,a=i.duration||500,o=s+a,c=i.onChange||t,h=i.abort||t,l=i.onComplete||t,u=i.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},f="startValue"in i?i.startValue:0,d="endValue"in i?i.endValue:100,g=i.byValue||d-f;i.onStart&&i.onStart(),function t(n){if(!h()){var p=(r=n||+new Date)>o?a:r-s,v=p/a,m=u(p,f,g,a),_=Math.abs((m-f)/g);return c(m,_,v),r>o?void(i.onComplete&&i.onComplete()):void e(t)}l(d,1,1)}(s)})},fabric.util.requestAnimFrame=e,fabric.util.cancelAnimFrame=function(){return n.apply(fabric.window,arguments)}}(),function(){function t(t,e,i){var n="rgba("+parseInt(t[0]+i*(e[0]-t[0]),10)+","+parseInt(t[1]+i*(e[1]-t[1]),10)+","+parseInt(t[2]+i*(e[2]-t[2]),10);return n+=","+(t&&e?parseFloat(t[3]+i*(e[3]-t[3])):1),n+=")"}fabric.util.animateColor=function(e,i,n,r){var s=new fabric.Color(e).getSource(),a=new fabric.Color(i).getSource();r=r||{},fabric.util.animate(fabric.util.object.extend(r,{duration:n||500,startValue:s,endValue:a,byValue:a,easing:function(e,i,n,s){return t(i,n,r.colorEasing?r.colorEasing(e,s):1-Math.cos(e/s*(Math.PI/2)))}}))}}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-t.s)*Math.PI/t.p)}function i(t,e,i,r){return i-n(r-t,0,i,r)+e}function n(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return 1>(t/=n/2)?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:1>(t/=n/2)?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return 1>(t/=n/2)?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,n,r,s){var a=0,o=r;return 0===i?n:1==(i/=s)?n+r:(a||(a=.3*s),-e(t(o,r,a,1.70158),i,s)+n)},easeOutElastic:function(e,i,n,r){var s=0,a=n;if(0===e)return i;if(1==(e/=r))return i+n;s||(s=.3*r);var o=t(a,n,s,1.70158);return o.a*Math.pow(2,-10*e)*Math.sin(2*(e*r-o.s)*Math.PI/o.p)+o.c+i},easeInOutElastic:function(i,n,r,s){var a=0,o=r;if(0===i)return n;if(2==(i/=s/2))return n+r;a||(a=.3*s*1.5);var c=t(o,r,a,1.70158);return 1>i?-.5*e(c,i,s)+n:c.a*Math.pow(2,-10*(i-=1))*Math.sin(2*(i*s-c.s)*Math.PI/c.p)*.5+c.c+n},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),1>(t/=n/2)?i/2*t*t*((1+(r*=1.525))*t-r)+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(t,e,r,s){return s/2>t?.5*i(2*t,0,r,s)+e:.5*n(2*t-s,0,r,s)+.5*r+e}}}(),function(t){"use strict";function e(t){return t in T?T[t]:t}function i(t,e,i,n){var r,s="[object Array]"===Object.prototype.toString.call(e);if("fill"!==t&&"stroke"!==t||"none"!==e)if("strokeDashArray"===t)e="none"===e?null:e.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)});else if("transformMatrix"===t)e=i&&i.transformMatrix?x(i.transformMatrix,v.parseTransformAttribute(e)):v.parseTransformAttribute(e);else if("visible"===t)e="none"!==e&&"hidden"!==e,i&&!1===i.visible&&(e=!1);else if("opacity"===t)e=parseFloat(e),i&&void 0!==i.opacity&&(e*=i.opacity);else if("textAnchor"===t)e="start"===e?"left":"end"===e?"right":"center";else if("paintFirst"===t){var a=e.indexOf("fill"),o=e.indexOf("stroke"),e="fill";a>-1&&o>-1&&a>o?e="stroke":-1===a&&o>-1&&(e="stroke")}else r=s?e.map(y):y(e,n);else e="";return!s&&isNaN(r)?e:r}function n(t){return new RegExp("^("+t.join("|")+")\\b","i")}function r(t){for(var e in k)if(void 0!==t[k[e]]&&""!==t[e]){if(void 0===t[e]){if(!v.Object.prototype[e])continue;t[e]=v.Object.prototype[e]}if(0!==t[e].indexOf("url(")){var i=new v.Color(t[e]);t[e]=i.setAlpha(b(i.getAlpha()*t[k[e]],2)).toRgba()}}return t}function s(t,e){var i,n,r,s,a=[];for(r=0,s=e.length;s>r;r++)i=e[r],n=t.getElementsByTagName(i),a=a.concat(Array.prototype.slice.call(n));return a}function a(t,e){var i,n;t.replace(/;\s*$/,"").split(";").forEach(function(t){var r=t.split(":");i=r[0].trim().toLowerCase(),n=r[1].trim(),e[i]=n})}function o(t,e){var i,n;for(var r in t)void 0!==t[r]&&(i=r.toLowerCase(),n=t[r],e[i]=n)}function c(t,e){var i={};for(var n in v.cssRules[e])if(h(t,n.split(" ")))for(var r in v.cssRules[e][n])i[r]=v.cssRules[e][n][r];return i}function h(t,e){var i,n=!0;return(i=u(t,e.pop()))&&e.length&&(n=l(t,e)),i&&n&&0===e.length}function l(t,e){for(var i,n=!0;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=u(t,i);return 0===e.length}function u(t,e){var i,n,r=t.nodeName,s=t.getAttribute("class"),a=t.getAttribute("id");if(i=new RegExp("^"+r,"i"),e=e.replace(i,""),a&&e.length&&(i=new RegExp("#"+a+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),s&&e.length)for(s=s.split(" "),n=s.length;n--;)i=new RegExp("\\."+s[n]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function f(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,r,s,a=t.getElementsByTagName("*");for(r=0,s=a.length;s>r;r++)if(n=a[r],e===n.getAttribute("id"))return n}function d(t){for(var e=s(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var n,r,a,o,c=e[i],h=c.getAttribute("xlink:href").substr(1),l=c.getAttribute("x")||0,u=c.getAttribute("y")||0,d=f(t,h).cloneNode(!0),p=(d.getAttribute("transform")||"")+" translate("+l+", "+u+")",v=e.length;if(g(d),/^svg$/i.test(d.nodeName)){var m=d.ownerDocument.createElement("g");for(r=0,o=(a=d.attributes).length;o>r;r++)n=a.item(r),m.setAttribute(n.nodeName,n.nodeValue);for(;d.firstChild;)m.appendChild(d.firstChild);d=m}for(r=0,o=(a=c.attributes).length;o>r;r++)"x"!==(n=a.item(r)).nodeName&&"y"!==n.nodeName&&"xlink:href"!==n.nodeName&&("transform"===n.nodeName?p=n.nodeValue+" "+p:d.setAttribute(n.nodeName,n.nodeValue));d.setAttribute("transform",p),d.setAttribute("instantiated_by_use","1"),d.removeAttribute("id"),c.parentNode.replaceChild(d,c),e.length===v&&i++}}function g(t){var e,i,n,r,s=t.getAttribute("viewBox"),a=1,o=1,c=0,h=0,l=t.getAttribute("width"),u=t.getAttribute("height"),f=t.getAttribute("x")||0,d=t.getAttribute("y")||0,g=t.getAttribute("preserveAspectRatio")||"",p=!s||!v.svgViewBoxElementsRegEx.test(t.nodeName)||!(s=s.match(O)),m=!l||!u||"100%"===l||"100%"===u,_=p&&m,b={},x="";if(b.width=0,b.height=0,b.toBeParsed=_,_)return b;if(p)return b.width=y(l),b.height=y(u),b;if(c=-parseFloat(s[1]),h=-parseFloat(s[2]),e=parseFloat(s[3]),i=parseFloat(s[4]),m?(b.width=e,b.height=i):(b.width=y(l),b.height=y(u),a=b.width/e,o=b.height/i),"none"!==(g=v.util.parsePreserveAspectRatioAttribute(g)).alignX&&(o=a=a>o?o:a),1===a&&1===o&&0===c&&0===h&&0===f&&0===d)return b;if((f||d)&&(x=" translate("+y(f)+" "+y(d)+") "),n=x+" matrix("+a+" 0 0 "+o+" "+c*a+" "+h*o+") ","svg"===t.nodeName){for(r=t.ownerDocument.createElement("g");t.firstChild;)r.appendChild(t.firstChild);t.appendChild(r)}else r=t,n=r.getAttribute("transform")+n;return r.setAttribute("transform",n),b}function p(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}var v=t.fabric||(t.fabric={}),m=v.util.object.extend,_=v.util.object.clone,b=v.util.toFixed,y=v.util.parseUnit,x=v.util.multiplyTransformMatrices,w=["path","circle","polygon","polyline","ellipse","rect","line","image","text","linearGradient","radialGradient","stop"],C=["symbol","image","marker","pattern","view","svg"],A=["pattern","defs","symbol","metadata","clipPath","mask","desc"],S=["symbol","g","a","svg"],T={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity"},k={stroke:"strokeOpacity",fill:"fillOpacity"};v.svgValidTagNamesRegEx=n(w),v.svgViewBoxElementsRegEx=n(C),v.svgInvalidAncestorsRegEx=n(A),v.svgValidParentsRegEx=n(S),v.cssRules={},v.gradientDefs={},v.parseTransformAttribute=function(){function t(t,e){var i=Math.cos(e[0]),n=Math.sin(e[0]),r=0,s=0;3===e.length&&(r=e[1],s=e[2]),t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=r-(i*r-n*s),t[5]=s-(n*r+i*s)}function e(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}function i(t,e,i){t[i]=Math.tan(v.util.degreesToRadians(e[0]))}function n(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}var r=[1,0,0,1,0,0],s=v.reNum,a="(?:\\s+,?\\s*|,\\s*)",o="(?:"+("(?:(matrix)\\s*\\(\\s*("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+")"+a+"("+s+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+s+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+s+")\\s*\\))")+")",c="^\\s*(?:"+("(?:"+o+"(?:"+a+"*"+o+")*)")+"?)\\s*$",h=new RegExp(c),l=new RegExp(o,"g");return function(s){var a=r.concat(),c=[];if(!s||s&&!h.test(s))return a;s.replace(l,function(s){var h=new RegExp(o).exec(s).filter(function(t){return!!t}),l=h[1],u=h.slice(2).map(parseFloat);switch(l){case"translate":n(a,u);break;case"rotate":u[0]=v.util.degreesToRadians(u[0]),t(a,u);break;case"scale":e(a,u);break;case"skewX":i(a,u,2);break;case"skewY":i(a,u,1);break;case"matrix":a=u}c.push(a.concat()),a=r.concat()});for(var u=c[0];c.length>1;)c.shift(),u=v.util.multiplyTransformMatrices(u,c[0]);return u}}();var O=new RegExp("^\\s*("+v.reNum+"+)\\s*,?\\s*("+v.reNum+"+)\\s*,?\\s*("+v.reNum+"+)\\s*,?\\s*("+v.reNum+"+)\\s*$");v.parseSVGDocument=function(t,e,i,n){if(t){d(t);var r,s,a=v.Object.__uid++,o=g(t),c=v.util.toArray(t.getElementsByTagName("*"));if(o.crossOrigin=n&&n.crossOrigin,o.svgUid=a,0===c.length&&v.isLikelyNode){var h=[];for(r=0,s=(c=t.selectNodes('//*[name(.)!="svg"]')).length;s>r;r++)h[r]=c[r];c=h}var l=c.filter(function(t){return g(t),v.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))&&!p(t,v.svgInvalidAncestorsRegEx)});if(!l||l&&!l.length)return void(e&&e([],{}));v.gradientDefs[a]=v.getGradientDefs(t),v.cssRules[a]=v.getCSSRules(t),v.parseElements(l,function(t,i){e&&e(t,o,i,c)},_(o),i,n)}};var P=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+v.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+v.reNum+"))?\\s+(.*)");m(v,{parseFontDeclaration:function(t,e){var i=t.match(P);if(i){var n=i[1],r=i[3],s=i[4],a=i[5],o=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),s&&(e.fontSize=y(s)),o&&(e.fontFamily=o),a&&(e.lineHeight="normal"===a?1:a)}},getGradientDefs:function(t){var e,i,n,r=s(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),a=0,o={},c={};for(a=r.length;a--;)e=r[a],n=e.getAttribute("xlink:href"),i=e.getAttribute("id"),n&&(c[i]=n.substr(1)),o[i]=e;for(i in c){var h=o[c[i]].cloneNode(!0);for(e=o[i];h.firstChild;)e.appendChild(h.firstChild)}return o},parseAttributes:function(t,n,s){if(t){var a,o,h={};void 0===s&&(s=t.getAttribute("svgUid")),t.parentNode&&v.svgValidParentsRegEx.test(t.parentNode.nodeName)&&(h=v.parseAttributes(t.parentNode,n,s)),o=h&&h.fontSize||t.getAttribute("font-size")||v.Text.DEFAULT_SVG_FONT_SIZE;var l=n.reduce(function(e,i){return(a=t.getAttribute(i))&&(e[i]=a),e},{});l=m(l,m(c(t,s),v.parseStyleAttribute(t)));var u,f,d={};for(var g in l)u=e(g),f=i(u,l[g],h,o),d[u]=f;d&&d.font&&v.parseFontDeclaration(d.font,d);var p=m(h,d);return v.svgValidParentsRegEx.test(t.nodeName)?p:r(p)}},parseElements:function(t,e,i,n,r){new v.ElementsParser(t,e,i,n,r).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?a(i,e):o(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;i>e;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){var e,i,n,r=t.getElementsByTagName("style"),s={};for(e=0,i=r.length;i>e;e++){var a=r[e].textContent||r[e].text;""!==(a=a.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&(n=a.match(/[^{]*\{[\s\S]*?\}/g),(n=n.map(function(t){return t.trim()})).forEach(function(t){var n=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},a=n[2].trim().replace(/;$/,"").split(/\s*;\s*/);for(e=0,i=a.length;i>e;e++){var o=a[e].split(/\s*:\s*/),c=o[0],h=o[1];r[c]=h}(t=n[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(s[t]?v.util.object.extend(s[t],r):s[t]=v.util.object.clone(r))})}))}return s},loadSVGFromURL:function(t,e,i,n){t=t.replace(/^\n\s*/,"").trim(),new v.util.request(t,{method:"get",onComplete:function(t){var r=t.responseXML;r&&!r.documentElement&&v.window.ActiveXObject&&t.responseText&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(t.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),r&&r.documentElement||e&&e(null),v.parseSVGDocument(r.documentElement,function(t,i,n,r){e&&e(t,i,n,r)},i,n)}})},loadSVGFromString:function(t,e,i,n){t=t.trim();var r;if("undefined"!=typeof DOMParser){var s=new DOMParser;s&&s.parseFromString&&(r=s.parseFromString(t,"text/xml"))}else v.window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));v.parseSVGDocument(r.documentElement,function(t,i,n,r){e(t,i,n,r)},i,n)}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,n,r){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=r},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;e>t;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){t.fromElement(e,this.createCallback(i,e),this.options)},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(n){i.resolveGradient(n,"fill"),i.resolveGradient(n,"stroke"),n._removeTransformMatrix(),n instanceof fabric.Image&&n.parsePreserveAspectRatioAttribute(e),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);if(/^url\(/.test(i)){var n=i.slice(5,i.length-1);fabric.gradientDefs[this.svgUid][n]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances,this.elements))},function(t){"use strict";function e(t,e){this.x=t,this.y=e}var i=t.fabric||(t.fabric={});i.Point?i.warn("fabric.Point is already defined"):(i.Point=e,e.prototype={type:"point",constructor:e,add:function(t){return new e(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new e(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new e(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new e(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new e(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new e(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,i){return void 0===i&&(i=.5),i=Math.max(Math.min(1,i),0),new e(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new e(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new e(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new e(this.x,this.y)}})}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){this.status=t,this.points=[]}var i=t.fabric||(t.fabric={});i.Intersection?i.warn("fabric.Intersection is already defined"):(i.Intersection=e,i.Intersection.prototype={constructor:e,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},i.Intersection.intersectLineLine=function(t,n,r,s){var a,o=(s.x-r.x)*(t.y-r.y)-(s.y-r.y)*(t.x-r.x),c=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),h=(s.y-r.y)*(n.x-t.x)-(s.x-r.x)*(n.y-t.y);if(0!==h){var l=o/h,u=c/h;l>=0&&1>=l&&u>=0&&1>=u?(a=new e("Intersection")).appendPoint(new i.Point(t.x+l*(n.x-t.x),t.y+l*(n.y-t.y))):a=new e}else a=new e(0===o||0===c?"Coincident":"Parallel");return a},i.Intersection.intersectLinePolygon=function(t,i,n){var r,s,a,o,c=new e,h=n.length;for(o=0;h>o;o++)r=n[o],s=n[(o+1)%h],a=e.intersectLineLine(t,i,r,s),c.appendPoints(a.points);return c.points.length>0&&(c.status="Intersection"),c},i.Intersection.intersectPolygonPolygon=function(t,i){var n,r=new e,s=t.length;for(n=0;s>n;n++){var a=t[n],o=t[(n+1)%s],c=e.intersectLinePolygon(a,o,i);r.appendPoints(c.points)}return r.points.length>0&&(r.status="Intersection"),r},i.Intersection.intersectPolygonRectangle=function(t,n,r){var s=n.min(r),a=n.max(r),o=new i.Point(a.x,s.y),c=new i.Point(s.x,a.y),h=e.intersectLinePolygon(s,o,t),l=e.intersectLinePolygon(o,a,t),u=e.intersectLinePolygon(a,c,t),f=e.intersectLinePolygon(c,s,t),d=new e;return d.appendPoints(h.points),d.appendPoints(l.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d})}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function i(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var n=t.fabric||(t.fabric={});n.Color?n.warn("fabric.Color is already defined."):(n.Color=e,n.Color.prototype={_tryParsingColor:function(t){var i;t in e.colorNameMap&&(t=e.colorNameMap[t]),"transparent"===t&&(i=[255,255,255,0]),i||(i=e.sourceFromHex(t)),i||(i=e.sourceFromRgb(t)),i||(i=e.sourceFromHsl(t)),i||(i=[0,0,0,1]),i&&this.setSource(i)},_rgbToHsl:function(t,e,i){t/=255,e/=255,i/=255;var r,s,a,o=n.util.array.max([t,e,i]),c=n.util.array.min([t,e,i]);if(a=(o+c)/2,o===c)r=s=0;else{var h=o-c;switch(s=a>.5?h/(2-o-c):h/(o+c),o){case t:r=(e-i)/h+(i>e?6:0);break;case e:r=(i-t)/h+2;break;case i:r=(t-e)/h+4}r/=6}return[Math.round(360*r),Math.round(100*s),Math.round(100*a)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=n[0].toString(16),t=1===t.length?"0"+t:t,e=n[1].toString(16),e=1===e.length?"0"+e:e,i=n[2].toString(16),i=1===i.length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},toHexa:function(){var t;return t=255*this.getSource()[3],t=t.toString(16),t=1===t.length?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof e||(t=new e(t));var i,n=[],r=this.getAlpha(),s=this.getSource(),a=t.getSource();for(i=0;3>i;i++)n.push(Math.round(.5*s[i]+.5*a[i]));return n[3]=r,this.setSource(n),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},n.Color.fromRgb=function(t){return e.fromSource(e.sourceFromRgb(t))},n.Color.sourceFromRgb=function(t){var i=t.match(e.reRGBa);if(i){var n=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),r=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),s=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(s,10),i[4]?parseFloat(i[4]):1]}},n.Color.fromRgba=e.fromRgb,n.Color.fromHsl=function(t){return e.fromSource(e.sourceFromHsl(t))},n.Color.sourceFromHsl=function(t){var n=t.match(e.reHSLa);if(n){var r,s,a,o=(parseFloat(n[1])%360+360)%360/360,c=parseFloat(n[2])/(/%$/.test(n[2])?100:1),h=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(0===c)r=s=a=h;else{var l=.5>=h?h*(c+1):h+c-h*c,u=2*h-l;r=i(u,l,o+1/3),s=i(u,l,o),a=i(u,l,o-1/3)}return[Math.round(255*r),Math.round(255*s),Math.round(255*a),n[4]?parseFloat(n[4]):1]}},n.Color.fromHsla=e.fromHsl,n.Color.fromHex=function(t){return e.fromSource(e.sourceFromHex(t))},n.Color.sourceFromHex=function(t){if(t.match(e.reHex)){var i=t.slice(t.indexOf("#")+1),n=3===i.length||4===i.length,r=8===i.length||4===i.length,s=n?i.charAt(0)+i.charAt(0):i.substring(0,2),a=n?i.charAt(1)+i.charAt(1):i.substring(2,4),o=n?i.charAt(2)+i.charAt(2):i.substring(4,6),c=r?n?i.charAt(3)+i.charAt(3):i.substring(6,8):"FF";return[parseInt(s,16),parseInt(a,16),parseInt(o,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},n.Color.fromSource=function(t){var i=new e;return i.setSource(t),i})}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=(fabric.util.toFixed,fabric.util.transformPoint),r=fabric.util.invertTransform,s=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,_initStatic:function(t,e){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){e&&(this[t]=new fabric.Image(e,n)),i&&i(e)},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,i&&i(e)),this},__setBgOverlayColor:function(t,e,i){return this[t]=e,this._initGradient(e,t),this._initPattern(e,t,i),this},_createCanvasElement:function(){var t=fabric.util.createCanvasElement();if(!t)throw s;if(t.style||(t.style={}),void 0===t.getContext)throw s;return t},_initOptions:function(t){this._setOptions(t),this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=t&&t.getContext?t:fabric.util.getById(t)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;e=e||{};for(var n in t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px"),e.backstoreOnly||this._setCssDimension(n,i);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i,n,r=this._activeObject;for(this.viewportTransform=t,i=0,n=this._objects.length;n>i;i++)(e=this._objects[i]).group||e.setCoords(!1,!0);return r&&"activeSelection"===r.type&&r.setCoords(!1,!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(t,e){var i=t,s=this.viewportTransform.slice(0);t=n(t,r(this.viewportTransform)),s[0]=e,s[3]=e;var a=n(t,s);return s[4]+=i.x-a.x,s[5]+=i.y-a.y,this.setViewportTransform(s)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var t={},e=this.width,i=this.height,s=r(this.viewportTransform);return t.tl=n({x:0,y:0},s),t.br=n({x:e,y:i},s),t.tr=new fabric.Point(t.br.x,t.tl.y),t.bl=new fabric.Point(t.tl.x,t.br.y),this.vptCoords=t,t},renderCanvas:function(t,e){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.calcViewportBoundaries(),this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform.apply(t,this.viewportTransform),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){var i,n;for(i=0,n=e.length;n>i;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];i&&(t.fillStyle=i.toLive?i.toLive(t,this):i,t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)),(i=this[e+"Image"])&&(this[e+"Vpt"]&&(t.save(),t.transform.apply(t,this.viewportTransform)),i.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=r(this.viewportTransform);return n({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n={version:fabric.version,objects:this._toObjects(e,i)};return t(n,this.__serializeBgOverlay(e,i)),fabric.util.populateWithProperties(this,n,i),n},_toObjects:function(t,e){return this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(t,e){var i={},n=this.backgroundImage,r=this.overlayImage;return this.backgroundColor&&(i.background=this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor),this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,t,e)),r&&!r.excludeFromExport&&(i.overlayImage=this._toObject(r,t,e)),i},sendToBack:function(t){if(!t)return this;var e,n,r,s=this._activeObject;if(t===s&&"activeSelection"===t.type)for(r=s._objects,e=r.length;e--;)n=r[e],i(this._objects,n),this._objects.unshift(n);else i(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(t){if(!t)return this;var e,n,r,s=this._activeObject;if(t===s&&"activeSelection"===t.type)for(r=s._objects,e=0;e<r.length;e++)n=r[e],i(this._objects,n),this._objects.push(n);else i(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(t,e){if(!t)return this;var n,r,s,a,o,c=this._activeObject,h=0;if(t===c&&"activeSelection"===t.type)for(o=c._objects,n=0;n<o.length;n++)r=o[n],(s=this._objects.indexOf(r))>0+h&&(a=s-1,i(this._objects,r),this._objects.splice(a,0,r)),h++;else 0!==(s=this._objects.indexOf(t))&&(a=this._findNewLowerIndex(t,s,e),i(this._objects,t),this._objects.splice(a,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(t,e,i){var n,r;if(i){for(n=e,r=e-1;r>=0;--r)if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var n,r,s,a,o,c=this._activeObject,h=0;if(t===c&&"activeSelection"===t.type)for(o=c._objects,n=o.length;n--;)r=o[n],(s=this._objects.indexOf(r))<this._objects.length-1-h&&(a=s+1,i(this._objects,r),this._objects.splice(a,0,r)),h++;else(s=this._objects.indexOf(t))!==this._objects.length-1&&(a=this._findNewUpperIndex(t,s,e),i(this._objects,t),this._objects.splice(a,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(t,e,i){var n,r,s;if(i){for(n=e,r=e+1,s=this._objects.length;s>r;++r)if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop,e=this.canvas.getZoom();t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*e,t.shadowOffsetX=this.shadow.offsetX*e,t.shadowOffsetY=this.shadow.offsetY*e}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t,e,i=this.canvas.contextTop,n=this.canvas.viewportTransform,r=this._points[0],s=this._points[1];if(i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),i.beginPath(),2===this._points.length&&r.x===s.x&&r.y===s.y){var a=this.width/1e3;r=new fabric.Point(r.x,r.y),s=new fabric.Point(s.x,s.y),r.x-=a,s.x+=a}for(i.moveTo(r.x,r.y),t=1,e=this._points.length;e>t;t++){var o=r.midPointFrom(s);i.quadraticCurveTo(r.x,r.y,o.x,o.y),r=this._points[t],s=this._points[t+1]}i.lineTo(r.x,r.y),i.stroke(),i.restore()},convertPointsToSVGPath:function(t){var e,i=[],n=this.width/1e3,r=new fabric.Point(t[0].x,t[0].y),s=new fabric.Point(t[1].x,t[1].y),a=t.length;for(i.push("M ",r.x-n," ",r.y," "),e=1;a>e;e++){if(!r.eq(s)){var o=r.midPointFrom(s);i.push("Q ",r.x," ",r.y," ",o.x," ",o.y," ")}r=t[e],e+1<t.length&&(s=t[e+1])}return i.push("L ",r.x+n," ",r.y," "),i},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray}),i=new fabric.Point(e.left+e.width/2,e.top+e.height/2);return i=e.translateToGivenOrigin(i,"center","center",e.originX,e.originY),e.top=i.y,e.left=i.x,this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.requestRenderAll(),this.canvas.fire("path:created",{path:e})}else this.canvas.requestRenderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop,n=this.canvas.viewportTransform;i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(t=0,e=this.points.length;e>t;t++){var r=this.points[t],s=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&s.setShadow(this.shadow),n.push(s)}var a=new fabric.Group(n,{originX:"center",originY:"center"});a.canvas=this.canvas,this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;n>i;i++)for(var r=this.sprayChunks[i],s=0,a=r.length;a>s;s++){var o=new fabric.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&o.setShadow(this.shadow),e.push(o)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e,{originX:"center",originY:"center"});c.canvas=this.canvas,this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var e,i,n,r={};for(i=0,n=t.length;n>i;i++)e=t[i].left+""+t[i].top,r[e]||(r[e]=t[i]);var s=[];for(e in r)s.push(r[e]);return s},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e,i,n=this.canvas.viewportTransform;for(t.save(),t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e=0,i=this.sprayChunkPoints.length;i>e;e++){var r=this.sprayChunkPoints[e];void 0!==r.opacity&&(t.globalAlpha=r.opacity),t.fillRect(r.x,r.y,r.width,r.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var e,i,n,r,s=this.width/2;for(r=0;r<this.density;r++){e=fabric.util.getRandomInt(t.x-s,t.x+s),i=fabric.util.getRandomInt(t.y-s,t.y+s),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var a=new fabric.Point(e,i);a.width=n,this.randomOpacity&&(a.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs,s=fabric.StaticCanvas.supports("setLineDash");fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e,i,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){e=[],i=[];for(var r=0,s=this._objects.length;s>r;r++)t=this._objects[r],-1===n.indexOf(t)?e.push(t):i.push(t);n.length>1&&(this._activeObject._objects=i),e.push.apply(e,i)}else e=this._objects;return e},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&(t.mouseXSign="right"===t.originX?-1:1),"center"!==t.originY&&(t.mouseYSign="bottom"===t.originY?-1:1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var n,r=i||this.getPointer(t,!0);return n=e.group&&e.group===this._activeObject&&"activeSelection"===e.group.type?this._normalizePointer(e.group,r):{x:r.x,y:r.y},e.containsPoint(n)||e._findTargetCorner(r)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=fabric.util.invertTransform(i),r=this.restorePointerVpt(e);return fabric.util.transformPoint(r,n)},isTargetTransparent:function(t,e,i){var n=this.contextCache,r=t.selectionBackgroundColor;return t.selectionBackgroundColor="",this.clearContext(n),n.save(),n.transform.apply(n,this.viewportTransform),t.render(n),n.restore(),t===this._activeObject&&t._renderControls(n,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),t.selectionBackgroundColor=r,fabric.util.isTransparent(n,e,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(t){return"[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(e){return!0===t[e]}):t[this.selectionKey]},_shouldClearSelection:function(t,e){var i=this.getActiveObjects(),n=this._activeObject;return!e||e&&n&&i.length>1&&-1===i.indexOf(e)&&n!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":("mr"===e||"tr"===e||"br"===e)&&(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":("bl"===e||"mb"===e||"br"===e)&&(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(this.getPointer(t,!0)),s=this._getActionFromCorner(i,r,t),a=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:s,corner:r,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:a.x,originY:a.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,originX:a.x,originY:a.y},this._resetCurrentTransform()}},_translateObject:function(t,e){var i=this._currentTransform,n=i.target,r=t-i.offsetX,s=e-i.offsetY,a=!n.get("lockMovementX")&&n.left!==r,o=!n.get("lockMovementY")&&n.top!==s;return a&&n.set("left",r),o&&n.set("top",s),a||o},_changeSkewTransformOrigin:function(t,e,i){var n="originX",r={0:"center"},s=e.target.skewX,a="left",o="right",c="mt"===e.corner||"ml"===e.corner?1:-1,h=1;t=t>0?1:-1,"y"===i&&(s=e.target.skewY,a="top",o="bottom",n="originY"),r[-1]=a,r[1]=o,e.target.flipX&&(h*=-1),e.target.flipY&&(h*=-1),0===s?(e.skewSign=-c*t*h,e[n]=r[-t]):(s=s>0?1:-1,e.skewSign=s,e[n]=r[s*c*h])},_skewObject:function(t,e,i){var n=this._currentTransform,r=n.target,s=!1,a=r.get("lockSkewingX"),o=r.get("lockSkewingY");if(a&&"x"===i||o&&"y"===i)return!1;var c,h,l=r.getCenterPoint(),u=r.toLocalPoint(new fabric.Point(t,e),"center","center")[i],f=r.toLocalPoint(new fabric.Point(n.lastX,n.lastY),"center","center")[i],d=r._getTransformedDimensions();return this._changeSkewTransformOrigin(u-f,n,i),c=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY)[i],h=r.translateToOriginPoint(l,n.originX,n.originY),s=this._setObjectSkew(c,n,i,d),n.lastX=t,n.lastY=e,r.setPositionByOrigin(h,n.originX,n.originY),s},_setObjectSkew:function(t,e,i,n){var r,s,a,o,c,h,l,u,f,d=e.target,g=!1,p=e.skewSign;return"x"===i?(o="y",c="Y",h="X",u=0,f=d.skewY):(o="x",c="X",h="Y",u=d.skewX,f=0),a=d._getTransformedDimensions(u,f),2>=(l=2*Math.abs(t)-a[i])?r=0:(r=p*Math.atan(l/d["scale"+h]/(a[o]/d["scale"+c])),r=fabric.util.radiansToDegrees(r)),g=d["skew"+h]!==r,d.set("skew"+h,r),0!==d["skew"+c]&&(s=d._getTransformedDimensions(),r=n[o]/s[o]*d["scale"+c],d.set("scale"+c,r)),g},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,s=r.get("lockScalingX"),a=r.get("lockScalingY"),o=r.get("lockScalingFlip");if(s&&a)return!1;var c=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),h=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY),l=r._getTransformedDimensions(),u=!1;return this._setLocalMouse(h,n),u=this._setObjectScale(h,n,s,a,i,o,l),r.setPositionByOrigin(c,n.originX,n.originY),u},_setObjectScale:function(t,e,i,n,r,s,a){var o,c,h,l,u=e.target,f=!1,d=!1,g=!1;return h=t.x*u.scaleX/a.x,l=t.y*u.scaleY/a.y,o=u.scaleX!==h,c=u.scaleY!==l,s&&0>=h&&h<u.scaleX&&(f=!0,t.x=0),s&&0>=l&&l<u.scaleY&&(d=!0,t.y=0),"equally"!==r||i||n?r?"x"!==r||u.get("lockUniScaling")?"y"!==r||u.get("lockUniScaling")||d||n||u.set("scaleY",l)&&(g=g||c):f||i||u.set("scaleX",h)&&(g=g||o):(f||i||u.set("scaleX",h)&&(g=g||o),d||n||u.set("scaleY",l)&&(g=g||c)):g=this._scaleObjectEqually(t,u,e,a),e.newScaleX=h,e.newScaleY=l,f||d||this._flipObject(e,r),g},_scaleObjectEqually:function(t,e,i,n){var r,s=t.y+t.x,a=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,o=t.x<0?-1:1,c=t.y<0?-1:1;return i.newScaleX=o*Math.abs(i.original.scaleX*s/a),i.newScaleY=c*Math.abs(i.original.scaleY*s/a),r=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),r},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target,n=this.getZoom(),s=i.padding/n;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>s?t.x<0?t.x+=s:t.x-=s:t.x=0,r(t.y)>s?t.y<0?t.y+=s:t.y-=s:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform;if(r.target.get("lockRotation"))return!1;var s=n(r.ey-r.top,r.ex-r.left),a=n(e-r.top,t-r.left),o=i(a-s+r.theta),c=!0;if(r.target.snapAngle>0){var h=r.target.snapAngle,l=r.target.snapThreshold||h,u=Math.ceil(o/h)*h,f=Math.floor(o/h)*h;Math.abs(o-f)<l?o=f:Math.abs(o-u)<l&&(o=u)}return 0>o&&(o=360+o),o%=360,r.target.angle===o?c=!1:r.target.angle=o,c},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.rotate(0)},_drawSelection:function(t){var e=this._groupSelector,i=e.left,n=e.top,a=r(i),o=r(n);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),a,o)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!s){var c=e.ex+.5-(i>0?0:a),h=e.ey+.5-(n>0?0:o);t.beginPath(),fabric.util.drawDashedLine(t,c,h,c+a,h,this.selectionDashArray),fabric.util.drawDashedLine(t,c,h+o-1,c+a,h+o-1,this.selectionDashArray),fabric.util.drawDashedLine(t,c,h,c,h+o,this.selectionDashArray),fabric.util.drawDashedLine(t,c+a-1,h,c+a-1,h+o,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(i>0?0:a),e.ey+.5-(n>0?0:o),a,o)},findTarget:function(t,e){if(!this.skipTargetFind){var i,n,r=this.getPointer(t,!0),s=this._activeObject,a=this.getActiveObjects();if(this.targets=[],a.length>1&&!e&&s===this._searchPossibleTargets([s],r))return s;if(1===a.length&&s._findTargetCorner(r))return s;if(1===a.length&&s===this._searchPossibleTargets([s],r)){if(!this.preserveObjectStacking)return s;i=s,n=this.targets,this.targets=[]}var o=this._searchPossibleTargets(this._objects,r);return t[this.altSelectionKey]&&o&&i&&o!==i&&(o=i,this.targets=n),o}},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,r,s=t.length;s--;)if(this._checkTarget(e,t[s])){"group"===(i=t[s]).type&&i.subTargetCheck&&(n=this._normalizePointer(i,e),(r=this._searchPossibleTargets(i._objects,n))&&this.targets.push(r));break}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(e,i,n){n||(n=this.upperCanvasEl);var r,s=t(e),a=n.getBoundingClientRect(),o=a.width||0,c=a.height||0;return o&&c||("top"in a&&"bottom"in a&&(c=Math.abs(a.top-a.bottom)),"right"in a&&"left"in a&&(o=Math.abs(a.right-a.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,i||(s=this.restorePointerVpt(s)),r=0===o||0===c?{width:1,height:1}:{width:n.width/o,height:n.height/c},{x:s.x*r.width,y:s.y*r.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.width||t.width,i=this.height||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0,"touch-action":"none"}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var t=this._activeObject;return t?"activeSelection"===t.type&&t._objects?t._objects.slice(0):[t]:[]},_onObjectRemoved:function(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this._hoveredTarget===t&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",t)},_fireSelectionEvents:function(t,e){var i=!1,n=this.getActiveObjects(),r=[],s=[],a={e:e};t.forEach(function(t){-1===n.indexOf(t)&&(i=!0,t.fire("deselected",a),s.push(t))}),n.forEach(function(e){-1===t.indexOf(e)&&(i=!0,e.fire("selected",a),r.push(e))}),t.length>0&&n.length>0?(a.selected=r,a.deselected=s,a.updated=r[0]||s[0],a.target=this._activeObject,i&&this.fire("selection:updated",a)):n.length>0?(1===n.length&&(a.target=r[0],this.fire("object:selected",a)),a.selected=r,a.target=this._activeObject,this.fire("selection:created",a)):t.length>0&&(a.deselected=s,this.fire("selection:cleared",a))},setActiveObject:function(t,e){var i=this.getActiveObjects();return this._setActiveObject(t,e),this._fireSelectionEvents(i,e),this},_setActiveObject:function(t,e){return this._activeObject!==t&&(!!this._discardActiveObject(e,t)&&(!t.onSelect({e:e})&&(this._activeObject=t,!0)))},_discardActiveObject:function(t,e){var i=this._activeObject;if(i){if(i.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var e=this.getActiveObjects();return e.length&&this.fire("before:selection:cleared",{target:e[0],e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this},dispose:function(){fabric.StaticCanvas.prototype.dispose.call(this);var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this._activeObject;e&&e._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),r=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),r},_realizeGroupTransformOnObject:function(t){if(t.group&&"activeSelection"===t.group.type&&this._activeObject===t.group){var e={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(i){e[i]=t[i]}),this._activeObject.realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(e);this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)}});for(var a in fabric.StaticCanvas)"prototype"!==a&&(fabric.Canvas[a]=fabric.StaticCanvas[a]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}(),function(){function t(t,e){return"which"in t?t.which===e:t.button===e-1}var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},i=fabric.util.addListener,n=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"dblclick",this._onDoubleClick),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mouseout",this._onMouseOut),i(this.upperCanvasEl,"mouseenter",this._onMouseEnter),i(this.upperCanvasEl,"wheel",this._onMouseWheel),i(this.upperCanvasEl,"contextmenu",this._onContextMenu),i(this.upperCanvasEl,"touchstart",this._onMouseDown,{passive:!1}),i(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this.eventsBinded||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this.eventsBinded=!0)},removeListeners:function(){n(fabric.window,"resize",this._onResize),n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"mouseout",this._onMouseOut),n(this.upperCanvasEl,"mouseenter",this._onMouseEnter),n(this.upperCanvasEl,"wheel",this._onMouseWheel),n(this.upperCanvasEl,"contextmenu",this._onContextMenu),n(this.upperCanvasEl,"doubleclick",this._onDoubleClick),n(this.upperCanvasEl,"touchstart",this._onMouseDown),n(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t}),this._iTextInstances&&this._iTextInstances.forEach(function(t){t.isEditing&&t.hiddenTextarea.focus()})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._handleEvent(t,"dblclick",void 0)},_onMouseDown:function(t){this.__onMouseDown(t),i(fabric.document,"touchend",this._onMouseUp,{passive:!1}),i(fabric.document,"touchmove",this._onMouseMove,{passive:!1}),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?n(this.upperCanvasEl,"mousedown",this._onMouseDown):(i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"touchend",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove),n(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"touchend"===t.type){var e=this;setTimeout(function(){i(e.upperCanvasEl,"mousedown",e._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this._activeObject;return(!i||!i.isEditing||t!==i)&&!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(e){var i,n=!0,r=this._currentTransform,s=this._groupSelector,a=!s||0===s.left&&0===s.top;if(t(e,3))this.fireRightClick&&this._handleEvent(e,"up",i,3,a);else if(t(e,2))this.fireMiddleClick&&this._handleEvent(e,"up",i,2,a);else if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(e);else{r&&(this._finalizeCurrentTransform(e),n=!r.actionPerformed),i=n?this.findTarget(e,!0):r.target;var o=this._shouldRender(i,this.getPointer(e));i||!a?this._maybeGroupObjects(e):(this._groupSelector=null,this._currentTransform=null),i&&(i.isMoving=!1),this._setCursorFromEvent(e,i),this._handleEvent(e,"up",i||null,1,a),i&&(i.__corner=0),o&&this.requestRenderAll()}},_handleEvent:function(t,e,i,n,r){var s=void 0===i?this.findTarget(t):i,a=this.targets||[],o={e:t,target:s,subTargets:a,button:n||1,isClick:r||!1};this.fire("mouse:"+e,o),s&&s.fire("mouse"+e,o);for(var c=0;c<a.length;c++)a[c].fire("mouse"+e,o)},_finalizeCurrentTransform:function(t){var e=this._currentTransform,i=e.target;i._scaling&&(i._scaling=!1),i.setCoords(),this._restoreOriginXY(i),(e.actionPerformed||this.stateful&&i.hasStateChanged())&&(this.fire("object:modified",{target:i,e:t}),i.fire("modified",{e:t}))},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(e){var i=this.findTarget(e);if(t(e,3))this.fireRightClick&&this._handleEvent(e,"down",i||null,3);else if(t(e,2))this.fireMiddleClick&&this._handleEvent(e,"down",i||null,2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(e);else if(!this._currentTransform){var n=this.getPointer(e,!0);this._previousPointer=n;var r=this._shouldRender(i,n),s=this._shouldGroup(e,i);this._shouldClearSelection(e,i)?this.discardActiveObject(e):s&&(this._handleGrouping(e,i),i=this._activeObject),!this.selection||i&&(i.selectable||i.isEditing||i===this._activeObject)||(this._groupSelector={ex:n.x,ey:n.y,top:0,left:0}),i&&(i.selectable&&this.setActiveObject(i,e),i!==this._activeObject||!i.__corner&&s||(this._beforeTransform(e,i),this._setupCurrentTransform(e,i))),this._handleEvent(e,"down",i||null),r&&this.requestRenderAll()}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e)},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&t.touches.length>1)){var n=this._groupSelector;n?(i=this.getPointer(t,!0),n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move",e||null)}},_fireOverOutEvents:function(t,e){var i,n,r=this._hoveredTarget;r!==t&&(i={e:e,target:t,previousTarget:this._hoveredTarget},n={e:e,target:this._hoveredTarget,nextTarget:t},this._hoveredTarget=t),t?r!==t&&(r&&(this.fire("mouse:out",n),r.fire("mouseout",n)),this.fire("mouse:over",i),t.fire("mouseover",i)):r&&(this.fire("mouse:out",n),r.fire("mouseout",n))},__onMouseWheel:function(t){this._handleEvent(t,"wheel")},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,i.shiftKey=t.shiftKey,i.altKey=t[this.centeredKey],this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,s=e.target,a=e.action,o=!1;"rotate"===a?(o=this._rotateObject(n,r))&&this._fire("rotating",s,t):"scale"===a?(o=this._onScale(t,e,n,r))&&this._fire("scaling",s,t):"scaleX"===a?(o=this._scaleObject(n,r,"x"))&&this._fire("scaling",s,t):"scaleY"===a?(o=this._scaleObject(n,r,"y"))&&this._fire("scaling",s,t):"skewX"===a?(o=this._skewObject(n,r,"x"))&&this._fire("skewing",s,t):"skewY"===a?(o=this._skewObject(n,r,"y"))&&this._fire("skewing",s,t):(o=this._translateObject(n,r))&&(this._fire("moving",s,t),this.setCursor(s.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||o},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,n){return this._isUniscalePossible(t,e.target)?(e.currentAction="scale",this._scaleObject(i,n)):(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally"))},_isUniscalePossible:function(t,e){return(t[this.uniScaleKey]||this.uniScaleTransform)&&!e.get("lockUniScaling")},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));this.setCursor(r?this.getCornerCursor(r,e,t):i)},getCornerCursor:function(t,i,n){return this.actionIsDisabled(t,i,n)?this.notAllowedCursor:t in e?this._getRotatedCornerCursor(t,i,n):"mtr"===t&&i.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(t,e,i){return"mt"===t||"mb"===t?i[this.altActionKey]?e.lockSkewingX:e.lockScalingY:"ml"===t||"mr"===t?i[this.altActionKey]?e.lockSkewingY:e.lockScalingX:"mtr"===t?e.lockRotation:this._isUniscalePossible(i,e)?e.lockScalingX&&e.lockScalingY:e.lockScalingX||e.lockScalingY},_getRotatedCornerCursor:function(t,i,n){var r=Math.round(i.angle%360/45);return 0>r&&(r+=8),r+=e[t],n[this.altActionKey]&&e[t]%2==0&&(r+=2),r%=8,this.cursorMap[r]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this._activeObject;return i&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(i!==e||"activeSelection"===i.type)},_handleGrouping:function(t,e){var i=this._activeObject;i.__corner||(e!==i||(e=this.findTarget(t,!0)))&&(i&&"activeSelection"===i.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))},_updateActiveSelection:function(t,e){var i=this._activeObject,n=i._objects.slice(0);i.contains(t)?(i.removeWithUpdate(t),this._hoveredTarget=t,1===i.size()&&this._setActiveObject(i.item(0),e)):(i.addWithUpdate(t),this._hoveredTarget=i),this._fireSelectionEvents(n,e)},_createActiveSelection:function(t,e){var i=this.getActiveObjects(),n=this._createGroup(t);this._hoveredTarget=n,this._setActiveObject(n,e),this._fireSelectionEvents(i,e)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(t){var e,i=this._collectObjects();1===i.length?this.setActiveObject(i[0],t):i.length>1&&(e=new fabric.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(e,t))},_collectObjects:function(){for(var i,n=[],r=this._groupSelector.ex,s=this._groupSelector.ey,a=r+this._groupSelector.left,o=s+this._groupSelector.top,c=new fabric.Point(t(r,a),t(s,o)),h=new fabric.Point(e(r,a),e(s,o)),l=r===a&&s===o,u=this._objects.length;u--&&!((i=this._objects[u])&&i.selectable&&i.visible&&(i.intersectsWithRect(c,h)||i.isContainedWithinRect(c,h)||i.containsPoint(c)||i.containsPoint(h))&&(n.push(i),l)););return n},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null,this._currentTransform=null}})}(),function(){var t=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=t.multiplier||1,r={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,r,n)},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.width,s=this.height,a=(i.width||this.width)*n,o=(i.height||this.height)*n,c=this.getZoom()*n,h=this.viewportTransform,l=[c,0,0,c,(h[4]-i.left)*n,(h[5]-i.top)*n],u=this.interactive,f=this.skipOffscreen,d=r!==a||s!==o;this.viewportTransform=l,this.skipOffscreen=!1,this.interactive=!1,d&&this.setDimensions({width:a,height:o},{backstoreOnly:!0}),this.renderAll();var g=this.__toDataURL(t,e,i);return this.interactive=u,this.skipOffscreen=f,this.viewportTransform=h,d&&this.setDimensions({width:r,height:s},{backstoreOnly:!0}),this.renderAll(),g},__toDataURL:function(e,i){var n=this.contextContainer.canvas;return"jpg"===e&&(e="jpeg"),t?n.toDataURL("image/"+e,i):n.toDataURL("image/"+e)}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t),r=this,s=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(n.objects,function(t){r.clear(),r._setBgOverlay(n,function(){t.forEach(function(t,e){r.insertAt(t,e)}),r.renderOnAddRemove=s,delete n.objects,delete n.backgroundImage,delete n.overlayImage,delete n.background,delete n.overlay,r._setOptions(n),r.renderAll(),e&&e()})},i),this}},_setBgOverlay:function(t,e){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",t.backgroundImage,i,n),this.__setBgOverlay("overlayImage",t.overlayImage,i,n),this.__setBgOverlay("backgroundColor",t.background,i,n),this.__setBgOverlay("overlayColor",t.overlay,i,n)}else e&&e()},__setBgOverlay:function(t,e,i,n){var r=this;return e?void("backgroundImage"===t||"overlayImage"===t?fabric.util.enlivenObjects([e],function(e){r[t]=e[0],i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()})):(i[t]=!0,void(n&&n()))},_enlivenObjects:function(t,e,i){return t&&0!==t.length?void fabric.util.enlivenObjects(t,function(t){e&&e(t)},null,i):void(e&&e([]))},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.width,e.height=this.height;var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,s=e.util.string.capitalize,a=e.util.degreesToRadians,o=e.StaticCanvas.supports("setLineDash"),c=!e.isLikelyNode;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:c,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),initialize:function(t){t&&this.setOptions(t)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas()},_limitCacheSize:function(t){var i=e.perfLimitSizeTotal,n=e.cacheSideLimit,r=t.width,s=t.height,a=r/s,o=e.util.limitDimsByArea(a,i,n),c=e.util.capValue,h=e.maxCacheSideLimit,l=e.minCacheSideLimit,u=c(l,o.x,h),f=c(l,o.y,h);return r>u?(t.zoomX/=r/u,t.width=u):l>r&&(t.width=l),s>f?(t.zoomY/=s/f,t.height=f):l>s&&(t.height=l),t},_getCacheCanvasDimensions:function(){var t=this.canvas&&this.canvas.getZoom()||1,i=this.getObjectScaling(),n=this._getNonTransformedDimensions(),r=this.canvas&&this.canvas._isRetinaScaling()?e.devicePixelRatio:1,s=i.scaleX*t*r,a=i.scaleY*t*r;return{width:n.x*s+2,height:n.y*a+2,zoomX:s,zoomY:a}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var t=this.canvas._currentTransform.target,i=this.canvas._currentTransform.action;if(this===t&&i.slice&&"scale"===i.slice(0,5))return!1}var n=this._limitCacheSize(this._getCacheCanvasDimensions()),r=e.minCacheSideLimit,s=n.width,a=n.height,o=n.zoomX,c=n.zoomY,h=s!==this.cacheWidth||a!==this.cacheHeight,l=this.zoomX!==o||this.zoomY!==c,u=h||l,f=0,d=0,g=!1;if(h){var p=this._cacheCanvas.width,v=this._cacheCanvas.height,m=s>p||a>v,_=(.9*p>s||.9*v>a)&&p>r&&v>r;g=m||_,m&&(f=.1*s&-2,d=.1*a&-2)}return!!u&&(g?(this._cacheCanvas.width=Math.max(Math.ceil(s)+f,r),this._cacheCanvas.height=Math.max(Math.ceil(a)+d,r),this.cacheTranslationX=(s+f)/2,this.cacheTranslationY=(a+d)/2):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,this._cacheCanvas.width,this._cacheCanvas.height)),this.cacheWidth=s,this.cacheHeight=a,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(o,c),this.zoomX=o,this.zoomY=c,!0)},setOptions:function(t){this._setOptions(t),this._initGradient(t.fill,"fill"),this._initGradient(t.stroke,"stroke"),this._initClipping(t),this._initPattern(t.fill,"fill"),this._initPattern(t.stroke,"stroke")},transform:function(t,e){this.group&&!this.group._transformDone&&this.group.transform(t);var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),this.angle&&t.rotate(a(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),this.skewX&&t.transform(1,0,Math.tan(a(this.skewX)),1,0,0),this.skewY&&t.transform(1,Math.tan(a(this.skewY)),0,1,0,0)},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:r(this.left,i),top:r(this.top,i),width:r(this.width,i),height:r(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,i),scaleX:r(this.scaleX,i),scaleY:r(this.scaleY,i),angle:r(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:r(this.skewX,i),skewY:r(this.skewY,i)};return e.util.populateWithProperties(this,n,t),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e],"[object Array]"===Object.prototype.toString.call(t[e])&&"[object Array]"===Object.prototype.toString.call(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e]}),t},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX,e*=i.scaleY}return{scaleX:t,scaleY:e}},getObjectOpacity:function(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t},_set:function(t,i){return("scaleX"===t||"scaleY"===t)&&(i=this._constrainScale(i)),"scaleX"===t&&0>i?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&0>i?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow?"dirty"===t&&this.group&&this.group.set("dirty",i):i=new e.Shadow(i),this[t]=i,this.cacheProperties.indexOf(t)>-1&&(this.group&&this.group.set("dirty",!0),this.dirty=!0),this.group&&this.stateProperties.indexOf(t)>-1&&this.group.isOnACache()&&this.group.set("dirty",!0),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(t){this.isNotVisible()||(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t,this),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this.shouldCache()?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext),this.dirty=!1),this.drawCacheOnCanvas(t)):(this._cacheCanvas=null,this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&t.restore(),t.restore())},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"==typeof this.shadow},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawObject:function(t){this._renderBackground(t),this._setStrokeStyles(t,this),this._setFillStyles(t,this),this._render(t)},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(t){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!t){var e=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-i/2,e,i)}return!0}return!1},_renderBackground:function(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}},_setOpacity:function(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity},_setStrokeStyles:function(t,e){e.stroke&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,t.strokeStyle=e.stroke.toLive?e.stroke.toLive(t,this):e.stroke)},_setFillStyles:function(t,e){e.fill&&(t.fillStyle=e.fill.toLive?e.fill.toLive(t,this):e.fill)},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),o?t.setLineDash(e):i&&i(t))},_renderControls:function(t,i){var n,r,s,o=this.getViewportTransform(),c=this.calcTransformMatrix();r=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,s=void 0!==i.hasControls?i.hasControls:this.hasControls,c=e.util.multiplyTransformMatrices(o,c),n=e.util.qrDecompose(c),t.save(),t.translate(n.translateX,n.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),i.forActiveSelection?(t.rotate(a(n.angle)),r&&this.drawBordersInGroup(t,n,i)):(t.rotate(a(this.angle)),r&&this.drawBorders(t,i)),s&&this.drawControls(t,i),t.restore()},_setShadow:function(t){if(this.shadow){var i=this.canvas&&this.canvas.viewportTransform[0]||1,n=this.canvas&&this.canvas.viewportTransform[3]||1,r=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(i*=e.devicePixelRatio,n*=e.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(i+n)*(r.scaleX+r.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*i*r.scaleX,t.shadowOffsetY=this.shadow.offsetY*n*r.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_applyPatternGradientTransform:function(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var i=e.gradientTransform||e.patternTransform,n=-this.width/2+e.offsetX||0,r=-this.height/2+e.offsetY||0;return t.translate(n,r),i&&t.transform.apply(t,i),{offsetX:n,offsetY:r}},_renderPaintInOrder:function(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))},_renderFill:function(t){this.fill&&(t.save(),this._applyPatternGradientTransform(t,this.fill),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())},_renderStroke:function(t){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(t,this.stroke),t.stroke(),t.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var t=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}},_removeTransformMatrix:function(){var t=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),t=e.util.transformPoint(t,this.transformMatrix)),this.transformMatrix=null,this.setPositionByOrigin(t,"center","center")},clone:function(t,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,t):e.Object._fromObject("Object",n,t)},cloneAsImage:function(t,i){var n=this.toDataURL(i);return e.util.loadImage(n,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),n=this.getBoundingRect();i.width=n.width,i.height=n.height,e.util.wrapElement(i,"div");var r=new e.StaticCanvas(i,{enableRetinaScaling:t.enableRetinaScaling});"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(r.backgroundColor="#fff");var s={left:this.left,top:this.top};this.setPositionByOrigin(new e.Point(r.width/2,r.height/2),"center","center");var a=this.canvas;r.add(this);var o=r.toDataURL(t);return this.set(s).setCoords(),this.canvas=a,r.dispose(),r=null,o},isType:function(t){return this.type===t},complexity:function(){return 1},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};return n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2),n.gradientTransform=i.gradientTransform,e.Gradient.prototype.addColorStop.call(n,i.colorStops),this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},rotate:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var n=new e.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=e.util.rotatePoint(n,r,a(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object._fromObject=function(t,i,r,s){var a=e[t];i=n(i,!0),e.util.enlivenPatterns([i.fill,i.stroke],function(t){void 0!==t[0]&&(i.fill=t[0]),void 0!==t[1]&&(i.stroke=t[1]);var e=s?new a(i[s],i):new a(i);r&&r(e)})},e.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,n,r,s,a){var o,c,h,l=t.x,u=t.y;return"string"==typeof n?n=e[n]:n-=.5,"string"==typeof s?s=e[s]:s-=.5,o=s-n,"string"==typeof r?r=i[r]:r-=.5,"string"==typeof a?a=i[a]:a-=.5,c=a-r,(o||c)&&(h=this._getTransformedDimensions(),l=t.x+o*h.x,u=t.y+c*h.y),new fabric.Point(l,u)},translateToCenterPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,i,n,"center","center");return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},translateToOriginPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,"center","center",i,n);return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,s,a=this.getCenterPoint();return r=void 0!==i&&void 0!==n?this.translateToGivenOrigin(a,"center","center",i,n):new fabric.Point(this.left,this.top),s=new fabric.Point(e.x,e.y),this.angle&&(s=fabric.util.rotatePoint(s,a,-t(this.angle))),s.subtractEquals(r)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(i){var n,r,s=t(this.angle),a=this.getScaledWidth(),o=Math.cos(s)*a,c=Math.sin(s)*a;n="string"==typeof this.originX?e[this.originX]:this.originX-.5,r="string"==typeof i?e[i]:i-.5,this.left+=o*(r-n),this.top+=c*(r-n),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},onDeselect:function(){}})}(),function(){function t(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var e=fabric.util.degreesToRadians,i=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,getCoords:function(e,i){this.oCoords||this.setCoords();var n=e?this.aCoords:this.oCoords;return t(i?this.calcCoords(e):n)},intersectsWithRect:function(t,e,i,n){var r=this.getCoords(i,n);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(r,t,e).status},intersectsWithObject:function(t,e,i){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(e,i),t.getCoords(e,i)).status||t.isContainedWithinObject(this,e,i)||this.isContainedWithinObject(t,e,i)},isContainedWithinObject:function(t,e,i){for(var n=this.getCoords(e,i),r=0,s=t._getImageLines(i?t.calcCoords(e):e?t.aCoords:t.oCoords);4>r;r++)if(!t.containsPoint(n[r],s))return!1;return!0},isContainedWithinRect:function(t,e,i,n){var r=this.getBoundingRect(i,n);return r.left>=t.x&&r.left+r.width<=e.x&&r.top>=t.y&&r.top+r.height<=e.y},containsPoint:function(t,e,i,n){var e=e||this._getImageLines(n?this.calcCoords(i):i?this.aCoords:this.oCoords),r=this._findCrossPoints(t,e);return 0!==r&&r%2==1},isOnScreen:function(t){if(!this.canvas)return!1;for(var e,i=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,r=this.getCoords(!0,t),s=0;4>s;s++)if((e=r[s]).x<=n.x&&e.x>=i.x&&e.y<=n.y&&e.y>=i.y)return!0;if(this.intersectsWithRect(i,n,!0))return!0;var a={x:(i.x+n.x)/2,y:(i.y+n.y)/2};return!!this.containsPoint(a,null,!0)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,s,a,o,c=0;for(var h in e)if(!((o=e[h]).o.y<t.y&&o.d.y<t.y||o.o.y>=t.y&&o.d.y>=t.y||(o.o.x===o.d.x&&o.o.x>=t.x?a=o.o.x:(i=0,n=(o.d.y-o.o.y)/(o.d.x-o.o.x),r=t.y-i*t.x,s=o.o.y-n*o.o.x,a=-(r-s)/(i-n)),a>=t.x&&(c+=1),2!==c)))break;return c},getBoundingRect:function(t,e){var i=this.getCoords(t,e);return fabric.util.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?0>t?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,e){var i=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/i)},scaleToHeight:function(t,e){var i=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/i)},calcCoords:function(t){var i=e(this.angle),n=this.getViewportTransform(),r=t?this._getTransformedDimensions():this._calculateCurrentDimensions(),s=r.x,a=r.y,o=i?Math.sin(i):0,c=i?Math.cos(i):1,h=s>0?Math.atan(a/s):0,l=s/Math.cos(h)/2,u=Math.cos(h+i)*l,f=Math.sin(h+i)*l,d=this.getCenterPoint(),g=t?d:fabric.util.transformPoint(d,n),p=new fabric.Point(g.x-u,g.y-f),v=new fabric.Point(p.x+s*c,p.y+s*o),m=new fabric.Point(p.x-a*o,p.y+a*c),_=new fabric.Point(g.x+u,g.y+f);if(!t)var b=new fabric.Point((p.x+m.x)/2,(p.y+m.y)/2),y=new fabric.Point((v.x+p.x)/2,(v.y+p.y)/2),x=new fabric.Point((_.x+v.x)/2,(_.y+v.y)/2),w=new fabric.Point((_.x+m.x)/2,(_.y+m.y)/2),C=new fabric.Point(y.x+o*this.rotatingPointOffset,y.y-c*this.rotatingPointOffset);g={tl:p,tr:v,br:_,bl:m};return t||(g.ml=b,g.mt=y,g.mr=x,g.mb=w,g.mtr=C),g},setCoords:function(t,e){return this.oCoords=this.calcCoords(t),e||(this.aCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=Math.cos(t),n=Math.sin(t);return(6.123233995736766e-17===i||-1.8369701987210297e-16===i)&&(i=0),[i,n,-n,i,0,0]}return fabric.iMatrix.concat()},calcTransformMatrix:function(t){var e,n,r=this.getCenterPoint(),s=[1,0,0,1,r.x,r.y],a=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return n=this.group&&!t?i(this.group.calcTransformMatrix(),s):s,this.angle&&(e=this._calcRotateMatrix(),n=i(n,e)),n=i(n,a)},_calcDimensionsTransformMatrix:function(t,n,r){var s,a=[this.scaleX*(r&&this.flipX?-1:1),0,0,this.scaleY*(r&&this.flipY?-1:1),0,0];return t&&(s=[1,0,Math.tan(e(t)),1],a=i(a,s,!0)),n&&(s=[1,Math.tan(e(n)),0,1],a=i(a,s,!0)),a},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,n,r=this._getNonTransformedDimensions(),s=r.x/2,a=r.y/2,o=[{x:-s,y:-a},{x:s,y:-a},{x:-s,y:a},{x:s,y:a}],c=this._calcDimensionsTransformMatrix(t,e,!1);for(i=0;i<o.length;i++)o[i]=fabric.util.transformPoint(o[i],c);return n=fabric.util.makeBoundingBoxFromPoints(o),{x:n.width,y:n.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return fabric.util.transformPoint(e,t,!0).scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function t(t,e,n){var r={};n.forEach(function(e){r[e]=t[e]}),i(t[e],r,!0)}function e(t,i,n){if(t===i)return!0;if(Array.isArray(t)){if(t.length!==i.length)return!1;for(var r=0,s=t.length;s>r;r++)if(!e(t[r],i[r]))return!1;return!0}if(t&&"object"==typeof t){var a,o=Object.keys(t);if(!n&&o.length!==Object.keys(i).length)return!1;for(var r=0,s=o.length;s>r;r++)if(a=o[r],!e(t[a],i[a]))return!1;return!0}}var i=fabric.util.object.extend,n="stateProperties";fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(t){var i="_"+(t=t||n);return Object.keys(this[i]).length<this[t].length||!e(this[i],this,!0)},saveState:function(e){var i=e&&e.propertySet||n,r="_"+i;return this[r]?(t(this,r,this[i]),e&&e.stateProperties&&t(this,r,e.stateProperties),this):this.setupState(e)},setupState:function(t){var e=(t=t||{}).propertySet||n;return t.propertySet=e,this["_"+e]={},this.saveState(t),this}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var e,i,n=t.x,r=t.y;this.__corner=0;for(var s in this.oCoords)if(this.isControlVisible(s)&&("mtr"!==s||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==s&&"mr"!==s&&"mb"!==s&&"ml"!==s)&&(i=this._getImageLines(this.oCoords[s].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=s,s;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),s=.707106*this.cornerSize,a=s*Math.cos(r),o=s*Math.sin(r);for(var c in n)e=n[c].x,i=n[c].y,n[c].corner={tl:{x:e-o,y:i-a},tr:{x:e+a,y:i-o},bl:{x:e-a,y:i+o},br:{x:e+o,y:i+a}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/r[0],1/r[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=1/this.borderScaleFactor,r=i.x+n,s=i.y+n,a=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,o=void 0!==e.hasControls?e.hasControls:this.hasControls,c=void 0!==e.rotatingPointOffset?e.rotatingPointOffset:this.rotatingPointOffset;if(t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray,null),t.strokeRect(-r/2,-s/2,r,s),a&&this.isControlVisible("mtr")&&o){var h=-s/2;t.beginPath(),t.moveTo(0,h),t.lineTo(0,h-c),t.closePath(),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e,i){i=i||{};var n=this._getNonTransformedDimensions(),r=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),s=fabric.util.transformPoint(n,r),a=1/this.borderScaleFactor,o=s.x+a,c=s.y+a;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-o/2,-c/2,o,c),t.restore(),this},drawControls:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=i.x,r=i.y,s=e.cornerSize||this.cornerSize,a=-(n+s)/2,o=-(r+s)/2,c=void 0!==e.transparentCorners?e.transparentCorners:this.transparentCorners,h=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,l=c?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",t,l,a,o,e),this._drawControl("tr",t,l,a+n,o,e),this._drawControl("bl",t,l,a,o+r,e),this._drawControl("br",t,l,a+n,o+r,e),this.get("lockUniScaling")||(this._drawControl("mt",t,l,a+n/2,o,e),this._drawControl("mb",t,l,a+n/2,o+r,e),this._drawControl("mr",t,l,a+n,o+r/2,e),this._drawControl("ml",t,l,a,o+r/2,e)),h&&this._drawControl("mtr",t,l,a+n/2,o-this.rotatingPointOffset,e),t.restore(),this},_drawControl:function(t,e,i,n,r,s){if(s=s||{},this.isControlVisible(t)){var a=this.cornerSize,o=!this.transparentCorners&&this.cornerStrokeColor;switch(s.cornerStyle||this.cornerStyle){case"circle":e.beginPath(),e.arc(n+a/2,r+a/2,a/2,0,2*Math.PI,!1),e[i](),o&&e.stroke();break;default:this.transparentCorners||e.clearRect(n,r,a,a),e[i+"Rect"](n,r,a,a),o&&e.strokeRect(n,r,a,a)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){t||(t={});for(var e in t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,s=this;return fabric.util.animate({startValue:t.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),s.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,s=this;return fabric.util.animate({startValue:t.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),s.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,s=this;return fabric.util.animate({startValue:t.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){t.set("opacity",e),s.requestRenderAll(),r()},onComplete:function(){s.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;r>n;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,s=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var a=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=a),e=~e.indexOf("=")?a+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(s)},onChange:function(e,a,o){r?s[r[0]][r[1]]=e:s.set(t,e),n||i.onChange&&i.onChange(e,a,o)},onComplete:function(t,e,r){n||(s.setCoords(),i.onComplete&&i.onComplete(t,e,r))}})}}),function(t){"use strict";function e(t,e){var i=t.origin,n=t.axis1,r=t.axis2,s=t.dimension,a=e.nearest,o=e.center,c=e.farthest;return function(){switch(this.get(i)){case a:return Math.min(this.get(n),this.get(r));case o:return Math.min(this.get(n),this.get(r))+.5*this.get(s);case c:return Math.max(this.get(n),this.get(r))}}}var i=t.fabric||(t.fabric={}),n=i.util.object.extend,r=i.util.object.clone,s={x1:1,x2:1,y1:1,y2:1},a=i.StaticCanvas.supports("setLineDash");if(i.Line)i.warn("fabric.Line is already defined");else{var o=i.Object.prototype.cacheProperties.concat();o.push("x1","x2","y1","y2"),i.Line=i.util.createClass(i.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:o,initialize:function(t,e){t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==s[t]&&this._setWidthHeight(),this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t){if(t.beginPath(),!this.strokeDashArray||this.strokeDashArray&&a){var e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)}t.lineWidth=this.strokeWidth;var i=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=i},_renderDashedStroke:function(t){var e=this.calcLinePoints();t.beginPath(),i.util.drawDashedLine(t,e.x1,e.y1,e.x2,e.y2,this.strokeDashArray),t.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(t){return n(this.callSuper("toObject",t),this.calcLinePoints())},_getNonTransformedDimensions:function(){var t=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}}}),i.Line.fromObject=function(t,e){var n=r(t,!0);n.points=[t.x1,t.y1,t.x2,t.y2],i.Object._fromObject("Line",n,function(t){delete t.points,e&&e(t)},"points")}}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.PI;if(e.util.object.extend,e.Circle)e.warn("fabric.Circle is already defined.");else{var n=e.Object.prototype.cacheProperties.concat();n.push("radius"),e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,cacheProperties:n,initialize:function(t){this.callSuper("initialize",t),this.set("radius",t&&t.radius||0)},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)}}),e.Circle.fromObject=function(t,i){return e.Object._fromObject("Circle",t,i)}}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){this.callSuper("initialize",t),this.set("width",t&&t.width||100).set("height",t&&t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()}}),e.Triangle.fromObject=function(t,i){return e.Object._fromObject("Triangle",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI;if(e.util.object.extend,e.Ellipse)e.warn("fabric.Ellipse is already defined.");else{var n=e.Object.prototype.cacheProperties.concat();n.push("rx","ry"),e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:n,initialize:function(t){this.callSuper("initialize",t),this.set("rx",t&&t.rx||0),this.set("ry",t&&t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},_render:function(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,i,!1),t.restore(),this._renderPaintInOrder(t)}}),e.Ellipse.fromObject=function(t,i){return e.Object._fromObject("Ellipse",t,i)}}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});if(e.util.object.extend,e.Rect)e.warn("fabric.Rect is already defined");else{var i=e.Object.prototype.stateProperties.concat();i.push("rx","ry");var n=e.Object.prototype.cacheProperties.concat();n.push("rx","ry"),e.Rect=e.util.createClass(e.Object,{stateProperties:i,type:"rect",rx:0,ry:0,cacheProperties:n,initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){if(1!==this.width||1!==this.height){var e=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,s=-this.width/2,a=-this.height/2,o=0!==e||0!==i,c=.4477152502;t.beginPath(),t.moveTo(s+e,a),t.lineTo(s+n-e,a),o&&t.bezierCurveTo(s+n-c*e,a,s+n,a+c*i,s+n,a+i),t.lineTo(s+n,a+r-i),o&&t.bezierCurveTo(s+n,a+r-c*i,s+n-c*e,a+r,s+n-e,a+r),t.lineTo(s+e,a+r),o&&t.bezierCurveTo(s+c*e,a+r,s,a+r-c*i,s,a+r-i),t.lineTo(s,a+i),o&&t.bezierCurveTo(s,a+c*i,s+c*e,a,s+e,a),t.closePath(),this._renderPaintInOrder(t)}else t.fillRect(-.5,-.5,1,1)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,s=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+s,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+s,i,n+s,this.strokeDashArray),e.util.drawDashedLine(t,i,n+s,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))}}),e.Rect.fromObject=function(t,i){return e.Object._fromObject("Rect",t,i)}}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max;if(e.util.toFixed,e.Object.NUM_FRACTION_DIGITS,e.Polyline)e.warn("fabric.Polyline is already defined");else{var s=e.Object.prototype.cacheProperties.concat();s.push("points"),e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:s,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e);var i=this._calcDimensions();void 0===e.left&&(this.left=i.left),void 0===e.top&&(this.top=i.top),this.width=i.width,this.height=i.height,this.pathOffset={x:i.left+this.width/2,y:i.top+this.height/2}},_calcDimensions:function(){var t=this.points,e=n(t,"x")||0,i=n(t,"y")||0;return{left:e,top:i,width:(r(t,"x")||0)-e,height:(r(t,"y")||0)-i}},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},commonRender:function(t){var e,i=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-r);for(var s=0;i>s;s++)e=this.points[s],t.lineTo(e.x-n,e.y-r);return!0},_render:function(t){this.commonRender(t)&&this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,s=this.points.length;s>r;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.fromObject=function(t,i){return e.Object._fromObject("Polyline",t,i,"points")}}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.util.object.extend,e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_render:function(t){this.commonRender(t)&&(t.closePath(),this._renderPaintInOrder(t))},_renderDashedStroke:function(t){this.callSuper("_renderDashedStroke",t),t.closePath()}}),e.Polygon.fromObject=function(t,i){return e.Object._fromObject("Polygon",t,i,"points")})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,s=Object.prototype.toString,a=e.util.drawArc,o={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};if(e.Path)e.warn("fabric.Path is already defined");else{var h=e.Object.prototype.stateProperties.concat();h.push("path");var l=e.Object.prototype.cacheProperties.concat();l.push("path","fillRule"),e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:l,stateProperties:h,initialize:function(t,e){e=e||{},this.callSuper("initialize",e),t||(t=[]);var i="[object Array]"===s.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left),void 0===t.top&&(this.top=e.top),this.pathOffset=this.pathOffset||{x:e.left+this.width/2,y:e.top+this.height/2}},_renderPathCommands:function(t){var e,i,n,r=null,s=0,o=0,c=0,h=0,l=0,u=0,f=-this.pathOffset.x,d=-this.pathOffset.y;t.beginPath();for(var g=0,p=this.path.length;p>g;++g){switch((e=this.path[g])[0]){case"l":c+=e[1],h+=e[2],t.lineTo(c+f,h+d);break;case"L":c=e[1],h=e[2],t.lineTo(c+f,h+d);break;case"h":c+=e[1],t.lineTo(c+f,h+d);break;case"H":c=e[1],t.lineTo(c+f,h+d);break;case"v":h+=e[1],t.lineTo(c+f,h+d);break;case"V":h=e[1],t.lineTo(c+f,h+d);break;case"m":s=c+=e[1],o=h+=e[2],t.moveTo(c+f,h+d);break;case"M":s=c=e[1],o=h=e[2],t.moveTo(c+f,h+d);break;case"c":i=c+e[5],n=h+e[6],l=c+e[3],u=h+e[4],t.bezierCurveTo(c+e[1]+f,h+e[2]+d,l+f,u+d,i+f,n+d),c=i,h=n;break;case"C":c=e[5],h=e[6],l=e[3],u=e[4],t.bezierCurveTo(e[1]+f,e[2]+d,l+f,u+d,c+f,h+d);break;case"s":i=c+e[3],n=h+e[4],null===r[0].match(/[CcSs]/)?(l=c,u=h):(l=2*c-l,u=2*h-u),t.bezierCurveTo(l+f,u+d,c+e[1]+f,h+e[2]+d,i+f,n+d),l=c+e[1],u=h+e[2],c=i,h=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(l=c,u=h):(l=2*c-l,u=2*h-u),t.bezierCurveTo(l+f,u+d,e[1]+f,e[2]+d,i+f,n+d),c=i,h=n,l=e[1],u=e[2];break;case"q":i=c+e[3],n=h+e[4],l=c+e[1],u=h+e[2],t.quadraticCurveTo(l+f,u+d,i+f,n+d),c=i,h=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+d,i+f,n+d),c=i,h=n,l=e[1],u=e[2];break;case"t":i=c+e[1],n=h+e[2],null===r[0].match(/[QqTt]/)?(l=c,u=h):(l=2*c-l,u=2*h-u),t.quadraticCurveTo(l+f,u+d,i+f,n+d),c=i,h=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(l=c,u=h):(l=2*c-l,u=2*h-u),t.quadraticCurveTo(l+f,u+d,i+f,n+d),c=i,h=n;break;case"a":a(t,c+f,h+d,[e[1],e[2],e[3],e[4],e[5],e[6]+c+f,e[7]+h+d]),c+=e[6],h+=e[7];break;case"A":a(t,c+f,h+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]),c=e[6],h=e[7];break;case"z":case"Z":c=s,h=o,t.closePath()}r=e}},_render:function(t){this._renderPathCommands(t),this._renderPaintInOrder(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return r(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),top:this.top,left:this.left})},toDatalessObject:function(t){var e=this.toObject(["sourcePath"].concat(t));return e.sourcePath&&delete e.path,e},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,s=[],a=[],h=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,l=0,u=this.path.length;u>l;l++){for(n=(t=this.path[l]).slice(1).trim(),a.length=0;i=h.exec(n);)a.push(i[0]);r=[t.charAt(0)];for(var f=0,d=a.length;d>f;f++)e=parseFloat(a[f]),isNaN(e)||r.push(e);var g=r[0],p=o[g.toLowerCase()],v=c[g]||g;if(r.length-1>p)for(var m=1,_=r.length;_>m;m+=p)s.push([g].concat(r.slice(m,m+p))),g=v;else s.push(r)}return s},_parseDimensions:function(){for(var t,r,s,a,o=[],c=[],h=null,l=0,u=0,f=0,d=0,g=0,p=0,v=0,m=this.path.length;m>v;++v){switch((t=this.path[v])[0]){case"l":f+=t[1],d+=t[2],a=[];break;case"L":f=t[1],d=t[2],a=[];break;case"h":f+=t[1],a=[];break;case"H":f=t[1],a=[];break;case"v":d+=t[1],a=[];break;case"V":d=t[1],a=[];break;case"m":l=f+=t[1],u=d+=t[2],a=[];break;case"M":l=f=t[1],u=d=t[2],a=[];break;case"c":r=f+t[5],s=d+t[6],g=f+t[3],p=d+t[4],a=e.util.getBoundsOfCurve(f,d,f+t[1],d+t[2],g,p,r,s),f=r,d=s;break;case"C":g=t[3],p=t[4],a=e.util.getBoundsOfCurve(f,d,t[1],t[2],g,p,t[5],t[6]),f=t[5],d=t[6];break;case"s":r=f+t[3],s=d+t[4],null===h[0].match(/[CcSs]/)?(g=f,p=d):(g=2*f-g,p=2*d-p),a=e.util.getBoundsOfCurve(f,d,g,p,f+t[1],d+t[2],r,s),g=f+t[1],p=d+t[2],f=r,d=s;break;case"S":r=t[3],s=t[4],null===h[0].match(/[CcSs]/)?(g=f,p=d):(g=2*f-g,p=2*d-p),a=e.util.getBoundsOfCurve(f,d,g,p,t[1],t[2],r,s),f=r,d=s,g=t[1],p=t[2];break;case"q":r=f+t[3],s=d+t[4],g=f+t[1],p=d+t[2],a=e.util.getBoundsOfCurve(f,d,g,p,g,p,r,s),f=r,d=s;break;case"Q":g=t[1],p=t[2],a=e.util.getBoundsOfCurve(f,d,g,p,g,p,t[3],t[4]),f=t[3],d=t[4];break;case"t":r=f+t[1],s=d+t[2],null===h[0].match(/[QqTt]/)?(g=f,p=d):(g=2*f-g,p=2*d-p),a=e.util.getBoundsOfCurve(f,d,g,p,g,p,r,s),f=r,d=s;break;case"T":r=t[1],s=t[2],null===h[0].match(/[QqTt]/)?(g=f,p=d):(g=2*f-g,p=2*d-p),a=e.util.getBoundsOfCurve(f,d,g,p,g,p,r,s),f=r,d=s;break;case"a":a=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6]+f,t[7]+d),f+=t[6],d+=t[7];break;case"A":a=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),f=t[6],d=t[7];break;case"z":case"Z":f=l,d=u}h=t,a.forEach(function(t){o.push(t.x),c.push(t.y)}),o.push(f),c.push(d)}var _=i(o)||0,b=i(c)||0;return{left:_,top:b,width:(n(o)||0)-_,height:(n(c)||0)-b}}}),e.Path.fromObject=function(t,i){if("string"==typeof t.sourcePath){var n=t.sourcePath;e.loadSVGFromURL(n,function(e){var n=e[0];n.setOptions(t),i&&i(n)})}else e.Object._fromObject("Path",t,i,"path")}}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),!i){var r=e&&e.centerPoint;r||this._calcBounds(),this._updateObjectsCoords(r),delete e.centerPoint,this.callSuper("initialize",e)}this.setCoords()},_updateObjectsCoords:function(t){for(var t=t||this.getCenterPoint(),e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){var i=t.left,n=t.top;t.set({left:i-e.x,top:n-e.y}),t.group=this,t.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,e){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(t,e);if("canvas"===t)for(i=this._objects.length;i--;)this._objects[i]._set(t,e);this.callSuper("_set",t,e)},toObject:function(t){var e=this.getObjects().map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var n=e.toObject(t);return e.includeDefaultValues=i,n});return i(this.callSuper("toObject",t),{objects:e})},toDatalessObject:function(t){var e,n=this.sourcePath;return e=n||this.getObjects().map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var n=e.toDatalessObject(t);return e.includeDefaultValues=i,n}),i(this.callSuper("toDatalessObject",t),{objects:e})},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=t,t)for(var e=0,i=this._objects.length;i>e;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var t=0,e=this._objects.length;e>t;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var e=0,i=this._objects.length;i>e;e++)this._objects[e].render(t)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var t=0,e=this._objects.length;e>t;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var i=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-i/2,-n/2,i,n)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),n=e.util.qrDecompose(i),r=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(r,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var t=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new e.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),t.forEach(function(t){t.group=r,t.dirty=!0,i.add(t)}),r.canvas=i,r._objects=t,i._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0,!0)}),this},_calcBounds:function(t){for(var e,i,n,r=[],s=[],a=["tr","br","bl","tl"],o=0,c=this._objects.length,h=a.length;c>o;++o)for((e=this._objects[o]).setCoords(!0),n=0;h>n;n++)i=a[n],r.push(e.oCoords[i].x),s.push(e.oCoords[i].y);this.set(this._getBounds(r,s,t))},_getBounds:function(t,i,s){var a=new e.Point(n(t),n(i)),o=new e.Point(r(t),r(i)),c={width:o.x-a.x||0,height:o.y-a.y||0};return s||(c.left=a.x||0,c.top=a.y||0,"center"===this.originX&&(c.left+=c.width/2),"right"===this.originX&&(c.left+=c.width),"center"===this.originY&&(c.top+=c.height/2),"bottom"===this.originY&&(c.top+=c.height)),c}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){var r=e.util.object.clone(t,!0);delete r.objects,i&&i(new e.Group(n,r,!0))})})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(t,i){i=i||{},this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var t=this._objects;this._objects=[];var i=this.toObject(),n=new e.Group([]);if(delete i.objects,n.set(i),n.type="group",t.forEach(function(t){t.group=n,t.canvas.remove(t)}),n._objects=t,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},_set:function(t,i){var n=this._objects.length;if("canvas"===t)for(;n--;)this._objects[n].set(t,i);if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,i);e.Object.prototype._set.call(this,t,i)},shouldCache:function(){return!1},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var t=0,e=this._objects.length;e>t;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return!1},_renderControls:function(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),void 0===i.hasRotatingPoint&&(i.hasRotatingPoint=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;r>n;n++)this._objects[n]._renderControls(t,i);t.restore()}}),e.ActiveSelection.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.ActiveSelection(n,t,!0))})})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=fabric.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image)fabric.warn("fabric.Image is already defined.");else{var i=fabric.Object.prototype.stateProperties.concat();i.push("cropX","cropY"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:i,objectCaching:!1,cacheKey:"",cropX:0,cropY:0,initialize:function(t,e){e||(e={}),this.filters=[],this.callSuper("initialize",e),this._initElement(t,e),this.cacheKey="texture"+fabric.Object.__uid++},getElement:function(){return this._element},setElement:function(t,e){return this._element=t,this._originalElement=t,this._initConfig(e),this.resizeFilter&&this.applyResizeFilters(),0!==this.filters.length&&this.applyFilters(),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t,this),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var i=[];this.filters.forEach(function(t){t&&i.push(t.toObject())});var n=e(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(t)),{src:this.getSrc(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n.width/=this._filterScalingX,n.height/=this._filterScalingY,n},getSrc:function(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():fabric.isLikelyNode?e._src:e.src:this.src||""},setSrc:function(t,e,i){return fabric.util.loadImage(t,function(t){this.setElement(t,i),e(this)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var t=this.resizeFilter,e=this.canvas?this.canvas.getRetinaScaling():1,i=this.minimumScaleTrigger,n=this.scaleX<i?this.scaleX:1,r=this.scaleY<i?this.scaleY:1;if(1>n*e&&(n*=e),1>r*e&&(r*=e),!t||n>=1&&r>=1)this._element=this._filteredEl;else{fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var s,a=this._filteredEl||this._originalElement;if(this._element===this._originalElement){var o=fabric.util.createCanvasElement();o.width=a.width,o.height=a.height,this._element=o}var c=this._element.getContext("2d");a.getContext?s=a.getContext("2d").getImageData(0,0,a.width,a.height):(c.drawImage(a,0,0),s=c.getImageData(0,0,a.width,a.height));var h={imageData:s,scaleX:n,scaleY:r};t.applyTo2d(h),this.width=this._element.width=h.imageData.width,this.height=this._element.height=h.imageData.height,c.putImageData(h.imageData,0,0)}},applyFilters:function(t){if(t=t||this.filters||[],0===(t=t.filter(function(t){return t})).length)return this._element=this._originalElement,this._filterScalingX=1,this._filterScalingY=1,this;var e=this._originalElement,i=e.naturalWidth||e.width,n=e.naturalHeight||e.height;if(this._element===this._originalElement){var r=fabric.util.createCanvasElement();r.width=e.width,r.height=e.height,this._element=r}else this._element.getContext("2d").clearRect(0,0,i,n);return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(t,this._originalElement,i,n,this._element,this.cacheKey),(this.width!==this._element.width||this.height!==this._element.height)&&(this._filterScalingX=this._element.width/this.width,this._filterScalingY=this._element.height/this.height,this.width=this._element.width,this.height=this._element.height),this},_render:function(t){!1===this.isMoving&&this.resizeFilter&&this._needsResize()&&(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,this.applyResizeFilters()),this._stroke(t),this._renderPaintInOrder(t)},_renderFill:function(t){var e,i=-this.width/2,n=-this.height/2;(e=this._element)&&t.drawImage(e,this.cropX,this.cropY,this.width,this.height,i,n,this.width,this.height)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t,e){this.setElement(fabric.util.getById(t),e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()?this.getElement().width||0:0,this.height="height"in t?t.height:this.getElement()?this.getElement().height||0:0},parsePreserveAspectRatioAttribute:function(){if(this.preserveAspectRatio){var t,e=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio),i=this._element.width,n=this._element.height,r=this.width,s=this.height,a={width:r,height:s};!e||"none"===e.alignX&&"none"===e.alignY?(this.scaleX=r/i,this.scaleY=s/n):("meet"===e.meetOrSlice&&(this.width=i,this.height=n,this.scaleX=this.scaleY=t=fabric.util.findScaleToFit(this._element,a),"Mid"===e.alignX&&(this.left+=(r-i*t)/2),"Max"===e.alignX&&(this.left+=r-i*t),"Mid"===e.alignY&&(this.top+=(s-n*t)/2),"Max"===e.alignY&&(this.top+=s-n*t)),"slice"===e.meetOrSlice&&(this.scaleX=this.scaleY=t=fabric.util.findScaleToCover(this._element,a),this.width=r/t,this.height=s/t,"Mid"===e.alignX&&(this.cropX=(i-this.width)/2),"Max"===e.alignX&&(this.cropX=i-this.width),"Mid"===e.alignY&&(this.cropY=(n-this.height)/2),"Max"===e.alignY&&(this.cropY=n-this.height)))}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i,n){return n?void(e&&e(null,n)):void fabric.Image.prototype._initFilters.call(t,t.filters,function(n){t.filters=n||[],fabric.Image.prototype._initFilters.call(t,[t.resizeFilter],function(n){t.resizeFilter=n[0];var r=new fabric.Image(i,t);e(r)})})},null,t.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)}}}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.angle%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.rotate(t),n()},onComplete:function(){r.setCoords(),i()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){"use strict";function t(t){t&&t.tileSize&&(this.tileSize=t.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}fabric.isWebglSupported=function(t){if(fabric.isLikelyNode)return!1;t=t||fabric.WebglFilterBackend.prototype.tileSize;var e=document.createElement("canvas"),i=e.getContext("webgl")||e.getContext("experimental-webgl"),n=!1;return i&&(fabric.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),n=fabric.maxTextureSize>=t),this.isSupported=n,n},fabric.WebglFilterBackend=t,t.prototype={tileSize:2048,resources:{},setupGLContext:function(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.squareVertices=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(t,e)},chooseFastestCopyGLTo2DMethod:function(t,e){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(t){i=!1}var r="undefined"!=typeof ArrayBuffer,s="undefined"!=typeof Uint8ClampedArray;if(n&&i&&r&&s){var a,o,c=fabric.util.createCanvasElement(),h=new ArrayBuffer(t*e*4),l={imageBuffer:h};c.width=t,c.height=e,a=window.performance.now(),copyGLTo2DDrawImage.call(l,this.gl,c),o=window.performance.now()-a,a=window.performance.now(),copyGLTo2DPutImageData.call(l,this.gl,c),o>window.performance.now()-a?(this.imageBuffer=h,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(t,e){var i=fabric.util.createCanvasElement();i.width=t,i.height=e;var n={premultipliedAlpha:!1},r=i.getContext("webgl",n);r||(r=i.getContext("experimental-webgl",n)),r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)},applyFilters:function(t,e,i,n,r,s){var a,o=this.gl;s&&(a=this.getCachedTexture(s,e));var c={originalWidth:e.width||e.originalWidth,originalHeight:e.height||e.originalHeight,sourceWidth:i,sourceHeight:n,context:o,sourceTexture:this.createTexture(o,i,n,!a&&e),targetTexture:this.createTexture(o,i,n),originalTexture:a||this.createTexture(o,i,n,!a&&e),passes:t.length,webgl:!0,squareVertices:this.squareVertices,programCache:this.programCache,pass:0,filterBackend:this},h=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,h),t.forEach(function(t){t&&t.applyTo(c)}),this.copyGLTo2D(o,r),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(c.sourceTexture),o.deleteTexture(c.targetTexture),o.deleteFramebuffer(h),r.getContext("2d").setTransform(1,0,0,1,0,0),c},applyFiltersDebug:function(t,e,i,n,r,s){var a=this.gl,o=this.applyFilters(t,e,i,n,r,s),c=a.getError();if(c!==a.NO_ERROR){var h=this.glErrorToString(a,c),l=new Error("WebGL Error "+h);throw l.glErrorCode=c,l}return o},glErrorToString:function(t,e){if(!t)return"Context undefined for error code: "+e;if("number"!=typeof e)return"Error code is not a number";switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"UNKNOWN_ERROR"}},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(t,e,i,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),r},getCachedTexture:function(t,e){if(this.textureCache[t])return this.textureCache[t];var i=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[t]=i,i},evictCachesForKey:function(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,e=t.getExtension("WEBGL_debug_renderer_info"),i={renderer:"",vendor:""};if(e){var n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),r=t.getParameter(e.UNMASKED_VENDOR_WEBGL);n&&(i.renderer=n.toLowerCase()),r&&(i.vendor=r.toLowerCase())}return this.gpuInfo=i,i}}}(),function(){"use strict";function t(){}var e=function(){};fabric.Canvas2dFilterBackend=t,t.prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(t,e,i,n,r){var s=r.getContext("2d");s.drawImage(e,0,0,i,n);var a={sourceWidth:i,sourceHeight:n,imageData:s.getImageData(0,0,i,n),originalEl:e,originalImageData:s.getImageData(0,0,i,n),canvasEl:r,ctx:s,filterBackend:this};return t.forEach(function(t){t.applyTo(a)}),(a.imageData.width!==i||a.imageData.height!==n)&&(r.width=a.imageData.width,r.height=a.imageData.height),s.putImageData(a.imageData,0,0),a}}}(),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aTexCoord;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},createProgram:function(t,e,i){if(this.vertexSource&&this.fragmentSource){var n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,i||this.vertexSource),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error('Vertex shader compile error for "${this.type}": '+t.getShaderInfoLog(n));var r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,e||this.fragmentSource),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error('Fragment shader compile error for "${this.type}": '+t.getShaderInfoLog(r));var s=t.createProgram();if(t.attachShader(s,n),t.attachShader(s,r),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(s));var a=this.getAttributeLocations(t,s),o=this.getUniformLocations(t,s)||{};return o.uStepW=t.getUniformLocation(s,"uStepW"),o.uStepH=t.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:a,uniformLocations:o}}},getAttributeLocations:function(t,e){return{aPosition:t.getAttribLocation(e,"aPosition"),aTexCoord:t.getAttribLocation(e,"aTexCoord")}},getUniformLocations:function(){},sendAttributeData:function(t,e,i){["aPosition","aTexCoord"].forEach(function(n){var r=e[n],s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW)})},_setupFrameBuffer:function(t){var e=t.context;t.passes>1?e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish())},_swapTextures:function(t){t.passes--,t.pass++;var e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e},isNeutralState:function(){return!1},applyTo:function(t){if(t.webgl){if(t.passes>1&&this.isNeutralState(t))return;this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)}else this.applyTo2d(t)},retrieveShader:function(t){return t.programCache.hasOwnProperty(this.type)||(t.programCache[this.type]=this.createProgram(t.context)),t.programCache[this.type]},applyToWebGL:function(t){var e=t.context,i=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.squareVertices),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.sourceWidth,t.sourceHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)},unbindAdditionalTexture:function(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(t){this[this.mainParameter]=t},sendUniformData:function(){},createHelpLayer:function(t){if(!t.helpLayer){var e=document.createElement("canvas");e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}},toObject:function(){var t={type:this.type},e=this.mainParameter;return e&&(t[e]=this[e]),t},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(t,e){var i=new fabric.Image.filters[t.type](t);return e&&e(i),i},function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var e,i,n,r,s,a=t.imageData.data,o=a.length,c=this.matrix,h=this.colorsOnly;for(s=0;o>s;s+=4)e=a[s],i=a[s+1],n=a[s+2],h?(a[s]=e*c[0]+i*c[1]+n*c[2]+255*c[4],a[s+1]=e*c[5]+i*c[6]+n*c[7]+255*c[9],a[s+2]=e*c[10]+i*c[11]+n*c[12]+255*c[14]):(r=a[s+3],a[s]=e*c[0]+i*c[1]+n*c[2]+r*c[3]+255*c[4],a[s+1]=e*c[5]+i*c[6]+n*c[7]+r*c[8]+255*c[9],a[s+2]=e*c[10]+i*c[11]+n*c[12]+r*c[13]+255*c[14],a[s+3]=e*c[15]+i*c[16]+n*c[17]+r*c[18]+255*c[19])},getUniformLocations:function(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}},sendUniformData:function(t,e){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],r=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,n),t.uniform4fv(e.uConstants,r)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(0!==this.brightness){var e,i=t.imageData.data,n=i.length,r=Math.round(255*this.brightness);for(e=0;n>e;e+=4)i[e]=i[e]+r,i[e+1]=i[e+1]+r,i[e+2]=i[e+2]+r}},getUniformLocations:function(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}},sendUniformData:function(t,e){t.uniform1f(e.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(t){var e=Math.sqrt(this.matrix.length),i=this.type+"_"+e+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return t.programCache.hasOwnProperty(i)||(t.programCache[i]=this.createProgram(t.context,n)),t.programCache[i]},applyTo2d:function(t){var e,i,n,r,s,a,o,c,h,l,u,f,d,g=t.imageData,p=g.data,v=this.matrix,m=Math.round(Math.sqrt(v.length)),_=Math.floor(m/2),b=g.width,y=g.height,x=t.ctx.createImageData(b,y),w=x.data,C=this.opaque?1:0;for(u=0;y>u;u++)for(l=0;b>l;l++){for(s=4*(u*b+l),e=0,i=0,n=0,r=0,d=0;m>d;d++)for(f=0;m>f;f++)o=u+d-_,a=l+f-_,0>o||o>y||0>a||a>b||(c=4*(o*b+a),h=v[d*m+f],e+=p[c]*h,i+=p[c+1]*h,n+=p[c+2]*h,C||(r+=p[c+3]*h));w[s]=e,w[s+1]=i,w[s+2]=n,w[s+3]=C?p[s+3]:r}t.imageData=x},getUniformLocations:function(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}},sendUniformData:function(t,e){t.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(t){var e,i,n=t.imageData.data,r=n.length,s=this.mode;for(e=0;r>e;e+=4)"average"===s?i=(n[e]+n[e+1]+n[e+2])/3:"lightness"===s?i=(Math.min(n[e],n[e+1],n[e+2])+Math.max(n[e],n[e+1],n[e+2]))/2:"luminosity"===s&&(i=.21*n[e]+.72*n[e+1]+.07*n[e+2]),n[e]=i,n[e+1]=i,n[e+2]=i},retrieveShader:function(t){var e=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(e)||(t.programCache[e]=this.createProgram(t.context,i)),t.programCache[e]},getUniformLocations:function(t,e){return{uMode:t.getUniformLocation(e,"uMode")}},sendUniformData:function(t,e){t.uniform1i(e.uMode,1)}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(t){if(this.invert){var e,i=t.imageData.data,n=i.length;for(e=0;n>e;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2]}},getUniformLocations:function(t,e){return{uInvert:t.getUniformLocation(e,"uInvert")}},sendUniformData:function(t,e){t.uniform1i(e.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(t){if(0!==this.noise){var e,i,n=t.imageData.data,r=n.length,s=this.noise;for(e=0,r=n.length;r>e;e+=4)i=(.5-Math.random())*s,n[e]+=i,n[e+1]+=i,n[e+2]+=i}},getUniformLocations:function(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}},sendUniformData:function(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(t){if(1!==this.blocksize){var e,i,n,r,s,a,o,c,h,l,u,f=t.imageData,d=f.data,g=f.height,p=f.width;for(i=0;g>i;i+=this.blocksize)for(n=0;p>n;n+=this.blocksize)for(e=4*i*p+4*n,r=d[e],s=d[e+1],a=d[e+2],o=d[e+3],l=Math.min(i+this.blocksize,g),u=Math.min(n+this.blocksize,p),c=i;l>c;c++)for(h=n;u>h;h++)e=4*c*p+4*h,d[e]=r,d[e+1]=s,d[e+2]=a,d[e+3]=o}},getUniformLocations:function(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}},sendUniformData:function(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.RemoveColor=r(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(t){var i,n,r,s,a=t.imageData.data,o=255*this.distance,c=new e.Color(this.color).getSource(),h=[c[0]-o,c[1]-o,c[2]-o],l=[c[0]+o,c[1]+o,c[2]+o];for(i=0;i<a.length;i+=4)n=a[i],r=a[i+1],s=a[i+2],n>h[0]&&r>h[1]&&s>h[2]&&n<l[0]&&r<l[1]&&s<l[2]&&(a[i+3]=0)},getUniformLocations:function(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource(),r=parseFloat(this.distance),s=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],a=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];t.uniform4fv(i.uLow,s),t.uniform4fv(i.uHigh,a)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in r)i[s]=n(i.ColorMatrix,{type:s,matrix:r[s],mainParameter:!1,colorsOnly:!0}),e.Image.filters[s].fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.BlendColor=n(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb *= uColor.rgb;\ngl_FragColor = color;\n}",screen:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb = 1.0 - (1.0 - color.rgb) * (1.0 - uColor.rgb);\ngl_FragColor = color;\n}",add:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb += uColor.rgb;\n}",diff:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n}",subtract:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb -= uColor.rgb;\n}",lighten:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n}",darken:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n}",exclusion:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n}",overlay:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n}",tint:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n}"},retrieveShader:function(t){var e=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(e)||(t.programCache[e]=this.createProgram(t.context,i)),t.programCache[e]},applyTo2d:function(t){var i,n,r,s,a,o,c,h=t.imageData.data,l=h.length,u=1-this.alpha;i=(c=new e.Color(this.color).getSource())[0]*this.alpha,n=c[1]*this.alpha,r=c[2]*this.alpha;for(var f=0;l>f;f+=4)switch(s=h[f],a=h[f+1],o=h[f+2],this.mode){case"multiply":h[f]=s*i/255,h[f+1]=a*n/255,h[f+2]=o*r/255;break;case"screen":h[f]=255-(255-s)*(255-i)/255,h[f+1]=255-(255-a)*(255-n)/255,h[f+2]=255-(255-o)*(255-r)/255;break;case"add":h[f]=s+i,h[f+1]=a+n,h[f+2]=o+r;break;case"diff":case"difference":h[f]=Math.abs(s-i),h[f+1]=Math.abs(a-n),h[f+2]=Math.abs(o-r);break;case"subtract":h[f]=s-i,h[f+1]=a-n,h[f+2]=o-r;break;case"darken":h[f]=Math.min(s,i),h[f+1]=Math.min(a,n),h[f+2]=Math.min(o,r);break;case"lighten":h[f]=Math.max(s,i),h[f+1]=Math.max(a,n),h[f+2]=Math.max(o,r);break;case"overlay":h[f]=128>i?2*s*i/255:255-2*(255-s)*(255-i)/255,h[f+1]=128>n?2*a*n/255:255-2*(255-a)*(255-n)/255,h[f+2]=128>r?2*o*r/255:255-2*(255-o)*(255-r)/255;break;case"exclusion":h[f]=i+s-2*i*s/255,h[f+1]=n+a-2*n*a/255,h[f+2]=r+o-2*r*o/255;break;case"tint":h[f]=i+s*u,h[f+1]=n+a*u,h[f+2]=r+o*u}},getUniformLocations:function(t,e){return{uColor:t.getUniformLocation(e,"uColor")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(i.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,s=Math.abs,a=Math.round,o=Math.sin,c=Math.ceil,h=e.Image.filters,l=e.util.createClass;h.Resize=l(h.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo2d:function(t){var e=t.imageData,i=t.scaleX||this.scaleX,n=t.scaleY||this.scaleY;if(1!==i||1!==n){this.rcpScaleX=1/i,this.rcpScaleY=1/n;var r,s=e.width,o=e.height,c=a(s*i),h=a(o*n);"sliceHack"===this.resizeType?r=this.sliceByTwo(t,s,o,c,h):"hermite"===this.resizeType?r=this.hermiteFastResize(t,s,o,c,h):"bilinear"===this.resizeType?r=this.bilinearFiltering(t,s,o,c,h):"lanczos"===this.resizeType&&(r=this.lanczosResize(t,s,o,c,h)),t.imageData=r}},sliceByTwo:function(t,i,r,s,a){var o,c,h=t.imageData,l=.5,u=!1,f=!1,d=i*l,g=r*l,p=e.filterBackend.resources,v=0,m=0,_=i,b=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),((o=p.sliceByTwo).width<1.5*i||o.height<r)&&(o.width=1.5*i,o.height=r),(c=o.getContext("2d")).clearRect(0,0,1.5*i,r),c.putImageData(h,0,0),s=n(s),a=n(a);!u||!f;)i=d,r=g,s<n(d*l)?d=n(d*l):(d=s,u=!0),a<n(g*l)?g=n(g*l):(g=a,f=!0),c.drawImage(o,v,m,i,r,_,b,d,g),v=_,m=b,b+=g;return c.getImageData(v,m,s,a)},lanczosResize:function(t,e,a,h,l){function u(t){var o,c,S,T,k,O,P,E,L,I,M;for(C.x=(t+.5)*v,A.x=n(C.x),o=0;l>o;o++){for(C.y=(o+.5)*m,A.y=n(C.y),k=0,O=0,P=0,E=0,L=0,c=A.x-y;c<=A.x+y;c++)if(!(0>c||c>=e)){I=n(1e3*s(c-C.x)),w[I]||(w[I]={});for(var D=A.y-x;D<=A.y+x;D++)0>D||D>=a||(M=n(1e3*s(D-C.y)),w[I][M]||(w[I][M]=p(r(i(I*_,2)+i(M*b,2))/1e3)),(S=w[I][M])>0&&(T=4*(D*e+c),k+=S,O+=S*f[T],P+=S*f[T+1],E+=S*f[T+2],L+=S*f[T+3]))}g[T=4*(o*h+t)]=O/k,g[T+1]=P/k,g[T+2]=E/k,g[T+3]=L/k}return++t<h?u(t):d}var f=t.imageData.data,d=t.ctx.creteImageData(h,l),g=d.data,p=function(t){return function(e){if(e>t)return 0;if(e*=Math.PI,s(e)<1e-16)return 1;var i=e/t;return o(e)*o(i)/e/i}}(this.lanczosLobes),v=this.rcpScaleX,m=this.rcpScaleY,_=2/this.rcpScaleX,b=2/this.rcpScaleY,y=c(v*this.lanczosLobes/2),x=c(m*this.lanczosLobes/2),w={},C={},A={};return u(0)},bilinearFiltering:function(t,e,i,r,s){var a,o,c,h,l,u,f,d,g,p,v,m,_,b=0,y=this.rcpScaleX,x=this.rcpScaleY,w=4*(e-1),C=t.imageData.data,A=t.ctx.createImageData(r,s),S=A.data;for(f=0;s>f;f++)for(d=0;r>d;d++)for(l=n(y*d),u=n(x*f),g=y*d-l,p=x*f-u,_=4*(u*e+l),v=0;4>v;v++)a=C[_+v],o=C[_+4+v],c=C[_+w+v],h=C[_+w+4+v],m=a*(1-g)*(1-p)+o*g*(1-p)+c*p*(1-g)+h*g*p,S[b++]=m;return A},hermiteFastResize:function(t,e,i,a,o){for(var h=this.rcpScaleX,l=this.rcpScaleY,u=c(h/2),f=c(l/2),d=t.imageData.data,g=t.ctx.createImageData(a,o),p=g.data,v=0;o>v;v++)for(var m=0;a>m;m++){for(var _=4*(m+v*a),b=0,y=0,x=0,w=0,C=0,A=0,S=0,T=(v+.5)*l,k=n(v*l);(v+1)*l>k;k++)for(var O=s(T-(k+.5))/f,P=(m+.5)*h,E=O*O,L=n(m*h);(m+1)*h>L;L++){var I=s(P-(L+.5))/u,M=r(E+I*I);M>1&&-1>M||(b=2*M*M*M-3*M*M+1)>0&&(I=4*(L+k*e),S+=b*d[I+3],x+=b,d[I+3]<255&&(b=b*d[I+3]/250),w+=b*d[I],C+=b*d[I+1],A+=b*d[I+2],y+=b)}p[_]=w/y,p[_+1]=C/y,p[_+2]=A/y,p[_+3]=S/x}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(0!==this.contrast){var e,i=t.imageData.data,n=i.length,r=Math.floor(255*this.contrast),s=259*(r+255)/(255*(259-r));for(e=0;n>e;e+=4)i[e]=s*(i[e]-128)+128,i[e+1]=s*(i[e+1]-128)+128,i[e+2]=s*(i[e+2]-128)+128}},getUniformLocations:function(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}},sendUniformData:function(t,e){t.uniform1f(e.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(0!==this.saturation){var e,i,n=t.imageData.data,r=n.length,s=-this.saturation;for(e=0;r>e;e+=4)i=Math.max(n[e],n[e+1],n[e+2]),n[e]+=i!==n[e]?(i-n[e])*s:0,n[e+1]+=i!==n[e+1]?(i-n[e+1])*s:0,n[e+2]+=i!==n[e+2]?(i-n[e+2])*s:0}},getUniformLocations:function(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}},sendUniformData:function(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var e,i,n=t.filterBackend.resources,r=t.imageData.width,s=t.imageData.height;n.blurLayer1||(n.blurLayer1=document.createElement("canvas"),n.blurLayer2=document.createElement("canvas")),e=n.blurLayer1,i=n.blurLayer2,(e.width!==r||e.height!==s)&&(i.width=e.width=r,i.height=e.height=s);var a,o,c,h,l=e.getContext("2d"),u=i.getContext("2d"),f=15,d=.06*this.blur*.5;for(l.putImageData(t.imageData,0,0),u.clearRect(0,0,r,s),h=-f;f>=h;h++)a=(Math.random()-.5)/4,o=h/f,c=d*o*r+a,u.globalAlpha=1-Math.abs(o),u.drawImage(e,c,a),l.drawImage(i,0,0),u.globalAlpha=1,u.clearRect(0,0,i.width,i.height);for(h=-f;f>=h;h++)a=(Math.random()-.5)/4,o=h/f,c=d*o*s+a,u.globalAlpha=1-Math.abs(o),u.drawImage(e,a,c),l.drawImage(i,0,0),u.globalAlpha=1,u.clearRect(0,0,i.width,i.height);t.ctx.drawImage(e,0,0);var g=t.ctx.getImageData(0,0,e.width,e.height);return l.globalAlpha=1,l.clearRect(0,0,e.width,e.height),g},getUniformLocations:function(t,e){return{delta:t.getUniformLocation(e,"uDelta")}},sendUniformData:function(t,e){var i=this.chooseRightDelta();t.uniform2fv(e.delta,i)},chooseRightDelta:function(){var t,e=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(e=1/this.aspectRatio):this.aspectRatio<1&&(e=this.aspectRatio),t=e*this.blur*.12,this.horizontal?i[0]=t:i[1]=t,i}}),i.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",applyTo2d:function(t){var e,i=t.imageData.data,n=this.gamma,r=i.length,s=1/n[0],a=1/n[1],o=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),e=0,r=256;r>e;e++)this.rVals[e]=255*Math.pow(e/255,s),this.gVals[e]=255*Math.pow(e/255,a),this.bVals[e]=255*Math.pow(e/255,o);for(e=0,r=i.length;r>e;e+=4)i[e]=this.rVals[i[e]],i[e+1]=this.gVals[i[e+1]],i[e+2]=this.bVals[i[e+2]]},getUniformLocations:function(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}},sendUniformData:function(t,e){t.uniform3fv(e.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(e){e.applyTo(t)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})}}),e.Image.filters.Composed.fromObject=function(t,i){var n=(t.subFilters||[]).map(function(t){return new e.Image.filters[t.type](t)}),r=new e.Image.filters.Composed({subFilters:n});return i&&i(r),r}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,e=Math.cos(t),i=Math.sin(t),n=1/3,r=Math.sqrt(n)*i,s=1-e;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=e+s/3,this.matrix[1]=n*s-r,this.matrix[2]=n*s+r,this.matrix[5]=n*s+r,this.matrix[6]=e+n*s,this.matrix[7]=n*s-r,this.matrix[10]=n*s-r,this.matrix[11]=n*s+r,this.matrix[12]=e+n*s},applyTo:function(t){this.calculateMatrix(),e.Image.filters.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;if(e.Text)e.warn("fabric.Text is already defined");else{var n=e.Object.prototype.stateProperties.concat();n.push("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles");var r=e.Object.prototype.cacheProperties.concat();r.push("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stateProperties:n,cacheProperties:r,stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","textBackgroundColor"],__charBounds:[],initialize:function(t,e){this.styles=e?e.styles||{}:{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||2,"justify"===this.textAlign&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var t,e,i,n,r,s,a,o=0,c=this._textLines.length;c>o;o++)if(n=0,r=this._textLines[o],(e=this.getLineWidth(o))<this.width&&(a=this.textLines[o].match(this._reSpacesAndTabs))){i=a.length,t=(this.width-e)/i;for(var h=0,l=r.length;l>=h;h++)s=this.__charBounds[o][h],this._reSpaceAndTab.test(r[h])?(s.width+=t,s.kernedWidth+=t,s.left+=n,n+=t):s.left+=n}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions"),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t},_render:function(t){this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")},_renderText:function(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))},_setTextStyles:function(t,e,i){t.textBaseline="alphabetic",t.font=this._getFontDeclaration(e,i)},calcTextWidth:function(){for(var t=this.getLineWidth(0),e=1,i=this._textLines.length;i>e;e++){var n=this.getLineWidth(e);n>t&&(t=n)}return t},_renderTextLine:function(t,e,i,n,r,s){this._renderChars(t,e,i,n,r,s)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e,i,n,r,s,a,o=0,c=t.fillStyle,h=this._getLeftOffset(),l=this._getTopOffset(),u=0,f=0,d=0,g=this._textLines.length;g>d;d++)if(e=this.getHeightOfLine(d),this.textBackgroundColor||this.styleHas("textBackgroundColor",d)){n=this._textLines[d],i=this._getLineLeftOffset(d),f=0,u=0,r=this.getValueOfPropertyAt(d,0,"textBackgroundColor");for(var p=0,v=n.length;v>p;p++)s=this.__charBounds[d][p],(a=this.getValueOfPropertyAt(d,p,"textBackgroundColor"))!==r?(t.fillStyle=r,r&&t.fillRect(h+i+u,l+o,f,e/this.lineHeight),u=s.left,f=s.width,r=a):f+=s.kernedWidth;a&&(t.fillStyle=a,t.fillRect(h+i+u,l+o,f,e/this.lineHeight)),o+=e}else o+=e;t.fillStyle=c,this._removeShadow(t)}},getFontCache:function(t){var i=t.fontFamily.toLowerCase();e.charWidthsCache[i]||(e.charWidthsCache[i]={});var n=e.charWidthsCache[i],r=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return n[r]||(n[r]={}),n[r]},_applyCharStyles:function(t,e,i,n,r){this._setFillStyles(e,r),this._setStrokeStyles(e,r),e.font=this._getFontDeclaration(r)},_measureChar:function(t,e,i,n){var r,s,a,o,c=this.getFontCache(e),h=i+t,l=this._getFontDeclaration(e)===this._getFontDeclaration(n),u=e.fontSize/200;if(i&&c[i]&&(a=c[i]),c[t]&&(o=r=c[t]),l&&c[h]&&(s=c[h],o=s-a),!r||!a||!s){var f=this.getMeasuringContext();this._setTextStyles(f,e,!0)}if(r||(o=r=f.measureText(t).width,c[t]=r),!a&&l&&i&&(a=f.measureText(i).width,c[i]=a),l&&!s&&(s=f.measureText(h).width,c[h]=s,(o=s-a)>r)){var d=o-r;c[t]=o,c[h]+=d,r=o}return{width:r*u,kernedWidth:o*u}},getHeightOfChar:function(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")},measureLine:function(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e},_measureLine:function(t){var e,i,n,r,s=0,a=this._textLines[t],o=new Array(a.length);for(this.__charBounds[t]=o,e=0;e<a.length;e++)i=a[e],r=this._getGraphemeBox(i,t,e,n),o[e]=r,s+=r.kernedWidth,n=i;return o[e]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:s,numOfSpaces:0}},_getGraphemeBox:function(t,e,i,n,r){var s=this.getCompleteStyleDeclaration(e,i),a=n?this.getCompleteStyleDeclaration(e,i-1):{},o=this._measureChar(t,s,n,a),c=o.kernedWidth,h=o.width;0!==this.charSpacing&&(h+=this._getWidthOfCharSpacing(),c+=this._getWidthOfCharSpacing());var l={width:h,left:0,height:s.fontSize,kernedWidth:c};if(i>0&&!r){var u=this.__charBounds[e][i-1];l.left=u.left+u.width+o.kernedWidth-o.width}return l},getHeightOfLine:function(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var e=this._textLines[t],i=this.getHeightOfChar(t,0),n=1,r=e.length;r>n;n++){var s=this.getHeightOfChar(t,n);s>i&&(i=s)}return this.__lineHeights[t]=i*this.lineHeight*this._fontSizeMult,this.__lineHeights[t]},calcTextHeight:function(){for(var t,e=0,i=0,n=this._textLines.length;n>i;i++)t=this.getHeightOfLine(i),e+=i===n-1?t/this.lineHeight:t;return e},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(t,e){t.save();for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),s=this._applyPatternGradientTransform(t,"fillText"===e?this.fill:this.stroke),a=0,o=this._textLines.length;o>a;a++){var c=this.getHeightOfLine(a),h=c/this.lineHeight,l=this._getLineLeftOffset(a);this._renderTextLine(e,t,this._textLines[a],n+l-s.offsetX,r+i+h-s.offsetY,a),i+=c}t.restore()},_renderTextFill:function(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_renderChars:function(t,e,i,n,r,s){var a,o,c,h,l=this.getHeightOfLine(s),u="",f=0;e.save(),r-=l*this._fontSizeFraction/this.lineHeight;for(var d=0,g=i.length-1;g>=d;d++)h=d===g||this.charSpacing,u+=i[d],c=this.__charBounds[s][d],0===f&&(n+=c.kernedWidth-c.width),f+=c.kernedWidth,"justify"!==this.textAlign||h||this._reSpaceAndTab.test(i[d])&&(h=!0),h||(a=a||this.getCompleteStyleDeclaration(s,d),o=this.getCompleteStyleDeclaration(s,d+1),h=this._hasStyleChanged(a,o)),h&&(this._renderChar(t,e,s,d,u,n,r,l),u="",a=o,n+=f,f=0);e.restore()},_renderChar:function(t,e,i,n,r,s,a){var o=this._getStyleDeclaration(i,n),c=this.getCompleteStyleDeclaration(i,n),h="fillText"===t&&c.fill,l="strokeText"===t&&c.stroke&&c.strokeWidth;(l||h)&&(o&&e.save(),this._applyCharStyles(t,e,i,n,c),o&&o.textBackgroundColor&&this._removeShadow(e),h&&e.fillText(r,s,a),l&&e.strokeText(r,s,a),o&&e.restore())},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle},_getLineLeftOffset:function(t){var e=this.getLineWidth(t);return"center"===this.textAlign?(this.width-e)/2:"right"===this.textAlign?this.width-e:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t},getLineWidth:function(t){if(this.__lineWidths[t])return this.__lineWidths[t];var e,i;return""===this._textLines[t]?e=0:(i=this.measureLine(t),e=i.width),this.__lineWidths[t]=e,e},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(t,e,i){var n=this._getStyleDeclaration(t,e);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(t,e){if(this[e]||this.styleHas(e)){for(var i,n,r,s,a,o,c,h,l,u,f,d=this._getLeftOffset(),g=this._getTopOffset(),p=0,v=this._textLines.length;v>p;p++)if(i=this.getHeightOfLine(p),this[e]||this.styleHas(e,p)){r=this._textLines[p],l=i/this.lineHeight,n=this._getLineLeftOffset(p),a=0,o=0,s=this.getValueOfPropertyAt(p,0,e),f=this.getValueOfPropertyAt(p,0,"fill");for(var m=0,_=r.length;_>m;m++)c=this.__charBounds[p][m],h=this.getValueOfPropertyAt(p,m,e),u=this.getValueOfPropertyAt(p,m,"fill"),(h!==s||u!==f)&&o>0?(t.fillStyle=f,s&&f&&t.fillRect(d+n+a,g+l*(1-this._fontSizeFraction)+this.offsets[e]*this.fontSize,o,this.fontSize/15),a=c.left,o=c.width,s=h,f=u):o+=c.kernedWidth;t.fillStyle=u,h&&u&&t.fillRect(d+n+a,g+l*(1-this._fontSizeFraction)+this.offsets[e]*this.fontSize,o,this.fontSize/15),g+=i}else g+=i;this._removeShadow(t)}},_getFontDeclaration:function(t,i){var n=t||this;return[e.isLikelyNode?n.fontWeight:n.fontStyle,e.isLikelyNode?n.fontStyle:n.fontWeight,i?"200px":n.fontSize+"px",e.isLikelyNode?'"'+n.fontFamily+'"':n.fontFamily].join(" ")},render:function(t){this.visible&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",t))},_splitTextIntoLines:function(t){for(var i=t.split(this._reNewline),n=new Array(i.length),r=["\n"],s=[],a=0;a<i.length;a++)n[a]=e.util.string.graphemeSplit(i[a]),s=s.concat(n[a],r);return s.pop(),{_unwrappedLines:n,lines:i,graphemeText:s,graphemeLines:n}},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(t),n=this.callSuper("toObject",e);return n.styles=i(this.styles,!0),n},set:function(t,e){this.callSuper("set",t,e);var i=!1;if("object"==typeof t)for(var n in t)i=i||-1!==this._dimensionAffectingProps.indexOf(n);else i=-1!==this._dimensionAffectingProps.indexOf(t);return i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.fromObject=function(t,i){return e.Object._fromObject("Text",t,i,"text")},e.util.createAccessors&&e.util.createAccessors(e.Text)}}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;var e=void 0===t?this.styles:{line:this.styles[t]};for(var i in e)for(var n in e[i])for(var r in e[i][n])return!1;return!0},styleHas:function(t,e){if(!this.styles||!t||""===t)return!1;if(void 0!==e&&!this.styles[e])return!1;var i=void 0===e?this.styles:{line:this.styles[e]};for(var n in i)for(var r in i[n])if(void 0!==i[n][r][t])return!0;return!1},cleanStyle:function(t){if(!this.styles||!t||""===t)return!1;var e,i,n=this.styles,r=0,s=!1,a=!0,o=0;for(var c in n){e=0;for(var h in n[c])r++,s?n[c][h][t]!==i&&(a=!1):(i=n[c][h][t],s=!0),n[c][h][t]===this[t]&&delete n[c][h][t],0!==Object.keys(n[c][h]).length?e++:delete n[c][h];0===e&&delete n[c]}for(var l=0;l<this._textLines.length;l++)o+=this._textLines[l].length;a&&r===o&&(this[t]=i,this.removeStyle(t))},removeStyle:function(t){if(this.styles&&t&&""!==t){var e,i,n,r=this.styles;for(i in r){e=r[i];for(n in e)delete e[n][t],0===Object.keys(e[n]).length&&delete e[n];0===Object.keys(e).length&&delete r[i]}}},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},get2DCursorLocation:function(t,e){void 0===t&&(t=this.selectionStart);for(var i=e?this._unwrappedTextLines:this._textLines,n=i.length,r=0;n>r;r++){if(t<=i[r].length)return{lineIndex:r,charIndex:t};t-=i[r].length+1}return{lineIndex:r-1,charIndex:i[r-1].length<t?i[r-1].length:t}},getSelectionStyles:function(t,e,i){void 0===t&&(t=this.selectionStart||0),void 0===e&&(e=this.selectionEnd||t);for(var n=[],r=t;e>r;r++)n.push(this.getStyleAtPosition(r,i));return n},getStyleAtPosition:function(t,e){var i=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(t,e,i){void 0===e&&(e=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||e);for(var n=e;i>n;n++)this._extendStyles(n,t);return this._forceClearCache=!0,this},_getStyleDeclaration:function(t,e){var i=this.styles&&this.styles[t];return i?i[e]:null},getCompleteStyleDeclaration:function(t,e){for(var i,n=this._getStyleDeclaration(t,e)||{},r={},s=0;s<this._styleProperties.length;s++)i=this._styleProperties[s],r[i]=void 0===n[i]?this[i]:n[i];return r},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]}}),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pdfjs-dist/build/pdf",[],e):"object"==typeof exports?exports["pdfjs-dist/build/pdf"]=e():t["pdfjs-dist/build/pdf"]=t.pdfjsDistBuildPdf=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=14)}([function(t,e,i){"use strict";(function(t){function n(t){T>=C.warnings&&console.log("Warning: "+t)}function r(t){throw T>=C.errors&&(console.log("Error: "+t),console.log(s())),new Error(t)}function s(){try{throw new Error}catch(t){return t.stack?t.stack.split("\n").slice(2).join("\n"):""}}function a(t,e){t||r(e)}function o(t){if(!t)return!1;switch(t.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function c(t){a("string"==typeof t,"Invalid argument for stringToBytes");for(var e=t.length,i=new Uint8Array(e),n=0;n<e;++n)i[n]=255&t.charCodeAt(n);return i}function h(t){return void 0!==t.length?t.length:(a(void 0!==t.byteLength),t.byteLength)}function l(t){return"number"==typeof t&&(0|t)===t}function u(){var t={};return t.promise=new Promise(function(e,i){t.resolve=e,t.reject=i}),t}function f(t,e,i){this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackIndex=1,this.postMessageTransfers=!0;var n=this.callbacksCapabilities=Object.create(null),s=this.actionHandler=Object.create(null);this._onComObjOnMessage=function(t){var e=t.data;if(e.targetName===this.sourceName)if(e.isReply){var a=e.callbackId;if(e.callbackId in n){var o=n[a];delete n[a],"error"in e?o.reject(e.error):o.resolve(e.data)}else r("Cannot resolve callback "+a)}else if(e.action in s){var c=s[e.action];if(e.callbackId){var h=this.sourceName,l=e.sourceName;Promise.resolve().then(function(){return c[0].call(c[1],e.data)}).then(function(t){i.postMessage({sourceName:h,targetName:l,isReply:!0,callbackId:e.callbackId,data:t})},function(t){t instanceof Error&&(t+=""),i.postMessage({sourceName:h,targetName:l,isReply:!0,callbackId:e.callbackId,error:t})})}else c[0].call(c[1],e.data)}else r("Unknown action from worker: "+e.action)}.bind(this),i.addEventListener("message",this._onComObjOnMessage)}i(13);var d="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:void 0,g=[.001,0,0,.001,0,0],p={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},v={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},m={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},_={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},b={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},y={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},x={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9},w={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10},C={errors:0,warnings:1,infos:5},A={NONE:0,BINARY:1,STREAM:2},S={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},T=C.warnings,k={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},O={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},P=function(){function t(t,e){this.name="PasswordException",this.message=t,this.code=e}return t.prototype=new Error,t.constructor=t,t}(),E=function(){function t(t,e){this.name="UnknownErrorException",this.message=t,this.details=e}return t.prototype=new Error,t.constructor=t,t}(),L=function(){function t(t){this.name="InvalidPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}(),I=function(){function t(t){this.name="MissingPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}(),M=function(){function t(t,e){this.name="UnexpectedResponseException",this.message=t,this.status=e}return t.prototype=new Error,t.constructor=t,t}(),D=function(){function t(t){this.message=t}return t.prototype=new Error,t.prototype.name="NotImplementedException",t.constructor=t,t}(),F=function(){function t(t,e){this.begin=t,this.end=e,this.message="Missing data ["+t+", "+e+")"}return t.prototype=new Error,t.prototype.name="MissingDataException",t.constructor=t,t}(),j=function(){function t(t){this.message=t}return t.prototype=new Error,t.prototype.name="XRefParseException",t.constructor=t,t}(),R=/\x00/g,N=function(){function t(t,e){this.buffer=t,this.byteLength=t.length,this.length=void 0===e?this.byteLength>>2:e,i(this.length)}function e(t){return{get:function(){var e=this.buffer,i=t<<2;return(e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24)>>>0},set:function(e){var i=this.buffer,n=t<<2;i[n]=255&e,i[n+1]=e>>8&255,i[n+2]=e>>16&255,i[n+3]=e>>>24&255}}}function i(i){for(;n<i;)Object.defineProperty(t.prototype,n,e(n)),n++}t.prototype=Object.create(null);var n=0;return t}();e.Uint32ArrayView=N;var B=[1,0,0,1,0,0],z=function(){function t(){}var e=["rgb(",0,",",0,",",0,")"];t.makeCssRgb=function(t,i,n){return e[1]=t,e[3]=i,e[5]=n,e.join("")},t.transform=function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]},t.applyTransform=function(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]},t.applyInverseTransform=function(t,e){var i=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i]},t.getAxialAlignedBoundingBox=function(e,i){var n=t.applyTransform(e,i),r=t.applyTransform(e.slice(2,4),i),s=t.applyTransform([e[0],e[3]],i),a=t.applyTransform([e[2],e[1]],i);return[Math.min(n[0],r[0],s[0],a[0]),Math.min(n[1],r[1],s[1],a[1]),Math.max(n[0],r[0],s[0],a[0]),Math.max(n[1],r[1],s[1],a[1])]},t.inverseTransform=function(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]},t.apply3dTransform=function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]},t.singularValueDecompose2dScale=function(t){var e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],r=t[2]*e[0]+t[3]*e[2],s=t[2]*e[1]+t[3]*e[3],a=(i+s)/2,o=Math.sqrt((i+s)*(i+s)-4*(i*s-r*n))/2,c=a+o||1,h=a-o||1;return[Math.sqrt(c),Math.sqrt(h)]},t.normalizeRect=function(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e},t.intersect=function(e,i){function n(t,e){return t-e}var r=[e[0],e[2],i[0],i[2]].sort(n),s=[e[1],e[3],i[1],i[3]].sort(n),a=[];return e=t.normalizeRect(e),i=t.normalizeRect(i),(r[0]===e[0]&&r[1]===i[0]||r[0]===i[0]&&r[1]===e[0])&&(a[0]=r[1],a[2]=r[2],(s[0]===e[1]&&s[1]===i[1]||s[0]===i[1]&&s[1]===e[1])&&(a[1]=s[1],a[3]=s[2],a))},t.sign=function(t){return t<0?-1:1};var i=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"];return t.toRoman=function(t,e){a(l(t)&&t>0,"The number should be a positive integer.");for(var n,r=[];t>=1e3;)t-=1e3,r.push("M");n=t/100|0,t%=100,r.push(i[n]),n=t/10|0,t%=10,r.push(i[10+n]),r.push(i[20+t]);var s=r.join("");return e?s.toLowerCase():s},t.appendToArray=function(t,e){Array.prototype.push.apply(t,e)},t.prependToArray=function(t,e){Array.prototype.unshift.apply(t,e)},t.extendObj=function(t,e){for(var i in e)t[i]=e[i]},t.getInheritableProperty=function(t,e,i){for(;t&&!t.has(e);)t=t.get("Parent");return t?i?t.getArray(e):t.get(e):null},t.inherit=function(t,e,i){t.prototype=Object.create(e.prototype),t.prototype.constructor=t;for(var n in i)t.prototype[n]=i[n]},t.loadScript=function(t,e){var i=document.createElement("script"),n=!1;i.setAttribute("src",t),e&&(i.onload=function(){n||e(),n=!0}),document.getElementsByTagName("head")[0].appendChild(i)},t}(),U=function(){function t(t,e,i,n,r,s){this.viewBox=t,this.scale=e,this.rotation=i,this.offsetX=n,this.offsetY=r;var a,o,c,h,l=(t[2]+t[0])/2,u=(t[3]+t[1])/2;switch(i%=360,i=i<0?i+360:i){case 180:a=-1,o=0,c=0,h=1;break;case 90:a=0,o=1,c=1,h=0;break;case 270:a=0,o=-1,c=-1,h=0;break;default:a=1,o=0,c=0,h=-1}s&&(c=-c,h=-h);var f,d,g,p;0===a?(f=Math.abs(u-t[1])*e+n,d=Math.abs(l-t[0])*e+r,g=Math.abs(t[3]-t[1])*e,p=Math.abs(t[2]-t[0])*e):(f=Math.abs(l-t[0])*e+n,d=Math.abs(u-t[1])*e+r,g=Math.abs(t[2]-t[0])*e,p=Math.abs(t[3]-t[1])*e),this.transform=[a*e,o*e,c*e,h*e,f-a*e*l-c*e*u,d-o*e*l-h*e*u],this.width=g,this.height=p,this.fontScale=e}return t.prototype={clone:function(e){var i="scale"in(e=e||{})?e.scale:this.scale,n="rotation"in e?e.rotation:this.rotation;return new t(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,e.dontFlip)},convertToViewportPoint:function(t,e){return z.applyTransform([t,e],this.transform)},convertToViewportRectangle:function(t){var e=z.applyTransform([t[0],t[1]],this.transform),i=z.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]},convertToPdfPoint:function(t,e){return z.applyInverseTransform([t,e],this.transform)}},t}(),X=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],W=function(){function t(t,e,i){for(;t.length<i;)t+=e;return t}function e(){this.started=Object.create(null),this.times=[],this.enabled=!0}return e.prototype={time:function(t){this.enabled&&(t in this.started&&n("Timer is already running for "+t),this.started[t]=Date.now())},timeEnd:function(t){this.enabled&&(t in this.started||n("Timer has not been started for "+t),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t])},toString:function(){var e,i,n=this.times,r="",s=0;for(e=0,i=n.length;e<i;++e){var a=n[e].name;a.length>s&&(s=a.length)}for(e=0,i=n.length;e<i;++e){var o=n[e],c=o.end-o.start;r+=t(o.name," ",s)+" "+c+"ms\n"}return r}},e}(),Y=function(t,e){if("undefined"!=typeof Blob)return new Blob([t],{type:e});n('The "Blob" constructor is not supported.')},V=function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(e,i,n){if(!n&&"undefined"!=typeof URL&&URL.createObjectURL){var r=Y(e,i);return URL.createObjectURL(r)}for(var s="data:"+i+";base64,",a=0,o=e.length;a<o;a+=3){var c=255&e[a],h=255&e[a+1],l=255&e[a+2],u=c>>2,f=(3&c)<<4|h>>4,d=a+1<o?(15&h)<<2|l>>6:64,g=a+2<o?63&l:64;s+=t[u]+t[f]+t[d]+t[g]}return s}}();f.prototype={on:function(t,e,i){var n=this.actionHandler;n[t]&&r('There is already an actionName called "'+t+'"'),n[t]=[e,i]},send:function(t,e,i){var n={sourceName:this.sourceName,targetName:this.targetName,action:t,data:e};this.postMessage(n,i)},sendWithPromise:function(t,e,i){var n=this.callbackIndex++,r={sourceName:this.sourceName,targetName:this.targetName,action:t,data:e,callbackId:n},s=u();this.callbacksCapabilities[n]=s;try{this.postMessage(r,i)}catch(t){s.reject(t)}return s.promise},postMessage:function(t,e){e&&this.postMessageTransfers?this.comObj.postMessage(t,e):this.comObj.postMessage(t)},destroy:function(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}},e.FONT_IDENTITY_MATRIX=g,e.IDENTITY_MATRIX=B,e.OPS=S,e.VERBOSITY_LEVELS=C,e.UNSUPPORTED_FEATURES=k,e.AnnotationBorderStyleType=y,e.AnnotationFieldFlag=b,e.AnnotationFlag=_,e.AnnotationType=m,e.FontType=w,e.ImageKind=v,e.CMapCompressionType=A,e.InvalidPDFException=L,e.MessageHandler=f,e.MissingDataException=F,e.MissingPDFException=I,e.NotImplementedException=D,e.PageViewport=U,e.PasswordException=P,e.PasswordResponses=O,e.StatTimer=W,e.StreamType=x,e.TextRenderingMode=p,e.UnexpectedResponseException=M,e.UnknownErrorException=E,e.Util=z,e.XRefParseException=j,e.arrayByteLength=h,e.arraysToBytes=function(t){if(1===t.length&&t[0]instanceof Uint8Array)return t[0];var e,i,n,r=0,s=t.length;for(e=0;e<s;e++)r+=n=h(i=t[e]);var a=0,o=new Uint8Array(r);for(e=0;e<s;e++)(i=t[e])instanceof Uint8Array||(i="string"==typeof i?c(i):new Uint8Array(i)),n=i.byteLength,o.set(i,a),a+=n;return o},e.assert=a,e.bytesToString=function(t){a(null!==t&&"object"==typeof t&&void 0!==t.length,"Invalid argument for bytesToString");var e=t.length;if(e<8192)return String.fromCharCode.apply(null,t);for(var i=[],n=0;n<e;n+=8192){var r=Math.min(n+8192,e),s=t.subarray(n,r);i.push(String.fromCharCode.apply(null,s))}return i.join("")},e.createBlob=Y,e.createPromiseCapability=u,e.createObjectURL=V,e.deprecated=function(t){console.log("Deprecated API usage: "+t)},e.error=r,e.getLookupTableFactory=function(t){var e;return function(){return t&&(e=Object.create(null),t(e),t=null),e}},e.getVerbosityLevel=function(){return T},e.globalScope=d,e.info=function(t){T>=C.infos&&console.log("Info: "+t)},e.isArray=function(t){return t instanceof Array},e.isArrayBuffer=function(t){return"object"==typeof t&&null!==t&&void 0!==t.byteLength},e.isBool=function(t){return"boolean"==typeof t},e.isEmptyObj=function(t){for(var e in t)return!1;return!0},e.isInt=l,e.isNum=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSpace=function(t){return 32===t||9===t||13===t||10===t},e.isNodeJS=function(){return"undefined"==typeof __pdfjsdev_webpack__&&"object"==typeof process&&process+""=="[object process]"},e.isSameOrigin=function(t,e){try{var i=new URL(t);if(!i.origin||"null"===i.origin)return!1}catch(t){return!1}var n=new URL(e,i);return i.origin===n.origin},e.createValidAbsoluteUrl=function(t,e){if(!t)return null;try{var i=e?new URL(t,e):new URL(t);if(o(i))return i}catch(t){}return null},e.isLittleEndian=function(){var t=new Uint8Array(2);return t[0]=1,1===new Uint16Array(t.buffer)[0]},e.isEvalSupported=function(){try{return new Function(""),!0}catch(t){return!1}},e.loadJpegStream=function(t,e,i){var r=new Image;r.onload=function(){i.resolve(t,r)},r.onerror=function(){i.resolve(t,null),n("Error during JPEG image loading")},r.src=e},e.log2=function(t){for(var e=1,i=0;t>e;)e<<=1,i++;return i},e.readInt8=function(t,e){return t[e]<<24>>24},e.readUint16=function(t,e){return t[e]<<8|t[e+1]},e.readUint32=function(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0},e.removeNullCharacters=function(t){return"string"!=typeof t?(n("The argument for removeNullCharacters must be a string."),t):t.replace(R,"")},e.setVerbosityLevel=function(t){T=t},e.shadow=function(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!1}),i},e.string32=function(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)},e.stringToBytes=c,e.stringToPDFString=function(t){var e,i=t.length,n=[];if("þ"===t[0]&&"ÿ"===t[1])for(e=2;e<i;e+=2)n.push(String.fromCharCode(t.charCodeAt(e)<<8|t.charCodeAt(e+1)));else for(e=0;e<i;++e){var r=X[t.charCodeAt(e)];n.push(r?String.fromCharCode(r):t.charAt(e))}return n.join("")},e.stringToUTF8String=function(t){return decodeURIComponent(escape(t))},e.utf8StringToString=function(t){return unescape(encodeURIComponent(t))},e.warn=n}).call(e,i(6))},function(t,e,i){"use strict";function n(){}function r(t){var e=s.globalScope.PDFJS;switch(t){case"pdfBug":return!!e&&e.pdfBug;case"disableAutoFetch":return!!e&&e.disableAutoFetch;case"disableStream":return!!e&&e.disableStream;case"disableRange":return!!e&&e.disableRange;case"disableFontFace":return!!e&&e.disableFontFace;case"disableCreateObjectURL":return!!e&&e.disableCreateObjectURL;case"disableWebGL":return!e||e.disableWebGL;case"cMapUrl":return e?e.cMapUrl:null;case"cMapPacked":return!!e&&e.cMapPacked;case"postMessageTransfers":return!e||e.postMessageTransfers;case"workerPort":return e?e.workerPort:null;case"workerSrc":return e?e.workerSrc:null;case"disableWorker":return!!e&&e.disableWorker;case"maxImageSize":return e?e.maxImageSize:-1;case"imageResourcesPath":return e?e.imageResourcesPath:"";case"isEvalSupported":return!e||e.isEvalSupported;case"externalLinkTarget":if(!e)return _.NONE;switch(e.externalLinkTarget){case _.NONE:case _.SELF:case _.BLANK:case _.PARENT:case _.TOP:return e.externalLinkTarget}return c("PDFJS.externalLinkTarget is invalid: "+e.externalLinkTarget),e.externalLinkTarget=_.NONE,_.NONE;case"externalLinkRel":return e?e.externalLinkRel:d;case"enableStats":return!(!e||!e.enableStats);case"pdfjsNext":return!(!e||!e.pdfjsNext);default:throw new Error("Unknown default setting: "+t)}}var s=i(0),a=s.assert,o=s.removeNullCharacters,c=s.warn,h=s.deprecated,l=s.createValidAbsoluteUrl,u=s.stringToBytes,f=s.CMapCompressionType,d="noopener noreferrer nofollow";n.prototype={create:function(t,e){a(t>0&&e>0,"invalid canvas size");var i=document.createElement("canvas"),n=i.getContext("2d");return i.width=t,i.height=e,{canvas:i,context:n}},reset:function(t,e,i){a(t.canvas,"canvas is not specified"),a(e>0&&i>0,"invalid canvas size"),t.canvas.width=e,t.canvas.height=i},destroy:function(t){a(t.canvas,"canvas is not specified"),t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}};var g,p=function(){function t(t){this.baseUrl=t.baseUrl||null,this.isCompressed=t.isCompressed||!1}return t.prototype={fetch:function(t){var e=t.name;return e?new Promise(function(t,i){var n=this.baseUrl+e+(this.isCompressed?".bcmap":""),r=new XMLHttpRequest;r.open("GET",n,!0),this.isCompressed&&(r.responseType="arraybuffer"),r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){if(200===r.status||0===r.status){var e;if(this.isCompressed&&r.response?e=new Uint8Array(r.response):!this.isCompressed&&r.responseText&&(e=u(r.responseText)),e)return void t({cMapData:e,compressionType:this.isCompressed?f.BINARY:f.NONE})}i(new Error("Unable to load "+(this.isCompressed?"binary ":"")+"CMap at: "+n))}}.bind(this),r.send(null)}.bind(this)):Promise.reject(new Error("CMap name must be specified."))}},t}(),v=function(){function t(){}var e=["ms","Moz","Webkit","O"],i=Object.create(null);return t.getProp=function(t,n){if(1===arguments.length&&"string"==typeof i[t])return i[t];var r,s,a=(n=n||document.documentElement).style;if("string"==typeof a[t])return i[t]=t;s=t.charAt(0).toUpperCase()+t.slice(1);for(var o=0,c=e.length;o<c;o++)if(r=e[o]+s,"string"==typeof a[r])return i[t]=r;return i[t]="undefined"},t.setProp=function(t,e,i){var n=this.getProp(t);"undefined"!==n&&(e.style[n]=i)},t}(),m=function(){function t(t,e){this.message=t,this.type=e}return t.prototype=new Error,t.prototype.name="RenderingCancelledException",t.constructor=t,t}();g=function(){var t=document.createElement("canvas");return t.width=t.height=1,void 0!==t.getContext("2d").createImageData(1,1).data.buffer};var _={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4},b=["","_self","_blank","_parent","_top"];e.CustomStyle=v,e.addLinkAttributes=function(t,e){var i=e&&e.url;if(t.href=t.title=i?o(i):"",i){var n=e.target;void 0===n&&(n=r("externalLinkTarget")),t.target=b[n];var s=e.rel;void 0===s&&(s=r("externalLinkRel")),t.rel=s}},e.isExternalLinkTargetSet=function(){switch(r("externalLinkTarget")){case _.NONE:return!1;case _.SELF:case _.BLANK:case _.PARENT:case _.TOP:return!0}},e.isValidUrl=function(t,e){return h("isValidUrl(), please use createValidAbsoluteUrl() instead."),null!==l(t,e?"http://example.com":null)},e.getFilenameFromUrl=function(t){var e=t.indexOf("#"),i=t.indexOf("?"),n=Math.min(e>0?e:t.length,i>0?i:t.length);return t.substring(t.lastIndexOf("/",n)+1,n)},e.LinkTarget=_,e.RenderingCancelledException=m,e.hasCanvasTypedArrays=g,e.getDefaultSetting=r,e.DEFAULT_LINK_REL=d,e.DOMCanvasFactory=n,e.DOMCMapReaderFactory=p},function(t,e,i){"use strict";function n(){}var r=i(0),s=i(1),a=r.AnnotationBorderStyleType,o=r.AnnotationType,c=r.stringToPDFString,h=r.Util,l=s.addLinkAttributes,u=s.LinkTarget,f=s.getFilenameFromUrl,d=r.warn,g=s.CustomStyle,p=s.getDefaultSetting;n.prototype={create:function(t){switch(t.data.annotationType){case o.LINK:return new m(t);case o.TEXT:return new _(t);case o.WIDGET:switch(t.data.fieldType){case"Tx":return new y(t);case"Btn":if(t.data.radioButton)return new w(t);if(t.data.checkBox)return new x(t);d("Unimplemented button widget annotation: pushbutton");break;case"Ch":return new C(t)}return new b(t);case o.POPUP:return new A(t);case o.LINE:return new T(t);case o.HIGHLIGHT:return new k(t);case o.UNDERLINE:return new O(t);case o.SQUIGGLY:return new P(t);case o.STRIKEOUT:return new E(t);case o.FILEATTACHMENT:return new L(t);default:return new v(t)}}};var v=function(){function t(t,e,i){this.isRenderable=e||!1,this.data=t.data,this.layer=t.layer,this.page=t.page,this.viewport=t.viewport,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderInteractiveForms=t.renderInteractiveForms,e&&(this.container=this._createContainer(i))}return t.prototype={_createContainer:function(t){var e=this.data,i=this.page,n=this.viewport,r=document.createElement("section"),s=e.rect[2]-e.rect[0],o=e.rect[3]-e.rect[1];r.setAttribute("data-annotation-id",e.id);var c=h.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]);if(g.setProp("transform",r,"matrix("+n.transform.join(",")+")"),g.setProp("transformOrigin",r,-c[0]+"px "+-c[1]+"px"),!t&&e.borderStyle.width>0){r.style.borderWidth=e.borderStyle.width+"px",e.borderStyle.style!==a.UNDERLINE&&(s-=2*e.borderStyle.width,o-=2*e.borderStyle.width);var l=e.borderStyle.horizontalCornerRadius,u=e.borderStyle.verticalCornerRadius;if(l>0||u>0){var f=l+"px / "+u+"px";g.setProp("borderRadius",r,f)}switch(e.borderStyle.style){case a.SOLID:r.style.borderStyle="solid";break;case a.DASHED:r.style.borderStyle="dashed";break;case a.BEVELED:d("Unimplemented border style: beveled");break;case a.INSET:d("Unimplemented border style: inset");break;case a.UNDERLINE:r.style.borderBottomStyle="solid"}e.color?r.style.borderColor=h.makeCssRgb(0|e.color[0],0|e.color[1],0|e.color[2]):r.style.borderWidth=0}return r.style.left=c[0]+"px",r.style.top=c[1]+"px",r.style.width=s+"px",r.style.height=o+"px",r},_createPopup:function(t,e,i){e||((e=document.createElement("div")).style.height=t.style.height,e.style.width=t.style.width,t.appendChild(e));var n=new S({container:t,trigger:e,color:i.color,title:i.title,contents:i.contents,hideWrapper:!0}).render();n.style.left=t.style.width,t.appendChild(n)},render:function(){throw new Error("Abstract method AnnotationElement.render called")}},t}(),m=function(){function t(t){v.call(this,t,!0)}return h.inherit(t,v,{render:function(){this.container.className="linkAnnotation";var t=document.createElement("a");return l(t,{url:this.data.url,target:this.data.newWindow?u.BLANK:void 0}),this.data.url||(this.data.action?this._bindNamedAction(t,this.data.action):this._bindLink(t,this.data.dest)),this.container.appendChild(t),this.container},_bindLink:function(t,e){var i=this;t.href=this.linkService.getDestinationHash(e),t.onclick=function(){return e&&i.linkService.navigateTo(e),!1},e&&(t.className="internalLink")},_bindNamedAction:function(t,e){var i=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return i.linkService.executeNamedAction(e),!1},t.className="internalLink"}}),t}(),_=function(){function t(t){var e=!!(t.data.hasPopup||t.data.title||t.data.contents);v.call(this,t,e)}return h.inherit(t,v,{render:function(){this.container.className="textAnnotation";var t=document.createElement("img");return t.style.height=this.container.style.height,t.style.width=this.container.style.width,t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.alt="[{{type}} Annotation]",t.dataset.l10nId="text_annotation_type",t.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(this.container,t,this.data),this.container.appendChild(t),this.container}}),t}(),b=function(){function t(t,e){v.call(this,t,e)}return h.inherit(t,v,{render:function(){return this.container}}),t}(),y=function(){function t(t){var e=t.renderInteractiveForms||!t.data.hasAppearance&&!!t.data.fieldValue;b.call(this,t,e)}var e=["left","center","right"];return h.inherit(t,b,{render:function(){this.container.className="textWidgetAnnotation";var t=null;if(this.renderInteractiveForms){if(this.data.multiLine?(t=document.createElement("textarea")).textContent=this.data.fieldValue:((t=document.createElement("input")).type="text",t.setAttribute("value",this.data.fieldValue)),t.disabled=this.data.readOnly,null!==this.data.maxLen&&(t.maxLength=this.data.maxLen),this.data.comb){var i=(this.data.rect[2]-this.data.rect[0])/this.data.maxLen;t.classList.add("comb"),t.style.letterSpacing="calc("+i+"px - 1ch)"}}else{(t=document.createElement("div")).textContent=this.data.fieldValue,t.style.verticalAlign="middle",t.style.display="table-cell";var n=null;this.data.fontRefName&&(n=this.page.commonObjs.getData(this.data.fontRefName)),this._setTextStyle(t,n)}return null!==this.data.textAlignment&&(t.style.textAlign=e[this.data.textAlignment]),this.container.appendChild(t),this.container},_setTextStyle:function(t,e){var i=t.style;if(i.fontSize=this.data.fontSize+"px",i.direction=this.data.fontDirection<0?"rtl":"ltr",e){i.fontWeight=e.black?e.bold?"900":"bold":e.bold?"bold":"normal",i.fontStyle=e.italic?"italic":"normal";var n=e.loadedName?'"'+e.loadedName+'", ':"",r=e.fallbackName||"Helvetica, sans-serif";i.fontFamily=n+r}}}),t}(),x=function(){function t(t){b.call(this,t,t.renderInteractiveForms)}return h.inherit(t,b,{render:function(){this.container.className="buttonWidgetAnnotation checkBox";var t=document.createElement("input");return t.disabled=this.data.readOnly,t.type="checkbox",this.data.fieldValue&&"Off"!==this.data.fieldValue&&t.setAttribute("checked",!0),this.container.appendChild(t),this.container}}),t}(),w=function(){function t(t){b.call(this,t,t.renderInteractiveForms)}return h.inherit(t,b,{render:function(){this.container.className="buttonWidgetAnnotation radioButton";var t=document.createElement("input");return t.disabled=this.data.readOnly,t.type="radio",t.name=this.data.fieldName,this.data.fieldValue===this.data.buttonValue&&t.setAttribute("checked",!0),this.container.appendChild(t),this.container}}),t}(),C=function(){function t(t){b.call(this,t,t.renderInteractiveForms)}return h.inherit(t,b,{render:function(){this.container.className="choiceWidgetAnnotation";var t=document.createElement("select");t.disabled=this.data.readOnly,this.data.combo||(t.size=this.data.options.length,this.data.multiSelect&&(t.multiple=!0));for(var e=0,i=this.data.options.length;e<i;e++){var n=this.data.options[e],r=document.createElement("option");r.textContent=n.displayValue,r.value=n.exportValue,this.data.fieldValue.indexOf(n.displayValue)>=0&&r.setAttribute("selected",!0),t.appendChild(r)}return this.container.appendChild(t),this.container}}),t}(),A=function(){function t(t){var e=!(!t.data.title&&!t.data.contents);v.call(this,t,e)}var e=["Line"];return h.inherit(t,v,{render:function(){if(this.container.className="popupAnnotation",e.indexOf(this.data.parentType)>=0)return this.container;var t='[data-annotation-id="'+this.data.parentId+'"]',i=this.layer.querySelector(t);if(!i)return this.container;var n=new S({container:this.container,trigger:i,color:this.data.color,title:this.data.title,contents:this.data.contents}),r=parseFloat(i.style.left),s=parseFloat(i.style.width);return g.setProp("transformOrigin",this.container,-(r+s)+"px -"+i.style.top),this.container.style.left=r+s+"px",this.container.appendChild(n.render()),this.container}}),t}(),S=function(){function t(t){this.container=t.container,this.trigger=t.trigger,this.color=t.color,this.title=t.title,this.contents=t.contents,this.hideWrapper=t.hideWrapper||!1,this.pinned=!1}return t.prototype={render:function(){var t=document.createElement("div");t.className="popupWrapper",this.hideElement=this.hideWrapper?t:this.container,this.hideElement.setAttribute("hidden",!0);var e=document.createElement("div");e.className="popup";var i=this.color;if(i){var n=.7*(255-i[0])+i[0],r=.7*(255-i[1])+i[1],s=.7*(255-i[2])+i[2];e.style.backgroundColor=h.makeCssRgb(0|n,0|r,0|s)}var a=this._formatContents(this.contents),o=document.createElement("h1");return o.textContent=this.title,this.trigger.addEventListener("click",this._toggle.bind(this)),this.trigger.addEventListener("mouseover",this._show.bind(this,!1)),this.trigger.addEventListener("mouseout",this._hide.bind(this,!1)),e.addEventListener("click",this._hide.bind(this,!0)),e.appendChild(o),e.appendChild(a),t.appendChild(e),t},_formatContents:function(t){for(var e=document.createElement("p"),i=t.split(/(?:\r\n?|\n)/),n=0,r=i.length;n<r;++n){var s=i[n];e.appendChild(document.createTextNode(s)),n<r-1&&e.appendChild(document.createElement("br"))}return e},_toggle:function(){this.pinned?this._hide(!0):this._show(!0)},_show:function(t){t&&(this.pinned=!0),this.hideElement.hasAttribute("hidden")&&(this.hideElement.removeAttribute("hidden"),this.container.style.zIndex+=1)},_hide:function(t){t&&(this.pinned=!1),this.hideElement.hasAttribute("hidden")||this.pinned||(this.hideElement.setAttribute("hidden",!0),this.container.style.zIndex-=1)}},t}(),T=function(){function t(t){var e=!!(t.data.hasPopup||t.data.title||t.data.contents);v.call(this,t,e,!0)}var e="http://www.w3.org/2000/svg";return h.inherit(t,v,{render:function(){this.container.className="lineAnnotation";var t=this.data,i=t.rect[2]-t.rect[0],n=t.rect[3]-t.rect[1],r=document.createElementNS(e,"svg:svg");r.setAttributeNS(null,"version","1.1"),r.setAttributeNS(null,"width",i+"px"),r.setAttributeNS(null,"height",n+"px"),r.setAttributeNS(null,"preserveAspectRatio","none"),r.setAttributeNS(null,"viewBox","0 0 "+i+" "+n);var s=document.createElementNS(e,"svg:line");return s.setAttributeNS(null,"x1",t.rect[2]-t.lineCoordinates[0]),s.setAttributeNS(null,"y1",t.rect[3]-t.lineCoordinates[1]),s.setAttributeNS(null,"x2",t.rect[2]-t.lineCoordinates[2]),s.setAttributeNS(null,"y2",t.rect[3]-t.lineCoordinates[3]),s.setAttributeNS(null,"stroke-width",t.borderStyle.width),s.setAttributeNS(null,"stroke","transparent"),r.appendChild(s),this.container.append(r),this._createPopup(this.container,s,this.data),this.container}}),t}(),k=function(){function t(t){var e=!!(t.data.hasPopup||t.data.title||t.data.contents);v.call(this,t,e,!0)}return h.inherit(t,v,{render:function(){return this.container.className="highlightAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}),t}(),O=function(){function t(t){var e=!!(t.data.hasPopup||t.data.title||t.data.contents);v.call(this,t,e,!0)}return h.inherit(t,v,{render:function(){return this.container.className="underlineAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}),t}(),P=function(){function t(t){var e=!!(t.data.hasPopup||t.data.title||t.data.contents);v.call(this,t,e,!0)}return h.inherit(t,v,{render:function(){return this.container.className="squigglyAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}),t}(),E=function(){function t(t){var e=!!(t.data.hasPopup||t.data.title||t.data.contents);v.call(this,t,e,!0)}return h.inherit(t,v,{render:function(){return this.container.className="strikeoutAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}),t}(),L=function(){function t(t){v.call(this,t,!0);var e=this.data.file;this.filename=f(e.filename),this.content=e.content,this.linkService.onFileAttachmentAnnotation({id:c(e.filename),filename:e.filename,content:e.content})}return h.inherit(t,v,{render:function(){this.container.className="fileAttachmentAnnotation";var t=document.createElement("div");return t.style.height=this.container.style.height,t.style.width=this.container.style.width,t.addEventListener("dblclick",this._download.bind(this)),this.data.hasPopup||!this.data.title&&!this.data.contents||this._createPopup(this.container,t,this.data),this.container.appendChild(t),this.container},_download:function(){this.downloadManager?this.downloadManager.downloadData(this.content,this.filename,""):d("Download cannot be started due to unavailable download manager")}}),t}(),I={render:function(t){for(var e=new n,i=0,r=t.annotations.length;i<r;i++){var s=t.annotations[i];if(s){var a=e.create({data:s,layer:t.div,page:t.page,viewport:t.viewport,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||p("imageResourcesPath"),renderInteractiveForms:t.renderInteractiveForms||!1});a.isRenderable&&t.div.appendChild(a.render())}}},update:function(t){for(var e=0,i=t.annotations.length;e<i;e++){var n=t.annotations[e],r=t.div.querySelector('[data-annotation-id="'+n.id+'"]');r&&g.setProp("transform",r,"matrix("+t.viewport.transform.join(",")+")")}t.div.removeAttribute("hidden")}};e.AnnotationLayer=I},function(t,e,i){"use strict";function n(t,e,i,n){return t.destroyed?Promise.reject(new Error("Worker was destroyed")):(e.disableAutoFetch=R("disableAutoFetch"),e.disableStream=R("disableStream"),e.chunkedViewerLoading=!!i,i&&(e.length=i.length,e.initialData=i.initialData),t.messageHandler.sendWithPromise("GetDocRequest",{docId:n,source:e,disableRange:R("disableRange"),maxImageSize:R("maxImageSize"),disableFontFace:R("disableFontFace"),disableCreateObjectURL:R("disableCreateObjectURL"),postMessageTransfers:R("postMessageTransfers")&&!X,docBaseUrl:e.docBaseUrl,disableNativeImageDecoder:e.disableNativeImageDecoder}).then(function(e){if(t.destroyed)throw new Error("Worker was destroyed");return e}))}var r,s=i(0),a=i(11),o=i(10),c=i(7),h=i(1),l=s.InvalidPDFException,u=s.MessageHandler,f=s.MissingPDFException,d=s.PageViewport,g=s.PasswordException,p=s.StatTimer,v=s.UnexpectedResponseException,m=s.UnknownErrorException,_=s.Util,b=s.createPromiseCapability,y=s.error,x=s.deprecated,w=s.getVerbosityLevel,C=s.info,A=s.isInt,S=s.isArray,T=s.isArrayBuffer,k=s.isSameOrigin,O=s.loadJpegStream,P=s.stringToBytes,E=s.globalScope,L=s.warn,I=a.FontFaceObject,M=a.FontLoader,D=o.CanvasGraphics,F=c.Metadata,j=h.RenderingCancelledException,R=h.getDefaultSetting,N=h.DOMCanvasFactory,B=h.DOMCMapReaderFactory,z=65536,U=!1,X=!1,W="undefined"!=typeof document&&document.currentScript?document.currentScript.src:null,Y=null,V=!1;if("undefined"==typeof __pdfjsdev_webpack__){"undefined"==typeof window?(U=!0,void 0===require.ensure&&(require.ensure=require("node-ensure")),V=!0):"undefined"!=typeof require&&"function"==typeof require.ensure&&(V=!0),"undefined"!=typeof requirejs&&requirejs.toUrl&&(r=requirejs.toUrl("pdfjs-dist/build/pdf.worker.js"));var G="undefined"!=typeof requirejs&&requirejs.load;Y=V?function(t){require.ensure([],function(){var e=require("./pdf.worker.js");t(e.WorkerMessageHandler)})}:G?function(t){requirejs(["pdfjs-dist/build/pdf.worker"],function(e){t(e.WorkerMessageHandler)})}:null}var H=function(){function t(){this._capability=b(),this._transport=null,this._worker=null,this.docId="d"+e++,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}var e=0;return t.prototype={get promise(){return this._capability.promise},destroy:function(){return this.destroyed=!0,(this._transport?this._transport.destroy():Promise.resolve()).then(function(){this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}.bind(this))},then:function(t,e){return this.promise.then.apply(this.promise,arguments)}},t}(),q=function(){function t(t,e){this.length=t,this.initialData=e,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._readyCapability=b()}return t.prototype={addRangeListener:function(t){this._rangeListeners.push(t)},addProgressListener:function(t){this._progressListeners.push(t)},addProgressiveReadListener:function(t){this._progressiveReadListeners.push(t)},onDataRange:function(t,e){for(var i=this._rangeListeners,n=0,r=i.length;n<r;++n)i[n](t,e)},onDataProgress:function(t){this._readyCapability.promise.then(function(){for(var e=this._progressListeners,i=0,n=e.length;i<n;++i)e[i](t)}.bind(this))},onDataProgressiveRead:function(t){this._readyCapability.promise.then(function(){for(var e=this._progressiveReadListeners,i=0,n=e.length;i<n;++i)e[i](t)}.bind(this))},transportReady:function(){this._readyCapability.resolve()},requestDataRange:function(t,e){throw new Error("Abstract method PDFDataRangeTransport.requestDataRange")},abort:function(){}},t}(),$=function(){function t(t,e,i){this.pdfInfo=t,this.transport=e,this.loadingTask=i}return t.prototype={get numPages(){return this.pdfInfo.numPages},get fingerprint(){return this.pdfInfo.fingerprint},getPage:function(t){return this.transport.getPage(t)},getPageIndex:function(t){return this.transport.getPageIndex(t)},getDestinations:function(){return this.transport.getDestinations()},getDestination:function(t){return this.transport.getDestination(t)},getPageLabels:function(){return this.transport.getPageLabels()},getAttachments:function(){return this.transport.getAttachments()},getJavaScript:function(){return this.transport.getJavaScript()},getOutline:function(){return this.transport.getOutline()},getMetadata:function(){return this.transport.getMetadata()},getData:function(){return this.transport.getData()},getDownloadInfo:function(){return this.transport.downloadInfoCapability.promise},getStats:function(){return this.transport.getStats()},cleanup:function(){this.transport.startCleanup()},destroy:function(){return this.loadingTask.destroy()}},t}(),J=function(){function t(t,e,i){this.pageIndex=t,this.pageInfo=e,this.transport=i,this.stats=new p,this.stats.enabled=R("enableStats"),this.commonObjs=i.commonObjs,this.objs=new Q,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this.intentStates=Object.create(null),this.destroyed=!1}return t.prototype={get pageNumber(){return this.pageIndex+1},get rotate(){return this.pageInfo.rotate},get ref(){return this.pageInfo.ref},get userUnit(){return this.pageInfo.userUnit},get view(){return this.pageInfo.view},getViewport:function(t,e){return arguments.length<2&&(e=this.rotate),new d(this.view,t,e,0,0)},getAnnotations:function(t){var e=t&&t.intent||null;return this.annotationsPromise&&this.annotationsIntent===e||(this.annotationsPromise=this.transport.getAnnotations(this.pageIndex,e),this.annotationsIntent=e),this.annotationsPromise},render:function(t){function e(t){var e=a.renderTasks.indexOf(o);e>=0&&a.renderTasks.splice(e,1),h.cleanupAfterRender&&(h.pendingCleanup=!0),h._tryCleanup(),t?o.capability.reject(t):o.capability.resolve(),i.timeEnd("Rendering"),i.timeEnd("Overall")}var i=this.stats;i.time("Overall"),this.pendingCleanup=!1;var n="print"===t.intent?"print":"display",r=!0===t.renderInteractiveForms,s=t.canvasFactory||new N;this.intentStates[n]||(this.intentStates[n]=Object.create(null));var a=this.intentStates[n];a.displayReadyCapability||(a.receivingOperatorList=!0,a.displayReadyCapability=b(),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this.stats.time("Page Request"),this.transport.messageHandler.send("RenderPageRequest",{pageIndex:this.pageNumber-1,intent:n,renderInteractiveForms:r}));var o=new et(e,t,this.objs,this.commonObjs,a.operatorList,this.pageNumber,s);o.useRequestAnimationFrame="print"!==n,a.renderTasks||(a.renderTasks=[]),a.renderTasks.push(o);var c=o.task;t.continueCallback&&(x("render is used with continueCallback parameter"),c.onContinue=t.continueCallback);var h=this;return a.displayReadyCapability.promise.then(function(t){h.pendingCleanup?e():(i.time("Rendering"),o.initializeGraphics(t),o.operatorListChanged())},function(t){e(t)}),c},getOperatorList:function(){this.intentStates.oplist||(this.intentStates.oplist=Object.create(null));var t,e=this.intentStates.oplist;return e.opListReadCapability||((t={}).operatorListChanged=function(){if(e.operatorList.lastChunk){e.opListReadCapability.resolve(e.operatorList);var i=e.renderTasks.indexOf(t);i>=0&&e.renderTasks.splice(i,1)}},e.receivingOperatorList=!0,e.opListReadCapability=b(),e.renderTasks=[],e.renderTasks.push(t),e.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this.transport.messageHandler.send("RenderPageRequest",{pageIndex:this.pageIndex,intent:"oplist"})),e.opListReadCapability.promise},getTextContent:function(t){return this.transport.messageHandler.sendWithPromise("GetTextContent",{pageIndex:this.pageNumber-1,normalizeWhitespace:!(!t||!0!==t.normalizeWhitespace),combineTextItems:!t||!0!==t.disableCombineTextItems})},_destroy:function(){this.destroyed=!0,this.transport.pageCache[this.pageIndex]=null;var t=[];return Object.keys(this.intentStates).forEach(function(e){"oplist"!==e&&this.intentStates[e].renderTasks.forEach(function(e){var i=e.capability.promise.catch(function(){});t.push(i),e.cancel()})},this),this.objs.clear(),this.annotationsPromise=null,this.pendingCleanup=!1,Promise.all(t)},destroy:function(){x("page destroy method, use cleanup() instead"),this.cleanup()},cleanup:function(){this.pendingCleanup=!0,this._tryCleanup()},_tryCleanup:function(){this.pendingCleanup&&!Object.keys(this.intentStates).some(function(t){var e=this.intentStates[t];return 0!==e.renderTasks.length||e.receivingOperatorList},this)&&(Object.keys(this.intentStates).forEach(function(t){delete this.intentStates[t]},this),this.objs.clear(),this.annotationsPromise=null,this.pendingCleanup=!1)},_startRenderPage:function(t,e){var i=this.intentStates[e];i.displayReadyCapability&&i.displayReadyCapability.resolve(t)},_renderPageChunk:function(t,e){var i,n,r=this.intentStates[e];for(i=0,n=t.length;i<n;i++)r.operatorList.fnArray.push(t.fnArray[i]),r.operatorList.argsArray.push(t.argsArray[i]);for(r.operatorList.lastChunk=t.lastChunk,i=0;i<r.renderTasks.length;i++)r.renderTasks[i].operatorListChanged();t.lastChunk&&(r.receivingOperatorList=!1,this._tryCleanup())}},t}(),Z=function(){function t(){return void 0!==r?r:R("workerSrc")?R("workerSrc"):W?W.replace(/(\.(?:min\.)?js)$/i,".worker$1"):void y("No PDFJS.workerSrc specified")}function e(){return a?a.promise:(a=b(),(Y||function(e){_.loadScript(t(),function(){e(window.pdfjsDistBuildPdfWorker.WorkerMessageHandler)})})(a.resolve),a.promise)}function i(t){this._listeners=[],this._defer=t,this._deferred=Promise.resolve(void 0)}function n(t){var e="importScripts('"+t+"');";return URL.createObjectURL(new Blob([e]))}function s(t,e){this.name=t,this.destroyed=!1,this._readyCapability=b(),this._port=null,this._webWorker=null,this._messageHandler=null,e?this._initializeFromPort(e):this._initialize()}var a,o=0;return i.prototype={postMessage:function(t,e){function i(t){if("object"!=typeof t||null===t)return t;if(n.has(t))return n.get(t);var r,s;if((s=t.buffer)&&T(s)){var a=e&&e.indexOf(s)>=0;return r=t===s?t:a?new t.constructor(s,t.byteOffset,t.byteLength):new t.constructor(t),n.set(t,r),r}r=S(t)?[]:{},n.set(t,r);for(var o in t){for(var c,h=t;!(c=Object.getOwnPropertyDescriptor(h,o));)h=Object.getPrototypeOf(h);void 0!==c.value&&"function"!=typeof c.value&&(r[o]=i(c.value))}return r}if(this._defer){var n=new WeakMap,r={data:i(t)};this._deferred.then(function(){this._listeners.forEach(function(t){t.call(this,r)},this)}.bind(this))}else this._listeners.forEach(function(e){e.call(this,{data:t})},this)},addEventListener:function(t,e){this._listeners.push(e)},removeEventListener:function(t,e){var i=this._listeners.indexOf(e);this._listeners.splice(i,1)},terminate:function(){this._listeners=[]}},s.prototype={get promise(){return this._readyCapability.promise},get port(){return this._port},get messageHandler(){return this._messageHandler},_initializeFromPort:function(t){this._port=t,this._messageHandler=new u("main","worker",t),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()},_initialize:function(){if(!U&&!R("disableWorker")&&"undefined"!=typeof Worker){var e=t();try{k(window.location.href,e)||(e=n(new URL(e,window.location).href));var i=new Worker(e),r=new u("main","worker",i),s=function(){i.removeEventListener("error",a),r.destroy(),i.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()}.bind(this),a=function(t){this._webWorker||s()}.bind(this);i.addEventListener("error",a),r.on("test",function(t){i.removeEventListener("error",a),this.destroyed?s():t&&t.supportTypedArray?(this._messageHandler=r,this._port=i,this._webWorker=i,t.supportTransfers||(X=!0),this._readyCapability.resolve(),r.send("configure",{verbosity:w()})):(this._setupFakeWorker(),r.destroy(),i.terminate())}.bind(this)),r.on("console_log",function(t){console.log.apply(console,t)}),r.on("console_error",function(t){console.error.apply(console,t)}),r.on("ready",function(t){if(i.removeEventListener("error",a),this.destroyed)s();else try{o()}catch(t){this._setupFakeWorker()}}.bind(this));var o=function(){var t=R("postMessageTransfers")&&!X,e=new Uint8Array([t?255:0]);try{r.send("test",e,[e.buffer])}catch(t){C("Cannot use postMessage transfers"),e[0]=0,r.send("test",e)}};return void o()}catch(t){C("The worker has been disabled.")}}this._setupFakeWorker()},_setupFakeWorker:function(){U||R("disableWorker")||(L("Setting up fake worker."),U=!0),e().then(function(t){if(this.destroyed)this._readyCapability.reject(new Error("Worker was destroyed"));else{var e=new i(Uint8Array!==Float32Array);this._port=e;var n="fake"+o++,r=new u(n+"_worker",n,e);t.setup(r,e);var s=new u(n,n+"_worker",e);this._messageHandler=s,this._readyCapability.resolve()}}.bind(this))},destroy:function(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}},s}(),K=function(){function t(t,e,i,n){this.messageHandler=t,this.loadingTask=e,this.pdfDataRangeTransport=i,this.commonObjs=new Q,this.fontLoader=new M(e.docId),this.CMapReaderFactory=new n({baseUrl:R("cMapUrl"),isCompressed:R("cMapPacked")}),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this.pageCache=[],this.pagePromises=[],this.downloadInfoCapability=b(),this.setupMessageHandler()}return t.prototype={destroy:function(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=b(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));var t=[];this.pageCache.forEach(function(e){e&&t.push(e._destroy())}),this.pageCache=[],this.pagePromises=[];var e=this,i=this.messageHandler.sendWithPromise("Terminate",null);return t.push(i),Promise.all(t).then(function(){e.fontLoader.clear(),e.pdfDataRangeTransport&&(e.pdfDataRangeTransport.abort(),e.pdfDataRangeTransport=null),e.messageHandler&&(e.messageHandler.destroy(),e.messageHandler=null),e.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise},setupMessageHandler:function(){var t=this.messageHandler,e=this.loadingTask,i=this.pdfDataRangeTransport;i&&(i.addRangeListener(function(e,i){t.send("OnDataRange",{begin:e,chunk:i})}),i.addProgressListener(function(e){t.send("OnDataProgress",{loaded:e})}),i.addProgressiveReadListener(function(e){t.send("OnDataRange",{chunk:e})}),t.on("RequestDataRange",function(t){i.requestDataRange(t.begin,t.end)},this)),t.on("GetDoc",function(t){var e=t.pdfInfo;this.numPages=t.pdfInfo.numPages;var i=this.loadingTask,n=new $(e,this,i);this.pdfDocument=n,i._capability.resolve(n)},this),t.on("PasswordRequest",function(t){if(this._passwordCapability=b(),e.onPassword){var i=function(t){this._passwordCapability.resolve({password:t})}.bind(this);e.onPassword(i,t.code)}else this._passwordCapability.reject(new g(t.message,t.code));return this._passwordCapability.promise},this),t.on("PasswordException",function(t){e._capability.reject(new g(t.message,t.code))},this),t.on("InvalidPDF",function(t){this.loadingTask._capability.reject(new l(t.message))},this),t.on("MissingPDF",function(t){this.loadingTask._capability.reject(new f(t.message))},this),t.on("UnexpectedResponse",function(t){this.loadingTask._capability.reject(new v(t.message,t.status))},this),t.on("UnknownError",function(t){this.loadingTask._capability.reject(new m(t.message,t.details))},this),t.on("DataLoaded",function(t){this.downloadInfoCapability.resolve(t)},this),t.on("PDFManagerReady",function(t){this.pdfDataRangeTransport&&this.pdfDataRangeTransport.transportReady()},this),t.on("StartRenderPage",function(t){if(!this.destroyed){var e=this.pageCache[t.pageIndex];e.stats.timeEnd("Page Request"),e._startRenderPage(t.transparency,t.intent)}},this),t.on("RenderPageChunk",function(t){this.destroyed||this.pageCache[t.pageIndex]._renderPageChunk(t.operatorList,t.intent)},this),t.on("commonobj",function(t){if(!this.destroyed){var e=t[0],i=t[1];if(!this.commonObjs.hasData(e))switch(i){case"Font":var n=t[2];if("error"in n){var r=n.error;L("Error during font loading: "+r),this.commonObjs.resolve(e,r);break}var s=null;R("pdfBug")&&E.FontInspector&&E.FontInspector.enabled&&(s={registerFont:function(t,e){E.FontInspector.fontAdded(t,e)}});var a=new I(n,{isEvalSuported:R("isEvalSupported"),disableFontFace:R("disableFontFace"),fontRegistry:s});this.fontLoader.bind([a],function(t){this.commonObjs.resolve(e,a)}.bind(this));break;case"FontPath":this.commonObjs.resolve(e,t[2]);break;default:y("Got unknown common object type "+i)}}},this),t.on("obj",function(t){if(!this.destroyed){var e,i=t[0],n=t[1],r=t[2],s=this.pageCache[n];if(!s.objs.hasData(i))switch(r){case"JpegStream":e=t[3],O(i,e,s.objs);break;case"Image":e=t[3],s.objs.resolve(i,e);e&&"data"in e&&e.data.length>8e6&&(s.cleanupAfterRender=!0);break;default:y("Got unknown object type "+r)}}},this),t.on("DocProgress",function(t){if(!this.destroyed){var e=this.loadingTask;e.onProgress&&e.onProgress({loaded:t.loaded,total:t.total})}},this),t.on("PageError",function(t){if(!this.destroyed){var e=this.pageCache[t.pageNum-1].intentStates[t.intent];if(e.displayReadyCapability?e.displayReadyCapability.reject(t.error):y(t.error),e.operatorList){e.operatorList.lastChunk=!0;for(var i=0;i<e.renderTasks.length;i++)e.renderTasks[i].operatorListChanged()}}},this),t.on("UnsupportedFeature",function(t){if(!this.destroyed){var e=t.featureId,i=this.loadingTask;i.onUnsupportedFeature&&i.onUnsupportedFeature(e),it.notify(e)}},this),t.on("JpegDecode",function(t){if(this.destroyed)return Promise.reject(new Error("Worker was destroyed"));if("undefined"==typeof document)return Promise.reject(new Error('"document" is not defined.'));var e=t[0],i=t[1];return 3!==i&&1!==i?Promise.reject(new Error("Only 3 components or 1 component can be returned")):new Promise(function(t,n){var r=new Image;r.onload=function(){var e=r.width,n=r.height,s=e*n,a=4*s,o=new Uint8Array(s*i),c=document.createElement("canvas");c.width=e,c.height=n;var h=c.getContext("2d");h.drawImage(r,0,0);var l,u,f=h.getImageData(0,0,e,n).data;if(3===i)for(l=0,u=0;l<a;l+=4,u+=3)o[u]=f[l],o[u+1]=f[l+1],o[u+2]=f[l+2];else if(1===i)for(l=0,u=0;l<a;l+=4,u++)o[u]=f[l];t({data:o,width:e,height:n})},r.onerror=function(){n(new Error("JpegDecode failed to load image"))},r.src=e})},this),t.on("FetchBuiltInCMap",function(t){return this.destroyed?Promise.reject(new Error("Worker was destroyed")):this.CMapReaderFactory.fetch({name:t.name})},this)},getData:function(){return this.messageHandler.sendWithPromise("GetData",null)},getPage:function(t,e){if(!A(t)||t<=0||t>this.numPages)return Promise.reject(new Error("Invalid page request"));var i=t-1;if(i in this.pagePromises)return this.pagePromises[i];var n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:i}).then(function(t){if(this.destroyed)throw new Error("Transport destroyed");var e=new J(i,t,this);return this.pageCache[i]=e,e}.bind(this));return this.pagePromises[i]=n,n},getPageIndex:function(t){return this.messageHandler.sendWithPromise("GetPageIndex",{ref:t}).catch(function(t){return Promise.reject(new Error(t))})},getAnnotations:function(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})},getDestinations:function(){return this.messageHandler.sendWithPromise("GetDestinations",null)},getDestination:function(t){return this.messageHandler.sendWithPromise("GetDestination",{id:t})},getPageLabels:function(){return this.messageHandler.sendWithPromise("GetPageLabels",null)},getAttachments:function(){return this.messageHandler.sendWithPromise("GetAttachments",null)},getJavaScript:function(){return this.messageHandler.sendWithPromise("GetJavaScript",null)},getOutline:function(){return this.messageHandler.sendWithPromise("GetOutline",null)},getMetadata:function(){return this.messageHandler.sendWithPromise("GetMetadata",null).then(function(t){return{info:t[0],metadata:t[1]?new F(t[1]):null}})},getStats:function(){return this.messageHandler.sendWithPromise("GetStats",null)},startCleanup:function(){this.messageHandler.sendWithPromise("Cleanup",null).then(function(){for(var t=0,e=this.pageCache.length;t<e;t++){var i=this.pageCache[t];i&&i.cleanup()}this.commonObjs.clear(),this.fontLoader.clear()}.bind(this))}},t}(),Q=function(){function t(){this.objs=Object.create(null)}return t.prototype={ensureObj:function(t){if(this.objs[t])return this.objs[t];var e={capability:b(),data:null,resolved:!1};return this.objs[t]=e,e},get:function(t,e){if(e)return this.ensureObj(t).capability.promise.then(e),null;var i=this.objs[t];return i&&i.resolved||y("Requesting object that isn't resolved yet "+t),i.data},resolve:function(t,e){var i=this.ensureObj(t);i.resolved=!0,i.data=e,i.capability.resolve(e)},isResolved:function(t){var e=this.objs;return!!e[t]&&e[t].resolved},hasData:function(t){return this.isResolved(t)},getData:function(t){var e=this.objs;return e[t]&&e[t].resolved?e[t].data:null},clear:function(){this.objs=Object.create(null)}},t}(),tt=function(){function t(t){this._internalRenderTask=t,this.onContinue=null}return t.prototype={get promise(){return this._internalRenderTask.capability.promise},cancel:function(){this._internalRenderTask.cancel()},then:function(t,e){return this.promise.then.apply(this.promise,arguments)}},t}(),et=function(){function t(t,e,i,n,r,s,a){this.callback=t,this.params=e,this.objs=i,this.commonObjs=n,this.operatorListIdx=null,this.operatorList=r,this.pageNumber=s,this.canvasFactory=a,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this.useRequestAnimationFrame=!1,this.cancelled=!1,this.capability=b(),this.task=new tt(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this)}return t.prototype={initializeGraphics:function(t){if(!this.cancelled){R("pdfBug")&&E.StepperManager&&E.StepperManager.enabled&&(this.stepper=E.StepperManager.create(this.pageNumber-1),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var e=this.params;this.gfx=new D(e.canvasContext,this.commonObjs,this.objs,this.canvasFactory,e.imageLayer),this.gfx.beginDrawing(e.transform,e.viewport,t),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}},cancel:function(){this.running=!1,this.cancelled=!0,R("pdfjsNext")?this.callback(new j("Rendering cancelled, page "+this.pageNumber,"canvas")):this.callback("cancelled")},operatorListChanged:function(){this.graphicsReady?(this.stepper&&this.stepper.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)},_continue:function(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())},_scheduleNext:function(){this.useRequestAnimationFrame&&"undefined"!=typeof window?window.requestAnimationFrame(this._nextBound):Promise.resolve(void 0).then(this._nextBound)},_next:function(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this.callback())))}},t}(),it=function(){var t=[];return{listen:function(e){x("Global UnsupportedManager.listen is used:  use PDFDocumentLoadingTask.onUnsupportedFeature instead"),t.push(e)},notify:function(e){for(var i=0,n=t.length;i<n;i++)t[i](e)}}}();e.version="1.8.188",e.build="ad1023ff",e.getDocument=function(t,e,i,r){var s=new H;arguments.length>1&&x("getDocument is called with pdfDataRangeTransport, passwordCallback or progressCallback argument"),e&&(e instanceof q||((e=Object.create(e)).length=t.length,e.initialData=t.initialData,e.abort||(e.abort=function(){})),(t=Object.create(t)).range=e),s.onPassword=i||null,s.onProgress=r||null;var a;"string"==typeof t?a={url:t}:T(t)?a={data:t}:t instanceof q?a={range:t}:("object"!=typeof t&&y("Invalid parameter in getDocument, need either Uint8Array, string or a parameter object"),t.url||t.data||t.range||y("Invalid parameter object: need either .data, .range or .url"),a=t);var o={},c=null,h=null;for(var l in a)if("url"!==l||"undefined"==typeof window)if("range"!==l)if("worker"!==l)if("data"!==l||a[l]instanceof Uint8Array)o[l]=a[l];else{var f=a[l];"string"==typeof f?o[l]=P(f):"object"!=typeof f||null===f||isNaN(f.length)?T(f)?o[l]=new Uint8Array(f):y("Invalid PDF binary data: either typed array, string or array-like object is expected in the data property."):o[l]=new Uint8Array(f)}else h=a[l];else c=a[l];else o[l]=new URL(a[l],window.location).href;o.rangeChunkSize=o.rangeChunkSize||z,o.disableNativeImageDecoder=!0===o.disableNativeImageDecoder;var d=o.CMapReaderFactory||B;if(!h){var g=R("workerPort");h=g?new Z(null,g):new Z,s._worker=h}var p=s.docId;return h.promise.then(function(){if(s.destroyed)throw new Error("Loading aborted");return n(h,o,c,p).then(function(t){if(s.destroyed)throw new Error("Loading aborted");var e=new u(p,t,h.port),i=new K(e,s,c,d);s._transport=i,e.send("Ready",null)})}).catch(s._capability.reject),s},e.PDFDataRangeTransport=q,e.PDFWorker=Z,e.PDFDocumentProxy=$,e.PDFPageProxy=J,e._UnsupportedManager=it},function(t,e,i){"use strict";var n=i(0),r=n.FONT_IDENTITY_MATRIX,s=n.IDENTITY_MATRIX,a=n.ImageKind,o=n.OPS,c=n.Util,h=n.isNum,l=n.isArray,u=n.warn,f=n.createObjectURL,d={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},g=function(){function t(t,e,i){for(var n=-1,r=e;r<i;r++){var s=255&(n^t[r]);n=n>>>8^o[s]}return-1^n}function e(e,i,n,r){var s=r,a=i.length;n[s]=a>>24&255,n[s+1]=a>>16&255,n[s+2]=a>>8&255,n[s+3]=255&a,n[s+=4]=255&e.charCodeAt(0),n[s+1]=255&e.charCodeAt(1),n[s+2]=255&e.charCodeAt(2),n[s+3]=255&e.charCodeAt(3),s+=4,n.set(i,s);var o=t(n,r+4,s+=i.length);n[s]=o>>24&255,n[s+1]=o>>16&255,n[s+2]=o>>8&255,n[s+3]=255&o}function i(t,e,i){for(var n=1,r=0,s=e;s<i;++s)r=(r+(n=(n+(255&t[s]))%65521))%65521;return r<<16|n}function n(t,n,o){var c,h,l,u=t.width,d=t.height,g=t.data;switch(n){case a.GRAYSCALE_1BPP:h=0,c=1,l=u+7>>3;break;case a.RGB_24BPP:h=2,c=8,l=3*u;break;case a.RGBA_32BPP:h=6,c=8,l=4*u;break;default:throw new Error("invalid format")}var p,v,m=new Uint8Array((1+l)*d),_=0,b=0;for(p=0;p<d;++p)m[_++]=0,m.set(g.subarray(b,b+l),_),b+=l,_+=l;if(n===a.GRAYSCALE_1BPP)for(_=0,p=0;p<d;p++)for(_++,v=0;v<l;v++)m[_++]^=255;var y=new Uint8Array([u>>24&255,u>>16&255,u>>8&255,255&u,d>>24&255,d>>16&255,d>>8&255,255&d,c,h,0,0,0]),x=m.length,w=Math.ceil(x/65535),C=new Uint8Array(2+x+5*w+4),A=0;C[A++]=120,C[A++]=156;for(var S=0;x>65535;)C[A++]=0,C[A++]=255,C[A++]=255,C[A++]=0,C[A++]=0,C.set(m.subarray(S,S+65535),A),A+=65535,S+=65535,x-=65535;C[A++]=1,C[A++]=255&x,C[A++]=x>>8&255,C[A++]=255&~x,C[A++]=(65535&~x)>>8&255,C.set(m.subarray(S),A),A+=m.length-S;var T=i(m,0,m.length);C[A++]=T>>24&255,C[A++]=T>>16&255,C[A++]=T>>8&255,C[A++]=255&T;var k=r.length+3*s+y.length+C.length,O=new Uint8Array(k),P=0;return O.set(r,P),P+=r.length,e("IHDR",y,O,P),P+=s+y.length,e("IDATA",C,O,P),P+=s+C.length,e("IEND",new Uint8Array(0),O,P),f(O,"image/png",o)}for(var r=new Uint8Array([137,80,78,71,13,10,26,10]),s=12,o=new Int32Array(256),c=0;c<256;c++){for(var h=c,l=0;l<8;l++)h=1&h?3988292384^h>>1&2147483647:h>>1&2147483647;o[c]=h}return function(t,e){return n(t,void 0===t.kind?a.GRAYSCALE_1BPP:t.kind,e)}}(),p=function(){function t(){this.fontSizeScale=1,this.fontWeight=d.fontWeight,this.fontSize=0,this.textMatrix=s,this.fontMatrix=r,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=d.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}return t.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(t,e){this.x=t,this.y=e}},t}(),v=function(){function t(t){for(var e=[],i=[],n=t.length,r=0;r<n;r++)"save"!==t[r].fn?"restore"===t[r].fn?e=i.pop():e.push(t[r]):(e.push({fnId:92,fn:"group",items:[]}),i.push(e),e=e[e.length-1].items);return e}function e(t){if(t===(0|t))return t.toString();var e=t.toFixed(10),i=e.length-1;if("0"!==e[i])return e;do{i--}while("0"===e[i]);return e.substr(0,"."===e[i]?i:i+1)}function i(t){if(0===t[4]&&0===t[5]){if(0===t[1]&&0===t[2])return 1===t[0]&&1===t[3]?"":"scale("+e(t[0])+" "+e(t[3])+")";if(t[0]===t[3]&&t[1]===-t[2])return"rotate("+e(180*Math.acos(t[0])/Math.PI)+")"}else if(1===t[0]&&0===t[1]&&0===t[2]&&1===t[3])return"translate("+e(t[4])+" "+e(t[5])+")";return"matrix("+e(t[0])+" "+e(t[1])+" "+e(t[2])+" "+e(t[3])+" "+e(t[4])+" "+e(t[5])+")"}function n(t,e,i){this.current=new p,this.transformMatrix=s,this.transformStack=[],this.extraStack=[],this.commonObjs=t,this.objs=e,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!i}var a="http://www.w3.org/2000/svg",v="http://www.w3.org/1999/xlink",m=["butt","round","square"],_=["miter","round","bevel"],b=0,y=0;return n.prototype={save:function(){this.transformStack.push(this.transformMatrix);var t=this.current;this.extraStack.push(t),this.current=t.clone()},restore:function(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.tgrp=null},group:function(t){this.save(),this.executeOpTree(t),this.restore()},loadDependencies:function(t){for(var e=t.fnArray,i=e.length,n=t.argsArray,r=this,s=0;s<i;s++)if(o.dependency===e[s])for(var a=n[s],c=0,h=a.length;c<h;c++){var l,u=a[c];l="g_"===u.substring(0,2)?new Promise(function(t){r.commonObjs.get(u,t)}):new Promise(function(t){r.objs.get(u,t)}),this.current.dependencies.push(l)}return Promise.all(this.current.dependencies)},transform:function(t,e,i,n,r,s){var a=[t,e,i,n,r,s];this.transformMatrix=c.transform(this.transformMatrix,a),this.tgrp=null},getSVG:function(t,e){this.viewport=e;var i=this._initialize(e);return this.loadDependencies(t).then(function(){this.transformMatrix=s;var e=this.convertOpList(t);return this.executeOpTree(e),i}.bind(this))},convertOpList:function(e){var i=e.argsArray,n=e.fnArray,r=n.length,s=[],a=[];for(var c in o)s[o[c]]=c;for(var h=0;h<r;h++){var l=n[h];a.push({fnId:l,fn:s[l],args:i[h]})}return t(a)},executeOpTree:function(t){for(var e=t.length,i=0;i<e;i++){var n=t[i].fn,r=t[i].fnId,s=t[i].args;switch(0|r){case o.beginText:this.beginText();break;case o.setLeading:this.setLeading(s);break;case o.setLeadingMoveText:this.setLeadingMoveText(s[0],s[1]);break;case o.setFont:this.setFont(s);break;case o.showText:case o.showSpacedText:this.showText(s[0]);break;case o.endText:this.endText();break;case o.moveText:this.moveText(s[0],s[1]);break;case o.setCharSpacing:this.setCharSpacing(s[0]);break;case o.setWordSpacing:this.setWordSpacing(s[0]);break;case o.setHScale:this.setHScale(s[0]);break;case o.setTextMatrix:this.setTextMatrix(s[0],s[1],s[2],s[3],s[4],s[5]);break;case o.setLineWidth:this.setLineWidth(s[0]);break;case o.setLineJoin:this.setLineJoin(s[0]);break;case o.setLineCap:this.setLineCap(s[0]);break;case o.setMiterLimit:this.setMiterLimit(s[0]);break;case o.setFillRGBColor:this.setFillRGBColor(s[0],s[1],s[2]);break;case o.setStrokeRGBColor:this.setStrokeRGBColor(s[0],s[1],s[2]);break;case o.setDash:this.setDash(s[0],s[1]);break;case o.setGState:this.setGState(s[0]);break;case o.fill:this.fill();break;case o.eoFill:this.eoFill();break;case o.stroke:this.stroke();break;case o.fillStroke:this.fillStroke();break;case o.eoFillStroke:this.eoFillStroke();break;case o.clip:this.clip("nonzero");break;case o.eoClip:this.clip("evenodd");break;case o.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case o.paintJpegXObject:this.paintJpegXObject(s[0],s[1],s[2]);break;case o.paintImageXObject:this.paintImageXObject(s[0]);break;case o.paintInlineImageXObject:this.paintInlineImageXObject(s[0]);break;case o.paintImageMaskXObject:this.paintImageMaskXObject(s[0]);break;case o.paintFormXObjectBegin:this.paintFormXObjectBegin(s[0],s[1]);break;case o.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case o.closePath:this.closePath();break;case o.closeStroke:this.closeStroke();break;case o.closeFillStroke:this.closeFillStroke();break;case o.nextLine:this.nextLine();break;case o.transform:this.transform(s[0],s[1],s[2],s[3],s[4],s[5]);break;case o.constructPath:this.constructPath(s[0],s[1]);break;case o.endPath:this.endPath();break;case 92:this.group(t[i].items);break;default:u("Unimplemented operator "+n)}}},setWordSpacing:function(t){this.current.wordSpacing=t},setCharSpacing:function(t){this.current.charSpacing=t},nextLine:function(){this.moveText(0,this.current.leading)},setTextMatrix:function(t,i,n,r,s,o){var c=this.current;this.current.textMatrix=this.current.lineMatrix=[t,i,n,r,s,o],this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,c.xcoords=[],c.tspan=document.createElementNS(a,"svg:tspan"),c.tspan.setAttributeNS(null,"font-family",c.fontFamily),c.tspan.setAttributeNS(null,"font-size",e(c.fontSize)+"px"),c.tspan.setAttributeNS(null,"y",e(-c.y)),c.txtElement=document.createElementNS(a,"svg:text"),c.txtElement.appendChild(c.tspan)},beginText:function(){this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.current.textMatrix=s,this.current.lineMatrix=s,this.current.tspan=document.createElementNS(a,"svg:tspan"),this.current.txtElement=document.createElementNS(a,"svg:text"),this.current.txtgrp=document.createElementNS(a,"svg:g"),this.current.xcoords=[]},moveText:function(t,i){var n=this.current;this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=i,n.xcoords=[],n.tspan=document.createElementNS(a,"svg:tspan"),n.tspan.setAttributeNS(null,"font-family",n.fontFamily),n.tspan.setAttributeNS(null,"font-size",e(n.fontSize)+"px"),n.tspan.setAttributeNS(null,"y",e(-n.y))},showText:function(t){var n=this.current,r=n.font,s=n.fontSize;if(0!==s){var a,o=n.charSpacing,c=n.wordSpacing,l=n.fontDirection,u=n.textHScale*l,f=t.length,g=r.vertical,p=s*n.fontMatrix[0],v=0;for(a=0;a<f;++a){var m=t[a];if(null!==m)if(h(m))v+=-m*s*.001;else{n.xcoords.push(n.x+v*u);var _=m.width,b=m.fontChar;v+=_*p+o*l,n.tspan.textContent+=b}else v+=l*c}g?n.y-=v*u:n.x+=v*u,n.tspan.setAttributeNS(null,"x",n.xcoords.map(e).join(" ")),n.tspan.setAttributeNS(null,"y",e(-n.y)),n.tspan.setAttributeNS(null,"font-family",n.fontFamily),n.tspan.setAttributeNS(null,"font-size",e(n.fontSize)+"px"),n.fontStyle!==d.fontStyle&&n.tspan.setAttributeNS(null,"font-style",n.fontStyle),n.fontWeight!==d.fontWeight&&n.tspan.setAttributeNS(null,"font-weight",n.fontWeight),n.fillColor!==d.fillColor&&n.tspan.setAttributeNS(null,"fill",n.fillColor),n.txtElement.setAttributeNS(null,"transform",i(n.textMatrix)+" scale(1, -1)"),n.txtElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),n.txtElement.appendChild(n.tspan),n.txtgrp.appendChild(n.txtElement),this._ensureTransformGroup().appendChild(n.txtElement)}},setLeadingMoveText:function(t,e){this.setLeading(-e),this.moveText(t,e)},addFontStyle:function(t){this.cssStyle||(this.cssStyle=document.createElementNS(a,"svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));var e=f(t.data,t.mimetype,this.forceDataSchema);this.cssStyle.textContent+='@font-face { font-family: "'+t.loadedName+'"; src: url('+e+"); }\n"},setFont:function(t){var i=this.current,n=this.commonObjs.get(t[0]),s=t[1];this.current.font=n,this.embedFonts&&n.data&&!this.embeddedFonts[n.loadedName]&&(this.addFontStyle(n),this.embeddedFonts[n.loadedName]=n),i.fontMatrix=n.fontMatrix?n.fontMatrix:r;var o=n.black?n.bold?"bolder":"bold":n.bold?"bold":"normal",c=n.italic?"italic":"normal";s<0?(s=-s,i.fontDirection=-1):i.fontDirection=1,i.fontSize=s,i.fontFamily=n.loadedName,i.fontWeight=o,i.fontStyle=c,i.tspan=document.createElementNS(a,"svg:tspan"),i.tspan.setAttributeNS(null,"y",e(-i.y)),i.xcoords=[]},endText:function(){},setLineWidth:function(t){this.current.lineWidth=t},setLineCap:function(t){this.current.lineCap=m[t]},setLineJoin:function(t){this.current.lineJoin=_[t]},setMiterLimit:function(t){this.current.miterLimit=t},setStrokeRGBColor:function(t,e,i){var n=c.makeCssRgb(t,e,i);this.current.strokeColor=n},setFillRGBColor:function(t,e,i){var n=c.makeCssRgb(t,e,i);this.current.fillColor=n,this.current.tspan=document.createElementNS(a,"svg:tspan"),this.current.xcoords=[]},setDash:function(t,e){this.current.dashArray=t,this.current.dashPhase=e},constructPath:function(t,i){var n=this.current,r=n.x,s=n.y;n.path=document.createElementNS(a,"svg:path");for(var c=[],h=t.length,l=0,u=0;l<h;l++)switch(0|t[l]){case o.rectangle:r=i[u++],s=i[u++];var f=r+i[u++],d=s+i[u++];c.push("M",e(r),e(s),"L",e(f),e(s),"L",e(f),e(d),"L",e(r),e(d),"Z");break;case o.moveTo:r=i[u++],s=i[u++],c.push("M",e(r),e(s));break;case o.lineTo:r=i[u++],s=i[u++],c.push("L",e(r),e(s));break;case o.curveTo:r=i[u+4],s=i[u+5],c.push("C",e(i[u]),e(i[u+1]),e(i[u+2]),e(i[u+3]),e(r),e(s)),u+=6;break;case o.curveTo2:r=i[u+2],s=i[u+3],c.push("C",e(r),e(s),e(i[u]),e(i[u+1]),e(i[u+2]),e(i[u+3])),u+=4;break;case o.curveTo3:r=i[u+2],s=i[u+3],c.push("C",e(i[u]),e(i[u+1]),e(r),e(s),e(r),e(s)),u+=4;break;case o.closePath:c.push("Z")}n.path.setAttributeNS(null,"d",c.join(" ")),n.path.setAttributeNS(null,"stroke-miterlimit",e(n.miterLimit)),n.path.setAttributeNS(null,"stroke-linecap",n.lineCap),n.path.setAttributeNS(null,"stroke-linejoin",n.lineJoin),n.path.setAttributeNS(null,"stroke-width",e(n.lineWidth)+"px"),n.path.setAttributeNS(null,"stroke-dasharray",n.dashArray.map(e).join(" ")),n.path.setAttributeNS(null,"stroke-dashoffset",e(n.dashPhase)+"px"),n.path.setAttributeNS(null,"fill","none"),this._ensureTransformGroup().appendChild(n.path),n.element=n.path,n.setCurrentPoint(r,s)},endPath:function(){},clip:function(t){var e=this.current,n="clippath"+b;b++;var r=document.createElementNS(a,"svg:clipPath");r.setAttributeNS(null,"id",n),r.setAttributeNS(null,"transform",i(this.transformMatrix));var s=e.element.cloneNode();"evenodd"===t?s.setAttributeNS(null,"clip-rule","evenodd"):s.setAttributeNS(null,"clip-rule","nonzero"),r.appendChild(s),this.defs.appendChild(r),e.activeClipUrl&&(e.clipGroup=null,this.extraStack.forEach(function(t){t.clipGroup=null})),e.activeClipUrl="url(#"+n+")",this.tgrp=null},closePath:function(){var t=this.current,e=t.path.getAttributeNS(null,"d");e+="Z",t.path.setAttributeNS(null,"d",e)},setLeading:function(t){this.current.leading=-t},setTextRise:function(t){this.current.textRise=t},setHScale:function(t){this.current.textHScale=t/100},setGState:function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e],r=n[0],s=n[1];switch(r){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"Font":this.setFont(s);break;default:u("Unimplemented graphic state "+r)}}},fill:function(){var t=this.current;t.element.setAttributeNS(null,"fill",t.fillColor)},stroke:function(){var t=this.current;t.element.setAttributeNS(null,"stroke",t.strokeColor),t.element.setAttributeNS(null,"fill","none")},eoFill:function(){var t=this.current;t.element.setAttributeNS(null,"fill",t.fillColor),t.element.setAttributeNS(null,"fill-rule","evenodd")},fillStroke:function(){this.stroke(),this.fill()},eoFillStroke:function(){this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()},closeStroke:function(){this.closePath(),this.stroke()},closeFillStroke:function(){this.closePath(),this.fillStroke()},paintSolidColorImageMask:function(){var t=this.current,e=document.createElementNS(a,"svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",t.fillColor),this._ensureTransformGroup().appendChild(e)},paintJpegXObject:function(t,i,n){var r=this.objs.get(t),s=document.createElementNS(a,"svg:image");s.setAttributeNS(v,"xlink:href",r.src),s.setAttributeNS(null,"width",r.width+"px"),s.setAttributeNS(null,"height",r.height+"px"),s.setAttributeNS(null,"x","0"),s.setAttributeNS(null,"y",e(-n)),s.setAttributeNS(null,"transform","scale("+e(1/i)+" "+e(-1/n)+")"),this._ensureTransformGroup().appendChild(s)},paintImageXObject:function(t){var e=this.objs.get(t);e?this.paintInlineImageXObject(e):u("Dependent image isn't ready yet")},paintInlineImageXObject:function(t,i){var n=t.width,r=t.height,s=g(t,this.forceDataSchema),o=document.createElementNS(a,"svg:rect");o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y","0"),o.setAttributeNS(null,"width",e(n)),o.setAttributeNS(null,"height",e(r)),this.current.element=o,this.clip("nonzero");var c=document.createElementNS(a,"svg:image");c.setAttributeNS(v,"xlink:href",s),c.setAttributeNS(null,"x","0"),c.setAttributeNS(null,"y",e(-r)),c.setAttributeNS(null,"width",e(n)+"px"),c.setAttributeNS(null,"height",e(r)+"px"),c.setAttributeNS(null,"transform","scale("+e(1/n)+" "+e(-1/r)+")"),i?i.appendChild(c):this._ensureTransformGroup().appendChild(c)},paintImageMaskXObject:function(t){var i=this.current,n=t.width,r=t.height,s=i.fillColor;i.maskId="mask"+y++;var o=document.createElementNS(a,"svg:mask");o.setAttributeNS(null,"id",i.maskId);var c=document.createElementNS(a,"svg:rect");c.setAttributeNS(null,"x","0"),c.setAttributeNS(null,"y","0"),c.setAttributeNS(null,"width",e(n)),c.setAttributeNS(null,"height",e(r)),c.setAttributeNS(null,"fill",s),c.setAttributeNS(null,"mask","url(#"+i.maskId+")"),this.defs.appendChild(o),this._ensureTransformGroup().appendChild(c),this.paintInlineImageXObject(t,o)},paintFormXObjectBegin:function(t,i){if(l(t)&&6===t.length&&this.transform(t[0],t[1],t[2],t[3],t[4],t[5]),l(i)&&4===i.length){var n=i[2]-i[0],r=i[3]-i[1],s=document.createElementNS(a,"svg:rect");s.setAttributeNS(null,"x",i[0]),s.setAttributeNS(null,"y",i[1]),s.setAttributeNS(null,"width",e(n)),s.setAttributeNS(null,"height",e(r)),this.current.element=s,this.clip("nonzero"),this.endPath()}},paintFormXObjectEnd:function(){},_initialize:function(t){var e=document.createElementNS(a,"svg:svg");e.setAttributeNS(null,"version","1.1"),e.setAttributeNS(null,"width",t.width+"px"),e.setAttributeNS(null,"height",t.height+"px"),e.setAttributeNS(null,"preserveAspectRatio","none"),e.setAttributeNS(null,"viewBox","0 0 "+t.width+" "+t.height);var n=document.createElementNS(a,"svg:defs");e.appendChild(n),this.defs=n;var r=document.createElementNS(a,"svg:g");return r.setAttributeNS(null,"transform",i(t.transform)),e.appendChild(r),this.svg=r,e},_ensureClipGroup:function(){if(!this.current.clipGroup){var t=document.createElementNS(a,"svg:g");t.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(t),this.current.clipGroup=t}return this.current.clipGroup},_ensureTransformGroup:function(){return this.tgrp||(this.tgrp=document.createElementNS(a,"svg:g"),this.tgrp.setAttributeNS(null,"transform",i(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}},n}();e.SVGGraphics=v},function(t,e,i){"use strict";var n=i(0),r=i(1),s=n.Util,a=n.createPromiseCapability,o=r.CustomStyle,c=r.getDefaultSetting,h=function(){function t(t){return!f.test(t)}function e(e,i,n){var r=document.createElement("div"),a={style:null,angle:0,canvasWidth:0,isWhitespace:!1,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1};if(e._textDivs.push(r),t(i.str))return a.isWhitespace=!0,void e._textDivProperties.set(r,a);var o=s.transform(e._viewport.transform,i.transform),h=Math.atan2(o[1],o[0]),l=n[i.fontName];l.vertical&&(h+=Math.PI/2);var u=Math.sqrt(o[2]*o[2]+o[3]*o[3]),f=u;l.ascent?f=l.ascent*f:l.descent&&(f=(1+l.descent)*f);var g,p;if(0===h?(g=o[4],p=o[5]-f):(g=o[4]+f*Math.sin(h),p=o[5]-f*Math.cos(h)),d[1]=g,d[3]=p,d[5]=u,d[7]=l.fontFamily,a.style=d.join(""),r.setAttribute("style",a.style),r.textContent=i.str,c("pdfBug")&&(r.dataset.fontName=i.fontName),0!==h&&(a.angle=h*(180/Math.PI)),i.str.length>1&&(l.vertical?a.canvasWidth=i.height*e._viewport.scale:a.canvasWidth=i.width*e._viewport.scale),e._textDivProperties.set(r,a),e._enhanceTextSelection){var v=1,m=0;0!==h&&(v=Math.cos(h),m=Math.sin(h));var _,b,y=(l.vertical?i.height:i.width)*e._viewport.scale,x=u;0!==h?(_=[v,m,-m,v,g,p],b=s.getAxialAlignedBoundingBox([0,0,y,x],_)):b=[g,p,g+y,p+x],e._bounds.push({left:b[0],top:b[1],right:b[2],bottom:b[3],div:r,size:[y,x],m:_})}}function i(t){if(!t._canceled){var e=t._container,i=t._textDivs,n=t._capability,r=i.length;if(r>u)return t._renderingDone=!0,void n.resolve();var s=document.createElement("canvas");s.mozOpaque=!0;for(var a,c,h=s.getContext("2d",{alpha:!1}),l=0;l<r;l++){var f=i[l],d=t._textDivProperties.get(f);if(!d.isWhitespace){var g=f.style.fontSize,p=f.style.fontFamily;g===a&&p===c||(h.font=g+" "+p,a=g,c=p);var v=h.measureText(f.textContent).width;e.appendChild(f);var m="";0!==d.canvasWidth&&v>0&&(d.scale=d.canvasWidth/v,m="scaleX("+d.scale+")"),0!==d.angle&&(m="rotate("+d.angle+"deg) "+m),""!==m&&(d.originalTransform=m,o.setProp("transform",f,m)),t._textDivProperties.set(f,d)}}t._renderingDone=!0,n.resolve()}}function n(t){for(var e=t._bounds,i=t._viewport,n=r(i.width,i.height,e),a=0;a<n.length;a++){var o=e[a].div,c=t._textDivProperties.get(o);if(0!==c.angle){var h=n[a],l=e[a],u=l.m,f=u[0],d=u[1],g=[[0,0],[0,l.size[1]],[l.size[0],0],l.size],p=new Float64Array(64);g.forEach(function(t,e){var i=s.applyTransform(t,u);p[e+0]=f&&(h.left-i[0])/f,p[e+4]=d&&(h.top-i[1])/d,p[e+8]=f&&(h.right-i[0])/f,p[e+12]=d&&(h.bottom-i[1])/d,p[e+16]=d&&(h.left-i[0])/-d,p[e+20]=f&&(h.top-i[1])/f,p[e+24]=d&&(h.right-i[0])/-d,p[e+28]=f&&(h.bottom-i[1])/f,p[e+32]=f&&(h.left-i[0])/-f,p[e+36]=d&&(h.top-i[1])/-d,p[e+40]=f&&(h.right-i[0])/-f,p[e+44]=d&&(h.bottom-i[1])/-d,p[e+48]=d&&(h.left-i[0])/d,p[e+52]=f&&(h.top-i[1])/-f,p[e+56]=d&&(h.right-i[0])/d,p[e+60]=f&&(h.bottom-i[1])/-f});var v=function(t,e,i){for(var n=0,r=0;r<i;r++){var s=t[e++];s>0&&(n=n?Math.min(s,n):s)}return n},m=1+Math.min(Math.abs(f),Math.abs(d));c.paddingLeft=v(p,32,16)/m,c.paddingTop=v(p,48,16)/m,c.paddingRight=v(p,0,16)/m,c.paddingBottom=v(p,16,16)/m,t._textDivProperties.set(o,c)}else c.paddingLeft=e[a].left-n[a].left,c.paddingTop=e[a].top-n[a].top,c.paddingRight=n[a].right-e[a].right,c.paddingBottom=n[a].bottom-e[a].bottom,t._textDivProperties.set(o,c)}}function r(t,e,i){var n=i.map(function(t,e){return{x1:t.left,y1:t.top,x2:t.right,y2:t.bottom,index:e,x1New:void 0,x2New:void 0}});h(t,n);var r=new Array(i.length);return n.forEach(function(t){var e=t.index;r[e]={left:t.x1New,top:0,right:t.x2New,bottom:0}}),i.map(function(e,i){var s=r[i],a=n[i];a.x1=e.top,a.y1=t-s.right,a.x2=e.bottom,a.y2=t-s.left,a.index=i,a.x1New=void 0,a.x2New=void 0}),h(e,n),n.forEach(function(t){var e=t.index;r[e].top=t.x1New,r[e].bottom=t.x2New}),r}function h(t,e){e.sort(function(t,e){return t.x1-e.x1||t.index-e.index});var i=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];e.forEach(function(t){for(var e=0;e<i.length&&i[e].end<=t.y1;)e++;for(var n=i.length-1;n>=0&&i[n].start>=t.y2;)n--;var r,s,a,o,c=-1/0;for(a=e;a<=n;a++){var h;(h=(s=(r=i[a]).boundary).x2>t.x1?s.index>t.index?s.x1New:t.x1:void 0===s.x2New?(s.x2+t.x1)/2:s.x2New)>c&&(c=h)}for(t.x1New=c,a=e;a<=n;a++)void 0===(s=(r=i[a]).boundary).x2New?s.x2>t.x1?s.index>t.index&&(s.x2New=s.x2):s.x2New=c:s.x2New>c&&(s.x2New=Math.max(c,s.x2));var l=[],u=null;for(a=e;a<=n;a++){var f=(s=(r=i[a]).boundary).x2>t.x2?s:t;u===f?l[l.length-1].end=r.end:(l.push({start:r.start,end:r.end,boundary:f}),u=f)}for(i[e].start<t.y1&&(l[0].start=t.y1,l.unshift({start:i[e].start,end:t.y1,boundary:i[e].boundary})),t.y2<i[n].end&&(l[l.length-1].end=t.y2,l.push({start:t.y2,end:i[n].end,boundary:i[n].boundary})),a=e;a<=n;a++)if(r=i[a],void 0===(s=r.boundary).x2New){var d=!1;for(o=e-1;!d&&o>=0&&i[o].start>=s.y1;o--)d=i[o].boundary===s;for(o=n+1;!d&&o<i.length&&i[o].end<=s.y2;o++)d=i[o].boundary===s;for(o=0;!d&&o<l.length;o++)d=l[o].boundary===s;d||(s.x2New=c)}Array.prototype.splice.apply(i,[e,n-e+1].concat(l))}),i.forEach(function(e){var i=e.boundary;void 0===i.x2New&&(i.x2New=Math.max(t,i.x2))})}function l(t,e,i,n,r){this._textContent=t,this._container=e,this._viewport=i,this._textDivs=n||[],this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=a(),this._renderTimer=null,this._bounds=[],this._enhanceTextSelection=!!r}var u=1e5,f=/\S/,d=["left: ",0,"px; top: ",0,"px; font-size: ",0,"px; font-family: ","",";"];return l.prototype={get promise(){return this._capability.promise},cancel:function(){this._canceled=!0,null!==this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject("canceled")},_render:function(t){for(var n=this._textContent.items,r=this._textContent.styles,s=0,a=n.length;s<a;s++)e(this,n[s],r);if(t){var o=this;this._renderTimer=setTimeout(function(){i(o),o._renderTimer=null},t)}else i(this)},expandTextDivs:function(t){if(this._enhanceTextSelection&&this._renderingDone){null!==this._bounds&&(n(this),this._bounds=null);for(var e=0,i=this._textDivs.length;e<i;e++){var r=this._textDivs[e],s=this._textDivProperties.get(r);if(!s.isWhitespace)if(t){var a="",c="";1!==s.scale&&(a="scaleX("+s.scale+")"),0!==s.angle&&(a="rotate("+s.angle+"deg) "+a),0!==s.paddingLeft&&(c+=" padding-left: "+s.paddingLeft/s.scale+"px;",a+=" translateX("+-s.paddingLeft/s.scale+"px)"),0!==s.paddingTop&&(c+=" padding-top: "+s.paddingTop+"px;",a+=" translateY("+-s.paddingTop+"px)"),0!==s.paddingRight&&(c+=" padding-right: "+s.paddingRight/s.scale+"px;"),0!==s.paddingBottom&&(c+=" padding-bottom: "+s.paddingBottom+"px;"),""!==c&&r.setAttribute("style",s.style+c),""!==a&&o.setProp("transform",r,a)}else r.style.padding=0,o.setProp("transform",r,s.originalTransform||"")}}}},function(t){var e=new l(t.textContent,t.container,t.viewport,t.textDivs,t.enhanceTextSelection);return e._render(t.timeout),e}}();e.renderTextLayer=h},function(t,e,i){"use strict";var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,i){"use strict";function n(t){return t.replace(/>\\376\\377([^<]+)/g,function(t,e){for(var i=e.replace(/\\([0-3])([0-7])([0-7])/g,function(t,e,i,n){return String.fromCharCode(64*e+8*i+1*n)}),n="",r=0;r<i.length;r+=2){var s=256*i.charCodeAt(r)+i.charCodeAt(r+1);n+=s>=32&&s<127&&60!==s&&62!==s&&38!==s?String.fromCharCode(s):"&#x"+(65536+s).toString(16).substring(1)+";"}return">"+n})}function r(t){"string"==typeof t?(t=n(t),t=(new DOMParser).parseFromString(t,"application/xml")):t instanceof Document||s("Metadata: Invalid metadata object"),this.metaDocument=t,this.metadata=Object.create(null),this.parse()}var s=i(0).error;r.prototype={parse:function(){var t=this.metaDocument.documentElement;if("rdf:rdf"!==t.nodeName.toLowerCase())for(t=t.firstChild;t&&"rdf:rdf"!==t.nodeName.toLowerCase();)t=t.nextSibling;var e=t?t.nodeName.toLowerCase():null;if(t&&"rdf:rdf"===e&&t.hasChildNodes()){var i,n,r,s,a,o,c,h=t.childNodes;for(s=0,o=h.length;s<o;s++)if("rdf:description"===(i=h[s]).nodeName.toLowerCase())for(a=0,c=i.childNodes.length;a<c;a++)"#text"!==i.childNodes[a].nodeName.toLowerCase()&&(r=(n=i.childNodes[a]).nodeName.toLowerCase(),this.metadata[r]=n.textContent.trim())}},get:function(t){return this.metadata[t]||null},has:function(t){return void 0!==this.metadata[t]}},e.Metadata=r},function(t,e,i){"use strict";var n=i(0),r=i(1),s=n.shadow,a=r.getDefaultSetting,o=function(){function t(t,e,i){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(n);throw new Error("Error during shader compilation: "+r)}return n}function e(e,i){return t(e,i,e.VERTEX_SHADER)}function i(e,i){return t(e,i,e.FRAGMENT_SHADER)}function n(t,e){for(var i=t.createProgram(),n=0,r=e.length;n<r;++n)t.attachShader(i,e[n]);if(t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){var s=t.getProgramInfoLog(i);throw new Error("Error during program linking: "+s)}return i}function r(t,e,i){t.activeTexture(i);var n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),n}function o(){l||(u=document.createElement("canvas"),l=u.getContext("webgl",{premultipliedalpha:!1}))}function c(){var t,r;o(),t=u,u=null,r=l,l=null;var s=n(r,[e(r,f),i(r,d)]);r.useProgram(s);var a={};a.gl=r,a.canvas=t,a.resolutionLocation=r.getUniformLocation(s,"u_resolution"),a.positionLocation=r.getAttribLocation(s,"a_position"),a.backdropLocation=r.getUniformLocation(s,"u_backdrop"),a.subtypeLocation=r.getUniformLocation(s,"u_subtype");var c=r.getAttribLocation(s,"a_texCoord"),h=r.getUniformLocation(s,"u_image"),p=r.getUniformLocation(s,"u_mask"),v=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,v),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(c),r.vertexAttribPointer(c,2,r.FLOAT,!1,0,0),r.uniform1i(h,0),r.uniform1i(p,1),g=a}function h(){var t,r;o(),t=u,u=null,r=l,l=null;var s=n(r,[e(r,p),i(r,v)]);r.useProgram(s);var a={};a.gl=r,a.canvas=t,a.resolutionLocation=r.getUniformLocation(s,"u_resolution"),a.scaleLocation=r.getUniformLocation(s,"u_scale"),a.offsetLocation=r.getUniformLocation(s,"u_offset"),a.positionLocation=r.getAttribLocation(s,"a_position"),a.colorLocation=r.getAttribLocation(s,"a_color"),m=a}var l,u,f="  attribute vec2 a_position;                                      attribute vec2 a_texCoord;                                                                                                      uniform vec2 u_resolution;                                                                                                      varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;       gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_texCoord = a_texCoord;                                      }                                                             ",d="  precision mediump float;                                                                                                        uniform vec4 u_backdrop;                                        uniform int u_subtype;                                          uniform sampler2D u_image;                                      uniform sampler2D u_mask;                                                                                                       varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec4 imageColor = texture2D(u_image, v_texCoord);               vec4 maskColor = texture2D(u_mask, v_texCoord);                 if (u_backdrop.a > 0.0) {                                         maskColor.rgb = maskColor.rgb * maskColor.a +                                   u_backdrop.rgb * (1.0 - maskColor.a);         }                                                               float lum;                                                      if (u_subtype == 0) {                                             lum = maskColor.a;                                            } else {                                                          lum = maskColor.r * 0.3 + maskColor.g * 0.59 +                        maskColor.b * 0.11;                                     }                                                               imageColor.a *= lum;                                            imageColor.rgb *= imageColor.a;                                 gl_FragColor = imageColor;                                    }                                                             ",g=null,p="  attribute vec2 a_position;                                      attribute vec3 a_color;                                                                                                         uniform vec2 u_resolution;                                      uniform vec2 u_scale;                                           uniform vec2 u_offset;                                                                                                          varying vec4 v_color;                                                                                                           void main() {                                                     vec2 position = (a_position + u_offset) * u_scale;              vec2 clipSpace = (position / u_resolution) * 2.0 - 1.0;         gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_color = vec4(a_color / 255.0, 1.0);                         }                                                             ",v="  precision mediump float;                                                                                                        varying vec4 v_color;                                                                                                           void main() {                                                     gl_FragColor = v_color;                                       }                                                             ",m=null;return{get isEnabled(){if(a("disableWebGL"))return!1;var t=!1;try{o(),t=!!l}catch(t){}return s(this,"isEnabled",t)},composeSMask:function(t,e,i){var n=t.width,s=t.height;g||c();var a=g,o=a.canvas,h=a.gl;o.width=n,o.height=s,h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight),h.uniform2f(a.resolutionLocation,n,s),i.backdrop?h.uniform4f(a.resolutionLocation,i.backdrop[0],i.backdrop[1],i.backdrop[2],1):h.uniform4f(a.resolutionLocation,0,0,0,0),h.uniform1i(a.subtypeLocation,"Luminosity"===i.subtype?1:0);var l=r(h,t,h.TEXTURE0),u=r(h,e,h.TEXTURE1),f=h.createBuffer();return h.bindBuffer(h.ARRAY_BUFFER,f),h.bufferData(h.ARRAY_BUFFER,new Float32Array([0,0,n,0,0,s,0,s,n,0,n,s]),h.STATIC_DRAW),h.enableVertexAttribArray(a.positionLocation),h.vertexAttribPointer(a.positionLocation,2,h.FLOAT,!1,0,0),h.clearColor(0,0,0,0),h.enable(h.BLEND),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA),h.clear(h.COLOR_BUFFER_BIT),h.drawArrays(h.TRIANGLES,0,6),h.flush(),h.deleteTexture(l),h.deleteTexture(u),h.deleteBuffer(f),o},drawFigures:function(t,e,i,n,r){m||h();var s=m,a=s.canvas,o=s.gl;a.width=t,a.height=e,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.uniform2f(s.resolutionLocation,t,e);var c,l,u,f=0;for(c=0,l=n.length;c<l;c++)switch(n[c].type){case"lattice":f+=((u=n[c].coords.length/n[c].verticesPerRow|0)-1)*(n[c].verticesPerRow-1)*6;break;case"triangles":f+=n[c].coords.length}var d=new Float32Array(2*f),g=new Uint8Array(3*f),p=r.coords,v=r.colors,_=0,b=0;for(c=0,l=n.length;c<l;c++){var y=n[c],x=y.coords,w=y.colors;switch(y.type){case"lattice":var C=y.verticesPerRow;u=x.length/C|0;for(var A=1;A<u;A++)for(var S=A*C+1,T=1;T<C;T++,S++)d[_]=p[x[S-C-1]],d[_+1]=p[x[S-C-1]+1],d[_+2]=p[x[S-C]],d[_+3]=p[x[S-C]+1],d[_+4]=p[x[S-1]],d[_+5]=p[x[S-1]+1],g[b]=v[w[S-C-1]],g[b+1]=v[w[S-C-1]+1],g[b+2]=v[w[S-C-1]+2],g[b+3]=v[w[S-C]],g[b+4]=v[w[S-C]+1],g[b+5]=v[w[S-C]+2],g[b+6]=v[w[S-1]],g[b+7]=v[w[S-1]+1],g[b+8]=v[w[S-1]+2],d[_+6]=d[_+2],d[_+7]=d[_+3],d[_+8]=d[_+4],d[_+9]=d[_+5],d[_+10]=p[x[S]],d[_+11]=p[x[S]+1],g[b+9]=g[b+3],g[b+10]=g[b+4],g[b+11]=g[b+5],g[b+12]=g[b+6],g[b+13]=g[b+7],g[b+14]=g[b+8],g[b+15]=v[w[S]],g[b+16]=v[w[S]+1],g[b+17]=v[w[S]+2],_+=12,b+=18;break;case"triangles":for(var k=0,O=x.length;k<O;k++)d[_]=p[x[k]],d[_+1]=p[x[k]+1],g[b]=v[w[k]],g[b+1]=v[w[k]+1],g[b+2]=v[w[k]+2],_+=2,b+=3}}i?o.clearColor(i[0]/255,i[1]/255,i[2]/255,1):o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT);var P=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,P),o.bufferData(o.ARRAY_BUFFER,d,o.STATIC_DRAW),o.enableVertexAttribArray(s.positionLocation),o.vertexAttribPointer(s.positionLocation,2,o.FLOAT,!1,0,0);var E=o.createBuffer();return o.bindBuffer(o.ARRAY_BUFFER,E),o.bufferData(o.ARRAY_BUFFER,g,o.STATIC_DRAW),o.enableVertexAttribArray(s.colorLocation),o.vertexAttribPointer(s.colorLocation,3,o.UNSIGNED_BYTE,!1,0,0),o.uniform2f(s.scaleLocation,r.scaleX,r.scaleY),o.uniform2f(s.offsetLocation,r.offsetX,r.offsetY),o.drawArrays(o.TRIANGLES,0,f),o.flush(),o.deleteBuffer(P),o.deleteBuffer(E),a},clear:function(){g&&g.canvas&&(g.canvas.width=0,g.canvas.height=0),m&&m.canvas&&(m.canvas.width=0,m.canvas.height=0),g=null,m=null}}}();e.WebGLUtils=o},function(t,e,i){"use strict";var n=i(0),r=i(1),s=i(3),a=i(2),o=i(5),c=i(7),h=i(4),l=n.globalScope,u=n.deprecated,f=n.warn,d=r.LinkTarget,g=r.DEFAULT_LINK_REL,p="undefined"==typeof window;l.PDFJS||(l.PDFJS={});var v=l.PDFJS;v.version="1.8.188",v.build="ad1023ff",v.pdfBug=!1,void 0!==v.verbosity&&n.setVerbosityLevel(v.verbosity),delete v.verbosity,Object.defineProperty(v,"verbosity",{get:function(){return n.getVerbosityLevel()},set:function(t){n.setVerbosityLevel(t)},enumerable:!0,configurable:!0}),v.VERBOSITY_LEVELS=n.VERBOSITY_LEVELS,v.OPS=n.OPS,v.UNSUPPORTED_FEATURES=n.UNSUPPORTED_FEATURES,v.isValidUrl=r.isValidUrl,v.shadow=n.shadow,v.createBlob=n.createBlob,v.createObjectURL=function(t,e){return n.createObjectURL(t,e,v.disableCreateObjectURL)},Object.defineProperty(v,"isLittleEndian",{configurable:!0,get:function(){var t=n.isLittleEndian();return n.shadow(v,"isLittleEndian",t)}}),v.removeNullCharacters=n.removeNullCharacters,v.PasswordResponses=n.PasswordResponses,v.PasswordException=n.PasswordException,v.UnknownErrorException=n.UnknownErrorException,v.InvalidPDFException=n.InvalidPDFException,v.MissingPDFException=n.MissingPDFException,v.UnexpectedResponseException=n.UnexpectedResponseException,v.Util=n.Util,v.PageViewport=n.PageViewport,v.createPromiseCapability=n.createPromiseCapability,v.maxImageSize=void 0===v.maxImageSize?-1:v.maxImageSize,v.cMapUrl=void 0===v.cMapUrl?null:v.cMapUrl,v.cMapPacked=void 0!==v.cMapPacked&&v.cMapPacked,v.disableFontFace=void 0!==v.disableFontFace&&v.disableFontFace,v.imageResourcesPath=void 0===v.imageResourcesPath?"":v.imageResourcesPath,v.disableWorker=void 0!==v.disableWorker&&v.disableWorker,v.workerSrc=void 0===v.workerSrc?null:v.workerSrc,v.workerPort=void 0===v.workerPort?null:v.workerPort,v.disableRange=void 0!==v.disableRange&&v.disableRange,v.disableStream=void 0!==v.disableStream&&v.disableStream,v.disableAutoFetch=void 0!==v.disableAutoFetch&&v.disableAutoFetch,v.pdfBug=void 0!==v.pdfBug&&v.pdfBug,v.postMessageTransfers=void 0===v.postMessageTransfers||v.postMessageTransfers,v.disableCreateObjectURL=void 0!==v.disableCreateObjectURL&&v.disableCreateObjectURL,v.disableWebGL=void 0===v.disableWebGL||v.disableWebGL,v.externalLinkTarget=void 0===v.externalLinkTarget?d.NONE:v.externalLinkTarget,v.externalLinkRel=void 0===v.externalLinkRel?g:v.externalLinkRel,v.isEvalSupported=void 0===v.isEvalSupported||v.isEvalSupported,v.pdfjsNext=void 0!==v.pdfjsNext&&v.pdfjsNext;var m=v.openExternalLinksInNewWindow;delete v.openExternalLinksInNewWindow,Object.defineProperty(v,"openExternalLinksInNewWindow",{get:function(){return v.externalLinkTarget===d.BLANK},set:function(t){t&&u('PDFJS.openExternalLinksInNewWindow, please use "PDFJS.externalLinkTarget = PDFJS.LinkTarget.BLANK" instead.'),v.externalLinkTarget===d.NONE?v.externalLinkTarget=t?d.BLANK:d.NONE:f("PDFJS.externalLinkTarget is already initialized")},enumerable:!0,configurable:!0}),m&&(v.openExternalLinksInNewWindow=m),v.getDocument=s.getDocument,v.PDFDataRangeTransport=s.PDFDataRangeTransport,v.PDFWorker=s.PDFWorker,Object.defineProperty(v,"hasCanvasTypedArrays",{configurable:!0,get:function(){var t=r.hasCanvasTypedArrays();return n.shadow(v,"hasCanvasTypedArrays",t)}}),v.CustomStyle=r.CustomStyle,v.LinkTarget=d,v.addLinkAttributes=r.addLinkAttributes,v.getFilenameFromUrl=r.getFilenameFromUrl,v.isExternalLinkTargetSet=r.isExternalLinkTargetSet,v.AnnotationLayer=a.AnnotationLayer,v.renderTextLayer=o.renderTextLayer,v.Metadata=c.Metadata,v.SVGGraphics=h.SVGGraphics,v.UnsupportedManager=s._UnsupportedManager,e.globalScope=l,e.isWorker=p,e.PDFJS=l.PDFJS},function(t,e,i){"use strict";function n(t){t.mozCurrentTransform||(t._originalSave=t.save,t._originalRestore=t.restore,t._originalRotate=t.rotate,t._originalScale=t.scale,t._originalTranslate=t.translate,t._originalTransform=t.transform,t._originalSetTransform=t.setTransform,t._transformMatrix=t._transformMatrix||[1,0,0,1,0,0],t._transformStack=[],Object.defineProperty(t,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(t,"mozCurrentTransformInverse",{get:function(){var t=this._transformMatrix,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=e*r-i*n,c=i*n-e*r;return[r/o,i/c,n/c,e/o,(r*s-n*a)/c,(i*s-e*a)/o]}}),t.save=function(){var t=this._transformMatrix;this._transformStack.push(t),this._transformMatrix=t.slice(0,6),this._originalSave()},t.restore=function(){var t=this._transformStack.pop();t&&(this._transformMatrix=t,this._originalRestore())},t.translate=function(t,e){var i=this._transformMatrix;i[4]=i[0]*t+i[2]*e+i[4],i[5]=i[1]*t+i[3]*e+i[5],this._originalTranslate(t,e)},t.scale=function(t,e){var i=this._transformMatrix;i[0]=i[0]*t,i[1]=i[1]*t,i[2]=i[2]*e,i[3]=i[3]*e,this._originalScale(t,e)},t.transform=function(e,i,n,r,s,a){var o=this._transformMatrix;this._transformMatrix=[o[0]*e+o[2]*i,o[1]*e+o[3]*i,o[0]*n+o[2]*r,o[1]*n+o[3]*r,o[0]*s+o[2]*a+o[4],o[1]*s+o[3]*a+o[5]],t._originalTransform(e,i,n,r,s,a)},t.setTransform=function(e,i,n,r,s,a){this._transformMatrix=[e,i,n,r,s,a],t._originalSetTransform(e,i,n,r,s,a)},t.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this._transformMatrix;this._transformMatrix=[n[0]*e+n[2]*i,n[1]*e+n[3]*i,n[0]*-i+n[2]*e,n[1]*-i+n[3]*e,n[4],n[5]],this._originalRotate(t)})}function r(t){var e,i,n,r,s=t.width,a=t.height,o=s+1,c=new Uint8Array(o*(a+1)),h=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),l=s+7&-8,u=t.data,f=new Uint8Array(l*a),d=0;for(e=0,r=u.length;e<r;e++)for(var g=128,p=u[e];g>0;)f[d++]=p&g?0:255,g>>=1;var v=0;for(0!==f[d=0]&&(c[0]=1,++v),i=1;i<s;i++)f[d]!==f[d+1]&&(c[i]=f[d]?2:1,++v),d++;for(0!==f[d]&&(c[i]=2,++v),e=1;e<a;e++){n=e*o,f[(d=e*l)-l]!==f[d]&&(c[n]=f[d]?1:8,++v);var m=(f[d]?4:0)+(f[d-l]?8:0);for(i=1;i<s;i++)h[m=(m>>2)+(f[d+1]?4:0)+(f[d-l+1]?8:0)]&&(c[n+i]=h[m],++v),d++;if(f[d-l]!==f[d]&&(c[n+i]=f[d]?2:4,++v),v>1e3)return null}for(n=e*o,0!==f[d=l*(a-1)]&&(c[n]=8,++v),i=1;i<s;i++)f[d]!==f[d+1]&&(c[n+i]=f[d]?4:8,++v),d++;if(0!==f[d]&&(c[n+i]=4,++v),v>1e3)return null;var _=new Int32Array([0,o,-1,0,-o,0,0,0,1]),b=[];for(e=0;v&&e<=a;e++){for(var y=e*o,x=y+s;y<x&&!c[y];)y++;if(y!==x){var w,C=[y%o,e],A=c[y],S=y;do{var T=_[A];do{y+=T}while(!c[y]);5!==(w=c[y])&&10!==w?(A=w,c[y]=0):(A=w&51*A>>4,c[y]&=A>>2|A<<2),C.push(y%o),C.push(y/o|0),--v}while(S!==y);b.push(C),--e}}return function(t){t.save(),t.scale(1/s,-1/a),t.translate(0,-a),t.beginPath();for(var e=0,i=b.length;e<i;e++){var n=b[e];t.moveTo(n[0],n[1]);for(var r=2,o=n.length;r<o;r+=2)t.lineTo(n[r],n[r+1])}t.fill(),t.beginPath(),t.restore()}}var s=i(0),a=i(1),o=i(12),c=i(8),h=s.FONT_IDENTITY_MATRIX,l=s.IDENTITY_MATRIX,u=s.ImageKind,f=s.OPS,d=s.TextRenderingMode,g=s.Uint32ArrayView,p=s.Util,v=s.assert,m=s.info,_=s.isNum,b=s.isArray,y=s.isLittleEndian,x=s.error,w=s.shadow,C=s.warn,A=o.TilingPattern,S=o.getShadingPatternFromIR,T=c.WebGLUtils,k=a.hasCanvasTypedArrays,O=16,P={get value(){return w(P,"value",k())}},E={get value(){return w(E,"value",y())}},L=function(){function t(t){this.canvasFactory=t,this.cache=Object.create(null)}return t.prototype={getCanvas:function(t,e,i,r){var s;return void 0!==this.cache[t]?(s=this.cache[t],this.canvasFactory.reset(s,e,i),s.context.setTransform(1,0,0,1,0,0)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),r&&n(s.context),s},clear:function(){for(var t in this.cache){var e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}},t}(),I=function(){function t(t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=l,this.textMatrixScale=1,this.fontMatrix=h,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=d.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.resumeSMaskCtx=null,this.old=t}return t.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(t,e){this.x=t,this.y=e}},t}(),M=function(){function t(t,e,i,r,s){this.ctx=t,this.current=new I,this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=r,this.imageLayer=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.cachedCanvases=new L(this.canvasFactory),t&&n(t),this.cachedGetSinglePixelWidth=null}function e(t,e){if("undefined"!=typeof ImageData&&e instanceof ImageData)t.putImageData(e,0,0);else{var i,n,r,s,a,o=e.height,c=e.width,h=o%O,l=(o-h)/O,f=0===h?l:l+1,d=t.createImageData(c,O),p=0,v=e.data,m=d.data;if(e.kind===u.GRAYSCALE_1BPP){var _=v.byteLength,b=P.value?new Uint32Array(m.buffer):new g(m),y=b.length,w=c+7>>3,C=4294967295,A=E.value||!P.value?4278190080:255;for(n=0;n<f;n++){for(s=n<l?O:h,i=0,r=0;r<s;r++){for(var S=_-p,T=0,k=S>w?c:8*S-7,L=-8&k,I=0,M=0;T<L;T+=8)M=v[p++],b[i++]=128&M?C:A,b[i++]=64&M?C:A,b[i++]=32&M?C:A,b[i++]=16&M?C:A,b[i++]=8&M?C:A,b[i++]=4&M?C:A,b[i++]=2&M?C:A,b[i++]=1&M?C:A;for(;T<k;T++)0===I&&(M=v[p++],I=128),b[i++]=M&I?C:A,I>>=1}for(;i<y;)b[i++]=0;t.putImageData(d,0,n*O)}}else if(e.kind===u.RGBA_32BPP){for(r=0,a=c*O*4,n=0;n<l;n++)m.set(v.subarray(p,p+a)),p+=a,t.putImageData(d,0,r),r+=O;n<f&&(a=c*h*4,m.set(v.subarray(p,p+a)),t.putImageData(d,0,r))}else if(e.kind===u.RGB_24BPP)for(a=c*(s=O),n=0;n<f;n++){for(n>=l&&(a=c*(s=h)),i=0,r=a;r--;)m[i++]=v[p++],m[i++]=v[p++],m[i++]=v[p++],m[i++]=255;t.putImageData(d,0,n*O)}else x("bad image kind: "+e.kind)}}function i(t,e){for(var i=e.height,n=e.width,r=i%O,s=(i-r)/O,a=0===r?s:s+1,o=t.createImageData(n,O),c=0,h=e.data,l=o.data,u=0;u<a;u++){for(var f=u<s?O:r,d=3,g=0;g<f;g++)for(var p=0,v=0;v<n;v++){if(!p){var m=h[c++];p=128}l[d]=m&p?0:255,d+=4,p>>=1}t.putImageData(o,0,u*O)}}function s(t,e){for(var i=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"],n=0,r=i.length;n<r;n++){var s=i[n];void 0!==t[s]&&(e[s]=t[s])}void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function a(t,e,i,n){for(var r=t.length,s=3;s<r;s+=4){var a=t[s];if(0===a)t[s-3]=e,t[s-2]=i,t[s-1]=n;else if(a<255){var o=255-a;t[s-3]=t[s-3]*a+e*o>>8,t[s-2]=t[s-2]*a+i*o>>8,t[s-1]=t[s-1]*a+n*o>>8}}}function o(t,e,i){for(var n=t.length,r=3;r<n;r+=4){var s=i?i[t[r]]:t[r];e[r]=e[r]*s*(1/255)|0}}function c(t,e,i){for(var n=t.length,r=3;r<n;r+=4){var s=77*t[r-3]+152*t[r-2]+28*t[r-1];e[r]=i?e[r]*i[s>>8]>>8:e[r]*s>>16}}function y(t,e,i,n,r,s,h){var l,u=!!s,f=u?s[0]:0,d=u?s[1]:0,g=u?s[2]:0;l="Luminosity"===r?c:o;for(var p=Math.min(n,Math.ceil(1048576/i)),v=0;v<n;v+=p){var m=Math.min(p,n-v),_=t.getImageData(0,v,i,m),b=e.getImageData(0,v,i,m);u&&a(_.data,f,d,g),l(_.data,b.data,h),t.putImageData(b,0,v)}}function k(t,e,i){var n=e.canvas,r=e.context;t.setTransform(e.scaleX,0,0,e.scaleY,e.offsetX,e.offsetY);var s=e.backdrop||null;if(!e.transferMap&&T.isEnabled){var a=T.composeSMask(i.canvas,n,{subtype:e.subtype,backdrop:s});return t.setTransform(1,0,0,1,0,0),void t.drawImage(a,e.offsetX,e.offsetY)}y(r,i,n.width,n.height,e.subtype,s,e.transferMap),t.drawImage(n,0,0)}var M=["butt","round","square"],D=["miter","round","bevel"],F={},j={};t.prototype={beginDrawing:function(t,e,i){var n=this.ctx.canvas.width,r=this.ctx.canvas.height;if(this.ctx.save(),this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(0,0,n,r),this.ctx.restore(),i){var s=this.cachedCanvases.getCanvas("transparent",n,r,!0);this.compositeCtx=this.ctx,this.transparentCanvas=s.canvas,this.ctx=s.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform)}this.ctx.save(),t&&this.ctx.transform.apply(this.ctx,t),this.ctx.transform.apply(this.ctx,e.transform),this.baseTransform=this.ctx.mozCurrentTransform.slice(),this.imageLayer&&this.imageLayer.beginLayout()},executeOperatorList:function(t,e,i,n){var r=t.argsArray,s=t.fnArray,a=e||0,o=r.length;if(o===a)return a;for(var c,h=o-a>10&&"function"==typeof i,l=h?Date.now()+15:0,u=0,d=this.commonObjs,g=this.objs;;){if(void 0!==n&&a===n.nextBreakPoint)return n.breakIt(a,i),a;if((c=s[a])!==f.dependency)this[c].apply(this,r[a]);else for(var p=r[a],v=0,m=p.length;v<m;v++){var _=p[v],b="g"===_[0]&&"_"===_[1]?d:g;if(!b.isResolved(_))return b.get(_,i),a}if(++a===o)return a;if(h&&++u>10){if(Date.now()>l)return i(),a;u=0}}},endDrawing:function(){null!==this.current.activeSMask&&this.endSMaskGroup(),this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null),this.cachedCanvases.clear(),T.clear(),this.imageLayer&&this.imageLayer.endLayout()},setLineWidth:function(t){this.current.lineWidth=t,this.ctx.lineWidth=t},setLineCap:function(t){this.ctx.lineCap=M[t]},setLineJoin:function(t){this.ctx.lineJoin=D[t]},setMiterLimit:function(t){this.ctx.miterLimit=t},setDash:function(t,e){var i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(t),i.lineDashOffset=e)},setRenderingIntent:function(t){},setFlatness:function(t){},setGState:function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e],r=n[0],s=n[1];switch(r){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=n[1];break;case"ca":this.current.fillAlpha=n[1],this.ctx.globalAlpha=n[1];break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask&&(this.stateStack.length>0&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask?this.suspendSMaskGroup():this.endSMaskGroup()),this.current.activeSMask=s?this.tempSMask:null,this.current.activeSMask&&this.beginSMaskGroup(),this.tempSMask=null}}},beginSMaskGroup:function(){var t=this.current.activeSMask,e=t.canvas.width,i=t.canvas.height,n="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(n,e,i,!0),a=this.ctx,o=a.mozCurrentTransform;this.ctx.save();var c=r.context;c.scale(1/t.scaleX,1/t.scaleY),c.translate(-t.offsetX,-t.offsetY),c.transform.apply(c,o),t.startTransformInverse=c.mozCurrentTransformInverse,s(a,c),this.ctx=c,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(a),this.groupLevel++},suspendSMaskGroup:function(){var t=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),k(this.ctx,this.current.activeSMask,t),this.ctx.restore(),this.ctx.save(),s(t,this.ctx),this.current.resumeSMaskCtx=t;var e=p.transform(this.current.activeSMask.startTransformInverse,t.mozCurrentTransform);this.ctx.transform.apply(this.ctx,e),t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.restore()},resumeSMaskGroup:function(){var t=this.current.resumeSMaskCtx,e=this.ctx;this.ctx=t,this.groupStack.push(e),this.groupLevel++},endSMaskGroup:function(){var t=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),k(this.ctx,this.current.activeSMask,t),this.ctx.restore(),s(t,this.ctx);var e=p.transform(this.current.activeSMask.startTransformInverse,t.mozCurrentTransform);this.ctx.transform.apply(this.ctx,e)},save:function(){this.ctx.save();var t=this.current;this.stateStack.push(t),this.current=t.clone(),this.current.resumeSMaskCtx=null},restore:function(){this.current.resumeSMaskCtx&&this.resumeSMaskGroup(),null===this.current.activeSMask||0!==this.stateStack.length&&this.stateStack[this.stateStack.length-1].activeSMask===this.current.activeSMask||this.endSMaskGroup(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.ctx.restore(),this.pendingClip=null,this.cachedGetSinglePixelWidth=null)},transform:function(t,e,i,n,r,s){this.ctx.transform(t,e,i,n,r,s),this.cachedGetSinglePixelWidth=null},constructPath:function(t,e){for(var i=this.ctx,n=this.current,r=n.x,s=n.y,a=0,o=0,c=t.length;a<c;a++)switch(0|t[a]){case f.rectangle:r=e[o++],s=e[o++];var h=e[o++],l=e[o++];0===h&&(h=this.getSinglePixelWidth()),0===l&&(l=this.getSinglePixelWidth());var u=r+h,d=s+l;this.ctx.moveTo(r,s),this.ctx.lineTo(u,s),this.ctx.lineTo(u,d),this.ctx.lineTo(r,d),this.ctx.lineTo(r,s),this.ctx.closePath();break;case f.moveTo:r=e[o++],s=e[o++],i.moveTo(r,s);break;case f.lineTo:r=e[o++],s=e[o++],i.lineTo(r,s);break;case f.curveTo:r=e[o+4],s=e[o+5],i.bezierCurveTo(e[o],e[o+1],e[o+2],e[o+3],r,s),o+=6;break;case f.curveTo2:i.bezierCurveTo(r,s,e[o],e[o+1],e[o+2],e[o+3]),r=e[o+2],s=e[o+3],o+=4;break;case f.curveTo3:r=e[o+2],s=e[o+3],i.bezierCurveTo(e[o],e[o+1],r,s,r,s),o+=4;break;case f.closePath:i.closePath()}n.setCurrentPoint(r,s)},closePath:function(){this.ctx.closePath()},stroke:function(t){t=void 0===t||t;var e=this.ctx,i=this.current.strokeColor;e.lineWidth=Math.max(.65*this.getSinglePixelWidth(),this.current.lineWidth),e.globalAlpha=this.current.strokeAlpha,i&&i.hasOwnProperty("type")&&"Pattern"===i.type?(e.save(),e.strokeStyle=i.getPattern(e,this),e.stroke(),e.restore()):e.stroke(),t&&this.consumePath(),e.globalAlpha=this.current.fillAlpha},closeStroke:function(){this.closePath(),this.stroke()},fill:function(t){t=void 0===t||t;var e=this.ctx,i=this.current.fillColor,n=!1;this.current.patternFill&&(e.save(),this.baseTransform&&e.setTransform.apply(e,this.baseTransform),e.fillStyle=i.getPattern(e,this),n=!0),this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill(),n&&e.restore(),t&&this.consumePath()},eoFill:function(){this.pendingEOFill=!0,this.fill()},fillStroke:function(){this.fill(!1),this.stroke(!1),this.consumePath()},eoFillStroke:function(){this.pendingEOFill=!0,this.fillStroke()},closeFillStroke:function(){this.closePath(),this.fillStroke()},closeEOFillStroke:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()},endPath:function(){this.consumePath()},clip:function(){this.pendingClip=F},eoClip:function(){this.pendingClip=j},beginText:function(){this.current.textMatrix=l,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},endText:function(){var t=this.pendingTextPaths,e=this.ctx;if(void 0!==t){e.save(),e.beginPath();for(var i=0;i<t.length;i++){var n=t[i];e.setTransform.apply(e,n.transform),e.translate(n.x,n.y),n.addToPath(e,n.fontSize)}e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}else e.beginPath()},setCharSpacing:function(t){this.current.charSpacing=t},setWordSpacing:function(t){this.current.wordSpacing=t},setHScale:function(t){this.current.textHScale=t/100},setLeading:function(t){this.current.leading=-t},setFont:function(t,e){var i=this.commonObjs.get(t),n=this.current;if(i||x("Can't find font for "+t),n.fontMatrix=i.fontMatrix?i.fontMatrix:h,0!==n.fontMatrix[0]&&0!==n.fontMatrix[3]||C("Invalid font matrix for font "+t),e<0?(e=-e,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=e,!i.isType3Font){var r=i.loadedName||"sans-serif",s=i.black?"900":i.bold?"bold":"normal",a=i.italic?"italic":"normal",o='"'+r+'", '+i.fallbackName,c=e<16?16:e>100?100:e;this.current.fontSizeScale=e/c;var l=a+" "+s+" "+c+"px "+o;this.ctx.font=l}},setTextRenderingMode:function(t){this.current.textRenderingMode=t},setTextRise:function(t){this.current.textRise=t},moveText:function(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e},setLeadingMoveText:function(t,e){this.setLeading(-e),this.moveText(t,e)},setTextMatrix:function(t,e,i,n,r,s){this.current.textMatrix=[t,e,i,n,r,s],this.current.textMatrixScale=Math.sqrt(t*t+e*e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},nextLine:function(){this.moveText(0,this.current.leading)},paintChar:function(t,e,i){var n,r=this.ctx,s=this.current,a=s.font,o=s.textRenderingMode,c=s.fontSize/s.fontSizeScale,h=o&d.FILL_STROKE_MASK,l=!!(o&d.ADD_TO_PATH_FLAG);(a.disableFontFace||l)&&(n=a.getPathGenerator(this.commonObjs,t)),a.disableFontFace?(r.save(),r.translate(e,i),r.beginPath(),n(r,c),h!==d.FILL&&h!==d.FILL_STROKE||r.fill(),h!==d.STROKE&&h!==d.FILL_STROKE||r.stroke(),r.restore()):(h!==d.FILL&&h!==d.FILL_STROKE||r.fillText(t,e,i),h!==d.STROKE&&h!==d.FILL_STROKE||r.strokeText(t,e,i)),l&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:r.mozCurrentTransform,x:e,y:i,fontSize:c,addToPath:n})},get isFontSubpixelAAEnabled(){var t=this.canvasFactory.create(10,10).context;t.scale(1.5,1),t.fillText("I",0,10);for(var e=t.getImageData(0,0,10,10).data,i=!1,n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){i=!0;break}return w(this,"isFontSubpixelAAEnabled",i)},showText:function(t){var e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);var n=e.fontSize;if(0!==n){var r=this.ctx,s=e.fontSizeScale,a=e.charSpacing,o=e.wordSpacing,c=e.fontDirection,h=e.textHScale*c,l=t.length,u=i.vertical,f=u?1:-1,g=i.defaultVMetrics,p=n*e.fontMatrix[0],v=e.textRenderingMode===d.FILL&&!i.disableFontFace;r.save(),r.transform.apply(r,e.textMatrix),r.translate(e.x,e.y+e.textRise),e.patternFill&&(r.fillStyle=e.fillColor.getPattern(r,this)),c>0?r.scale(h,-1):r.scale(h,1);var m=e.lineWidth,b=e.textMatrixScale;if(0===b||0===m){var y=e.textRenderingMode&d.FILL_STROKE_MASK;y!==d.STROKE&&y!==d.FILL_STROKE||(this.cachedGetSinglePixelWidth=null,m=.65*this.getSinglePixelWidth())}else m/=b;1!==s&&(r.scale(s,s),m/=s),r.lineWidth=m;var x,w=0;for(x=0;x<l;++x){var C=t[x];if(_(C))w+=f*C*n/1e3;else{var A,S,T,k,O=!1,P=(C.isSpace?o:0)+a,E=C.fontChar,L=C.accent,I=C.width;if(u){var M,D,F;M=C.vmetric||g,D=-(D=C.vmetric?M[1]:.5*I)*p,F=M[2]*p,I=M?-M[0]:I,A=D/s,S=(w+F)/s}else A=w/s,S=0;if(i.remeasure&&I>0){var j=1e3*r.measureText(E).width/n*s;if(I<j&&this.isFontSubpixelAAEnabled){var R=I/j;O=!0,r.save(),r.scale(R,1),A/=R}else I!==j&&(A+=(I-j)/2e3*n/s)}(C.isInFont||i.missingFile)&&(v&&!L?r.fillText(E,A,S):(this.paintChar(E,A,S),L&&(T=A+L.offset.x/s,k=S-L.offset.y/s,this.paintChar(L.fontChar,T,k)))),w+=I*p+P*c,O&&r.restore()}}u?e.y-=w*h:e.x+=w*h,r.restore()}},showType3Text:function(t){var e,i,n,r,s=this.ctx,a=this.current,o=a.font,c=a.fontSize,l=a.fontDirection,u=o.vertical?1:-1,f=a.charSpacing,g=a.wordSpacing,v=a.textHScale*l,m=a.fontMatrix||h,b=t.length;if(!(a.textRenderingMode===d.INVISIBLE)&&0!==c){for(this.cachedGetSinglePixelWidth=null,s.save(),s.transform.apply(s,a.textMatrix),s.translate(a.x,a.y),s.scale(v,l),e=0;e<b;++e)if(i=t[e],_(i))r=u*i*c/1e3,this.ctx.translate(r,0),a.x+=r*v;else{var y=(i.isSpace?g:0)+f,x=o.charProcOperatorList[i.operatorListId];x?(this.processingType3=i,this.save(),s.scale(c,c),s.transform.apply(s,m),this.executeOperatorList(x),this.restore(),n=p.applyTransform([i.width,0],m)[0]*c+y,s.translate(n,0),a.x+=n*v):C('Type3 character "'+i.operatorListId+'" is not available')}s.restore(),this.processingType3=null}},setCharWidth:function(t,e){},setCharWidthAndBounds:function(t,e,i,n,r,s){this.ctx.rect(i,n,r-i,s-n),this.clip(),this.endPath()},getColorN_Pattern:function(e){var i;if("TilingPattern"===e[0]){var n=e[1],r=this.baseTransform||this.ctx.mozCurrentTransform.slice(),s=this,a={createCanvasGraphics:function(e){return new t(e,s.commonObjs,s.objs,s.canvasFactory)}};i=new A(e,n,this.ctx,a,r)}else i=S(e);return i},setStrokeColorN:function(){this.current.strokeColor=this.getColorN_Pattern(arguments)},setFillColorN:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0},setStrokeRGBColor:function(t,e,i){var n=p.makeCssRgb(t,e,i);this.ctx.strokeStyle=n,this.current.strokeColor=n},setFillRGBColor:function(t,e,i){var n=p.makeCssRgb(t,e,i);this.ctx.fillStyle=n,this.current.fillColor=n,this.current.patternFill=!1},shadingFill:function(t){var e=this.ctx;this.save();var i=S(t);e.fillStyle=i.getPattern(e,this,!0);var n=e.mozCurrentTransformInverse;if(n){var r=e.canvas,s=r.width,a=r.height,o=p.applyTransform([0,0],n),c=p.applyTransform([0,a],n),h=p.applyTransform([s,0],n),l=p.applyTransform([s,a],n),u=Math.min(o[0],c[0],h[0],l[0]),f=Math.min(o[1],c[1],h[1],l[1]),d=Math.max(o[0],c[0],h[0],l[0]),g=Math.max(o[1],c[1],h[1],l[1]);this.ctx.fillRect(u,f,d-u,g-f)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.restore()},beginInlineImage:function(){x("Should not call beginInlineImage")},beginImageData:function(){x("Should not call beginImageData")},paintFormXObjectBegin:function(t,e){if(this.save(),this.baseTransformStack.push(this.baseTransform),b(t)&&6===t.length&&this.transform.apply(this,t),this.baseTransform=this.ctx.mozCurrentTransform,b(e)&&4===e.length){var i=e[2]-e[0],n=e[3]-e[1];this.ctx.rect(e[0],e[1],i,n),this.clip(),this.endPath()}},paintFormXObjectEnd:function(){this.restore(),this.baseTransform=this.baseTransformStack.pop()},beginGroup:function(t){this.save();var e=this.ctx;t.isolated||m("TODO: Support non-isolated groups."),t.knockout&&C("Knockout groups not supported.");var i=e.mozCurrentTransform;t.matrix&&e.transform.apply(e,t.matrix),v(t.bbox,"Bounding box is required.");var n=p.getAxialAlignedBoundingBox(t.bbox,e.mozCurrentTransform),r=[0,0,e.canvas.width,e.canvas.height];n=p.intersect(n,r)||[0,0,0,0];var a=Math.floor(n[0]),o=Math.floor(n[1]),c=Math.max(Math.ceil(n[2])-a,1),h=Math.max(Math.ceil(n[3])-o,1),l=1,u=1;c>4096&&(l=c/4096,c=4096),h>4096&&(u=h/4096,h=4096);var f="groupAt"+this.groupLevel;t.smask&&(f+="_smask_"+this.smaskCounter++%2);var d=this.cachedCanvases.getCanvas(f,c,h,!0),g=d.context;g.scale(1/l,1/u),g.translate(-a,-o),g.transform.apply(g,i),t.smask?this.smaskStack.push({canvas:d.canvas,context:g,offsetX:a,offsetY:o,scaleX:l,scaleY:u,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.scale(l,u)),s(e,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++,this.current.activeSMask=null},endGroup:function(t){this.groupLevel--;var e=this.ctx;this.ctx=this.groupStack.pop(),void 0!==this.ctx.imageSmoothingEnabled?this.ctx.imageSmoothingEnabled=!1:this.ctx.mozImageSmoothingEnabled=!1,t.smask?this.tempSMask=this.smaskStack.pop():this.ctx.drawImage(e.canvas,0,0),this.restore()},beginAnnotations:function(){this.save(),this.current=new I,this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform)},endAnnotations:function(){this.restore()},beginAnnotation:function(t,e,i){if(this.save(),b(t)&&4===t.length){var n=t[2]-t[0],r=t[3]-t[1];this.ctx.rect(t[0],t[1],n,r),this.clip(),this.endPath()}this.transform.apply(this,e),this.transform.apply(this,i)},endAnnotation:function(){this.restore()},paintJpegXObject:function(t,e,i){var n=this.objs.get(t);if(n){this.save();var r=this.ctx;if(r.scale(1/e,-1/i),r.drawImage(n,0,0,n.width,n.height,0,-i,e,i),this.imageLayer){var s=r.mozCurrentTransformInverse,a=this.getCanvasPosition(0,0);this.imageLayer.appendImage({objId:t,left:a[0],top:a[1],width:e/s[0],height:i/s[3]})}this.restore()}else C("Dependent image isn't ready yet")},paintImageMaskXObject:function(t){var e=this.ctx,n=t.width,s=t.height,a=this.current.fillColor,o=this.current.patternFill,c=this.processingType3;if(c&&void 0===c.compiled&&(c.compiled=n<=1e3&&s<=1e3?r({data:t.data,width:n,height:s}):null),c&&c.compiled)c.compiled(e);else{var h=this.cachedCanvases.getCanvas("maskCanvas",n,s),l=h.context;l.save(),i(l,t),l.globalCompositeOperation="source-in",l.fillStyle=o?a.getPattern(l,this):a,l.fillRect(0,0,n,s),l.restore(),this.paintInlineImageXObject(h.canvas)}},paintImageMaskXObjectRepeat:function(t,e,n,r){var s=t.width,a=t.height,o=this.current.fillColor,c=this.current.patternFill,h=this.cachedCanvases.getCanvas("maskCanvas",s,a),l=h.context;l.save(),i(l,t),l.globalCompositeOperation="source-in",l.fillStyle=c?o.getPattern(l,this):o,l.fillRect(0,0,s,a),l.restore();for(var u=this.ctx,f=0,d=r.length;f<d;f+=2)u.save(),u.transform(e,0,0,n,r[f],r[f+1]),u.scale(1,-1),u.drawImage(h.canvas,0,0,s,a,0,-1,1,1),u.restore()},paintImageMaskXObjectGroup:function(t){for(var e=this.ctx,n=this.current.fillColor,r=this.current.patternFill,s=0,a=t.length;s<a;s++){var o=t[s],c=o.width,h=o.height,l=this.cachedCanvases.getCanvas("maskCanvas",c,h),u=l.context;u.save(),i(u,o),u.globalCompositeOperation="source-in",u.fillStyle=r?n.getPattern(u,this):n,u.fillRect(0,0,c,h),u.restore(),e.save(),e.transform.apply(e,o.transform),e.scale(1,-1),e.drawImage(l.canvas,0,0,c,h,0,-1,1,1),e.restore()}},paintImageXObject:function(t){var e=this.objs.get(t);e?this.paintInlineImageXObject(e):C("Dependent image isn't ready yet")},paintImageXObjectRepeat:function(t,e,i,n){var r=this.objs.get(t);if(r){for(var s=r.width,a=r.height,o=[],c=0,h=n.length;c<h;c+=2)o.push({transform:[e,0,0,i,n[c],n[c+1]],x:0,y:0,w:s,h:a});this.paintInlineImageXObjectGroup(r,o)}else C("Dependent image isn't ready yet")},paintInlineImageXObject:function(t){var i=t.width,n=t.height,r=this.ctx;this.save(),r.scale(1/i,-1/n);var s,a,o=r.mozCurrentTransformInverse,c=o[0],h=o[1],l=Math.max(Math.sqrt(c*c+h*h),1),u=o[2],f=o[3],d=Math.max(Math.sqrt(u*u+f*f),1);if(t instanceof HTMLElement||!t.data)s=t;else{var g=(a=this.cachedCanvases.getCanvas("inlineImage",i,n)).context;e(g,t),s=a.canvas}for(var p=i,v=n,m="prescale1";l>2&&p>1||d>2&&v>1;){var _=p,b=v;l>2&&p>1&&(l/=p/(_=Math.ceil(p/2))),d>2&&v>1&&(d/=v/(b=Math.ceil(v/2))),(g=(a=this.cachedCanvases.getCanvas(m,_,b)).context).clearRect(0,0,_,b),g.drawImage(s,0,0,p,v,0,0,_,b),s=a.canvas,p=_,v=b,m="prescale1"===m?"prescale2":"prescale1"}if(r.drawImage(s,0,0,p,v,0,-n,i,n),this.imageLayer){var y=this.getCanvasPosition(0,-n);this.imageLayer.appendImage({imgData:t,left:y[0],top:y[1],width:i/o[0],height:n/o[3]})}this.restore()},paintInlineImageXObjectGroup:function(t,i){var n=this.ctx,r=t.width,s=t.height,a=this.cachedCanvases.getCanvas("inlineImage",r,s);e(a.context,t);for(var o=0,c=i.length;o<c;o++){var h=i[o];if(n.save(),n.transform.apply(n,h.transform),n.scale(1,-1),n.drawImage(a.canvas,h.x,h.y,h.w,h.h,0,-1,1,1),this.imageLayer){var l=this.getCanvasPosition(h.x,h.y);this.imageLayer.appendImage({imgData:t,left:l[0],top:l[1],width:r,height:s})}n.restore()}},paintSolidColorImageMask:function(){this.ctx.fillRect(0,0,1,1)},paintXObject:function(){C("Unsupported 'paintXObject' command.")},markPoint:function(t){},markPointProps:function(t,e){},beginMarkedContent:function(t){},beginMarkedContentProps:function(t,e){},endMarkedContent:function(){},beginCompat:function(){},endCompat:function(){},consumePath:function(){var t=this.ctx;this.pendingClip&&(this.pendingClip===j?t.clip("evenodd"):t.clip(),this.pendingClip=null),t.beginPath()},getSinglePixelWidth:function(t){if(null===this.cachedGetSinglePixelWidth){this.ctx.save();var e=this.ctx.mozCurrentTransformInverse;this.ctx.restore(),this.cachedGetSinglePixelWidth=Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1],e[2]*e[2]+e[3]*e[3]))}return this.cachedGetSinglePixelWidth},getCanvasPosition:function(t,e){var i=this.ctx.mozCurrentTransform;return[i[0]*t+i[2]*e+i[4],i[1]*t+i[3]*e+i[5]]}};for(var R in f)t.prototype[f[R]]=t.prototype[R];return t}();e.CanvasGraphics=M},function(t,e,i){"use strict";function n(t){this.docId=t,this.styleElement=null,this.nativeFontFaces=[],this.loadTestFontId=0,this.loadingContext={requests:[],nextRequestId:0}}var r=i(0),s=r.assert,a=r.bytesToString,o=r.string32,c=r.shadow,h=r.warn;n.prototype={insertRule:function(t){var e=this.styleElement;e||((e=this.styleElement=document.createElement("style")).id="PDFJS_FONT_STYLE_TAG_"+this.docId,document.documentElement.getElementsByTagName("head")[0].appendChild(e));var i=e.sheet;i.insertRule(t,i.cssRules.length)},clear:function(){this.styleElement&&(this.styleElement.remove(),this.styleElement=null),this.nativeFontFaces.forEach(function(t){document.fonts.delete(t)}),this.nativeFontFaces.length=0}};var l=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};Object.defineProperty(n.prototype,"loadTestFont",{get:function(){return c(this,"loadTestFont",l())},configurable:!0}),n.prototype.addNativeFontFace=function(t){this.nativeFontFaces.push(t),document.fonts.add(t)},n.prototype.bind=function(t,e){for(var i=[],r=[],s=[],a=n.isFontLoadingAPISupported&&!n.isSyncFontLoadingSupported,o=0,c=t.length;o<c;o++){var l=t[o];if(!l.attached&&!1!==l.loading)if(l.attached=!0,a){var u=l.createNativeFontFace();u&&(this.addNativeFontFace(u),s.push(function(t){return t.loaded.catch(function(e){h('Failed to load font "'+t.family+'": '+e)})}(u)))}else{var f=l.createFontFaceRule();f&&(this.insertRule(f),i.push(f),r.push(l))}}var d=this.queueLoadingCallback(e);a?Promise.all(s).then(function(){d.complete()}):i.length>0&&!n.isSyncFontLoadingSupported?this.prepareFontLoadEvent(i,r,d):d.complete()},n.prototype.queueLoadingCallback=function(t){var e=this.loadingContext,i={id:"pdfjs-font-loading-"+e.nextRequestId++,complete:function(){for(s(!i.end,"completeRequest() cannot be called twice"),i.end=Date.now();e.requests.length>0&&e.requests[0].end;){var t=e.requests.shift();setTimeout(t.callback,0)}},callback:t,started:Date.now()};return e.requests.push(i),i},n.prototype.prepareFontLoadEvent=function(t,e,i){function n(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function r(t,e,i,n){return t.substr(0,e)+n+t.substr(e+i)}function s(t,e){if(++f>30)return h("Load test font never loaded."),void e();u.font="30px "+t,u.fillText(".",0,20),u.getImageData(0,0,1,1).data[3]>0?e():setTimeout(s.bind(null,t,e))}var a,c,l=document.createElement("canvas");l.width=1,l.height=1;var u=l.getContext("2d"),f=0,d="lt"+Date.now()+this.loadTestFontId++,g=this.loadTestFont,p=n(g=r(g,976,d.length,d),16);for(a=0,c=d.length-3;a<c;a+=4)p=p-1482184792+n(d,a)|0;a<d.length&&(p=p-1482184792+n(d+"XXX",a)|0),g=r(g,16,4,o(p));var v='@font-face { font-family:"'+d+'";src:'+("url(data:font/opentype;base64,"+btoa(g)+");")+"}";this.insertRule(v);var m=[];for(a=0,c=e.length;a<c;a++)m.push(e[a].loadedName);m.push(d);var _=document.createElement("div");for(_.setAttribute("style","visibility: hidden;width: 10px; height: 10px;position: absolute; top: 0px; left: 0px;"),a=0,c=m.length;a<c;++a){var b=document.createElement("span");b.textContent="Hi",b.style.fontFamily=m[a],_.appendChild(b)}document.body.appendChild(_),s(d,function(){document.body.removeChild(_),i.complete()})},n.isFontLoadingAPISupported="undefined"!=typeof document&&!!document.fonts;var u=function(){if("undefined"==typeof navigator)return!0;var t=!1,e=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);return e&&e[1]>=14&&(t=!0),t};Object.defineProperty(n,"isSyncFontLoadingSupported",{get:function(){return c(n,"isSyncFontLoadingSupported",u())},enumerable:!0,configurable:!0});var f={get value(){return c(this,"value",r.isEvalSupported())}},d=function(){function t(t,e){this.compiledGlyphs=Object.create(null);for(var i in t)this[i]=t[i];this.options=e}return t.prototype={createNativeFontFace:function(){if(!this.data)return null;if(this.options.disableFontFace)return this.disableFontFace=!0,null;var t=new FontFace(this.loadedName,this.data,{});return this.options.fontRegistry&&this.options.fontRegistry.registerFont(this),t},createFontFaceRule:function(){if(!this.data)return null;if(this.options.disableFontFace)return this.disableFontFace=!0,null;var t=a(new Uint8Array(this.data)),e=this.loadedName,i="url(data:"+this.mimetype+";base64,"+btoa(t)+");",n='@font-face { font-family:"'+e+'";src:'+i+"}";return this.options.fontRegistry&&this.options.fontRegistry.registerFont(this,i),n},getPathGenerator:function(t,e){if(!(e in this.compiledGlyphs)){var i,n,r,s=t.get(this.loadedName+"_path_"+e);if(this.options.isEvalSupported&&f.value){var a,o="";for(n=0,r=s.length;n<r;n++)a=void 0!==(i=s[n]).args?i.args.join(","):"",o+="c."+i.cmd+"("+a+");\n";this.compiledGlyphs[e]=new Function("c","size",o)}else this.compiledGlyphs[e]=function(t,e){for(n=0,r=s.length;n<r;n++)"scale"===(i=s[n]).cmd&&(i.args=[e,-e]),t[i.cmd].apply(t,i.args)}}return this.compiledGlyphs[e]}},t}();e.FontFaceObject=d,e.FontLoader=n},function(t,e,i){"use strict";var n=i(0),r=i(8),s=n.Util,a=n.info,o=n.isArray,c=n.error,h=r.WebGLUtils,l={};l.RadialAxial={fromIR:function(t){var e=t[1],i=t[2],n=t[3],r=t[4],s=t[5],a=t[6];return{type:"Pattern",getPattern:function(t){var o;"axial"===e?o=t.createLinearGradient(n[0],n[1],r[0],r[1]):"radial"===e&&(o=t.createRadialGradient(n[0],n[1],s,r[0],r[1],a));for(var c=0,h=i.length;c<h;++c){var l=i[c];o.addColorStop(l[0],l[1])}return o}}}};var u=function(){function t(t,e,i,n,r,s,a,o){var c,h=e.coords,l=e.colors,u=t.data,f=4*t.width;h[i+1]>h[n+1]&&(c=i,i=n,n=c,c=s,s=a,a=c),h[n+1]>h[r+1]&&(c=n,n=r,r=c,c=a,a=o,o=c),h[i+1]>h[n+1]&&(c=i,i=n,n=c,c=s,s=a,a=c);var d=(h[i]+e.offsetX)*e.scaleX,g=(h[i+1]+e.offsetY)*e.scaleY,p=(h[n]+e.offsetX)*e.scaleX,v=(h[n+1]+e.offsetY)*e.scaleY,m=(h[r]+e.offsetX)*e.scaleX,_=(h[r+1]+e.offsetY)*e.scaleY;if(!(g>=_))for(var b,y,x,w,C,A,S,T,k,O=l[s],P=l[s+1],E=l[s+2],L=l[a],I=l[a+1],M=l[a+2],D=l[o],F=l[o+1],j=l[o+2],R=Math.round(g),N=Math.round(_),B=R;B<=N;B++){B<v?(b=d-(d-p)*(k=B<g?0:g===v?1:(g-B)/(g-v)),y=O-(O-L)*k,x=P-(P-I)*k,w=E-(E-M)*k):(b=p-(p-m)*(k=B>_?1:v===_?0:(v-B)/(v-_)),y=L-(L-D)*k,x=I-(I-F)*k,w=M-(M-j)*k),C=d-(d-m)*(k=B<g?0:B>_?1:(g-B)/(g-_)),A=O-(O-D)*k,S=P-(P-F)*k,T=E-(E-j)*k;for(var z=Math.round(Math.min(b,C)),U=Math.round(Math.max(b,C)),X=f*B+4*z,W=z;W<=U;W++)k=(k=(b-W)/(b-C))<0?0:k>1?1:k,u[X++]=y-(y-A)*k|0,u[X++]=x-(x-S)*k|0,u[X++]=w-(w-T)*k|0,u[X++]=255}}function e(e,i,n){var r,s,a=i.coords,o=i.colors;switch(i.type){case"lattice":var h=i.verticesPerRow,l=Math.floor(a.length/h)-1,u=h-1;for(r=0;r<l;r++)for(var f=r*h,d=0;d<u;d++,f++)t(e,n,a[f],a[f+1],a[f+h],o[f],o[f+1],o[f+h]),t(e,n,a[f+h+1],a[f+1],a[f+h],o[f+h+1],o[f+1],o[f+h]);break;case"triangles":for(r=0,s=a.length;r<s;r+=3)t(e,n,a[r],a[r+1],a[r+2],o[r],o[r+1],o[r+2]);break;default:c("illigal figure")}}return function(t,i,n,r,s,a,o){var c,l,u,f,d=Math.floor(t[0]),g=Math.floor(t[1]),p=Math.ceil(t[2])-d,v=Math.ceil(t[3])-g,m=Math.min(Math.ceil(Math.abs(p*i[0]*1.1)),3e3),_=Math.min(Math.ceil(Math.abs(v*i[1]*1.1)),3e3),b=p/m,y=v/_,x={coords:n,colors:r,offsetX:-d,offsetY:-g,scaleX:1/b,scaleY:1/y},w=m+4,C=_+4;if(h.isEnabled)c=h.drawFigures(m,_,a,s,x),(l=o.getCanvas("mesh",w,C,!1)).context.drawImage(c,2,2),c=l.canvas;else{var A=(l=o.getCanvas("mesh",w,C,!1)).context,S=A.createImageData(m,_);if(a){var T=S.data;for(u=0,f=T.length;u<f;u+=4)T[u]=a[0],T[u+1]=a[1],T[u+2]=a[2],T[u+3]=255}for(u=0;u<s.length;u++)e(S,s[u],x);A.putImageData(S,2,2),c=l.canvas}return{canvas:c,offsetX:d-2*b,offsetY:g-2*y,scaleX:b,scaleY:y}}}();l.Mesh={fromIR:function(t){var e=t[2],i=t[3],n=t[4],r=t[5],a=t[6],o=t[8];return{type:"Pattern",getPattern:function(t,c,h){var l;if(h)l=s.singularValueDecompose2dScale(t.mozCurrentTransform);else if(l=s.singularValueDecompose2dScale(c.baseTransform),a){var f=s.singularValueDecompose2dScale(a);l=[l[0]*f[0],l[1]*f[1]]}var d=u(r,l,e,i,n,h?null:o,c.cachedCanvases);return h||(t.setTransform.apply(t,c.baseTransform),a&&t.transform.apply(t,a)),t.translate(d.offsetX,d.offsetY),t.scale(d.scaleX,d.scaleY),t.createPattern(d.canvas,"no-repeat")}}}},l.Dummy={fromIR:function(){return{type:"Pattern",getPattern:function(){return"hotpink"}}}};var f=function(){function t(t,e,i,n,r){this.operatorList=t[2],this.matrix=t[3]||[1,0,0,1,0,0],this.bbox=s.normalizeRect(t[4]),this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.canvasGraphicsFactory=n,this.baseTransform=r,this.type="Pattern",this.ctx=i}var e={COLORED:1,UNCOLORED:2};return t.prototype={createPatternCanvas:function(t){var e=this.operatorList,i=this.bbox,n=this.xstep,r=this.ystep,o=this.paintType,c=this.tilingType,h=this.color,l=this.canvasGraphicsFactory;a("TilingType: "+c);var u=i[0],f=i[1],d=i[2],g=i[3],p=[u,f],v=[u+n,f+r],m=v[0]-p[0],_=v[1]-p[1],b=s.singularValueDecompose2dScale(this.matrix),y=s.singularValueDecompose2dScale(this.baseTransform),x=[b[0]*y[0],b[1]*y[1]];m=Math.min(Math.ceil(Math.abs(m*x[0])),3e3),_=Math.min(Math.ceil(Math.abs(_*x[1])),3e3);var w=t.cachedCanvases.getCanvas("pattern",m,_,!0),C=w.context,A=l.createCanvasGraphics(C);A.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(C,o,h),this.setScale(m,_,n,r),this.transformToScale(A);var S=[1,0,0,1,-p[0],-p[1]];return A.transform.apply(A,S),this.clipBbox(A,i,u,f,d,g),A.executeOperatorList(e),w.canvas},setScale:function(t,e,i,n){this.scale=[t/i,e/n]},transformToScale:function(t){var e=this.scale,i=[e[0],0,0,e[1],0,0];t.transform.apply(t,i)},scaleToContext:function(){var t=this.scale;this.ctx.scale(1/t[0],1/t[1])},clipBbox:function(t,e,i,n,r,s){if(o(e)&&4===e.length){var a=r-i,c=s-n;t.ctx.rect(i,n,a,c),t.clip(),t.endPath()}},setFillAndStrokeStyleToContext:function(t,i,n){switch(i){case e.COLORED:var r=this.ctx;t.fillStyle=r.fillStyle,t.strokeStyle=r.strokeStyle;break;case e.UNCOLORED:var a=s.makeCssRgb(n[0],n[1],n[2]);t.fillStyle=a,t.strokeStyle=a;break;default:c("Unsupported paint type: "+i)}},getPattern:function(t,e){var i=this.createPatternCanvas(e);return(t=this.ctx).setTransform.apply(t,this.baseTransform),t.transform.apply(t,this.matrix),this.scaleToContext(),t.createPattern(i,"repeat")}},t}();e.getShadingPatternFromIR=function(t){var e=l[t[0]];return e||c("Unknown IR type: "+t[0]),e.fromIR(t)},e.TilingPattern=f},function(t,e,i){"use strict";(function(t){if("undefined"==typeof PDFJS||!PDFJS.compatibilityChecked){var e="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:void 0,i="undefined"!=typeof navigator&&navigator.userAgent||"",n=/Android/.test(i),r=/Android\s[0-2][^\d]/.test(i),s=/Android\s[0-4][^\d]/.test(i),a=i.indexOf("Chrom")>=0,o=/Chrome\/(39|40)\./.test(i),c=i.indexOf("CriOS")>=0,h=i.indexOf("Trident")>=0,l=/\b(iPad|iPhone|iPod)(?=;)/.test(i),u=i.indexOf("Opera")>=0,f=/Safari\//.test(i)&&!/(Chrome\/|Android\s)/.test(i),d="object"==typeof window&&"object"==typeof document;"undefined"==typeof PDFJS&&(e.PDFJS={}),PDFJS.compatibilityChecked=!0,function(){function t(t,e){return new n(this.slice(t,e))}function i(t,e){arguments.length<2&&(e=0);for(var i=0,n=t.length;i<n;++i,++e)this[e]=255&t[i]}function n(e){var n,r,s;if("number"==typeof e)for(n=[],r=0;r<e;++r)n[r]=0;else if("slice"in e)n=e.slice(0);else for(n=[],r=0,s=e.length;r<s;++r)n[r]=e[r];return n.subarray=t,n.buffer=n,n.byteLength=n.length,n.set=i,"object"==typeof e&&e.buffer&&(n.buffer=e.buffer),n}if("undefined"!=typeof Uint8Array)return void 0===Uint8Array.prototype.subarray&&(Uint8Array.prototype.subarray=function(t,e){return new Uint8Array(this.slice(t,e))},Float32Array.prototype.subarray=function(t,e){return new Float32Array(this.slice(t,e))}),void("undefined"==typeof Float64Array&&(e.Float64Array=Float32Array));e.Uint8Array=n,e.Int8Array=n,e.Uint32Array=n,e.Int32Array=n,e.Uint16Array=n,e.Float32Array=n,e.Float64Array=n}(),e.URL||(e.URL=e.webkitURL),function(){if(void 0!==Object.defineProperty){var t=!0;try{d&&Object.defineProperty(new Image,"id",{value:"test"});var e=function(){};e.prototype={get id(){}},Object.defineProperty(new e,"id",{value:"",configurable:!0,enumerable:!0,writable:!1})}catch(e){t=!1}if(t)return}Object.defineProperty=function(t,e,i){delete t[e],"get"in i&&t.__defineGetter__(e,i.get),"set"in i&&t.__defineSetter__(e,i.set),"value"in i&&(t.__defineSetter__(e,function(t){return this.__defineGetter__(e,function(){return t}),t}),t[e]=i.value)}}(),function(){if("undefined"!=typeof XMLHttpRequest){var t=XMLHttpRequest.prototype,e=new XMLHttpRequest;"overrideMimeType"in e||Object.defineProperty(t,"overrideMimeType",{value:function(t){}}),"responseType"in e||(Object.defineProperty(t,"responseType",{get:function(){return this._responseType||"text"},set:function(t){"text"!==t&&"arraybuffer"!==t||(this._responseType=t,"arraybuffer"===t&&"function"==typeof this.overrideMimeType&&this.overrideMimeType("text/plain; charset=x-user-defined"))}}),"undefined"==typeof VBArray?Object.defineProperty(t,"response",{get:function(){if("arraybuffer"!==this.responseType)return this.responseText;var t,e=this.responseText,i=e.length,n=new Uint8Array(i);for(t=0;t<i;++t)n[t]=255&e.charCodeAt(t);return n.buffer}}):Object.defineProperty(t,"response",{get:function(){return"arraybuffer"===this.responseType?new Uint8Array(new VBArray(this.responseBody).toArray()):this.responseText}}))}}(),function(){if(!("btoa"in e)){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.btoa=function(e){var i,n,r="";for(i=0,n=e.length;i<n;i+=3){var s=255&e.charCodeAt(i),a=255&e.charCodeAt(i+1),o=255&e.charCodeAt(i+2),c=s>>2,h=(3&s)<<4|a>>4,l=i+1<n?(15&a)<<2|o>>6:64,u=i+2<n?63&o:64;r+=t.charAt(c)+t.charAt(h)+t.charAt(l)+t.charAt(u)}return r}}}(),function(){if(!("atob"in e)){e.atob=function(t){if((t=t.replace(/=+$/,"")).length%4==1)throw new Error("bad atob input");for(var e,i,n=0,r=0,s="";i=t.charAt(r++);~i&&(e=n%4?64*e+i:i,n++%4)?s+=String.fromCharCode(255&e>>(-2*n&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s}}}(),void 0===Function.prototype.bind&&(Function.prototype.bind=function(t){var e=this,i=Array.prototype.slice.call(arguments,1);return function(){var n=i.concat(Array.prototype.slice.call(arguments));return e.apply(t,n)}}),d&&("dataset"in document.createElement("div")||Object.defineProperty(HTMLElement.prototype,"dataset",{get:function(){if(this._dataset)return this._dataset;for(var t={},e=0,i=this.attributes.length;e<i;e++){var n=this.attributes[e];"data-"===n.name.substring(0,5)&&(t[n.name.substring(5).replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()})]=n.value)}return Object.defineProperty(this,"_dataset",{value:t,writable:!1,enumerable:!1}),t},enumerable:!0})),function(){function t(t,e,i,n){var r=(t.className||"").split(/\s+/g);""===r[0]&&r.shift();var s=r.indexOf(e);return s<0&&i&&r.push(e),s>=0&&n&&r.splice(s,1),t.className=r.join(" "),s>=0}if(d&&!("classList"in document.createElement("div"))){var e={add:function(e){t(this.element,e,!0,!1)},contains:function(e){return t(this.element,e,!1,!1)},remove:function(e){t(this.element,e,!1,!0)},toggle:function(e){t(this.element,e,!0,!0)}};Object.defineProperty(HTMLElement.prototype,"classList",{get:function(){if(this._classList)return this._classList;var t=Object.create(e,{element:{value:this,writable:!1,enumerable:!0}});return Object.defineProperty(this,"_classList",{value:t,writable:!1,enumerable:!1}),t},enumerable:!0})}}(),function(){if(!("undefined"==typeof importScripts||"console"in e)){var t={},i={log:function(){var t=Array.prototype.slice.call(arguments);e.postMessage({targetName:"main",action:"console_log",data:t})},error:function(){var t=Array.prototype.slice.call(arguments);e.postMessage({targetName:"main",action:"console_error",data:t})},time:function(e){t[e]=Date.now()},timeEnd:function(e){var i=t[e];if(!i)throw new Error("Unknown timer name "+e);this.log("Timer:",e,Date.now()-i)}};e.console=i}}(),function(){if(d){if("console"in window)return"bind"in console.log?void 0:(console.log=function(t){return function(e){return t(e)}}(console.log),console.error=function(t){return function(e){return t(e)}}(console.error),void(console.warn=function(t){return function(e){return t(e)}}(console.warn)));window.console={log:function(){},error:function(){},warn:function(){}}}}(),function(){function t(e){return e.disabled||e.parentNode&&t(e.parentNode)}u&&document.addEventListener("click",function(e){t(e.target)&&e.stopPropagation()},!0)}(),(h||c)&&(PDFJS.disableCreateObjectURL=!0),"undefined"!=typeof navigator&&("language"in navigator||(PDFJS.locale=navigator.userLanguage||"en-US")),(f||r||o||l)&&(PDFJS.disableRange=!0,PDFJS.disableStream=!0),d&&(history.pushState&&!r||(PDFJS.disableHistory=!0)),function(){if(d)if(window.CanvasPixelArray)"function"!=typeof window.CanvasPixelArray.prototype.set&&(window.CanvasPixelArray.prototype.set=function(t){for(var e=0,i=this.length;e<i;e++)this[e]=t[e]});else{var t,e=!1;if(a?e=(t=i.match(/Chrom(e|ium)\/([0-9]+)\./))&&parseInt(t[2])<21:n?e=s:f&&(e=(t=i.match(/Version\/([0-9]+)\.([0-9]+)\.([0-9]+) Safari\//))&&parseInt(t[1])<6),e){var r=window.CanvasRenderingContext2D.prototype,o=r.createImageData;r.createImageData=function(t,e){var i=o.call(this,t,e);return i.data.set=function(t){for(var e=0,i=this.length;e<i;e++)this[e]=t[e]},i},r=null}}}(),function(){function t(){window.requestAnimationFrame=function(t){return window.setTimeout(t,20)},window.cancelAnimationFrame=function(t){window.clearTimeout(t)}}d&&(l?t():"requestAnimationFrame"in window||(window.requestAnimationFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame,window.requestAnimationFrame||t()))}(),(l||n)&&(PDFJS.maxCanvasPixels=5242880),d&&h&&window.parent!==window&&(PDFJS.disableFullscreen=!0),d&&("currentScript"in document||Object.defineProperty(document,"currentScript",{get:function(){var t=document.getElementsByTagName("script");return t[t.length-1]},enumerable:!0,configurable:!0})),function(){if(d){var t=document.createElement("input");try{t.type="number"}catch(n){var e=t.constructor.prototype,i=Object.getOwnPropertyDescriptor(e,"type");Object.defineProperty(e,"type",{get:function(){return i.get.call(this)},set:function(t){i.set.call(this,"number"===t?"text":t)},enumerable:!0,configurable:!0})}}}(),function(){if(d&&document.attachEvent){var t=document.constructor.prototype,e=Object.getOwnPropertyDescriptor(t,"readyState");Object.defineProperty(t,"readyState",{get:function(){var t=e.get.call(this);return"interactive"===t?"loading":t},set:function(t){e.set.call(this,t)},enumerable:!0,configurable:!0})}}(),d&&void 0===Element.prototype.remove&&(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),function(){if(e.Promise)return"function"!=typeof e.Promise.all&&(e.Promise.all=function(t){var i,n,r=0,s=[],a=new e.Promise(function(t,e){i=t,n=e});return t.forEach(function(t,e){r++,t.then(function(t){s[e]=t,0===--r&&i(s)},n)}),0===r&&i(s),a}),"function"!=typeof e.Promise.resolve&&(e.Promise.resolve=function(t){return new e.Promise(function(e){e(t)})}),"function"!=typeof e.Promise.reject&&(e.Promise.reject=function(t){return new e.Promise(function(e,i){i(t)})}),void("function"!=typeof e.Promise.prototype.catch&&(e.Promise.prototype.catch=function(t){return e.Promise.prototype.then(void 0,t)}));var t=2,i={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(t){0!==t._status&&(this.handlers=this.handlers.concat(t._handlers),t._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=Date.now()+1;this.handlers.length>0;){var i=this.handlers.shift(),n=i.thisPromise._status,r=i.thisPromise._value;try{1===n?"function"==typeof i.onResolve&&(r=i.onResolve(r)):"function"==typeof i.onReject&&(r=i.onReject(r),n=1,i.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(i.thisPromise))}catch(e){n=t,r=e}if(i.nextPromise._updateStatus(n,r),Date.now()>=e)break}this.handlers.length>0?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(t){this.unhandledRejections.push({promise:t,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(t){t._unhandledRejection=!1;for(var e=0;e<this.unhandledRejections.length;e++)this.unhandledRejections[e].promise===t&&(this.unhandledRejections.splice(e),e--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var t=Date.now(),e=0;e<this.unhandledRejections.length;e++)if(t-this.unhandledRejections[e].time>500){var i=this.unhandledRejections[e].promise._value,n="Unhandled rejection: "+i;i.stack&&(n+="\n"+i.stack);try{throw new Error(n)}catch(t){console.warn(n)}this.unhandledRejections.splice(e),e--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}},n=function(t){this._status=0,this._handlers=[];try{t.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(t){this._reject(t)}};n.all=function(e){var i,r,s=new n(function(t,e){i=t,r=e}),a=e.length,o=[];if(0===a)return i(o),s;for(var c=0,h=e.length;c<h;++c){var l=e[c],u=function(e){return function(n){s._status!==t&&(o[e]=n,0===--a&&i(o))}}(c);n.isPromise(l)?l.then(u,function(e){s._status!==t&&(o=[],r(e))}):u(l)}return s},n.isPromise=function(t){return t&&"function"==typeof t.then},n.resolve=function(t){return new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,i){i(t)})},n.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(e,r){1!==this._status&&this._status!==t&&(1===e&&n.isPromise(r)?r.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,t)):(this._status=e,this._value=r,e===t&&0===this._handlers.length&&(this._unhandledRejection=!0,i.addUnhandledRejection(this)),i.scheduleHandlers(this)))},_resolve:function(t){this._updateStatus(1,t)},_reject:function(e){this._updateStatus(t,e)},then:function(t,e){var r=new n(function(t,e){this.resolve=t,this.reject=e});return this._handlers.push({thisPromise:this,onResolve:t,onReject:e,nextPromise:r}),i.scheduleHandlers(this),r},catch:function(t){return this.then(void 0,t)}},e.Promise=n}(),function(){function t(){this.id="$weakmap"+i++}if(!e.WeakMap){var i=0;t.prototype={has:function(t){return!!Object.getOwnPropertyDescriptor(t,this.id)},get:function(t,e){return this.has(t)?t[this.id]:e},set:function(t,e){Object.defineProperty(t,this.id,{value:e,enumerable:!1,configurable:!0})},delete:function(t){delete t[this.id]}},e.WeakMap=t}}(),function(){function t(t){return void 0!==u[t]}function i(){o.call(this),this._isInvalid=!0}function n(t){return""===t&&i.call(this),t.toLowerCase()}function r(t){var e=t.charCodeAt(0);return e>32&&e<127&&-1===[34,35,60,62,63,96].indexOf(e)?t:encodeURIComponent(t)}function s(t){var e=t.charCodeAt(0);return e>32&&e<127&&-1===[34,35,60,62,96].indexOf(e)?t:encodeURIComponent(t)}function a(e,a,o){function c(t){b.push(t)}var h=a||"scheme start",l=0,v="",m=!1,_=!1,b=[];t:for(;(e[l-1]!==d||0===l)&&!this._isInvalid;){var y=e[l];switch(h){case"scheme start":if(!y||!g.test(y)){if(a){c("Invalid scheme.");break t}v="",h="no scheme";continue}v+=y.toLowerCase(),h="scheme";break;case"scheme":if(y&&p.test(y))v+=y.toLowerCase();else{if(":"!==y){if(a){if(y===d)break t;c("Code point not allowed in scheme: "+y);break t}v="",l=0,h="no scheme";continue}if(this._scheme=v,v="",a)break t;t(this._scheme)&&(this._isRelative=!0),h="file"===this._scheme?"relative":this._isRelative&&o&&o._scheme===this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"===y?(this._query="?",h="query"):"#"===y?(this._fragment="#",h="fragment"):y!==d&&"\t"!==y&&"\n"!==y&&"\r"!==y&&(this._schemeData+=r(y));break;case"no scheme":if(o&&t(o._scheme)){h="relative";continue}c("Missing scheme."),i.call(this);break;case"relative or authority":if("/"!==y||"/"!==e[l+1]){c("Expected /, got: "+y),h="relative";continue}h="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!==this._scheme&&(this._scheme=o._scheme),y===d){this._host=o._host,this._port=o._port,this._path=o._path.slice(),this._query=o._query,this._username=o._username,this._password=o._password;break t}if("/"===y||"\\"===y)"\\"===y&&c("\\ is an invalid code point."),h="relative slash";else if("?"===y)this._host=o._host,this._port=o._port,this._path=o._path.slice(),this._query="?",this._username=o._username,this._password=o._password,h="query";else{if("#"!==y){var x=e[l+1],w=e[l+2];("file"!==this._scheme||!g.test(y)||":"!==x&&"|"!==x||w!==d&&"/"!==w&&"\\"!==w&&"?"!==w&&"#"!==w)&&(this._host=o._host,this._port=o._port,this._username=o._username,this._password=o._password,this._path=o._path.slice(),this._path.pop()),h="relative path";continue}this._host=o._host,this._port=o._port,this._path=o._path.slice(),this._query=o._query,this._fragment="#",this._username=o._username,this._password=o._password,h="fragment"}break;case"relative slash":if("/"!==y&&"\\"!==y){"file"!==this._scheme&&(this._host=o._host,this._port=o._port,this._username=o._username,this._password=o._password),h="relative path";continue}"\\"===y&&c("\\ is an invalid code point."),h="file"===this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!==y){c("Expected '/', got: "+y),h="authority ignore slashes";continue}h="authority second slash";break;case"authority second slash":if(h="authority ignore slashes","/"!==y){c("Expected '/', got: "+y);continue}break;case"authority ignore slashes":if("/"!==y&&"\\"!==y){h="authority";continue}c("Expected authority, got: "+y);break;case"authority":if("@"===y){m&&(c("@ already seen."),v+="%40"),m=!0;for(var C=0;C<v.length;C++){var A=v[C];if("\t"!==A&&"\n"!==A&&"\r"!==A)if(":"!==A||null!==this._password){var S=r(A);null!==this._password?this._password+=S:this._username+=S}else this._password="";else c("Invalid whitespace in authority.")}v=""}else{if(y===d||"/"===y||"\\"===y||"?"===y||"#"===y){l-=v.length,v="",h="host";continue}v+=y}break;case"file host":if(y===d||"/"===y||"\\"===y||"?"===y||"#"===y){2!==v.length||!g.test(v[0])||":"!==v[1]&&"|"!==v[1]?0===v.length?h="relative path start":(this._host=n.call(this,v),v="",h="relative path start"):h="relative path";continue}"\t"===y||"\n"===y||"\r"===y?c("Invalid whitespace in file host."):v+=y;break;case"host":case"hostname":if(":"!==y||_){if(y===d||"/"===y||"\\"===y||"?"===y||"#"===y){if(this._host=n.call(this,v),v="",h="relative path start",a)break t;continue}"\t"!==y&&"\n"!==y&&"\r"!==y?("["===y?_=!0:"]"===y&&(_=!1),v+=y):c("Invalid code point in host/hostname: "+y)}else if(this._host=n.call(this,v),v="",h="port","hostname"===a)break t;break;case"port":if(/[0-9]/.test(y))v+=y;else{if(y===d||"/"===y||"\\"===y||"?"===y||"#"===y||a){if(""!==v){var T=parseInt(v,10);T!==u[this._scheme]&&(this._port=T+""),v=""}if(a)break t;h="relative path start";continue}"\t"===y||"\n"===y||"\r"===y?c("Invalid code point in port: "+y):i.call(this)}break;case"relative path start":if("\\"===y&&c("'\\' not allowed in path."),h="relative path","/"!==y&&"\\"!==y)continue;break;case"relative path":if(y!==d&&"/"!==y&&"\\"!==y&&(a||"?"!==y&&"#"!==y))"\t"!==y&&"\n"!==y&&"\r"!==y&&(v+=r(y));else{"\\"===y&&c("\\ not allowed in relative path.");var k;(k=f[v.toLowerCase()])&&(v=k),".."===v?(this._path.pop(),"/"!==y&&"\\"!==y&&this._path.push("")):"."===v&&"/"!==y&&"\\"!==y?this._path.push(""):"."!==v&&("file"===this._scheme&&0===this._path.length&&2===v.length&&g.test(v[0])&&"|"===v[1]&&(v=v[0]+":"),this._path.push(v)),v="","?"===y?(this._query="?",h="query"):"#"===y&&(this._fragment="#",h="fragment")}break;case"query":a||"#"!==y?y!==d&&"\t"!==y&&"\n"!==y&&"\r"!==y&&(this._query+=s(y)):(this._fragment="#",h="fragment");break;case"fragment":y!==d&&"\t"!==y&&"\n"!==y&&"\r"!==y&&(this._fragment+=y)}l++}}function o(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function c(t,e){void 0===e||e instanceof c||(e=new c(String(e))),this._url=t,o.call(this);var i=t.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");a.call(this,i,null,e)}var h=!1;try{if("function"==typeof URL&&"object"==typeof URL.prototype&&"origin"in URL.prototype){var l=new URL("b","http://a");l.pathname="c%20d",h="http://a/c%20d"===l.href}}catch(t){}if(!h){var u=Object.create(null);u.ftp=21,u.file=0,u.gopher=70,u.http=80,u.https=443,u.ws=80,u.wss=443;var f=Object.create(null);f["%2e"]=".",f[".%2e"]="..",f["%2e."]="..",f["%2e%2e"]="..";var d,g=/[a-zA-Z]/,p=/[a-zA-Z0-9\+\-\.]/;c.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var t="";return""===this._username&&null===this._password||(t=this._username+(null!==this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+t+this.host:"")+this.pathname+this._query+this._fragment},set href(t){o.call(this),a.call(this,t)},get protocol(){return this._scheme+":"},set protocol(t){this._isInvalid||a.call(this,t+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(t){!this._isInvalid&&this._isRelative&&a.call(this,t,"host")},get hostname(){return this._host},set hostname(t){!this._isInvalid&&this._isRelative&&a.call(this,t,"hostname")},get port(){return this._port},set port(t){!this._isInvalid&&this._isRelative&&a.call(this,t,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(t){!this._isInvalid&&this._isRelative&&(this._path=[],a.call(this,t,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"===this._query?"":this._query},set search(t){!this._isInvalid&&this._isRelative&&(this._query="?","?"===t[0]&&(t=t.slice(1)),a.call(this,t,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"===this._fragment?"":this._fragment},set hash(t){this._isInvalid||(this._fragment="#","#"===t[0]&&(t=t.slice(1)),a.call(this,t,"fragment"))},get origin(){var t;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null"}return(t=this.host)?this._scheme+"://"+t:""}};var v=e.URL;v&&(c.createObjectURL=function(t){return v.createObjectURL.apply(v,arguments)},c.revokeObjectURL=function(t){v.revokeObjectURL(t)}),e.URL=c}}()}}).call(e,i(6))},function(t,e,i){"use strict";var n=i(0),r=i(9),s=i(3),a=i(5),o=i(2),c=i(1),h=i(4);e.PDFJS=r.PDFJS,e.build=s.build,e.version=s.version,e.getDocument=s.getDocument,e.PDFDataRangeTransport=s.PDFDataRangeTransport,e.PDFWorker=s.PDFWorker,e.renderTextLayer=a.renderTextLayer,e.AnnotationLayer=o.AnnotationLayer,e.CustomStyle=c.CustomStyle,e.createPromiseCapability=n.createPromiseCapability,e.PasswordResponses=n.PasswordResponses,e.InvalidPDFException=n.InvalidPDFException,e.MissingPDFException=n.MissingPDFException,e.SVGGraphics=h.SVGGraphics,e.UnexpectedResponseException=n.UnexpectedResponseException,e.OPS=n.OPS,e.UNSUPPORTED_FEATURES=n.UNSUPPORTED_FEATURES,e.isValidUrl=c.isValidUrl,e.createValidAbsoluteUrl=n.createValidAbsoluteUrl,e.createObjectURL=n.createObjectURL,e.removeNullCharacters=n.removeNullCharacters,e.shadow=n.shadow,e.createBlob=n.createBlob,e.RenderingCancelledException=c.RenderingCancelledException,e.getFilenameFromUrl=c.getFilenameFromUrl,e.addLinkAttributes=c.addLinkAttributes}])}),ReImg={OutputProcessor:function(t,e){var i=function(){return 0===t.indexOf("data:image/png")},n=function(t,e){var i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click()};return{toBase64:function(){return t},toImg:function(){var e=document.createElement("img");return e.src=t,e},toCanvas:function(t){var i=document.createElement("canvas"),n=e.getBoundingClientRect();i.width=n.width,i.height=n.height;var r=i.getContext("2d"),s=this.toImg();s.onload=function(){r.drawImage(s,0,0),t(i)}},toPng:function(){if(i()){var e=document.createElement("img");return e.src=t,e}this.toCanvas(function(t){var e=document.createElement("img");return e.src=t.toDataURL(),e})},toJpeg:function(t){!function(t){this.toCanvas(function(e){var i=document.createElement("img");return i.src=e.toDataURL("image/jpeg",t),i})}(t=t||1)},downloadPng:function(e){e=e||"image.png",i()?n(t,e):this.toCanvas(function(t){n(t.toDataURL(),e)})}}},fromSvg:function(t){var e=(new XMLSerializer).serializeToString(t);return new this.OutputProcessor("data:image/svg+xml;base64,"+window.btoa(e),t)},fromCanvas:function(t){var e=t.toDataURL();return new this.OutputProcessor(e)}},"object"==typeof exports&&void 0!==typeof module?module.exports={ReImg:ReImg}:window.ReImg=ReImg,PDFJS.workerSrc="https://www.donga.fr/area/js/build/pdf.worker.js",$(document).ready(function(){function t(){setTimeout(e,5e3)}function e(){$(".one, .two").toggle(),setTimeout(function(){$(".one, .two").toggle(),t()},5e3)}t(),window.addEventListener("resize",resizeCanvas,!1),$("#myCanvas").click(function(t){for(var e=0;e<legendes.length;e++)legendes[e].remove();legendes=[],$("input").blur()}),createEchelle(),$(".btn-close-modal").click(function(t){t.preventDefault(),$("#modal_container").hide()}),$(".btn-close-modal-plan").click(function(t){t.preventDefault(),canvas.remove(canvas.getActiveObject()),$(".step-setup-plan").hide(),$(".step-plan-is-setup").hide(),$(".step-no-plan").show(),bringToFront("canvas-draw");var e=$("#imageLoader");e.wrap("<form>").closest("form").get(0).reset(),e.unwrap(),$("#modal_container_pdf").hide()}),$(".modal_pdf_pagination ul").on("click","li",function(t){t.preventDefault(),loadSpecificPdfPage($(this).text()),$("#modal_container_pdf").hide()}),$("#form-new-size").submit(function(t){return $("#new_size_input").val()>0&&resizeLineLength($("#new_size_input").val()),$("#modal_container").hide(),!1}),$("#form-change-echelle").submit(function(t){var e=(echelle.children[4].position-echelle.children[5].position).length.toFixed(2),i=$("#ratio-input").val();ratio=i/e,updateEchelle();for(r=0;r<surfaces.length;r++)updateLabels(surfaces[r].path);for(var n=surfaces.length,r=0;r<n;r++)refreshAreas(calculateAreas(surfaces[r].path),surfaces[r].path);return updateTotalSurfaceCount(),!1})}),$("#download-canvas").click(function(t){t.preventDefault(),$.each(surfaces,function(t,e){var i=new PointText(surfaces[t].path.position),n=new PointText(surfaces[t].path.position);legendes.push(i),legendes.push(n),n.content=i.content=$("span."+surfaces[t].name).text()+" m²",n.justification=i.justification="center",n.color="black",i.color="white",n.fontWeight=i.fontWeight="bold",n.fontSize=i.fontSize=20,i.strokeWidth=5,i.strokeColor="white"});var e=new PointText(40,window.innerHeight-40),i=new PointText(40,window.innerHeight-40);i.content=e.content=$(".surface-totale").text(),i.justification=e.justification="left",i.color="black",i.color="white",i.fontWeight=e.fontWeight="bold",i.fontSize=e.fontSize=20,e.strokeWidth=5,e.strokeColor="white",legendes.push(e),legendes.push(i);setTimeout(function(){var t=document.getElementById("canvas-top-infos"),e=t.getContext("2d");e.canvas.width=window.innerWidth,e.canvas.height=window.innerHeight,e.fillStyle="#ffffff",e.fillRect(0,0,window.innerWidth,window.innerHeight);var i=document.getElementById("canvas-plan"),n=document.getElementById("myCanvas"),r=t.getContext("2d");r.drawImage(i,0,0),r.drawImage(n,0,0),drawing=new Image,drawing.src="img/logo-donga.png",drawing.onload=function(){r.drawImage(drawing,window.innerWidth/2-100,window.innerHeight-80),ReImg.fromCanvas(document.getElementById("canvas-top-infos")).downloadPng()}},1e3)}),fabric.Object.prototype.set({transparentCorners:!1,borderColor:"#ff00ff",cornerColor:"#ff0000"}),$(".add-surface").click(function(t){t.preventDefault(),addSurface()});var surfaces=[],tempTriangles=[],trianglesGroup=new Group,legendes=[],delayedTrianglesDestruction,classSelectedItem="",shapeIsChanged=!1,debug=!1,ratio=1,iTri=3,point_echelle_left=new Point(0,50),point_echelle_right=new Point(500,50),echelle_handle_radius=5,echelle=new Group;echelle.name="echelle",echelle.data.type="group";var labels={},colors=["#c39a6b","#f05a28","#27a9e1","#a99dcb","#6ba3d1","#8ea35f","#e9ca5d","#de9a32","#d33728","#851c45","#c5447b","#3258a6","#8ac3c9","#519265","#a8c762","#ba723e","#854c27","#253271"],colorIndex=0,point_TL=new Point(50,50),point_TR=new Point(200,50),point_BR=new Point(200,200),point_BL=new Point(50,200),selectedElements=[],selectedElement,selectedSurfaceThroughLabel,latestSelectedElementName="",globalScopeElement,labelOffset=30,cursorDown=!1,hitOptions={segments:!0,stroke:!0,fill:!0,tolerance:10},segment,path,movePath=!1,labelDoubleClicked,labelPointA,labelPointB,handle_extension_ratio=10,fabricObject;paper.settings.handleSize=12;var lastRotationLeftHandle=0,lastRotationRightHandle=0,Surface=Base.extend({initialize:function(t){Base.call(this);var e=300*Math.random();return this.path=new Path,this.nom=this.name=t,this.path.name=t,this.taille=20,this.path.add(point_TL+e),this.path.add(point_TR+e),this.path.add(point_BR+e),this.path.add(point_BL+e),this.path.closed=!0,this.path.fillColor=colors[colorIndex],this.path.fillColor.alpha=.5,this.path.isDraggable=!0,colorIndex++,this.path.strokeColor="black",this.path.dashArray=[4,10],this.path.strokeWidth=3,this.path.strokeCap="round",this.path.attach("mousemove",function(t){if(!cursorDown){var e=project.hitTest(t.point,hitOptions);switch(e.type){case"segment":$("#myCanvas").css("cursor","pointer"),e.segment.selected=!0;break;case"stroke":$("#myCanvas").css("cursor","copy");break;case"fill":$("#myCanvas").css("cursor","move");break;default:$("#myCanvas").css("cursor","default")}}}),this.path.attach("mousedrag",function(t){segment?(segment.point=t.point,shapeIsChanged=!0,updateLabels(t.target)):path&&(shapeIsChanged=!1,path.position+=t.delta,updateLabels(t.target))}),this.path.attach("mouseenter",function(t){cursorDown||(t.target.selected=!0),$.each($(".surface-box"),function(){$(this).removeClass("selectedSurface")}),$("#surface-list").find(".surface-box."+this.name).addClass("selectedSurface")}),this.path.attach("mouseleave",function(t){cursorDown||(t.target.selected=!1,$.each($(".surface-box"),function(){$(this).removeClass("selectedSurface")})),$("#myCanvas").css("cursor","default")}),this.path.attach("mousedown",function(t){if(!cursorDown){selectedElement=t.target;var e=project.hitTest(t.point,hitOptions);if("segment"==e.type){if(t.modifiers.shift)return e.segment.remove(),recreateLabels(t.target,t.target.name),shapeIsChanged=!0,refreshAreas(calculateAreas(t.target),t.target),void updateTotalSurfaceCount();segment=e.segment}else if("stroke"==e.type){var i=e.location;segment=t.target.insert(i.index+1,t.point),shapeIsChanged=!0,recreateLabels(t.target,t.target.name)}else"fill"==e.type&&(path=e.item)}cursorDown=!0}),this.path.attach("mouseup",function(t){cursorDown=!1,segment&&(segment.selected=!1),segment=path=null,refreshAreas(calculateAreas(t.target),t.target),updateTotalSurfaceCount()}),this},destroy:function(){this.path.remove()}}),canvas=new fabric.Canvas("canvas-plan"),canvas_pdf=document.getElementById("canvas_pdf");resizeCanvas();var pdfObj;document.getElementById("imageLoader").addEventListener("change",function(t){bringToFront("canvas-plan");var e=t.target.files[0];if("application/pdf"==e.type)(i=new FileReader).onload=function(t){var e=new Uint8Array(this.result);PDFJS.getDocument(e).then(function(t){pdfObj=t;var e=t.numPages;if(e>1){$("#modal_container_pdf").show(),$(".modal_pdf_pagination ul").html("");for(var i=0;i<e;i++){var n=i+1;$(".modal_pdf_pagination ul").append("<li>"+n+"</li>")}}else t.getPage(1).then(function(t){var e=t.getViewport(1.5),i=canvas_pdf.getContext("2d");canvas_pdf.height=e.height,canvas_pdf.width=e.width;var n={canvasContext:i,viewport:e};t.render(n).promise.then(function(){fabric.Image.fromURL(canvas_pdf.toDataURL(),function(t){var e=1;t.height>canvas_pdf.height&&(e=canvas_pdf.height/t.height),t.width*e>canvas_pdf.width&&(e=canvas_pdf.width/t.width),e-=.2;var i=t.set({left:canvas.width/2,top:canvas.height/2,angle:0,width:t.width,height:t.height,originX:"center",originY:"center",centeredScaling:!0}).scale(e);canvas.add(i).renderAll();canvas.setActiveObject(i),canvas.toDataURL({format:"png",quality:.8})}),i.clearRect(0,0,canvas.width,canvas.height)})})})},i.readAsArrayBuffer(e),$(".step-no-plan").hide(),$(".step-setup-plan").show();else{var i=new FileReader;i.onload=function(t){var e=t.target.result;fabric.Image.fromURL(e,function(t){var e=1;t.height>canvas.height&&(e=canvas.height/t.height),t.width*e>canvas.width&&(e=canvas.width/t.width),e-=.2;var i=t.set({left:canvas.width/2,top:canvas.height/2,angle:0,width:t.width,height:t.height,originX:"center",originY:"center",centeredScaling:!0}).scale(e);canvas.add(i).renderAll();canvas.setActiveObject(i),canvas.toDataURL({format:"png",quality:.8})})},i.readAsDataURL(e),$(".step-no-plan").hide(),$(".step-setup-plan").show()}}),$(".delete-image").click(function(t){canvas.remove(canvas.getActiveObject()),$(".step-setup-plan").hide(),$(".step-plan-is-setup").hide(),$(".step-no-plan").show(),bringToFront("canvas-draw");var e=$("#imageLoader");e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()}),$("#accept-image").click(function(t){bringToFront("canvas-draw"),$(".step-setup-plan").hide(),$(".step-plan-is-setup").show(),canvas_pdf.getContext("2d").clearRect(0,0,canvas_pdf.width,canvas_pdf.height)}),$("#modify-image").click(function(t){bringToFront("canvas-plan"),$(".step-plan-is-setup").hide(),$(".step-setup-plan").show()}),$("#ratio-input").keypress(function(t){var e=$(this);46==t.which&&-1==e.val().indexOf(".")||!(t.which<48||t.which>57)||0==t.which||8==t.which||t.preventDefault();var i=$(this).val();46==t.which&&-1==i.indexOf(".")&&setTimeout(function(){e.val().substring(e.val().indexOf(".")).length>3&&e.val(e.val().substring(0,e.val().indexOf(".")+3))},1),-1!=i.indexOf(".")&&i.substring(i.indexOf(".")).length>2&&0!=t.which&&8!=t.which&&$(this)[0].selectionStart>=i.length-2&&t.preventDefault(),13==t.which&&$("#form-change-echelle").submit()}),$("#ratio-input").bind("paste",function(t){var e=t.originalEvent.clipboardData.getData("Text");$.isNumeric(e)?e.substring(e.indexOf(".")).length>3&&e.indexOf(".")>-1&&(t.preventDefault(),$(this).val(e.substring(0,e.indexOf(".")+3))):t.preventDefault()});